globals
//globals from BzAPI:
constant boolean LIBRARY_BzAPI=true
//endglobals from BzAPI
//globals from ConversionUtils:
constant boolean LIBRARY_ConversionUtils=true
//endglobals from ConversionUtils
//globals from DzAPI:
constant boolean LIBRARY_DzAPI=true
//endglobals from DzAPI
//globals from Geometry:
constant boolean LIBRARY_Geometry=true
//endglobals from Geometry
//globals from JBase:
constant boolean LIBRARY_JBase=true
//endglobals from JBase
//globals from Music:
constant boolean LIBRARY_Music=true
//endglobals from Music
//globals from PIVInterface:
constant boolean LIBRARY_PIVInterface=true
boolean array sPIV
//endglobals from PIVInterface
//globals from RegionUtils:
constant boolean LIBRARY_RegionUtils=true
//endglobals from RegionUtils
//globals from StringUtils:
constant boolean LIBRARY_StringUtils=true
string StringUtils___temp
//endglobals from StringUtils
//globals from UnitFilter:
constant boolean LIBRARY_UnitFilter=true
//endglobals from UnitFilter
//globals from YDLua:
constant boolean LIBRARY_YDLua=true
//endglobals from YDLua
//globals from YDTriggerSaveLoadSystem:
constant boolean LIBRARY_YDTriggerSaveLoadSystem=true
hashtable YDHT
hashtable YDLOC
//endglobals from YDTriggerSaveLoadSystem
//globals from YDWEBase:
constant boolean LIBRARY_YDWEBase=true
//ȫ�ֹ�ϣ�� 
hashtable YDHT= null
string bj_AllString=".................................!.#$%&'()*+,-./0123456789:;<=>.@ABCDEFGHIJKLMNOPQRSTUVWXYZ[.]^_`abcdefghijklmnopqrstuvwxyz{|}~................................................................................................................................"
//全局系统变量
unit bj_lastAbilityCastingUnit=null
unit bj_lastAbilityTargetUnit=null
unit bj_lastPoolAbstractedUnit=null
unitpool bj_lastCreatedUnitPool=null
item bj_lastPoolAbstractedItem=null
itempool bj_lastCreatedItemPool=null
attacktype bj_lastSetAttackType= ATTACK_TYPE_NORMAL
damagetype bj_lastSetDamageType= DAMAGE_TYPE_NORMAL
weapontype bj_lastSetWeaponType= WEAPON_TYPE_WHOKNOWS
real yd_MapMaxX= 0
real yd_MapMinX= 0
real yd_MapMaxY= 0
real yd_MapMinY= 0
string array YDWEBase___yd_PlayerColor
trigger array YDWEBase___AbilityCastingOverEventQueue
integer array YDWEBase___AbilityCastingOverEventType
integer YDWEBase___AbilityCastingOverEventNumber= 0
//endglobals from YDWEBase
//globals from YDWEGetForceOfPlayerNull:
constant boolean LIBRARY_YDWEGetForceOfPlayerNull=true
force yd_NullTempForce
//endglobals from YDWEGetForceOfPlayerNull
//globals from YDWEGetItemOfTypeFromUnitBJNull:
constant boolean LIBRARY_YDWEGetItemOfTypeFromUnitBJNull=true
item yd_NullTempItem
//endglobals from YDWEGetItemOfTypeFromUnitBJNull
//globals from YDWEGetUnitsInRectMatchingNull:
constant boolean LIBRARY_YDWEGetUnitsInRectMatchingNull=true
//endglobals from YDWEGetUnitsInRectMatchingNull
//globals from YDWEGetUnitsOfPlayerAndTypeIdNull:
constant boolean LIBRARY_YDWEGetUnitsOfPlayerAndTypeIdNull=true
//endglobals from YDWEGetUnitsOfPlayerAndTypeIdNull
//globals from YDWEGetUnitsOfPlayerMatchingNull:
constant boolean LIBRARY_YDWEGetUnitsOfPlayerMatchingNull=true
group yd_NullTempGroup
//endglobals from YDWEGetUnitsOfPlayerMatchingNull
//globals from YDWEGetUnitsOfTypeIdAllNull:
constant boolean LIBRARY_YDWEGetUnitsOfTypeIdAllNull=true
//endglobals from YDWEGetUnitsOfTypeIdAllNull
//globals from YDWEMultiboardSetItemValueBJNull:
constant boolean LIBRARY_YDWEMultiboardSetItemValueBJNull=true
//endglobals from YDWEMultiboardSetItemValueBJNull
//globals from YDWEPolledWaitNull:
constant boolean LIBRARY_YDWEPolledWaitNull=true
//endglobals from YDWEPolledWaitNull
//globals from YDWETriggerEvent:
constant boolean LIBRARY_YDWETriggerEvent=true
trigger yd_DamageEventTrigger= null
constant integer YDWETriggerEvent___DAMAGE_EVENT_SWAP_TIMEOUT= 20
constant boolean YDWETriggerEvent___DAMAGE_EVENT_SWAP_ENABLE= true
trigger YDWETriggerEvent___yd_DamageEventTriggerToDestory= null
trigger array YDWETriggerEvent___DamageEventQueue
integer YDWETriggerEvent___DamageEventNumber= 0
item bj_lastMovedItemInItemSlot= null
trigger YDWETriggerEvent___MoveItemEventTrigger= null
trigger array YDWETriggerEvent___MoveItemEventQueue
integer YDWETriggerEvent___MoveItemEventNumber= 0
//endglobals from YDWETriggerEvent
//globals from YDWETriggerRegisterEnterRectSimpleNull:
constant boolean LIBRARY_YDWETriggerRegisterEnterRectSimpleNull=true
//endglobals from YDWETriggerRegisterEnterRectSimpleNull
//globals from YDWETriggerRegisterLeaveRectSimpleNull:
constant boolean LIBRARY_YDWETriggerRegisterLeaveRectSimpleNull=true
region yd_NullTempRegion
//endglobals from YDWETriggerRegisterLeaveRectSimpleNull
//globals from YDWEUnitHasItemOfTypeBJNull:
constant boolean LIBRARY_YDWEUnitHasItemOfTypeBJNull=true
//endglobals from YDWEUnitHasItemOfTypeBJNull
//globals from Constant:
constant boolean LIBRARY_Constant=true
string diffculty= ""
string SgameMode= ""
		
constant integer HERO_COUNT= 20
		
constant boolean Huodong= false
		
constant integer PAGE_ACHIEVE= 11
constant integer PAGE_HERO_CHALLANGER= 3
		
integer renshu= 0
		
integer mode= 0
constant integer COUNT_WANJIE= 6
integer Constant___WPointer= 1
		//星胧的标志位
boolean BSpinXinglong= false
//endglobals from Constant
//globals from GroupUtils:
constant boolean LIBRARY_GroupUtils=true
group GroupUtils___tempG=null
unit GroupUtils___tempU=null
//endglobals from GroupUtils
//globals from Logger:
constant boolean LIBRARY_Logger=true
integer logger_level=0
string logger_msg=null
player logger_p=null
trigger logger_tr=null
//endglobals from Logger
//globals from YDWEAroundSystem:
constant boolean LIBRARY_YDWEAroundSystem=true
constant timer YDWEAroundSystem___AROUND_TIM= CreateTimer()
constant real YDWEAroundSystem___AROUND_INTER= 0.01
//endglobals from YDWEAroundSystem
//globals from YDWESetGuard:
constant boolean LIBRARY_YDWESetGuard=true
//endglobals from YDWESetGuard
//globals from YDWETimerPattern:
constant boolean LIBRARY_YDWETimerPattern=true
boolexpr YDWETimerPattern___Bexpr= null
rect YDWETimerPattern___Area= null
integer YDWETimerPattern___tmp_data
location YDWETimerPattern___yd_loc= Location(0.0, 0.0)
//endglobals from YDWETimerPattern
//globals from YDWETimerSystem:
constant boolean LIBRARY_YDWETimerSystem=true
integer YDWETimerSystem___CurrentTime
integer YDWETimerSystem___CurrentIndex
integer YDWETimerSystem___TaskListHead
integer YDWETimerSystem___TaskListIdleHead
integer YDWETimerSystem___TaskListIdleMax
integer array YDWETimerSystem___TaskListIdle
integer array YDWETimerSystem___TaskListNext
integer array YDWETimerSystem___TaskListTime
trigger array YDWETimerSystem___TaskListProc
trigger YDWETimerSystem___fnRemoveUnit
trigger YDWETimerSystem___fnDestroyTimer
trigger YDWETimerSystem___fnRemoveItem
trigger YDWETimerSystem___fnDestroyEffect
trigger YDWETimerSystem___fnDestroyLightning
trigger YDWETimerSystem___fnRunTrigger
timer YDWETimerSystem___Timer
integer YDWETimerSystem___TimerHandle
integer YDWETimerSystem___TimerSystem_RunIndex= 0
//endglobals from YDWETimerSystem
//globals from DamageUtils:
constant boolean LIBRARY_DamageUtils=true
//endglobals from DamageUtils
//globals from LHBase:
constant boolean LIBRARY_LHBase=true
unit learnSkillHero= null
        
unit array UDepot
string array playerName
        
boolean array BMoshou
        
unit Uwanjie= null
hashtable itemTable= InitHashtable()
hashtable LHTable= InitHashtable()
hashtable spellTable= InitHashtable()
        
unit kaisa= null
unit yanmie= null
unit moqi= null
unit lingxue= null
unit bajue= null
unit seyu= null
unit xiaoyue= null
unit xuanxue= null
unit chenji= null
unit hanshang= null
unit taiya= null
unit sheyan= null
unit Heiyan= null
unit cangling= null
unit mengji= null
unit Huanyi= null
unit sichen= null
unit xinglong= null
unit xiaoting= null
unit lichi= null
        
boolean array BJuexing1
boolean array BJuexing2
boolean array BJuexing3
        //是否变色
timer array TBianse
        //是否正在禁用天赋
boolean BTianfu= false
boolean array BYeguaiFirst
        //是否显示伤害
boolean array BHideDamage
        //是否可以跳关
        //boolean BSkipKuilei = false
        //英雄死了
boolean array BHeroDeath
        //轮流玩家指针
integer INextPlayerID= 0
        //京剧
boolean JJ1= false
boolean JJ2= false
boolean JJ3= false
boolean JJ4= false
item array IBibo
        //仓库改称号
boolean array BBoxName
boolean BBuqian1= false
boolean BBuqian2= false
boolean BBuqian3= false
        //英雄是否3秒复活
boolean array B3SecondRevive
//endglobals from LHBase
//globals from Attr:
constant boolean LIBRARY_Attr=true
integer array IStr
integer array IAgi
integer array IInt
//endglobals from Attr
//globals from ChallangerDZ:
constant boolean LIBRARY_ChallangerDZ=true
constant integer COUNT_CHALLANGER= 7
string array easyCString
string array middleCString
string array hardCString
		//挑战难度
integer CDiff= 0
		//挑战类型
integer CType= 0
		//判断是否读取成功
boolean array Bdudang
string array Greward2
//endglobals from ChallangerDZ
//globals from Exercise:
constant boolean LIBRARY_Exercise=true
rect array regionAll
		//怪物的区域
rect array regionM1
rect array regionM2
rect array regionM3
rect array regionM4
rect array regionM5
rect array regionM6
timer array Exercise__TiExercise
//endglobals from Exercise
//globals from Printer:
constant boolean LIBRARY_Printer=true
//endglobals from Printer
//globals from SpellBase:
constant boolean LIBRARY_SpellBase=true
constant integer kUImmuteDamage=8
//endglobals from SpellBase
//globals from Structs:
constant boolean LIBRARY_Structs=true
//endglobals from Structs
//globals from TouristTrap:
constant boolean LIBRARY_TouristTrap=true
		
boolean array HasCombineHalf
//endglobals from TouristTrap
//globals from UseItem:
constant boolean LIBRARY_UseItem=true
//endglobals from UseItem
//globals from Wing:
constant boolean LIBRARY_Wing=true
constant integer kWingDialog1=10
constant integer kWingDialog2=12
constant integer kWingDialog3=14
constant integer kWingDialog4=16
constant integer kWingDialog5=18
constant integer kWingDialog6=20
constant integer kWingUnit=22
//endglobals from Wing
//globals from Achievement:
constant boolean LIBRARY_Achievement=true
integer array achiPage
integer array achieve
integer array achieve2
integer array achieve3
integer array achieve4
effect array achiEff
		
integer array spin
integer array spin2
integer array spin3
string array heroCountString
		//倾雪寒晶
integer array Greward
//endglobals from Achievement
//globals from Aura:
constant boolean LIBRARY_Aura=true
integer array Aura___YKillCount
trigger Aura___TSpellYanmie3= null
trigger Aura___TSpellMengji3= null
		
boolean array Aura___shunHints
//endglobals from Aura
//globals from ItemAttr:
constant boolean LIBRARY_ItemAttr=true
//endglobals from ItemAttr
//globals from Mirror:
constant boolean LIBRARY_Mirror=true
timer TiMirror
timerdialog TiDiaMirror
//endglobals from Mirror
//globals from Shen:
constant boolean LIBRARY_Shen=true
//endglobals from Shen
//globals from Fanzhuan:
constant boolean LIBRARY_Fanzhuan=true
integer array diyu
string array SFanzhaun
//endglobals from Fanzhuan
//globals from Huodong:
constant boolean LIBRARY_Huodong=true
integer IKuanghuan= 0
//endglobals from Huodong
//globals from Jizi:
constant boolean LIBRARY_Jizi=true
//endglobals from Jizi
//globals from Mengji:
constant boolean LIBRARY_Mengji=true
integer Mengji___ITianhong= 0
real Mengji___HuanmengX= 0.
real Mengji___HuanmengY= 0.
		
trigger Mengji___TSpellMengji= null
trigger Mengji___TSpellMengji01= null
trigger Mengji___TSpellMengji02= null
trigger Mengji___TSpellMengji03= null
trigger Mengji___TSpellMengji2= null
trigger Mengji___TSpellMengji41= null
trigger Mengji___TSpellMengji42= null
		
item Mengji___Liutao= null
item Mengji___Nihe= null
		
unit Mengji___ULinglong1= null
unit Mengji___ULinglong2= null
lightning array Mengji___LLinglong
//endglobals from Mengji
//globals from Qixi:
constant boolean LIBRARY_Qixi=true
//endglobals from Qixi
//globals from ChallangerMode:
constant boolean LIBRARY_ChallangerMode=true
integer EquipLoopingTime= 1
group GJingxiang= null
//endglobals from ChallangerMode
//globals from Diffculty:
constant boolean LIBRARY_Diffculty=true
		
integer NanDiff= 0
unit UWanjieGuanghuan= null
boolean IsTianyan= false
//endglobals from Diffculty
//globals from Battle:
constant boolean LIBRARY_Battle=true
boolean array BSkip
//endglobals from Battle
//globals from ItemBase:
constant boolean LIBRARY_ItemBase=true
timerdialog TiDiaNecklace
unit UCrainax
boolean array BRing
//endglobals from ItemBase
//globals from Jungle:
constant boolean LIBRARY_Jungle=true
unit UYeYang= null
unit UYeYin= null
//endglobals from Jungle
//globals from LHOther:
constant boolean LIBRARY_LHOther=true
//endglobals from LHOther
//globals from Beast:
constant boolean LIBRARY_Beast=true
		
constant integer Beast__kU=24
constant integer Beast__kr=26
constant integer Beast__kg=28
constant integer Beast__kb=30
constant integer Beast__ksr=32
constant integer Beast__ksg=34
constant integer Beast__ksb=36
constant integer Beast__kBeastItem=38
		
unit array Unit_Beast
constant integer DAMAGE_BEAST_00= 30000
constant integer DAMAGE_BEAST_01= 160000
constant integer DAMAGE_BEAST_02= 1000000
constant integer DAMAGE_BEAST_03= 2600000
constant integer DAMAGE_BEAST_04= 7000000
constant integer DAMAGE_BEAST_05= 16000000
constant integer DAMAGE_BEAST_06= 40000000
constant integer DAMAGE_BEAST_07= 80000000
constant integer DAMAGE_BEAST_08= 120000000
constant integer DAMAGE_BEAST_09= 200000000
constant integer DAMAGE_BEAST_10= 400000000
constant integer DAMAGE_BEAST_11= 200000000
constant integer DAMAGE_BEAST_12= 600000000
constant integer DAMAGE_BEAST_13= 400000000
		
constant integer CHARGES_BEAST= 100
//endglobals from Beast
//globals from Continous:
constant boolean LIBRARY_Continous=true
integer array IConDays
integer array ILastTime
constant integer TIMESTAMP_START= 1500998400
boolean array BWuxing
		//integer DzAPI_Map_GetGameStartTime() = 0
//endglobals from Continous
//globals from Purgatory:
constant boolean LIBRARY_Purgatory=true
//endglobals from Purgatory
//globals from SameItem:
constant boolean LIBRARY_SameItem=true
//endglobals from SameItem
//globals from Version:
constant boolean LIBRARY_Version=true
		//集字
string array SJizi
unit UChengjiu= null
integer array vipCode
		
integer array mingcha
		
integer array passTimes
		
integer array petTimes
		
constant integer kSaveHeroTimes=40
		
		
		
integer array deathCount
		
integer array killCount
		
boolean BBaseDamage= false
		
integer JunengCount= 0
		
integer array Idaixin
boolean BJiulun= false
boolean BHaojie= false
		//杀擂台十的英雄统计
integer array Ileishi
		//DIY名字
string array SDIY
		//没被碰到
boolean BShengming= false
		//签到指数
		//integer array IQiandao2
		//总数不存在20个
boolean BZongshu= false
		//箱子
string array SBoxWord
		//不说话的成就
boolean BSlince= false
//endglobals from Version
//globals from CenterBase:
constant boolean LIBRARY_CenterBase=true
trigger TCenterBaseDeath= null
//endglobals from CenterBase
//globals from Diamond:
constant boolean LIBRARY_Diamond=true
constant string DIAMOND_CANT_UPDATE= "|cFFFF66CC【消息】|r该宝石不能升级该物品。"
        
integer IAtleast1= 0
integer IAtleast2= 0
integer IAtleast3= 0
        
boolean array Diamond___BLuoshang1
boolean array Diamond___BLuoshang2
//endglobals from Diamond
//globals from GoldSystem:
constant boolean LIBRARY_GoldSystem=true
boolean array BGoldGongxiang
//endglobals from GoldSystem
//globals from MiJing:
constant boolean LIBRARY_MiJing=true
        //当前层数
integer IDeng= 0
        //显示当前层数的漂浮文字
texttag MiJing__TDeng= null
        //灯与进度显示器
unit MiJing__UDeng
texttag MiJing__TDengProcess
        //当前进度
integer MiJing__IProcess= 0
        //计时器
timer MiJing__TMijingJudge= null
timer MiJing__TMijingFlash= null
timer MiJing__TMijingBound= null
        //刷怪
integer MiJing__ITotalMonster= 0
group MiJing__GMijing= null
        //判断是否正在挑战
boolean MiJing__BMijingStart= false
trigger MiJing__TDengUnderAttacked= null
unit UMijingShangdian= null
        //秘境装备
item array MiJing__IMijing
        //夜袭使者的技能
trigger MiJing__TDeathKou= null
unit MiJing__yexi= null
//endglobals from MiJing
//globals from MiniGame:
constant boolean LIBRARY_MiniGame=true
timer MiniGame__TGame1= null
texttag MiniGame__TTGame1= null
integer array MiniGame__IGoldGame1
integer MiniGame__TTimeGame1= 0
group MiniGame__GGame1= null
		//中级挑战
timer MiniGame__TGame2= null
texttag MiniGame__TTGame2= null
integer array MiniGame__IGoldGame2
integer MiniGame__TTimeGame2= 0
group MiniGame__GGame2= null
unit MiniGame__UGame2= null
//endglobals from MiniGame
//globals from Multiboard:
constant boolean LIBRARY_Multiboard=true
integer array centerCredit
		
integer array Mdamage1
integer array Mdamage2
//endglobals from Multiboard
//globals from Pet:
constant boolean LIBRARY_Pet=true
group array GPet
//endglobals from Pet
//globals from Ring:
constant boolean LIBRARY_Ring=true
boolean array BHintRing
//endglobals from Ring
//globals from Spin:
constant boolean LIBRARY_Spin=true
boolean array BCancelSpin
//endglobals from Spin
//globals from Bajue:
constant boolean LIBRARY_Bajue=true
real Bajue__baseX
real Bajue__baseY
real Bajue__tempX
real Bajue__tempY
boolean Bajue__BFengshuang= false
boolean Bajue__BFengshuangStart= false
//endglobals from Bajue
//globals from Cangling:
constant boolean LIBRARY_Cangling=true
		
		
		//item array IBibo(放到了LHBase)
boolean Cangling__BiBo= false
trigger Cangling__TSpellCangling= null
trigger Cangling__TSpellCangling2= null
		
unit Cangling__UGuang= null
effect Cangling__EGuang= null
real Cangling__RGuang= 0.
integer Cangling__IGuang= 10
timer Cangling__TGuang= null
		
unit Cangling__UCangHuo= null
unit Cangling__UCangFeng= null
		
unit Cangling__UTanlang= null
		
boolean array Cangling__BWusuo
//endglobals from Cangling
//globals from Chenji:
constant boolean LIBRARY_Chenji=true
        
trigger Chenji__TSpellChenji4= null
real Chenji__RDamage= 0
integer Chenji__IYinduTimes= 0
//endglobals from Chenji
//globals from Hanshang:
constant boolean LIBRARY_Hanshang=true
boolean Hanshang__IsLianhuan= false
		
trigger Hanshang__TSpellHanshang= null
trigger Hanshang__TSpellHanshang2= null
trigger Hanshang__TSpellHanshang3= null
trigger Hanshang__TSpellHanshang4= null
		
real Hanshang__RLianjin= 0
real Hanshang__RLianjin2= 0
constant integer kLianhuanBoomX=42
constant integer kLianhuanBoomY=44
		
timer Hanshang__TDuwu= null
unit Hanshang__UDuwu= null
effect Hanshang__EffectDu= null
		
integer Hanshang__IJuexing= 0
		
integer Hanshang__ITotalEat= 0
		
integer Hanshang__ILianjinChi= 1
		//获得物品的数量
integer Hanshang__IDuxin= 0
trigger Hanshang__TDuxin= null
hashtable Hanshang__HTHS= null
//endglobals from Hanshang
//globals from Heiyan:
constant boolean LIBRARY_Heiyan=true
		
trigger Heiyan__TSpellHeiyan1= null
trigger Heiyan__TSpellHeiyan00= null
trigger Heiyan__TSpellHeiyan2= null
trigger Heiyan__TSpellHeiyan40= null
trigger Heiyan__TSpellHeiyan41= null
		
boolean Heiyan__BIsMojie= true
		
		
constant integer kUYanluo=46
		
unit Heiyan__UZangJiuTian= null
boolean Heiyan__IsDouble= false
		
integer Heiyan__ISacriMaxCount= 6
		
group Heiyan__GSacri= null
		
real Heiyan__DamageSacri= 0
		//成就死亡值
integer Heiyan__ISpinHeiyan= 0
//endglobals from Heiyan
//globals from Huanyi:
constant boolean LIBRARY_Huanyi=true
		
trigger Huanyi___TSpellHuanyi= null
		
real Huanyi___RDamageHuanyi= 0.
		
boolean Huanyi___IsFire= false
boolean Huanyi___IsWater= false
boolean Huanyi___IsLumber= false
boolean Huanyi___IsWind= false
integer ICurrentSpell= 0
		
integer Huanyi___IMoneng= 0
		
constant integer kNoneIntTimes=48
		
constant integer kUHuanyiQuan=50
		
constant integer kIGuCan=52
timer TGuCan= null
		
constant integer kHuanyuTimes=54
		
texttag Huanyi___TTMoneng
effect Huanyi___ELowMoneng= null
unit Huanyi___UGucan= null
		//开始挑战的计时器
timer TiHuanyiTiaozhan= null
timerdialog TiDiaHuanyiTiaozhan= null
integer HuanyiTiaozhanCount= 0
integer HuanyiTiaozhanCurrent= 0
integer HuanyiWrongTimes= 0
//endglobals from Huanyi
//globals from Kaisa:
constant boolean LIBRARY_Kaisa=true
trigger Kaisa__TSpellKaisa= null
integer Kaisa__INiuSpinCount= 0
boolean BFanzhuanKS= false
		//天地裂变
boolean BLiebian= false
timer Kaisa__TLiebian= null
integer Kaisa__ILiebian= 0
real Kaisa__RLiebianX= 0.
real Kaisa__RLiebianY= 0.
effect Kaisa__ELiebian= null
real Kaisa__RDistanceLiebian= 0.
integer Kaisa__TTBLiebian= 0
		//图腾
group Kaisa__GTuteng= null
//endglobals from Kaisa
//globals from Lichi:
constant boolean LIBRARY_Lichi=true
trigger Lichi___TSpellLichi= null
trigger Lichi___TSpellLichiDamage= null
trigger Lichi___TAttackLichi= null
		//伤害值
real Lichi___LichiDamage= 0
		//记录点
real Lichi___NiLiX= 0.
real Lichi___NiLiY= 0.
		//幻影
integer IMaxHuanying= 0
unit array Lichi___UHuan
		//幻影攻击目标
boolean Lichi___BHuanAttack= false
		//0是静止,1是移动,2是攻击
integer Lichi___ILichiDoing= 0
		//统计值
integer Lichi___IHuanyingCount= 0
		//第二个技能的冷却期
boolean Lichi___BTongyun= false
		//湮魂印连结效果
integer array Lichi___CYanhun
integer Iyanhun= 0
unit Uyanhun= null
		//神月缺的单位组
integer Lichi___IShenyue= 0
group array Lichi___GShenyue
boolean Lichi___BShenyue= false
		//囚天地
trigger Lichi___TSpellLichi51= null
trigger Lichi___TSpellLichi52= null
integer Lichi___IQiutian= 0
		//皮肤统计
integer Lichi___ISpinLichi= 0
//endglobals from Lichi
//globals from Lingxue:
constant boolean LIBRARY_Lingxue=true
//endglobals from Lingxue
//globals from MonsterSpell:
constant boolean LIBRARY_MonsterSpell=true
trigger TSpellQianfa
trigger TSpellDart
		
constant real DRAT_JUNENG= 30000000
constant real DRAT_XIANLIAN= 15000000
integer level_juneng= 1
integer JunengID= 0
//endglobals from MonsterSpell
//globals from Moqi:
constant boolean LIBRARY_Moqi=true
group Moqi___GMoqiXingxuan= null
boolean BFanzhuanMQ= false
trigger Moqi___TSpellMoqi= null
//endglobals from Moqi
//globals from Seyu:
constant boolean LIBRARY_Seyu=true
unit array chongdongs
unit array shashous
integer Seyu___chongCount= 2
		
texttag Seyu___TTPower= null
integer Seyu___IPower
		
real Seyu___RAddtion
		
trigger Seyu___TSpellSeyu= null
trigger Seyu___TSpellSeyu2= null
trigger Seyu___TSpellSeyu3= null
trigger Seyu___TSpellSeyuUpdate= null
trigger Seyu___TSpellChongdong= null
constant integer kAnShaCount=56
		
integer Seyu___ItempPower= 0
texttag array Seyu___TTCD
//endglobals from Seyu
//globals from Sheyan:
constant boolean LIBRARY_Sheyan=true
boolean BSheyanBUG= FALSE
//endglobals from Sheyan
//globals from Shilian:
constant boolean LIBRARY_Shilian=true
unit UShilian= null
		//时间
integer array Shilian___IShilianTime
		//连结效果
integer array Shilian___CShilian
		//类型
integer array IShilianType
		//是否正在放
boolean array Shilian___BShilianing
		//计时器
timer array Shilian___TShilian
		//那个漂浮文字
integer array Shilian___TTBShilian
		//次数
integer array Shilian___IShilianTimes
		//试练提示对话框:第一次购买
boolean array Shilian___BFirstShilian1
		//试练提示对话框:第一次使用,提示关闭
boolean array Shilian___BFirstShilian2
boolean array BEscOnce
boolean array BEscTwice
		//单位组，传承试练
group Shilian___GShilian= null
		//试练玩家
player Shilian___PShilian= null
		//正在挑战的试练
integer Shilian___IContinousShilian= 0
		//正在进行传承的计时器
timer Shilian___TChuanchengRest=null
timerdialog Shilian___TDChuanchengRest=null
timer Shilian___TChuanchengJudge= null
		//字的触发
trigger Shilian___TZhe= null
trigger Shilian___TXing= null
		//吸怪的临
integer array Shilian___ALin
		//皆的数值中途值
integer array Shilian___IJie1
integer array Shilian___IJie2
		//前的分身
unit array Shilian___UQian
boolean array Shilian___BQian
integer array IKuanghuanType
integer array IQianAchievement
integer array IZheCountOnce
//endglobals from Shilian
//globals from Sichen:
constant boolean LIBRARY_Sichen=true
		//触发器
trigger Sichen__TSpellSichen= null
trigger Sichen__TSpellSichen2= null
trigger Sichen__TSpellSichen3= null
trigger Sichen__TSpellSichenDamage= null
trigger Sichen__TSpellSichenBuilding= null
trigger Sichen__TSpellSichenUpdate= null
		//塔的单位组
group Sichen__GTower= null
unit Sichen__UCili= null
real Sichen__SichenDamage= 0
//endglobals from Sichen
//globals from Taiya:
constant boolean LIBRARY_Taiya=true
integer Taiya__ITaiyamiao= 0
//endglobals from Taiya
//globals from Xiaoting:
constant boolean LIBRARY_Xiaoting=true
		
trigger Xiaoting___TSpellXiaoting= null
trigger Xiaoting___TAttackXT= null
		
real Xiaoting___RDamageXiaoting= 0.
		
integer ISpellState= 0
		
integer ICombo= 0
		
integer Xiaoting___IMaxCombo= 0
timer Xiaoting___TArrow= null
unit array Xiaoting___UArrow
group array Xiaoting___GArrow
		//整秒读数
integer Xiaoting___IZhengmiao= 0
		//反弹读秒
integer Xiaoting___IFantan= 0
		//绝焱读秒
integer Xiaoting___IJueyan= 0
		//静止布尔
boolean Xiaoting___BJingzhi= false
		//御箭
boolean Xiaoting___BYujian= false
		//Combo判断
timer Xiaoting___TComboAdd= null
		//两个科技(前者射出,后者未射出)
unit Xiaoting___UJianKeji1= null
unit Xiaoting___UJianKeji2= null
		
real Xiaoting___RAddtion= 0.
		//攻击保留特效
effect Xiaoting___EAttackXT= null
integer Xiaoting___IAttackAdd= 0
integer Xiaoting___ITimeAttackadd= 0
		//分裂时间
timer Xiaoting___TFenlie= null
		//大招持续
timer Xiaoting___TDazhao= null
		//衰减
boolean array Xiaoting___BShuaijian
//endglobals from Xiaoting
//globals from Xiaoyue:
constant boolean LIBRARY_Xiaoyue=true
integer Xiaoyue__IFuhuo
//endglobals from Xiaoyue
//globals from Xinglong:
constant boolean LIBRARY_Xinglong=true
trigger Xinglong___TSpellXinglong= null
trigger Xinglong___TSpellXinglongUpdate= null
trigger Xinglong___TSpellXinglongAttack= null
trigger Xinglong___TSpellXinglongDamage= null
		//是否已经变身
boolean Xinglong___BBianshen= false
		//伤害值
real Xinglong___XinglongDamage= 0
		//显示特效的flag
		//private boolean BEffUpdate = false
		//伤害的指示器
boolean Xinglong___BDamage= false
		//轮回加属性时间
integer Xinglong___BAttrTime= 0
		//待选光环数
integer IChooseAura= 0
		//当前吐息数
integer ITuxi= 0
		//龙皇轮回
real Xinglong___RLunhui= 0.
timer Xinglong___TLunhui= null
unit Xinglong___ULunhui= null
texttag Xinglong___TTLunhui= null
integer Xinglong___ILunhui= 0
		//皮肤自增值
integer Xinglong___ISpinValue= 1
//endglobals from Xinglong
//globals from Xuanxue:
constant boolean LIBRARY_Xuanxue=true
hashtable HTXX= null
integer Xuanxue__IQinru
//endglobals from Xuanxue
//globals from Yanmie:
constant boolean LIBRARY_Yanmie=true
group Yanmie__GShadow= null
constant integer ICountShadowMAX= 3
integer Yanmie__Ilingyu= 0
integer Yanmie__Ishuaxinyifu= 0
		//trigger
trigger Yanmie__TSpellYanmie2= null
trigger Yanmie__TSpellYanmie= null
		//雷神
real Yanmie__RYingyueX= 0.
real Yanmie__RYingyueY= 0.
timer Yanmie__TYingyue= null
unit Yanmie__UShijie= null
integer Yanmie__IYingyue= 0
boolean Yanmie__BYingyue= false
boolean BFanzhuanYM= false
		//轰鸣
real Yanmie__RHongmingX= 0.
real Yanmie__RHongmingY= 0.
timer Yanmie__THongming= null
//endglobals from Yanmie
//globals from HeroSpellBase:
constant boolean LIBRARY_HeroSpellBase=true
boolean array BTianting1
boolean array BTianting2
//endglobals from HeroSpellBase
//globals from Juexing:
constant boolean LIBRARY_Juexing=true
//endglobals from Juexing
//globals from Kuanghuan:
constant boolean LIBRARY_Kuanghuan=true
trigger Kuanghuan___TRedAttack= null
boolean array Kuanghuan___BKuanghuanRed
//endglobals from Kuanghuan
//globals from Revive:
constant boolean LIBRARY_Revive=true
//endglobals from Revive
//globals from Boss:
constant boolean LIBRARY_Boss=true
		
hashtable bossTable= null
trigger Boss___TSpellZuo= null
trigger Boss___TSpellYou= null
		
timer Boss___TiMissile= null
		//生命联结
timer TLifeConnect= null
lightning array Boss___LLifeConnect
unit UChuanzhang= null
unit UXiaoY= null
integer MLChuanzhang= 0
integer MLXiaoY= 0
		//落时提醒:
integer Boss___ILuoshi= 0
		//计时器
timer TiRenYao
timerdialog TiDiaRenYao
		//大肉棒的数量
integer IRoubang= 0
		//天赋禁用器
integer TFChuan= 0
		//肉棒指示器
timer TRBChuan= null
		//触发器-判断人妖死亡状态
trigger Boss___TDeathRenyao= null
		//生命联结解药
boolean BGongxiang= false
		//BOSS伤害统计
integer DTJ1= 0
integer DTJ2= 0
integer DTJ3= 0
		//鬼与仙
integer TShieldGhost= 0
integer TShieldAngle= 0
unit UGhost= null
unit UAngle= null
integer MLGhost= 0
integer MLAngle= 0
timer TiGhostAngle= null
timerdialog TiDiaGhostAngle= null
trigger TSpellGhost= null
timer TGhostShiye= null
timer TAngleQuestion= null
integer Boss___IGuangmang= 0
trigger TDeathGhostAngle= null
timer TGhostShiye2= null
integer IKongshen= 0
//endglobals from Boss
//globals from PIV:
constant boolean LIBRARY_PIV=true
boolean PIV___isFirst= true
hashtable PIV___PIVTable= InitHashtable()
constant integer kPIV=58
constant integer kPIVStr=60
constant integer kPIVPlayer=62
constant integer kPIVPointer=64
trigger T17Wan= null
	    //信哲
boolean BX1= false
boolean BX2= false
//endglobals from PIV
//globals from Arena:
constant boolean LIBRARY_Arena=true
constant integer ARENA_MAX_LEVEL= 50
		
trigger Arena___TDieEvent= null
		
trigger Arena___TSpellLinger= null
trigger Arena___TSpellZhousi= null
trigger Arena___TSpellXuemo1= null
trigger Arena___TSpellXuemo2= null
trigger Arena___TSpellWuxin= null
trigger Arena___TSpellFuwang= null
trigger Arena___TSpellMeidusha1= null
trigger Arena___TSpellMeidusha2= null
trigger Arena___TSpellKiller1= null
trigger Arena___TSpellKiller2= null
trigger Arena___TSpellJinxuan1= null
trigger Arena___TSpellJinxuan2= null
trigger Arena___TSpellJinxuan3= null
trigger Arena___TSpellJinxuan4= null
trigger Arena___TSpellYuansha= null
		
integer array Arena___currentArena
		
integer Arena___currentLevel= 1
		
unit Arena___challenager= null
		
unit Arena___defier= null
		
texttag Arena___textTag_Level= null
//endglobals from Arena
//globals from Box:
constant boolean LIBRARY_Box=true
integer array TTBBox
//endglobals from Box
//globals from CenterCredit:
constant boolean LIBRARY_CenterCredit=true
constant integer CenterCredit__CREDIT_SOLIDER_1= 2500
constant integer CenterCredit__CREDIT_SOLIDER_2= 5000
constant integer CenterCredit__CREDIT_SOLIDER_3= 8000
constant integer CenterCredit__CREDIT_SOLIDER_4= 15000
//endglobals from CenterCredit
//globals from Hundun:
constant boolean LIBRARY_Hundun=true
unit UHundun= null
integer MLHundun= 0
group GHundunDian= null
group GHundunAttack= null
timer THundunDian= null
trigger THundunSpellDamage= null
integer hundun1_level= 1
integer hundun2_level= 1
integer hundun_playerID= 0
		//混沌2
integer AHundun2= 0
integer TShieldHundun= 0
//endglobals from Hundun
//globals from RandomHero:
constant boolean LIBRARY_RandomHero=true
boolean array BSuiji
//endglobals from RandomHero
//globals from BaseVersion:
constant boolean LIBRARY_BaseVersion=true
boolean array BDIYName
		//获取仓库与皮肤
boolean BCangkuhuoqu= false
boolean BSpinhuoqu= false
integer ISpinachi= 0
//endglobals from BaseVersion
//globals from Combine:
constant boolean LIBRARY_Combine=true
//endglobals from Combine
//globals from ItemSpell:
constant boolean LIBRARY_ItemSpell=true
boolean array BYaoShuxing
//endglobals from ItemSpell
//globals from ChatCommand:
constant boolean LIBRARY_ChatCommand=true
item array ChatCommand__IBox
integer ChatCommand__IBoxSucceed= 0
integer ChatCommand__IBoxCount= 0
boolean array ChatCommand__BYincang
boolean BShengli= false
//endglobals from ChatCommand
//globals from Simulate:
constant boolean LIBRARY_Simulate=true
//endglobals from Simulate
    // Generated
rect gg_rct_Wave1= null
rect gg_rct_Wave2= null
rect gg_rct_Wave3= null
rect gg_rct_Wave4= null
rect gg_rct_Base= null
rect gg_rct_BaseBack= null
rect gg_rct_Home1= null
rect gg_rct_Home2= null
rect gg_rct_Home3= null
rect gg_rct_Home4= null
rect gg_rct_Fuben1= null
rect gg_rct_Fuben2= null
rect gg_rct_Fuben3= null
rect gg_rct_Fuben4= null
rect gg_rct_Fuben5= null
rect gg_rct_Fuben6= null
rect gg_rct_Fuben7= null
rect gg_rct_Fuben8= null
trigger gg_trg_______u= null
unit gg_unit_hcas_0011= null

trigger l__library_init

//JASSHelper struct globals:
constant integer si__music=1
sound array s__music_snd
constant integer si__triangleXY=2
real s__triangleXY_x=0.0
real s__triangleXY_y=0.0
constant integer si__YDWEAroundSystem___Data=3
integer si__YDWEAroundSystem___Data_F=0
integer si__YDWEAroundSystem___Data_I=0
integer array si__YDWEAroundSystem___Data_V
integer array s__YDWEAroundSystem___Data_Structs
integer s__YDWEAroundSystem___Data_Total= 0
unit array s__YDWEAroundSystem___Data_caster
unit array s__YDWEAroundSystem___Data_obj
real array s__YDWEAroundSystem___Data_dur
real array s__YDWEAroundSystem___Data_inter
real array s__YDWEAroundSystem___Data_each
real array s__YDWEAroundSystem___Data_rate
real array s__YDWEAroundSystem___Data_dis
real array s__YDWEAroundSystem___Data_rise
real array s__YDWEAroundSystem___Data_angle
real array s__YDWEAroundSystem___Data_radius
real array s__YDWEAroundSystem___Data_height
constant integer si__YDWETimerPattern___YDVector3=4
integer si__YDWETimerPattern___YDVector3_F=0
integer si__YDWETimerPattern___YDVector3_I=0
integer array si__YDWETimerPattern___YDVector3_V
real array s__YDWETimerPattern___YDVector3_x
real array s__YDWETimerPattern___YDVector3_y
real array s__YDWETimerPattern___YDVector3_z
constant integer si__YDWETimerPattern___Thread=5
integer si__YDWETimerPattern___Thread_F=0
integer si__YDWETimerPattern___Thread_I=0
integer array si__YDWETimerPattern___Thread_V
integer array s__YDWETimerPattern___Thread_des
integer array s__YDWETimerPattern___Thread_pos
integer array s__YDWETimerPattern___Thread_vel
unit array s__YDWETimerPattern___Thread_caster
unit array s__YDWETimerPattern___Thread_source
unit array s__YDWETimerPattern___Thread_target
unit array s__YDWETimerPattern___Thread_obj
real array s__YDWETimerPattern___Thread_ac
real array s__YDWETimerPattern___Thread_bc
real array s__YDWETimerPattern___Thread_dist
real array s__YDWETimerPattern___Thread_step
real array s__YDWETimerPattern___Thread_amount
real array s__YDWETimerPattern___Thread_radius
integer array s__YDWETimerPattern___Thread_switch
integer array s__YDWETimerPattern___Thread_follow
integer array s__YDWETimerPattern___Thread_unitid
integer array s__YDWETimerPattern___Thread_skills
integer array s__YDWETimerPattern___Thread_order
integer array s__YDWETimerPattern___Thread_level
string array s__YDWETimerPattern___Thread_dsfx
string array s__YDWETimerPattern___Thread_gsfx
string array s__YDWETimerPattern___Thread_wsfx
string array s__YDWETimerPattern___Thread_part
boolean array s__YDWETimerPattern___Thread_recycle
boolean array s__YDWETimerPattern___Thread_killdest
boolean array s__YDWETimerPattern___Thread_volume
group array s__YDWETimerPattern___Thread_g
timer array s__YDWETimerPattern___Thread_t
integer array s__YDWETimerPattern___Thread_afc
constant integer si__YDWETimerPattern___Parabola=6
constant integer si__YDWETimerPattern___Linear=7
constant integer si__YDWETimerPattern___Deceleration=8
constant integer si__DamageUtils___DmgP=9
integer si__DamageUtils___DmgP_F=0
integer si__DamageUtils___DmgP_I=0
integer array si__DamageUtils___DmgP_V
unit array s__DamageUtils___DmgP_source
string array s__DamageUtils___DmgP_eft
real array s__DamageUtils___DmgP_damage
boolean array s__DamageUtils___DmgP_isBj
constant integer si__DmgS=10
integer s__DmgS_top=- 1
constant integer si__OnlyAttackBase=11
integer si__OnlyAttackBase_F=0
integer si__OnlyAttackBase_I=0
integer array si__OnlyAttackBase_V
unit array s__OnlyAttackBase_u
timer array s__OnlyAttackBase_t
constant integer si__Connect=12
integer si__Connect_F=0
integer si__Connect_I=0
integer array si__Connect_V
boolean array s__Connect_BDie
unit array s__Connect_unit1
unit array s__Connect_unit2
lightning array s__Connect_l
timer array s__Connect_t
constant integer si__Attract=13
integer si__Attract_F=0
integer si__Attract_I=0
integer array si__Attract_V
unit array s__Attract_caster
real array s__Attract_radius
real array s__Attract_interval
real array s__Attract_speed
timer array s__Attract_t
boolean array s__Attract_forbitHero
boolean array s__Attract_deathContinue
constant integer si__Missile=14
integer si__Missile_F=0
integer si__Missile_I=0
integer array si__Missile_V
unit array s__Missile_caster
string array s__Missile_effx
real array s__Missile_radius
real array s__Missile_interval1
real array s__Missile_interval2
real array s__Missile_damage
real array s__Missile_x
real array s__Missile_y
timer array s__Missile_t
constant integer si__Questions=15
integer si__Questions_F=0
integer si__Questions_I=0
integer array si__Questions_V
player array s__Questions_p
integer array s__Questions_time
trigger array s__Questions_click
dialog array s__Questions_d
timer array s__Questions_t
integer array s__Questions_rightPos
string array s__Questions_question
integer array s__Questions_as
constant integer si__Roubang=16
integer si__Roubang_F=0
integer si__Roubang_I=0
integer array si__Roubang_V
unit array s___Roubang_URou
constant integer s___Roubang_URou_size=20
integer array s__Roubang_URou
real array s__Roubang_aSpeed
real array s__Roubang_cAngle
real array s__Roubang_radius
timer array s__Roubang_t
integer array s__Roubang_number
unit array s__Roubang_caster
constant integer si__MultiLife=18
integer si__MultiLife_F=0
integer si__MultiLife_I=0
integer array si__MultiLife_V
unit array s__MultiLife_caster
integer array s__MultiLife_times
integer array s__MultiLife_current
timer array s__MultiLife_t
texttag array s__MultiLife_ttHint
integer array s__MultiLife_al
constant integer si__SuperShield=19
integer si__SuperShield_F=0
integer si__SuperShield_I=0
integer array si__SuperShield_V
unit array s__SuperShield_caster
integer array s__SuperShield_times
integer array s__SuperShield_current
timer array s__SuperShield_t
boolean array s__SuperShield_deathContinue
constant integer si__TextTagBind=20
integer si__TextTagBind_F=0
integer si__TextTagBind_I=0
integer array si__TextTagBind_V
unit array s__TextTagBind_caster
texttag array s__TextTagBind_tt
real array s__TextTagBind_xOff
real array s__TextTagBind_yOff
real array s__TextTagBind_size
string array s__TextTagBind_content
timer array s__TextTagBind_t
constant integer si__Buff=21
integer si__Buff_F=0
integer si__Buff_I=0
integer array si__Buff_V
player array s__Buff_p
integer array s__Buff_ab
timer array s__Buff_t
constant integer si__JudgeInvu=22
integer si__JudgeInvu_F=0
integer si__JudgeInvu_I=0
integer array si__JudgeInvu_V
unit array s__JudgeInvu_u
timer array s__JudgeInvu_t
constant integer si__Boom=23
integer si__Boom_F=0
integer si__Boom_I=0
integer array si__Boom_V
unit array s__Boom_caster
timer array s__Boom_t
real array s__Boom_x
real array s__Boom_y
real array s__Boom_facing
real array s__Boom_damage
real array s__Boom_speed
real array s__Boom_radius
string array s__Boom_effx
constant integer si__TianfuForbidder=24
integer si__TianfuForbidder_F=0
integer si__TianfuForbidder_I=0
integer array si__TianfuForbidder_V
real array s__TianfuForbidder_IForbid
real array s__TianfuForbidder_IAllow
timer array s__TianfuForbidder_t
constant integer si__DamageTJ=25
integer si__DamageTJ_F=0
integer si__DamageTJ_I=0
integer array si__DamageTJ_V
real array s___DamageTJ_RTongji
constant integer s___DamageTJ_RTongji_size=7
integer array s__DamageTJ_RTongji
trigger array s__DamageTJ_t
unit array s__DamageTJ_monitor
integer array s__s__DmgS_stack
integer array si__YDWETimerPattern___Thread_type
trigger array st__YDWETimerPattern___Thread_onDestroy
trigger st__OnlyAttackBase__staticgetindex
trigger st__OnlyAttackBase_onDestroy
trigger st__OnlyAttackBase_destroy
trigger st__Connect__staticgetindex
trigger st__Connect_onDestroy
trigger st__Attract__staticgetindex
trigger st__Attract_onDestroy
trigger st__Attract_destroy
trigger st__Missile__staticgetindex
trigger st__Missile_onDestroy
trigger st__Missile_destroy
trigger st__Questions_onDestroy
trigger st__Questions_destroy
trigger st__Roubang__staticgetindex
trigger st__Roubang_onDestroy
trigger st__Roubang_destroy
trigger st__MultiLife__staticgetindex
trigger st__MultiLife_onDestroy
trigger st__SuperShield__staticgetindex
trigger st__SuperShield_onDestroy
trigger st__SuperShield_destroy
trigger st__TextTagBind__staticgetindex
trigger st__TextTagBind_onDestroy
trigger st__Buff__staticgetindex
trigger st__Buff_onDestroy
trigger st__Buff_destroy
trigger st__JudgeInvu_onDestroy
trigger st__JudgeInvu_destroy
trigger st__Boom_onDestroy
trigger st__Boom_destroy
trigger st__TianfuForbidder_forbitTimer
trigger st__TianfuForbidder__staticgetindex
trigger st__TianfuForbidder_onDestroy
trigger st__DamageTJ__staticgetindex
trigger st__DamageTJ_onDestroy
trigger st__DamageTJ_destroy
trigger array st___prototype51
trigger array st___prototype189
trigger array st___prototype223
trigger array st___prototype261
handle f__arg_handle1
unit f__arg_unit1
integer f__arg_integer1
real f__arg_real1
real f__arg_real2
player f__arg_player1
integer f__arg_this
integer f__result_integer

endglobals
    native DzGetMouseTerrainX takes nothing returns real
    native DzGetMouseTerrainY takes nothing returns real
    native DzGetMouseTerrainZ takes nothing returns real
    native DzIsMouseOverUI takes nothing returns boolean
    native DzGetMouseX takes nothing returns integer
    native DzGetMouseY takes nothing returns integer
    native DzGetMouseXRelative takes nothing returns integer
    native DzGetMouseYRelative takes nothing returns integer
    native DzSetMousePos takes integer x, integer y returns nothing
    native DzTriggerRegisterMouseEvent takes trigger trig, integer btn, integer status, boolean sync, string func returns nothing
    native DzTriggerRegisterMouseEventByCode takes trigger trig, integer btn, integer status, boolean sync, code funcHandle returns nothing
    native DzTriggerRegisterKeyEvent takes trigger trig, integer key, integer status, boolean sync, string func returns nothing
    native DzTriggerRegisterKeyEventByCode takes trigger trig, integer key, integer status, boolean sync, code funcHandle returns nothing
    native DzTriggerRegisterMouseWheelEvent takes trigger trig, boolean sync, string func returns nothing
    native DzTriggerRegisterMouseWheelEventByCode takes trigger trig, boolean sync, code funcHandle returns nothing
    native DzTriggerRegisterMouseMoveEvent takes trigger trig, boolean sync, string func returns nothing
    native DzTriggerRegisterMouseMoveEventByCode takes trigger trig, boolean sync, code funcHandle returns nothing
    native DzGetTriggerKey takes nothing returns integer
    native DzGetWheelDelta takes nothing returns integer
    native DzIsKeyDown takes integer iKey returns boolean
    native DzGetTriggerKeyPlayer takes nothing returns player
    native DzGetWindowWidth takes nothing returns integer
    native DzGetWindowHeight takes nothing returns integer
    native DzGetWindowX takes nothing returns integer
    native DzGetWindowY takes nothing returns integer
    native DzTriggerRegisterWindowResizeEvent takes trigger trig, boolean sync, string func returns nothing
    native DzTriggerRegisterWindowResizeEventByCode takes trigger trig, boolean sync, code funcHandle returns nothing
    native DzIsWindowActive takes nothing returns boolean
    native DzDestructablePosition takes destructable d, real x, real y returns nothing
    native DzSetUnitPosition takes unit whichUnit, real x, real y returns nothing
    native DzExecuteFunc takes string funcName returns nothing
    native DzGetUnitUnderMouse takes nothing returns unit
    native DzSetUnitTexture takes unit whichUnit, string path, integer texId returns nothing
    native DzSetMemory takes integer address, real value returns nothing
    native DzSetUnitID takes unit whichUnit, integer id returns nothing
    native DzSetUnitModel takes unit whichUnit, string path returns nothing
    native DzSetWar3MapMap takes string map returns nothing
    native DzGetLocale takes nothing returns string
    native DzGetUnitNeededXP takes unit whichUnit, integer level returns integer
    native DzTriggerRegisterSyncData takes trigger trig, string prefix, boolean server returns nothing
    native DzSyncData takes string prefix, string data returns nothing
    native DzGetTriggerSyncPrefix takes nothing returns string
    native DzGetTriggerSyncData takes nothing returns string
    native DzGetTriggerSyncPlayer takes nothing returns player
    native DzSyncBuffer takes string prefix, string data, integer dataLen returns nothing
    native DzSyncDataImmediately takes string prefix, string data returns nothing 
    native DzFrameHideInterface takes nothing returns nothing
    native DzFrameEditBlackBorders takes real upperHeight, real bottomHeight returns nothing
    native DzFrameGetPortrait takes nothing returns integer
    native DzFrameGetMinimap takes nothing returns integer
    native DzFrameGetCommandBarButton takes integer row, integer column returns integer
    native DzFrameGetHeroBarButton takes integer buttonId returns integer
    native DzFrameGetHeroHPBar takes integer buttonId returns integer
    native DzFrameGetHeroManaBar takes integer buttonId returns integer
    native DzFrameGetItemBarButton takes integer buttonId returns integer
    native DzFrameGetMinimapButton takes integer buttonId returns integer
    native DzFrameGetUpperButtonBarButton takes integer buttonId returns integer
    native DzFrameGetTooltip takes nothing returns integer
    native DzFrameGetChatMessage takes nothing returns integer
    native DzFrameGetUnitMessage takes nothing returns integer
    native DzFrameGetTopMessage takes nothing returns integer
    native DzGetColor takes integer r, integer g, integer b, integer a returns integer
    native DzFrameSetUpdateCallback takes string func returns nothing
    native DzFrameSetUpdateCallbackByCode takes code funcHandle returns nothing
    native DzFrameShow takes integer frame, boolean enable returns nothing
    native DzCreateFrame takes string frame, integer parent, integer id returns integer
    native DzCreateSimpleFrame takes string frame, integer parent, integer id returns integer
    native DzDestroyFrame takes integer frame returns nothing
    native DzLoadToc takes string fileName returns nothing
    native DzFrameSetPoint takes integer frame, integer point, integer relativeFrame, integer relativePoint, real x, real y returns nothing
    native DzFrameSetAbsolutePoint takes integer frame, integer point, real x, real y returns nothing
    native DzFrameClearAllPoints takes integer frame returns nothing
    native DzFrameSetEnable takes integer name, boolean enable returns nothing
    native DzFrameSetScript takes integer frame, integer eventId, string func, boolean sync returns nothing
    native DzFrameSetScriptByCode takes integer frame, integer eventId, code funcHandle, boolean sync returns nothing
    native DzGetTriggerUIEventPlayer takes nothing returns player
    native DzGetTriggerUIEventFrame takes nothing returns integer
    native DzFrameFindByName takes string name, integer id returns integer
    native DzSimpleFrameFindByName takes string name, integer id returns integer
    native DzSimpleFontStringFindByName takes string name, integer id returns integer
    native DzSimpleTextureFindByName takes string name, integer id returns integer
    native DzGetGameUI takes nothing returns integer
    native DzClickFrame takes integer frame returns nothing
    native DzSetCustomFovFix takes real value returns nothing
    native DzEnableWideScreen takes boolean enable returns nothing
    native DzFrameSetText takes integer frame, string text returns nothing
    native DzFrameGetText takes integer frame returns string
    native DzFrameSetTextSizeLimit takes integer frame, integer size returns nothing
    native DzFrameGetTextSizeLimit takes integer frame returns integer
    native DzFrameSetTextColor takes integer frame, integer color returns nothing
    native DzGetMouseFocus takes nothing returns integer
    native DzFrameSetAllPoints takes integer frame, integer relativeFrame returns boolean
    native DzFrameSetFocus takes integer frame, boolean enable returns boolean
    native DzFrameSetModel takes integer frame, string modelFile, integer modelType, integer flag returns nothing
    native DzFrameGetEnable takes integer frame returns boolean
    native DzFrameSetAlpha takes integer frame, integer alpha returns nothing
    native DzFrameGetAlpha takes integer frame returns integer
    native DzFrameSetAnimate takes integer frame, integer animId, boolean autocast returns nothing
    native DzFrameSetAnimateOffset takes integer frame, real offset returns nothing
    native DzFrameSetTexture takes integer frame, string texture, integer flag returns nothing
    native DzFrameSetScale takes integer frame, real scale returns nothing
    native DzFrameSetTooltip takes integer frame, integer tooltip returns nothing
    native DzFrameCageMouse takes integer frame, boolean enable returns nothing
    native DzFrameGetValue takes integer frame returns real
    native DzFrameSetMinMaxValue takes integer frame, real minValue, real maxValue returns nothing
    native DzFrameSetStepValue takes integer frame, real step returns nothing
    native DzFrameSetValue takes integer frame, real value returns nothing
    native DzFrameSetSize takes integer frame, real w, real h returns nothing
    native DzCreateFrameByTagName takes string frameType, string name, integer parent, string template, integer id returns integer
    native DzFrameSetVertexColor takes integer frame, integer color returns nothing
    native DzOriginalUIAutoResetPoint takes boolean enable returns nothing
    native DzFrameSetPriority takes integer frame, integer priority returns nothing
    native DzFrameSetParent takes integer frame, integer parent returns nothing
    native DzFrameGetHeight takes integer frame returns real
    native DzFrameSetFont takes integer frame, string fileName, real height, integer flag returns nothing
    native DzFrameGetParent takes integer frame returns integer
    native DzFrameSetTextAlignment takes integer frame, integer align returns nothing
    native DzFrameGetName takes integer frame returns string
    native DzGetClientWidth takes nothing returns integer
    native DzGetClientHeight takes nothing returns integer
    native DzFrameIsVisible takes integer frame returns boolean
    native DzFrameAddText takes integer frame, string text returns nothing
    native DzUnitSilence takes unit whichUnit, boolean disable returns nothing
    native DzUnitDisableAttack takes unit whichUnit, boolean disable returns nothing
    native DzUnitDisableInventory takes unit whichUnit, boolean disable returns nothing
    native DzUpdateMinimap takes nothing returns nothing
    native DzUnitChangeAlpha takes unit whichUnit, integer alpha, boolean forceUpdate returns nothing
    native DzUnitSetCanSelect takes unit whichUnit, boolean state returns nothing
    native DzUnitSetTargetable takes unit whichUnit, boolean state returns nothing
    native DzSaveMemoryCache takes string cache returns nothing
    native DzGetMemoryCache takes nothing returns string
    native DzSetSpeed takes real ratio returns nothing
    native DzConvertWorldPosition takes real x, real y, real z, code callback returns boolean
    native DzGetConvertWorldPositionX takes nothing returns real
    native DzGetConvertWorldPositionY takes nothing returns real
    native DzCreateCommandButton takes integer parent, string icon, string name, string desc returns integer
    native DzAPI_Map_HasMallItem takes player whichPlayer, string key returns boolean
    native DzAPI_Map_GetMapLevel takes player whichPlayer returns integer
    native RequestExtraIntegerData takes integer dataType, player whichPlayer, string param1, string param2, boolean param3, integer param4, integer param5, integer param6 returns integer
    native RequestExtraBooleanData takes integer dataType, player whichPlayer, string param1, string param2, boolean param3, integer param4, integer param5, integer param6 returns boolean
    native RequestExtraStringData takes integer dataType, player whichPlayer, string param1, string param2, boolean param3, integer param4, integer param5, integer param6 returns string
    native RequestExtraRealData takes integer dataType, player whichPlayer, string param1, string param2, boolean param3, integer param4, integer param5, integer param6 returns real


//Generated method caller for DamageTJ._staticgetindex
function sc__DamageTJ__staticgetindex takes handle h returns integer
    set f__arg_handle1=h
    call TriggerEvaluate(st__DamageTJ__staticgetindex)
 return f__result_integer
endfunction

//Generated method caller for DamageTJ.onDestroy
function sc__DamageTJ_onDestroy takes integer this returns nothing
    set f__arg_this=this
    call TriggerEvaluate(st__DamageTJ_onDestroy)
endfunction

//Generated allocator of DamageTJ
function s__DamageTJ__allocate takes nothing returns integer
 local integer this=si__DamageTJ_F
    if (this!=0) then
        set si__DamageTJ_F=si__DamageTJ_V[this]
    else
        set si__DamageTJ_I=si__DamageTJ_I+1
        set this=si__DamageTJ_I
    endif
    if (this>1169) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Unable to allocate id for an object of type: DamageTJ")
        return 0
    endif
    set s__DamageTJ_RTongji[this]=(this-1)*7
    set si__DamageTJ_V[this]=-1
 return this
endfunction

//Generated destructor of DamageTJ
function sc__DamageTJ_deallocate takes integer this returns nothing
    if this==null then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: DamageTJ")
        return
    elseif (si__DamageTJ_V[this]!=-1) then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: DamageTJ")
        return
    endif
    set f__arg_this=this
    call TriggerEvaluate(st__DamageTJ_onDestroy)
    set si__DamageTJ_V[this]=si__DamageTJ_F
    set si__DamageTJ_F=this
endfunction

//Generated method caller for TianfuForbidder.forbitTimer
function sc__TianfuForbidder_forbitTimer takes nothing returns nothing
    call TriggerEvaluate(st__TianfuForbidder_forbitTimer)
endfunction

//Generated method caller for TianfuForbidder._staticgetindex
function sc__TianfuForbidder__staticgetindex takes handle h returns integer
    set f__arg_handle1=h
    call TriggerEvaluate(st__TianfuForbidder__staticgetindex)
 return f__result_integer
endfunction

//Generated method caller for TianfuForbidder.onDestroy
function sc__TianfuForbidder_onDestroy takes integer this returns nothing
    set f__arg_this=this
    call TriggerEvaluate(st__TianfuForbidder_onDestroy)
endfunction

//Generated allocator of TianfuForbidder
function s__TianfuForbidder__allocate takes nothing returns integer
 local integer this=si__TianfuForbidder_F
    if (this!=0) then
        set si__TianfuForbidder_F=si__TianfuForbidder_V[this]
    else
        set si__TianfuForbidder_I=si__TianfuForbidder_I+1
        set this=si__TianfuForbidder_I
    endif
    if (this>8190) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Unable to allocate id for an object of type: TianfuForbidder")
        return 0
    endif

    set si__TianfuForbidder_V[this]=-1
 return this
endfunction

//Generated destructor of TianfuForbidder
function sc__TianfuForbidder_deallocate takes integer this returns nothing
    if this==null then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: TianfuForbidder")
        return
    elseif (si__TianfuForbidder_V[this]!=-1) then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: TianfuForbidder")
        return
    endif
    set f__arg_this=this
    call TriggerEvaluate(st__TianfuForbidder_onDestroy)
    set si__TianfuForbidder_V[this]=si__TianfuForbidder_F
    set si__TianfuForbidder_F=this
endfunction

//Generated method caller for Boom.onDestroy
function sc__Boom_onDestroy takes integer this returns nothing
			call FlushChildHashtable(LHTable, GetHandleId(s__Boom_t[this]))
			call RemoveUnit(s__Boom_caster[this])
			set s__Boom_caster[this]=null
			set s__Boom_x[this]=0.0
			set s__Boom_y[this]=0.0
			set s__Boom_facing[this]=0.0
			set s__Boom_damage[this]=0.0
			set s__Boom_speed[this]=0.0
			set s__Boom_radius[this]=0.0
			set s__Boom_effx[this]=null
			call PauseTimer(s__Boom_t[this])
			call DestroyTimer(s__Boom_t[this])
			set s__Boom_t[this]=null
endfunction

//Generated allocator of Boom
function s__Boom__allocate takes nothing returns integer
 local integer this=si__Boom_F
    if (this!=0) then
        set si__Boom_F=si__Boom_V[this]
    else
        set si__Boom_I=si__Boom_I+1
        set this=si__Boom_I
    endif
    if (this>8190) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Unable to allocate id for an object of type: Boom")
        return 0
    endif

    set si__Boom_V[this]=-1
 return this
endfunction

//Generated destructor of Boom
function sc__Boom_deallocate takes integer this returns nothing
    if this==null then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: Boom")
        return
    elseif (si__Boom_V[this]!=-1) then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: Boom")
        return
    endif
    set f__arg_this=this
    call TriggerEvaluate(st__Boom_onDestroy)
    set si__Boom_V[this]=si__Boom_F
    set si__Boom_F=this
endfunction

//Generated method caller for JudgeInvu.onDestroy
function sc__JudgeInvu_onDestroy takes integer this returns nothing
			call FlushChildHashtable(LHTable, GetHandleId(s__JudgeInvu_t[this]))
			set s__JudgeInvu_u[this]=null
			call PauseTimer(s__JudgeInvu_t[this])
			call DestroyTimer(s__JudgeInvu_t[this])
			set s__JudgeInvu_t[this]=null
endfunction

//Generated allocator of JudgeInvu
function s__JudgeInvu__allocate takes nothing returns integer
 local integer this=si__JudgeInvu_F
    if (this!=0) then
        set si__JudgeInvu_F=si__JudgeInvu_V[this]
    else
        set si__JudgeInvu_I=si__JudgeInvu_I+1
        set this=si__JudgeInvu_I
    endif
    if (this>8190) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Unable to allocate id for an object of type: JudgeInvu")
        return 0
    endif

    set si__JudgeInvu_V[this]=-1
 return this
endfunction

//Generated destructor of JudgeInvu
function sc__JudgeInvu_deallocate takes integer this returns nothing
    if this==null then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: JudgeInvu")
        return
    elseif (si__JudgeInvu_V[this]!=-1) then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: JudgeInvu")
        return
    endif
    set f__arg_this=this
    call TriggerEvaluate(st__JudgeInvu_onDestroy)
    set si__JudgeInvu_V[this]=si__JudgeInvu_F
    set si__JudgeInvu_F=this
endfunction

//Generated method caller for Buff._staticgetindex
function sc__Buff__staticgetindex takes handle h returns integer
    set f__arg_handle1=h
    call TriggerEvaluate(st__Buff__staticgetindex)
 return f__result_integer
endfunction

//Generated method caller for Buff.onDestroy
function sc__Buff_onDestroy takes integer this returns nothing
    set f__arg_this=this
    call TriggerEvaluate(st__Buff_onDestroy)
endfunction

//Generated allocator of Buff
function s__Buff__allocate takes nothing returns integer
 local integer this=si__Buff_F
    if (this!=0) then
        set si__Buff_F=si__Buff_V[this]
    else
        set si__Buff_I=si__Buff_I+1
        set this=si__Buff_I
    endif
    if (this>8190) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Unable to allocate id for an object of type: Buff")
        return 0
    endif

    set si__Buff_V[this]=-1
 return this
endfunction

//Generated destructor of Buff
function sc__Buff_deallocate takes integer this returns nothing
    if this==null then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: Buff")
        return
    elseif (si__Buff_V[this]!=-1) then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: Buff")
        return
    endif
    set f__arg_this=this
    call TriggerEvaluate(st__Buff_onDestroy)
    set si__Buff_V[this]=si__Buff_F
    set si__Buff_F=this
endfunction

//Generated method caller for TextTagBind._staticgetindex
function sc__TextTagBind__staticgetindex takes handle h returns integer
    set f__arg_handle1=h
    call TriggerEvaluate(st__TextTagBind__staticgetindex)
 return f__result_integer
endfunction

//Generated method caller for TextTagBind.onDestroy
function sc__TextTagBind_onDestroy takes integer this returns nothing
    set f__arg_this=this
    call TriggerEvaluate(st__TextTagBind_onDestroy)
endfunction

//Generated allocator of TextTagBind
function s__TextTagBind__allocate takes nothing returns integer
 local integer this=si__TextTagBind_F
    if (this!=0) then
        set si__TextTagBind_F=si__TextTagBind_V[this]
    else
        set si__TextTagBind_I=si__TextTagBind_I+1
        set this=si__TextTagBind_I
    endif
    if (this>8190) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Unable to allocate id for an object of type: TextTagBind")
        return 0
    endif

    set si__TextTagBind_V[this]=-1
 return this
endfunction

//Generated destructor of TextTagBind
function sc__TextTagBind_deallocate takes integer this returns nothing
    if this==null then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: TextTagBind")
        return
    elseif (si__TextTagBind_V[this]!=-1) then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: TextTagBind")
        return
    endif
    set f__arg_this=this
    call TriggerEvaluate(st__TextTagBind_onDestroy)
    set si__TextTagBind_V[this]=si__TextTagBind_F
    set si__TextTagBind_F=this
endfunction

//Generated method caller for SuperShield._staticgetindex
function sc__SuperShield__staticgetindex takes handle h returns integer
    set f__arg_handle1=h
    call TriggerEvaluate(st__SuperShield__staticgetindex)
 return f__result_integer
endfunction

//Generated method caller for SuperShield.onDestroy
function sc__SuperShield_onDestroy takes integer this returns nothing
    set f__arg_this=this
    call TriggerEvaluate(st__SuperShield_onDestroy)
endfunction

//Generated allocator of SuperShield
function s__SuperShield__allocate takes nothing returns integer
 local integer this=si__SuperShield_F
    if (this!=0) then
        set si__SuperShield_F=si__SuperShield_V[this]
    else
        set si__SuperShield_I=si__SuperShield_I+1
        set this=si__SuperShield_I
    endif
    if (this>8190) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Unable to allocate id for an object of type: SuperShield")
        return 0
    endif

    set si__SuperShield_V[this]=-1
 return this
endfunction

//Generated destructor of SuperShield
function sc__SuperShield_deallocate takes integer this returns nothing
    if this==null then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: SuperShield")
        return
    elseif (si__SuperShield_V[this]!=-1) then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: SuperShield")
        return
    endif
    set f__arg_this=this
    call TriggerEvaluate(st__SuperShield_onDestroy)
    set si__SuperShield_V[this]=si__SuperShield_F
    set si__SuperShield_F=this
endfunction

//Generated method caller for MultiLife._staticgetindex
function sc__MultiLife__staticgetindex takes handle h returns integer
    set f__arg_handle1=h
    call TriggerEvaluate(st__MultiLife__staticgetindex)
 return f__result_integer
endfunction

//Generated method caller for MultiLife.onDestroy
function sc__MultiLife_onDestroy takes integer this returns nothing
    set f__arg_this=this
    call TriggerEvaluate(st__MultiLife_onDestroy)
endfunction

//Generated allocator of MultiLife
function s__MultiLife__allocate takes nothing returns integer
 local integer this=si__MultiLife_F
    if (this!=0) then
        set si__MultiLife_F=si__MultiLife_V[this]
    else
        set si__MultiLife_I=si__MultiLife_I+1
        set this=si__MultiLife_I
    endif
    if (this>8190) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Unable to allocate id for an object of type: MultiLife")
        return 0
    endif

    set si__MultiLife_V[this]=-1
 return this
endfunction

//Generated destructor of MultiLife
function sc__MultiLife_deallocate takes integer this returns nothing
    if this==null then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: MultiLife")
        return
    elseif (si__MultiLife_V[this]!=-1) then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: MultiLife")
        return
    endif
    set f__arg_this=this
    call TriggerEvaluate(st__MultiLife_onDestroy)
    set si__MultiLife_V[this]=si__MultiLife_F
    set si__MultiLife_F=this
endfunction

//Generated method caller for Roubang._staticgetindex
function sc__Roubang__staticgetindex takes handle h returns integer
    set f__arg_handle1=h
    call TriggerEvaluate(st__Roubang__staticgetindex)
 return f__result_integer
endfunction

//Generated method caller for Roubang.onDestroy
function sc__Roubang_onDestroy takes integer this returns nothing
    set f__arg_this=this
    call TriggerEvaluate(st__Roubang_onDestroy)
endfunction

//Generated allocator of Roubang
function s__Roubang__allocate takes nothing returns integer
 local integer this=si__Roubang_F
    if (this!=0) then
        set si__Roubang_F=si__Roubang_V[this]
    else
        set si__Roubang_I=si__Roubang_I+1
        set this=si__Roubang_I
    endif
    if (this>408) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Unable to allocate id for an object of type: Roubang")
        return 0
    endif
    set s__Roubang_URou[this]=(this-1)*20
    set si__Roubang_V[this]=-1
 return this
endfunction

//Generated destructor of Roubang
function sc__Roubang_deallocate takes integer this returns nothing
    if this==null then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: Roubang")
        return
    elseif (si__Roubang_V[this]!=-1) then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: Roubang")
        return
    endif
    set f__arg_this=this
    call TriggerEvaluate(st__Roubang_onDestroy)
    set si__Roubang_V[this]=si__Roubang_F
    set si__Roubang_F=this
endfunction

//Generated method caller for Questions.onDestroy
function sc__Questions_onDestroy takes integer this returns nothing
			call PauseTimer(s__Questions_t[this])
			call DestroyTimer(s__Questions_t[this])
			call FlushChildHashtable(LHTable, GetHandleId(s__Questions_t[this]))
			set s__Questions_t[this]=null
			set s__Questions_time[this]=0
			set s__Questions_rightPos[this]=0
			call FlushChildHashtable(LHTable, GetHandleId(s__Questions_click[this]))
			call FlushChildHashtable(LHTable, GetHandleId(s__Questions_d[this]))
			call DestroyTrigger(s__Questions_click[this])
	    	call DialogDisplay(s__Questions_p[this], s__Questions_d[this], false)
	        call DialogClear(s__Questions_d[this])
	        call DialogDestroy(s__Questions_d[this])
			set s__Questions_click[this]=null
			set s__Questions_p[this]=null
			set s__Questions_question[this]=null
			set s__Questions_d[this]=null
endfunction

//Generated allocator of Questions
function s__Questions__allocate takes nothing returns integer
 local integer this=si__Questions_F
    if (this!=0) then
        set si__Questions_F=si__Questions_V[this]
    else
        set si__Questions_I=si__Questions_I+1
        set this=si__Questions_I
    endif
    if (this>8190) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Unable to allocate id for an object of type: Questions")
        return 0
    endif

    set si__Questions_V[this]=-1
 return this
endfunction

//Generated destructor of Questions
function sc__Questions_deallocate takes integer this returns nothing
    if this==null then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: Questions")
        return
    elseif (si__Questions_V[this]!=-1) then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: Questions")
        return
    endif
    set f__arg_this=this
    call TriggerEvaluate(st__Questions_onDestroy)
    set si__Questions_V[this]=si__Questions_F
    set si__Questions_F=this
endfunction

//Generated method caller for Missile._staticgetindex
function sc__Missile__staticgetindex takes handle h returns integer
    set f__arg_handle1=h
    call TriggerEvaluate(st__Missile__staticgetindex)
 return f__result_integer
endfunction

//Generated method caller for Missile.onDestroy
function sc__Missile_onDestroy takes integer this returns nothing
    set f__arg_this=this
    call TriggerEvaluate(st__Missile_onDestroy)
endfunction

//Generated allocator of Missile
function s__Missile__allocate takes nothing returns integer
 local integer this=si__Missile_F
    if (this!=0) then
        set si__Missile_F=si__Missile_V[this]
    else
        set si__Missile_I=si__Missile_I+1
        set this=si__Missile_I
    endif
    if (this>8190) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Unable to allocate id for an object of type: Missile")
        return 0
    endif

    set si__Missile_V[this]=-1
 return this
endfunction

//Generated destructor of Missile
function sc__Missile_deallocate takes integer this returns nothing
    if this==null then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: Missile")
        return
    elseif (si__Missile_V[this]!=-1) then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: Missile")
        return
    endif
    set f__arg_this=this
    call TriggerEvaluate(st__Missile_onDestroy)
    set si__Missile_V[this]=si__Missile_F
    set si__Missile_F=this
endfunction

//Generated method caller for Attract._staticgetindex
function sc__Attract__staticgetindex takes handle h returns integer
    set f__arg_handle1=h
    call TriggerEvaluate(st__Attract__staticgetindex)
 return f__result_integer
endfunction

//Generated method caller for Attract.onDestroy
function sc__Attract_onDestroy takes integer this returns nothing
    set f__arg_this=this
    call TriggerEvaluate(st__Attract_onDestroy)
endfunction

//Generated allocator of Attract
function s__Attract__allocate takes nothing returns integer
 local integer this=si__Attract_F
    if (this!=0) then
        set si__Attract_F=si__Attract_V[this]
    else
        set si__Attract_I=si__Attract_I+1
        set this=si__Attract_I
    endif
    if (this>8190) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Unable to allocate id for an object of type: Attract")
        return 0
    endif

    set si__Attract_V[this]=-1
 return this
endfunction

//Generated destructor of Attract
function sc__Attract_deallocate takes integer this returns nothing
    if this==null then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: Attract")
        return
    elseif (si__Attract_V[this]!=-1) then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: Attract")
        return
    endif
    set f__arg_this=this
    call TriggerEvaluate(st__Attract_onDestroy)
    set si__Attract_V[this]=si__Attract_F
    set si__Attract_F=this
endfunction

//Generated method caller for Connect._staticgetindex
function sc__Connect__staticgetindex takes handle h returns integer
    set f__arg_handle1=h
    call TriggerEvaluate(st__Connect__staticgetindex)
 return f__result_integer
endfunction

//Generated method caller for Connect.onDestroy
function sc__Connect_onDestroy takes integer this returns nothing
    set f__arg_this=this
    call TriggerEvaluate(st__Connect_onDestroy)
endfunction

//Generated allocator of Connect
function s__Connect__allocate takes nothing returns integer
 local integer this=si__Connect_F
    if (this!=0) then
        set si__Connect_F=si__Connect_V[this]
    else
        set si__Connect_I=si__Connect_I+1
        set this=si__Connect_I
    endif
    if (this>8190) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Unable to allocate id for an object of type: Connect")
        return 0
    endif

    set si__Connect_V[this]=-1
 return this
endfunction

//Generated destructor of Connect
function sc__Connect_deallocate takes integer this returns nothing
    if this==null then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: Connect")
        return
    elseif (si__Connect_V[this]!=-1) then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: Connect")
        return
    endif
    set f__arg_this=this
    call TriggerEvaluate(st__Connect_onDestroy)
    set si__Connect_V[this]=si__Connect_F
    set si__Connect_F=this
endfunction

//Generated method caller for OnlyAttackBase._staticgetindex
function sc__OnlyAttackBase__staticgetindex takes handle h returns integer
    set f__arg_handle1=h
    call TriggerEvaluate(st__OnlyAttackBase__staticgetindex)
 return f__result_integer
endfunction

//Generated method caller for OnlyAttackBase.onDestroy
function sc__OnlyAttackBase_onDestroy takes integer this returns nothing
    set f__arg_this=this
    call TriggerEvaluate(st__OnlyAttackBase_onDestroy)
endfunction

//Generated allocator of OnlyAttackBase
function s__OnlyAttackBase__allocate takes nothing returns integer
 local integer this=si__OnlyAttackBase_F
    if (this!=0) then
        set si__OnlyAttackBase_F=si__OnlyAttackBase_V[this]
    else
        set si__OnlyAttackBase_I=si__OnlyAttackBase_I+1
        set this=si__OnlyAttackBase_I
    endif
    if (this>8190) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Unable to allocate id for an object of type: OnlyAttackBase")
        return 0
    endif

    set si__OnlyAttackBase_V[this]=-1
 return this
endfunction

//Generated destructor of OnlyAttackBase
function sc__OnlyAttackBase_deallocate takes integer this returns nothing
    if this==null then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: OnlyAttackBase")
        return
    elseif (si__OnlyAttackBase_V[this]!=-1) then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: OnlyAttackBase")
        return
    endif
    set f__arg_this=this
    call TriggerEvaluate(st__OnlyAttackBase_onDestroy)
    set si__OnlyAttackBase_V[this]=si__OnlyAttackBase_F
    set si__OnlyAttackBase_F=this
endfunction

//Generated allocator of DamageUtils___DmgP
function s__DamageUtils___DmgP__allocate takes nothing returns integer
 local integer this=si__DamageUtils___DmgP_F
    if (this!=0) then
        set si__DamageUtils___DmgP_F=si__DamageUtils___DmgP_V[this]
    else
        set si__DamageUtils___DmgP_I=si__DamageUtils___DmgP_I+1
        set this=si__DamageUtils___DmgP_I
    endif
    if (this>8190) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Unable to allocate id for an object of type: DamageUtils___DmgP")
        return 0
    endif

    set si__DamageUtils___DmgP_V[this]=-1
 return this
endfunction

//Generated destructor of DamageUtils___DmgP
function s__DamageUtils___DmgP_deallocate takes integer this returns nothing
    if this==null then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: DamageUtils___DmgP")
        return
    elseif (si__DamageUtils___DmgP_V[this]!=-1) then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: DamageUtils___DmgP")
        return
    endif
    set si__DamageUtils___DmgP_V[this]=si__DamageUtils___DmgP_F
    set si__DamageUtils___DmgP_F=this
endfunction

//Generated allocator of YDWEAroundSystem___Data
function s__YDWEAroundSystem___Data__allocate takes nothing returns integer
 local integer this=si__YDWEAroundSystem___Data_F
    if (this!=0) then
        set si__YDWEAroundSystem___Data_F=si__YDWEAroundSystem___Data_V[this]
    else
        set si__YDWEAroundSystem___Data_I=si__YDWEAroundSystem___Data_I+1
        set this=si__YDWEAroundSystem___Data_I
    endif
    if (this>8190) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Unable to allocate id for an object of type: YDWEAroundSystem___Data")
        return 0
    endif

   set s__YDWEAroundSystem___Data_caster[this]= null
   set s__YDWEAroundSystem___Data_obj[this]= null
   set s__YDWEAroundSystem___Data_dur[this]= 0.
   set s__YDWEAroundSystem___Data_inter[this]= 0.
   set s__YDWEAroundSystem___Data_each[this]= 0.
   set s__YDWEAroundSystem___Data_rate[this]= 0.
   set s__YDWEAroundSystem___Data_dis[this]= 0.
   set s__YDWEAroundSystem___Data_rise[this]= 0.
   set s__YDWEAroundSystem___Data_angle[this]= 0.
   set s__YDWEAroundSystem___Data_radius[this]= 0.
   set s__YDWEAroundSystem___Data_height[this]= 0
    set si__YDWEAroundSystem___Data_V[this]=-1
 return this
endfunction

//Generated destructor of YDWEAroundSystem___Data
function s__YDWEAroundSystem___Data_deallocate takes integer this returns nothing
    if this==null then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: YDWEAroundSystem___Data")
        return
    elseif (si__YDWEAroundSystem___Data_V[this]!=-1) then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: YDWEAroundSystem___Data")
        return
    endif
    set si__YDWEAroundSystem___Data_V[this]=si__YDWEAroundSystem___Data_F
    set si__YDWEAroundSystem___Data_F=this
endfunction

//Generated allocator of YDWETimerPattern___YDVector3
function s__YDWETimerPattern___YDVector3__allocate takes nothing returns integer
 local integer this=si__YDWETimerPattern___YDVector3_F
    if (this!=0) then
        set si__YDWETimerPattern___YDVector3_F=si__YDWETimerPattern___YDVector3_V[this]
    else
        set si__YDWETimerPattern___YDVector3_I=si__YDWETimerPattern___YDVector3_I+1
        set this=si__YDWETimerPattern___YDVector3_I
    endif
    if (this>8190) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Unable to allocate id for an object of type: YDWETimerPattern___YDVector3")
        return 0
    endif

    set si__YDWETimerPattern___YDVector3_V[this]=-1
 return this
endfunction

//Generated destructor of YDWETimerPattern___YDVector3
function s__YDWETimerPattern___YDVector3_deallocate takes integer this returns nothing
    if this==null then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: YDWETimerPattern___YDVector3")
        return
    elseif (si__YDWETimerPattern___YDVector3_V[this]!=-1) then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: YDWETimerPattern___YDVector3")
        return
    endif
    set si__YDWETimerPattern___YDVector3_V[this]=si__YDWETimerPattern___YDVector3_F
    set si__YDWETimerPattern___YDVector3_F=this
endfunction

//Generated method caller for YDWETimerPattern___Thread.onDestroy
function sc__YDWETimerPattern___Thread_onDestroy takes integer this returns nothing
    set f__arg_this=this
    call TriggerEvaluate(st__YDWETimerPattern___Thread_onDestroy[5])
endfunction

//Generated allocator of YDWETimerPattern___Thread
function s__YDWETimerPattern___Thread__allocate takes nothing returns integer
 local integer this=si__YDWETimerPattern___Thread_F
    if (this!=0) then
        set si__YDWETimerPattern___Thread_F=si__YDWETimerPattern___Thread_V[this]
    else
        set si__YDWETimerPattern___Thread_I=si__YDWETimerPattern___Thread_I+1
        set this=si__YDWETimerPattern___Thread_I
    endif
    if (this>8190) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Unable to allocate id for an object of type: YDWETimerPattern___Thread")
        return 0
    endif

    set si__YDWETimerPattern___Thread_type[this]=5
    set si__YDWETimerPattern___Thread_V[this]=-1
 return this
endfunction

//Generated destructor of YDWETimerPattern___Thread
function sc__YDWETimerPattern___Thread_deallocate takes integer this returns nothing
    if this==null then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: YDWETimerPattern___Thread")
        return
    elseif (si__YDWETimerPattern___Thread_V[this]!=-1) then
            call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: YDWETimerPattern___Thread")
        return
    endif
    set f__arg_this=this
    call TriggerEvaluate(st__YDWETimerPattern___Thread_onDestroy[si__YDWETimerPattern___Thread_type[this]])
    set si__YDWETimerPattern___Thread_V[this]=si__YDWETimerPattern___Thread_F
    set si__YDWETimerPattern___Thread_F=this
endfunction

//Generated allocator of YDWETimerPattern___Deceleration
function s__YDWETimerPattern___Deceleration__allocate takes nothing returns integer
 local integer this=s__YDWETimerPattern___Thread__allocate()
 local integer kthis
    if(this==0) then
        return 0
    endif
    set si__YDWETimerPattern___Thread_type[this]=8
    set kthis=this

 return this
endfunction


//Generated allocator of YDWETimerPattern___Parabola
function s__YDWETimerPattern___Parabola__allocate takes nothing returns integer
 local integer this=s__YDWETimerPattern___Thread__allocate()
 local integer kthis
    if(this==0) then
        return 0
    endif
    set si__YDWETimerPattern___Thread_type[this]=6
    set kthis=this

 return this
endfunction


//Generated allocator of YDWETimerPattern___Linear
function s__YDWETimerPattern___Linear__allocate takes nothing returns integer
 local integer this=s__YDWETimerPattern___Thread__allocate()
 local integer kthis
    if(this==0) then
        return 0
    endif
    set si__YDWETimerPattern___Thread_type[this]=7
    set kthis=this

 return this
endfunction

function sc___prototype51_execute takes integer i returns nothing

    call TriggerExecute(st___prototype51[i])
endfunction
function sc___prototype51_evaluate takes integer i returns nothing

    call TriggerEvaluate(st___prototype51[i])

endfunction
function sc___prototype189_execute takes integer i,unit a1 returns nothing
    set f__arg_unit1=a1

    call TriggerExecute(st___prototype189[i])
endfunction
function sc___prototype189_evaluate takes integer i,unit a1 returns nothing
    set f__arg_unit1=a1

    call TriggerEvaluate(st___prototype189[i])

endfunction
function sc___prototype223_execute takes integer i,integer a1,real a2,real a3 returns nothing
    set f__arg_integer1=a1
    set f__arg_real1=a2
    set f__arg_real2=a3

    call TriggerExecute(st___prototype223[i])
endfunction
function sc___prototype223_evaluate takes integer i,integer a1,real a2,real a3 returns nothing
    set f__arg_integer1=a1
    set f__arg_real1=a2
    set f__arg_real2=a3

    call TriggerEvaluate(st___prototype223[i])

endfunction
function sc___prototype261_execute takes integer i,player a1 returns nothing
    set f__arg_player1=a1

    call TriggerExecute(st___prototype261[i])
endfunction
function sc___prototype261_evaluate takes integer i,player a1 returns nothing
    set f__arg_player1=a1

    call TriggerEvaluate(st___prototype261[i])

endfunction

//library BzAPI:
    //hardware




























    //plus











    //sync






    //native DzGetPushContext takes nothing returns string

    //gui











































































        //显示/隐藏SimpleFrame
    //native DzSimpleFrameShow takes integer frame, boolean enable returns nothing
    // 追加文字（支持TextArea）

    // 沉默单位-禁用技能

    // 禁用攻击

    // 禁用道具

    // 刷新小地图

    // 修改单位alpha

    // 设置单位是否可以选中

    // 修改单位是否可以被设置为目标

    // 保存内存数据

    // 读取内存数据

    // 设置加速倍率

    // 转换世界坐标为屏幕坐标-异步

    // 转换世界坐标为屏幕坐标-获取转换后的X坐标

    // 转换世界坐标为屏幕坐标-获取转换后的Y坐标

    // 创建command button

    function DzTriggerRegisterMouseEventTrg takes trigger trg,integer status,integer btn returns nothing
        if trg == null then
            return
        endif
        call DzTriggerRegisterMouseEvent(trg, btn, status, true, null)
    endfunction
    function DzTriggerRegisterKeyEventTrg takes trigger trg,integer status,integer btn returns nothing
        if trg == null then
            return
        endif
        call DzTriggerRegisterKeyEvent(trg, btn, status, true, null)
    endfunction
    function DzTriggerRegisterMouseMoveEventTrg takes trigger trg returns nothing
        if trg == null then
            return
        endif
        call DzTriggerRegisterMouseMoveEvent(trg, true, null)
    endfunction
    function DzTriggerRegisterMouseWheelEventTrg takes trigger trg returns nothing
        if trg == null then
            return
        endif
        call DzTriggerRegisterMouseWheelEvent(trg, true, null)
    endfunction
    function DzTriggerRegisterWindowResizeEventTrg takes trigger trg returns nothing
        if trg == null then
            return
        endif
        call DzTriggerRegisterWindowResizeEvent(trg, true, null)
    endfunction
    function DzF2I takes integer i returns integer
        return i
    endfunction
    function DzI2F takes integer i returns integer
        return i
    endfunction
    function DzK2I takes integer i returns integer
        return i
    endfunction
    function DzI2K takes integer i returns integer
        return i
    endfunction
    function DzTriggerRegisterMallItemSyncData takes trigger trig returns nothing
        call DzTriggerRegisterSyncData(trig, "DZMIA", true)
    endfunction
    //玩家消耗/使用商城道具事件
    function DzTriggerRegisterMallItemConsumeEvent takes trigger trig returns nothing
        call DzTriggerRegisterSyncData(trig, "DZMIC", true)
    endfunction
    //玩家删除商城道具事件
    function DzTriggerRegisterMallItemRemoveEvent takes trigger trig returns nothing
        call DzTriggerRegisterSyncData(trig, "DZMID", true)
    endfunction
    function DzGetTriggerMallItemPlayer takes nothing returns player
        return DzGetTriggerSyncPlayer()
    endfunction
    function DzGetTriggerMallItem takes nothing returns string
        return DzGetTriggerSyncData()
    endfunction
    

//library BzAPI ends
//library ConversionUtils:
    function B2S takes boolean b returns string
        if ( b ) then
            return "true"
        else
            return "false"
        endif
    endfunction  //三目运算符
    function S3 takes boolean b,string s1,string s2 returns string
        if ( b ) then
            return s1
        else
            return s2
        endif
    endfunction  //三目运算符
    function I3 takes boolean b,integer i1,integer i2 returns integer
        if ( b ) then
            return i1
        else
            return i2
        endif
    endfunction  //三目运算符
    function R3 takes boolean b,real r1,real r2 returns real
        if ( b ) then
            return r1
        else
            return r2
        endif
    endfunction  // 将数字转换为魔兽的四字符ID,使用256进制但限制36个数一进位
    function GetIDSymbol takes integer pos returns integer
        local integer bit=pos / 36
        set pos=ModuloInteger(pos, 36)
        if ( pos < 10 ) then
            return pos + bit * 256
        else
            return '000a' - '0000' + pos - 10 + bit * 256
        endif
    endfunction  // 将魔兽的四字符ID转换回对应数字
    function GetSymbolID takes integer s returns integer
        local integer i1=s / 256
        local integer i2=ModuloInteger(s, 256)
        if ( i2 < 10 ) then
            return i1 * 36 + i2
        else
            return i2 - '000a' + '0000' + 10 + i1 * 36
        endif
    endfunction

//library ConversionUtils ends
//library DzAPI:


    // native DzAPI_Map_GetGuildName takes player whichPlayer returns string




    
    // SaveServerValue,               //保存服务器存档
    function DzAPI_Map_SaveServerValue takes player whichPlayer,string key,string value returns boolean
        return RequestExtraBooleanData(4, whichPlayer, key, value, false, 0, 0, 0)
    endfunction
    // GetServerValue,                //读取服务器存档
    function DzAPI_Map_GetServerValue takes player whichPlayer,string key returns string
        return RequestExtraStringData(5, whichPlayer, key, null, false, 0, 0, 0)
    endfunction
    // GetGameStartTime,              //取游戏开始时间
    function DzAPI_Map_GetGameStartTime takes nothing returns integer
        return RequestExtraIntegerData(11, null, null, null, false, 0, 0, 0)
    endfunction
    // IsRPGLadder,                   //判断当前是否rpg天梯
    function DzAPI_Map_IsRPGLadder takes nothing returns boolean
        return RequestExtraBooleanData(12, null, null, null, false, 0, 0, 0)
    endfunction
    // GetMatchType,                  //获取匹配类型
    function DzAPI_Map_GetMatchType takes nothing returns integer
        return RequestExtraIntegerData(13, null, null, null, false, 0, 0, 0)
    endfunction
        // SetStat,                       //统计-提交地图数据
    function DzAPI_Map_Stat_SetStat takes player whichPlayer,string key,string value returns nothing
        call RequestExtraIntegerData(7, whichPlayer, key, value, false, 0, 0, 0)
    endfunction
    // SetLadderStat,                 //天梯-统计数据
    function DzAPI_Map_Ladder_SetStat takes player whichPlayer,string key,string value returns nothing
        call RequestExtraIntegerData(8, whichPlayer, key, value, false, 0, 0, 0)
    endfunction
    // SetLadderPlayerStat,           //天梯-统计数据
    function DzAPI_Map_Ladder_SetPlayerStat takes player whichPlayer,string key,string value returns nothing
        call RequestExtraIntegerData(9, whichPlayer, key, value, false, 0, 0, 0)
    endfunction
        // GetServerValueErrorCode,       //读取加载服务器存档时的错误码
    function DzAPI_Map_GetServerValueErrorCode takes player whichPlayer returns integer
        return RequestExtraIntegerData(6, whichPlayer, null, null, false, 0, 0, 0)
    endfunction
    // GetLadderLevel,                //提供给地图的接口，用与取天梯等级
    function DzAPI_Map_GetLadderLevel takes player whichPlayer returns integer
        return RequestExtraIntegerData(14, whichPlayer, null, null, false, 0, 0, 0)
    endfunction
    // PlayerIdentityType, // 获取玩家身份类型
    function KKApiPlayerIdentityType takes player whichPlayer,integer id returns boolean
        return RequestExtraBooleanData(92, whichPlayer, null, null, false, id, 0, 0)
    endfunction
    // IsRedVIP,                      //提供给地图的接口，用与判断是否红V
    function DzAPI_Map_IsRedVIP takes player whichPlayer returns boolean
        return KKApiPlayerIdentityType(whichPlayer , 4)
    endfunction
    // IsBlueVIP,                     //提供给地图的接口，用与判断是否蓝V
    function DzAPI_Map_IsBlueVIP takes player whichPlayer returns boolean
        return KKApiPlayerIdentityType(whichPlayer , 3)
    endfunction
    // GetLadderRank,                 //提供给地图的接口，用与取天梯排名
    function DzAPI_Map_GetLadderRank takes player whichPlayer returns integer
        return RequestExtraIntegerData(17, whichPlayer, null, null, false, 0, 0, 0)
    endfunction
    // GetMapLevelRank,               //提供给地图的接口，用与取地图等级排名
    function DzAPI_Map_GetMapLevelRank takes player whichPlayer returns integer
        return RequestExtraIntegerData(18, whichPlayer, null, null, false, 0, 0, 0)
    endfunction
    // GetGuildRole,                  //获取公会职责 Member=10 Admin=20 Leader=30
    function DzAPI_Map_GetGuildRole takes player whichPlayer returns integer
        return RequestExtraIntegerData(20, whichPlayer, null, null, false, 0, 0, 0)
    endfunction
    // IsRPGLobby,                    //检查是否大厅地图
    function DzAPI_Map_IsRPGLobby takes nothing returns boolean
        return RequestExtraBooleanData(10, null, null, null, false, 0, 0, 0)
    endfunction
    
    // MissionComplete,               //用作完成某个任务，发奖励
    function DzAPI_Map_MissionComplete takes player whichPlayer,string key,string value returns nothing
        call RequestExtraIntegerData(1, whichPlayer, key, value, false, 0, 0, 0)
    endfunction
    // GetActivityData,               //提供给地图的接口，用作取服务器上的活动数据
    function DzAPI_Map_GetActivityData takes nothing returns string
        return RequestExtraStringData(2, null, null, null, false, 0, 0, 0)
    endfunction
    // GetMapConfig,                  //获取地图配置
    function DzAPI_Map_GetMapConfig takes string key returns string
        return RequestExtraStringData(21, null, key, null, false, 0, 0, 0)
    endfunction
    // SavePublicArchive,             //保存服务器存档组
    function DzAPI_Map_SavePublicArchive takes player whichPlayer,string key,string value returns boolean
        return RequestExtraBooleanData(31, whichPlayer, key, value, false, 0, 0, 0)
    endfunction
    // GetPublicArchive,              //读取服务器存档组
    function DzAPI_Map_GetPublicArchive takes player whichPlayer,string key returns string
        return RequestExtraStringData(32, whichPlayer, key, null, false, 0, 0, 0)
    endfunction
    function DzAPI_Map_UseConsumablesItem takes player whichPlayer,string key returns nothing
        call RequestExtraIntegerData(33, whichPlayer, key, null, false, 0, 0, 0)
    endfunction
    // OrpgTrigger,                   //触发boss击杀
    function DzAPI_Map_OrpgTrigger takes player whichPlayer,string key returns nothing
        call RequestExtraIntegerData(28, whichPlayer, key, null, false, 0, 0, 0)
    endfunction
    // GetServerArchiveDrop,          //读取服务器掉落数据
    function DzAPI_Map_GetServerArchiveDrop takes player whichPlayer,string key returns string
        return RequestExtraStringData(27, whichPlayer, key, null, false, 0, 0, 0)
    endfunction
    // GetServerArchiveEquip,         //读取服务器装备数据
    function DzAPI_Map_GetServerArchiveEquip takes player whichPlayer,string key returns integer
        return RequestExtraIntegerData(26, whichPlayer, key, null, false, 0, 0, 0)
    endfunction
    function DzAPI_Map_GetPlatformVIP takes player whichPlayer returns integer
        return RequestExtraIntegerData(30, whichPlayer, null, null, false, 0, 0, 0)
    endfunction
    function DzAPI_Map_IsPlatformVIP takes player whichPlayer returns boolean
        return DzAPI_Map_GetPlatformVIP(whichPlayer) > 0
    endfunction
    function DzAPI_Map_Global_GetStoreString takes string key returns string
        return RequestExtraStringData(36, GetLocalPlayer(), key, null, false, 0, 0, 0)
    endfunction
    function DzAPI_Map_Global_StoreString takes string key,string value returns nothing
        call RequestExtraBooleanData(37, GetLocalPlayer(), key, value, false, 0, 0, 0)
    endfunction
    function DzAPI_Map_Global_ChangeMsg takes trigger trig returns nothing
        call DzTriggerRegisterSyncData(trig, "DZGAU", true)
    endfunction
    function DzAPI_Map_ServerArchive takes player whichPlayer,string key returns string
        return RequestExtraStringData(38, whichPlayer, key, null, false, 0, 0, 0)
    endfunction
    function DzAPI_Map_SaveServerArchive takes player whichPlayer,string key,string value returns nothing
        call RequestExtraBooleanData(39, whichPlayer, key, value, false, 0, 0, 0)
    endfunction
    function DzAPI_Map_IsRPGQuickMatch takes nothing returns boolean
        return RequestExtraBooleanData(40, null, null, null, false, 0, 0, 0)
    endfunction
    function DzAPI_Map_GetMallItemCount takes player whichPlayer,string key returns integer
        return RequestExtraIntegerData(41, whichPlayer, key, null, false, 0, 0, 0)
    endfunction
    function DzAPI_Map_ConsumeMallItem takes player whichPlayer,string key,integer count returns boolean
        return RequestExtraBooleanData(42, whichPlayer, key, null, false, count, 0, 0)
    endfunction
    function DzAPI_Map_EnablePlatformSettings takes player whichPlayer,integer option,boolean enable returns boolean
        return RequestExtraBooleanData(43, whichPlayer, null, null, enable, option, 0, 0)
    endfunction
    function GetPlayerServerValueSuccess takes player whichPlayer returns boolean
        if ( DzAPI_Map_GetServerValueErrorCode(whichPlayer) == 0 ) then
            return true
        else
            return false
        endif
    endfunction
    function DzAPI_Map_StoreIntegerEX takes player whichPlayer,string key,integer value returns nothing
        set key="I" + key
        call RequestExtraBooleanData(39, whichPlayer, key, I2S(value), false, 0, 0, 0)
        set key=null
        set whichPlayer=null
    endfunction
    function DzAPI_Map_GetStoredIntegerEX takes player whichPlayer,string key returns integer
        local integer value
        set key="I" + key
        set value=S2I(RequestExtraStringData(38, whichPlayer, key, null, false, 0, 0, 0))
        set key=null
        set whichPlayer=null
        return value
    endfunction
    function DzAPI_Map_StoreInteger takes player whichPlayer,string key,integer value returns nothing
        set key="I" + key
        call DzAPI_Map_SaveServerValue(whichPlayer , key , I2S(value))
        set key=null
        set whichPlayer=null
    endfunction
    function DzAPI_Map_GetStoredInteger takes player whichPlayer,string key returns integer
        local integer value
        set key="I" + key
        set value=S2I(DzAPI_Map_GetServerValue(whichPlayer , key))
        set key=null
        set whichPlayer=null
        return value
    endfunction
        function DzAPI_Map_CommentTotalCount1 takes player whichPlayer,integer id returns integer
            return RequestExtraIntegerData(52, whichPlayer, null, null, false, id, 0, 0)
    endfunction
    function DzAPI_Map_StoreReal takes player whichPlayer,string key,real value returns nothing
        set key="R" + key
        call DzAPI_Map_SaveServerValue(whichPlayer , key , R2S(value))
        set key=null
        set whichPlayer=null
    endfunction
    function DzAPI_Map_GetStoredReal takes player whichPlayer,string key returns real
        local real value
        set key="R" + key
        set value=S2R(DzAPI_Map_GetServerValue(whichPlayer , key))
        set key=null
        set whichPlayer=null
        return value
    endfunction
    function DzAPI_Map_StoreBoolean takes player whichPlayer,string key,boolean value returns nothing
        set key="B" + key
        if ( value ) then
            call DzAPI_Map_SaveServerValue(whichPlayer , key , "1")
        else
            call DzAPI_Map_SaveServerValue(whichPlayer , key , "0")
        endif
        set key=null
        set whichPlayer=null
    endfunction
    function DzAPI_Map_GetStoredBoolean takes player whichPlayer,string key returns boolean
        local boolean value
        set key="B" + key
        set key=DzAPI_Map_GetServerValue(whichPlayer , key)
        if ( key == "1" ) then
            set value=true
        else
            set value=false
        endif
        set key=null
        set whichPlayer=null
        return value
    endfunction
    function DzAPI_Map_StoreString takes player whichPlayer,string key,string value returns nothing
        set key="S" + key
        call DzAPI_Map_SaveServerValue(whichPlayer , key , value)
        set key=null
        set whichPlayer=null
    endfunction
    function DzAPI_Map_GetStoredString takes player whichPlayer,string key returns string
        return DzAPI_Map_GetServerValue(whichPlayer , "S" + key)
    endfunction
    function DzAPI_Map_StoreStringEX takes player whichPlayer,string key,string value returns nothing
        set key="S" + key
        call RequestExtraBooleanData(39, whichPlayer, key, value, false, 0, 0, 0)
        set key=null
        set whichPlayer=null
    endfunction
    function DzAPI_Map_GetStoredStringEX takes player whichPlayer,string key returns string
        return RequestExtraStringData(38, whichPlayer, "S" + key, null, false, 0, 0, 0)
    endfunction
    function DzAPI_Map_GetStoredUnitType takes player whichPlayer,string key returns integer
        local integer value
        set key="I" + key
        set value=S2I(DzAPI_Map_GetServerValue(whichPlayer , key))
        set key=null
        set whichPlayer=null
        return value
    endfunction
    function DzAPI_Map_GetStoredAbilityId takes player whichPlayer,string key returns integer
        local integer value
        set key="I" + key
        set value=S2I(DzAPI_Map_GetServerValue(whichPlayer , key))
        set key=null
        set whichPlayer=null
        return value
    endfunction
    function DzAPI_Map_FlushStoredMission takes player whichPlayer,string key returns nothing
        call DzAPI_Map_SaveServerValue(whichPlayer , key , null)
        set key=null
        set whichPlayer=null
    endfunction
    function DzAPI_Map_Ladder_SubmitIntegerData takes player whichPlayer,string key,integer value returns nothing
        call DzAPI_Map_Ladder_SetStat(whichPlayer , key , I2S(value))
    endfunction
    function DzAPI_Map_Stat_SubmitUnitIdData takes player whichPlayer,string key,integer value returns nothing
        if ( value == 0 ) then
            //call DzAPI_Map_Ladder_SetStat(whichPlayer,key,"0")
        else
            call DzAPI_Map_Ladder_SetStat(whichPlayer , key , I2S(value))
        endif
    endfunction
    function DzAPI_Map_Stat_SubmitUnitData takes player whichPlayer,string key,unit value returns nothing
        call DzAPI_Map_Stat_SubmitUnitIdData(whichPlayer , key , GetUnitTypeId(value))
    endfunction
    function DzAPI_Map_Ladder_SubmitAblityIdData takes player whichPlayer,string key,integer value returns nothing
        if ( value == 0 ) then
            //call DzAPI_Map_Ladder_SetStat(whichPlayer,key,"0")
        else
            call DzAPI_Map_Ladder_SetStat(whichPlayer , key , I2S(value))
        endif
    endfunction
    function DzAPI_Map_Ladder_SubmitItemIdData takes player whichPlayer,string key,integer value returns nothing
        local string S
        if ( value == 0 ) then
            set S="0"
        else
            set S=I2S(value)
            call DzAPI_Map_Ladder_SetStat(whichPlayer , key , S)
        endif
        //call DzAPI_Map_Ladder_SetStat(whichPlayer,key,S)
        set S=null
        set whichPlayer=null
    endfunction
    function DzAPI_Map_Ladder_SubmitItemData takes player whichPlayer,string key,item value returns nothing
        call DzAPI_Map_Ladder_SubmitItemIdData(whichPlayer , key , GetItemTypeId(value))
    endfunction
    function DzAPI_Map_Ladder_SubmitBooleanData takes player whichPlayer,string key,boolean value returns nothing
        if ( value ) then
            call DzAPI_Map_Ladder_SetStat(whichPlayer , key , "1")
        else
            call DzAPI_Map_Ladder_SetStat(whichPlayer , key , "0")
        endif
    endfunction
    function DzAPI_Map_Ladder_SubmitTitle takes player whichPlayer,string value returns nothing
        call DzAPI_Map_Ladder_SetStat(whichPlayer , value , "1")
    endfunction
    function DzAPI_Map_Ladder_SubmitPlayerRank takes player whichPlayer,integer value returns nothing
        call DzAPI_Map_Ladder_SetPlayerStat(whichPlayer , "RankIndex" , I2S(value))
    endfunction
    function DzAPI_Map_Ladder_SubmitPlayerExtraExp takes player whichPlayer,integer value returns nothing
        call DzAPI_Map_Ladder_SetStat(whichPlayer , "ExtraExp" , I2S(value))
    endfunction
    function DzAPI_Map_PlayedGames takes player whichPlayer returns integer
        return RequestExtraIntegerData(45, whichPlayer, null, null, false, 0, 0, 0)
    endfunction
    function DzAPI_Map_CommentCount takes player whichPlayer returns integer
        return RequestExtraIntegerData(46, whichPlayer, null, null, false, 0, 0, 0)
    endfunction
    function DzAPI_Map_FriendCount takes player whichPlayer returns integer
        return RequestExtraIntegerData(47, whichPlayer, null, null, false, 0, 0, 0)
    endfunction
    function DzAPI_Map_IsConnoisseur takes player whichPlayer returns boolean
        return RequestExtraBooleanData(48, whichPlayer, null, null, false, 0, 0, 0)
    endfunction
    function DzAPI_Map_IsAuthor takes player whichPlayer returns boolean
        return RequestExtraBooleanData(50, whichPlayer, null, null, false, 0, 0, 0)
    endfunction
    function DzAPI_Map_CommentTotalCount takes nothing returns integer
        return RequestExtraIntegerData(51, null, null, null, false, 0, 0, 0)
    endfunction
    function DzAPI_Map_Statistics takes player whichPlayer,string eventKey,string eventType,integer value returns nothing
        call RequestExtraBooleanData(34, whichPlayer, eventKey, eventType, false, value, 0, 0)
    endfunction
    function DzAPI_Map_Returns takes player whichPlayer,integer label returns boolean
        return RequestExtraBooleanData(53, whichPlayer, null, null, false, label, 0, 0)
    endfunction
    function DzAPI_Map_ContinuousCount takes player whichPlayer,integer id returns integer
        return RequestExtraIntegerData(54, whichPlayer, null, null, false, id, 0, 0)
    endfunction
    // IsPlayer,                      //是否为玩家
    function DzAPI_Map_IsPlayer takes player whichPlayer returns boolean
        return RequestExtraBooleanData(55, whichPlayer, null, null, false, 0, 0, 0)
    endfunction
    // MapsTotalPlayed,               //所有地图的总游戏时长
    function DzAPI_Map_MapsTotalPlayed takes player whichPlayer returns integer
        return RequestExtraIntegerData(56, whichPlayer, null, null, false, 0, 0, 0)
    endfunction
    // MapsLevel,                    //指定地图的地图等级
    function DzAPI_Map_MapsLevel takes player whichPlayer,integer mapId returns integer
        return RequestExtraIntegerData(57, whichPlayer, null, null, false, mapId, 0, 0)
    endfunction
    // MapsConsumeGold,              //所有地图的金币消耗
    function DzAPI_Map_MapsConsumeGold takes player whichPlayer,integer mapId returns integer
        return RequestExtraIntegerData(58, whichPlayer, null, null, false, mapId, 0, 0)
    endfunction
    // MapsConsumeLumber,            //所有地图的木材消耗
    function DzAPI_Map_MapsConsumeLumber takes player whichPlayer,integer mapId returns integer
        return RequestExtraIntegerData(59, whichPlayer, null, null, false, mapId, 0, 0)
    endfunction
    // MapsConsumeLv1,               //消费 1-199
    function DzAPI_Map_MapsConsumeLv1 takes player whichPlayer,integer mapId returns boolean
        return RequestExtraBooleanData(60, whichPlayer, null, null, false, mapId, 0, 0)
    endfunction
    // MapsConsumeLv2,               //消费 200-499
    function DzAPI_Map_MapsConsumeLv2 takes player whichPlayer,integer mapId returns boolean
        return RequestExtraBooleanData(61, whichPlayer, null, null, false, mapId, 0, 0)
    endfunction
    // MapsConsumeLv3,               //消费 500~999
    function DzAPI_Map_MapsConsumeLv3 takes player whichPlayer,integer mapId returns boolean
        return RequestExtraBooleanData(62, whichPlayer, null, null, false, mapId, 0, 0)
    endfunction
    // MapsConsumeLv4,               //消费 1000+
    function DzAPI_Map_MapsConsumeLv4 takes player whichPlayer,integer mapId returns boolean
        return RequestExtraBooleanData(63, whichPlayer, null, null, false, mapId, 0, 0)
    endfunction
    // IsPlayerUsingSkin,            //检查是否装备着皮肤（skinType：头像=1、边框=2、称号=3、底纹=4）
    function DzAPI_Map_IsPlayerUsingSkin takes player whichPlayer,integer skinType,integer id returns boolean
        return RequestExtraBooleanData(64, whichPlayer, null, null, false, skinType, id, 0)
    endfunction
    //获取论坛数据（0=累计获得赞数，1=精华帖数量，2=发表回复次数，3=收到的欢乐数，4=是否发过贴子，5=是否版主，6=主题数量）
    function DzAPI_Map_GetForumData takes player whichPlayer,integer whichData returns integer
        return RequestExtraIntegerData(65, whichPlayer, null, null, false, whichData, 0, 0)
    endfunction
    // PlayerFlags,                   //玩家标记 label（1=曾经是平台回流用户，2=当前是平台回流用户，4=曾经是地图回流用户，8=当前是地图回流用户，16=地图是否被玩家收藏）
    function DzAPI_Map_PlayerFlags takes player whichPlayer,integer label returns boolean
        return RequestExtraBooleanData(53, whichPlayer, null, null, false, label, 0, 0)
    endfunction
    // GetLotteryUsedCount, // 获取宝箱抽取次数
    function DzAPI_Map_GetLotteryUsedCountEx takes player whichPlayer,integer index returns integer
        return RequestExtraIntegerData(68, whichPlayer, null, null, false, index, 0, 0)
    endfunction
    function DzAPI_Map_GetLotteryUsedCount takes player whichPlayer returns integer
        return DzAPI_Map_GetLotteryUsedCountEx(whichPlayer , 0) + DzAPI_Map_GetLotteryUsedCountEx(whichPlayer , 1) + DzAPI_Map_GetLotteryUsedCountEx(whichPlayer , 2)
    endfunction
    function DzAPI_Map_OpenMall takes player whichPlayer,string whichkey returns boolean
        return RequestExtraBooleanData(66, whichPlayer, whichkey, null, false, 0, 0, 0)
    endfunction
    function DzAPI_Map_GameResult_CommitData takes player whichPlayer,string key,string value returns nothing
        call RequestExtraIntegerData(69, whichPlayer, key, value, false, 0, 0, 0)
    endfunction
    //游戏结算
    function DzAPI_Map_GameResult_CommitTitle takes player whichPlayer,string value returns nothing
        call DzAPI_Map_GameResult_CommitData(whichPlayer , value , "1")
        set whichPlayer=null
        set value=null
    endfunction
    function DzAPI_Map_GameResult_CommitPlayerRank takes player whichPlayer,integer value returns nothing
        call DzAPI_Map_GameResult_CommitData(whichPlayer , "RankIndex" , I2S(value))
        set whichPlayer=null
        set value=0
    endfunction
    function DzAPI_Map_GameResult_CommitGameMode takes string value returns nothing
        call DzAPI_Map_GameResult_CommitData(GetLocalPlayer() , "InnerGameMode" , value)
        set value=null
    endfunction
    function DzAPI_Map_GameResult_CommitGameResult takes player whichPlayer,integer value returns nothing
        call DzAPI_Map_GameResult_CommitData(whichPlayer , "GameResult" , I2S(value))
        set whichPlayer=null
    endfunction
    function DzAPI_Map_GameResult_CommitGameResultNoEnd takes player whichPlayer,integer value returns nothing
        call DzAPI_Map_GameResult_CommitData(whichPlayer , "GameResultNoEnd" , I2S(value))
        set whichPlayer=null
    endfunction
    // GetSinceLastPlayedSeconds, // 获取距最后一次游戏的秒数
    function DzAPI_Map_GetSinceLastPlayedSeconds takes player whichPlayer returns integer
        return RequestExtraIntegerData(70, whichPlayer, null, null, false, 0, 0, 0)
    endfunction
    // QuickBuy, //游戏内快速购买
    function DzAPI_Map_QuickBuy takes player whichPlayer,string key,integer count,integer seconds returns boolean
        return RequestExtraBooleanData(72, whichPlayer, key, null, false, count, seconds, 0)
    endfunction
    // CancelQuickBuy, //取消快速购买
    function DzAPI_Map_CancelQuickBuy takes player whichPlayer returns boolean
        return RequestExtraBooleanData(73, whichPlayer, null, null, false, 0, 0, 0)
    endfunction
    //判断是加载成功某个玩家的道具
    function DzAPI_Map_PlayerLoadedItems takes player whichPlayer returns boolean
        return RequestExtraBooleanData(77, whichPlayer, null, null, false, 0, 0, 0)
    endfunction
    function DzAPI_Map_CustomRankCount takes integer id returns integer
        return RequestExtraIntegerData(78, null, null, null, false, id, 0, 0)
    endfunction
    // CustomRankPlayerName            // 获取排行榜上指定排名的用户名称
    function DzAPI_Map_CustomRankPlayerName takes integer id,integer ranking returns string
        return RequestExtraStringData(79, null, null, null, false, id, ranking, 0)
    endfunction
    // CustomRankPlayerValue           // 获取排行榜上指定排名的值
    function DzAPI_Map_CustomRankValue takes integer id,integer ranking returns integer
        return RequestExtraIntegerData(80, null, null, null, false, id, ranking, 0)
    endfunction
    //获取玩家在KK平台的完整昵称（基础昵称#编号）
    function DzAPI_Map_GetPlayerUserName takes player whichPlayer returns string
        return RequestExtraStringData(81, whichPlayer, null, null, false, 0, 0, 0)
    endfunction
    // GetServerValueLimitLeft,   // 获取服务器存档限制余额
    function KKApiGetServerValueLimitLeft takes player whichPlayer,string key returns integer
        return RequestExtraIntegerData(82, whichPlayer, key, null, false, 0, 0, 0)
    endfunction
    // RequestBackendLogic,       //请求后端逻辑生成 
    function KKApiRequestBackendLogic takes player whichPlayer,string key,string groupkey returns boolean
        return RequestExtraBooleanData(83, whichPlayer, key, groupkey, false, 0, 0, 0)
    endfunction
    // CheckBackendLogicExists,   // 获取后端逻辑生成结果 是否存在
    function KKApiCheckBackendLogicExists takes player whichPlayer,string key returns boolean
        return RequestExtraBooleanData(84, whichPlayer, key, null, false, 0, 0, 0)
    endfunction
    // GetBackendLogicIntResult,  // 获取后端逻辑生成结果 整型
    function KKApiGetBackendLogicIntResult takes player whichPlayer,string key returns integer
        return RequestExtraIntegerData(85, whichPlayer, key, null, false, 0, 0, 0)
    endfunction
    // GetBackendLogicStrResult,  // 获取后端逻辑生成结果 字符串
    function KKApiGetBackendLogicStrResult takes player whichPlayer,string key returns string
        return RequestExtraStringData(86, whichPlayer, key, null, false, 0, 0, 0)
    endfunction
    // GetBackendLogicUpdateTime, // 获取后端逻辑生成时间
    function KKApiGetBackendLogicUpdateTime takes player whichPlayer,string key returns integer
        return RequestExtraIntegerData(87, whichPlayer, key, null, false, 0, 0, 0)
    endfunction
    // GetBackendLogicGroup,      // 获取后端逻辑生成组
    function KKApiGetBackendLogicGroup takes player whichPlayer,string key returns string
        return RequestExtraStringData(88, whichPlayer, key, null, false, 0, 0, 0)
    endfunction
    // RemoveBackendLogicResult,  // 删除后端逻辑生成结果
    function KKApiRemoveBackendLogicResult takes player whichPlayer,string key returns boolean
        return RequestExtraBooleanData(89, whichPlayer, key, null, false, 0, 0, 0)
    endfunction
    // 获取随机存档剩余次数
    function KKApiRandomSaveGameCount takes player whichPlayer,string groupkey returns integer
        return RequestExtraIntegerData(101, whichPlayer, groupkey, null, false, 0, 0, 0)
    endfunction
    function KKApiTriggerRegisterBackendLogicUpdata takes trigger trig returns nothing
        call DzTriggerRegisterSyncData(trig, "DZBLU", true)
    endfunction
    function KKApiTriggerRegisterBackendLogicDelete takes trigger trig returns nothing
        call DzTriggerRegisterSyncData(trig, "DZBLD", true)
    endfunction
    function KKApiGetSyncBackendLogic takes nothing returns string
        return DzGetTriggerSyncData()
    endfunction
    function KKApiIsGameMode takes nothing returns boolean
        return RequestExtraBooleanData(90, null, null, null, false, 0, 0, 0)
    endfunction
    function KKApiInitializeGameKey takes player whichPlayer,integer setIndex,string k,string data returns boolean
        return RequestExtraBooleanData(91, whichPlayer, "[{\"name\":\"" + data + "\",\"key\":\"" + k + "\"}]", null, false, setIndex, 0, 0)
    endfunction
    function KKApiPlayerGUID takes player whichPlayer returns string
        return RequestExtraStringData(93, whichPlayer, null, null, false, 0, 0, 0)
    endfunction
    function KKApiIsTaskInProgress takes player whichPlayer,integer setIndex,integer taskstat returns boolean
        return RequestExtraIntegerData(94, whichPlayer, null, null, false, setIndex, 0, 0) == taskstat
    endfunction
    function KKApiQueryTaskCurrentProgress takes player whichPlayer,integer setIndex returns integer
        return RequestExtraIntegerData(95, whichPlayer, null, null, false, setIndex, 0, 0)
    endfunction
    function KKApiQueryTaskTotalProgress takes player whichPlayer,integer setIndex returns integer
        return RequestExtraIntegerData(96, whichPlayer, null, null, false, setIndex, 0, 0)
    endfunction
    // IsAchievementCompleted,  // 获取玩家成就是否完成
    function KKApiIsAchievementCompleted takes player whichPlayer,string id returns boolean
        return RequestExtraBooleanData(98, whichPlayer, id, null, false, 0, 0, 0)
    endfunction
    // AchievementPoints,  // 获取玩家地图成就点数
    function KKApiAchievementPoints takes player whichPlayer returns integer
        return RequestExtraIntegerData(99, whichPlayer, null, null, false, 0, 0, 0)
    endfunction
    
    // 判断游戏时长是否满足条件 minHours: 最小小时数，maxHours: 最大小时数，0表示不限制
    function KKApiPlayedTime takes player whichPlayer,integer minHours,integer maxHours returns boolean
        return RequestExtraBooleanData(100, whichPlayer, null, null, false, minHours, maxHours, 0)
    endfunction
    // BeginBatchSaveArchive,  // 开始批量保存存档
    function KKApiBeginBatchSaveArchive takes player whichPlayer returns boolean
        return RequestExtraBooleanData(102, whichPlayer, null, null, false, 0, 0, 0)
    endfunction
    
    // AddBatchSaveArchive,    // 添加批量保存存档条目
    function KKApiAddBatchSaveArchive takes player whichPlayer,string key,string value,boolean caseInsensitive returns boolean
        return RequestExtraBooleanData(103, whichPlayer, key, value, caseInsensitive, 0, 0, 0)
    endfunction
    
    // EndBatchSaveArchive,    // 结束批量保存存档
    function KKApiEndBatchSaveArchive takes player whichPlayer,boolean abandon returns boolean
        return RequestExtraBooleanData(104, whichPlayer, null, null, abandon, 0, 0, 0)
    endfunction
    //天梯投降
    function KKApiTriggerRegisterLadderSurrender takes trigger trig returns nothing
        call DzTriggerRegisterSyncData(trig, "DZSR", true)
    endfunction
    function KKApiGetLadderSurrenderTeamId takes nothing returns integer
        return S2I(DzGetTriggerSyncData())
    endfunction
    // GetGuildLevel,          // 获取公会等级
    function KKApiGetGuildLevel takes player whichPlayer returns integer
        return RequestExtraIntegerData(106, whichPlayer, null, null, false, 0, 0, 0)
    endfunction
    //宠物探险次数
    function KKApiMapExplorationNum takes player whichPlayer returns integer
        return RequestExtraIntegerData(107, whichPlayer, null, null, false, 0, 0, 0)
    endfunction
    //宠物探险时间
    function KKApiMapExplorationTime takes player whichPlayer returns integer
        return RequestExtraIntegerData(108, whichPlayer, null, null, false, 0, 0, 0)
    endfunction
    
    //测试大厅预约人数
    function KKApiMapOrderNum takes nothing returns integer
        return RequestExtraIntegerData(109, null, null, null, false, 0, 0, 0)
    endfunction
    // 发送云脚本数据
    function KKApiMlScriptEvent takes player whichPlayer,string eventName,string payload returns boolean
        return RequestExtraBooleanData(110, whichPlayer, eventName, payload, false, 0, 0, 0)
    endfunction
    // 获取商城道具最后变动的数量（新增/删除）
    function KKApiGetMallItemUpdateCount takes player whichPlayer,string key returns integer
        return RequestExtraIntegerData(110, whichPlayer, key, null, false, 0, 0, 0)
    endfunction

//library DzAPI ends
//library Geometry:
    function GetDistance takes real x1,real y1,real x2,real y2 returns real
        local real dx=x2 - x1
        local real dy=y2 - y1
        return SquareRoot(dx * dx + dy * dy)
    endfunction  // 6个坐标的距离
    function GetDistanceZ takes real x1,real y1,real z1,real x2,real y2,real z2 returns real
        local real dx=x2 - x1
        local real dy=y2 - y1
        local real dz=z2 - z1
        return SquareRoot(dx * dx + dy * dy + dz * dz)
    endfunction  // 4个坐标的角度,前面是人的位置，后面是点的位置
    function GetFacing takes real x1,real y1,real x2,real y2 returns real
        return Atan2BJ(y2 - y1, x2 - x1)
    endfunction

//library Geometry ends
//library JBase:

//library JBase ends
//library Music:
        function s__music_playFor takes integer this,player p returns nothing
            if ( GetLocalPlayer() == p ) then
                call StartSound(s__music_snd[this])
            endif
        endfunction  //播放音效
        function s__music_play takes integer this returns nothing
            call StartSound(s__music_snd[this])
        endfunction
        function s__music_onInit takes nothing returns nothing
            local sound snd=null
            set snd=null
        endfunction

//library Music ends
//library PIVInterface:
//---------------------------------------------------------------------------------------------------
	
 function IsPIV takes player p returns boolean
		return sPIV[GetConvertedPlayerId(p)]
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function hasPIV takes nothing returns boolean
  local integer i= 1
		loop
			exitwhen i > 6
			if ( IsPIV(ConvertedPlayer(i)) ) then
				return true
			endif
			set i=i + 1
		endloop
		return false
	endfunction

//library PIVInterface ends
//library RegionUtils:
        function s__triangleXY_random takes real ax,real ay,real bx,real by,real cx,real cy returns nothing
            local real rA=GetRandomReal(0, 1.0)
            local real rB=GetRandomReal(0, 1.0)
            local real abx=bx - ax
            local real aby=by - ay
            local real acx=cx - ax
            local real acy=cy - ay
            if ( rA + rB > 1.0 ) then
                set rA=1.0 - rA
                set rB=1.0 - rB
            endif
            set s__triangleXY_x=ax + rA * abx + rB * acx
            set s__triangleXY_y=ay + rA * aby + rB * acy
        endfunction
    function GetRectRandomInnerX takes rect r,real inner returns real
        return GetRandomReal(GetRectMinX(r) + inner, GetRectMaxX(r) - inner)
    endfunction  // 矩形区域内随机取点[内嵌一定范围]
    function GetRectRandomInnerY takes rect r,real inner returns real
        return GetRandomReal(GetRectMinY(r) + inner, GetRectMaxY(r) - inner)
    endfunction  // 矩形区域内随机取点
    function GetRectRandomX takes rect r returns real
        return GetRandomReal(GetRectMinX(r), GetRectMaxX(r))
    endfunction  // 矩形区域内随机取点
    function GetRectRandomY takes rect r returns real
        return GetRandomReal(GetRectMinY(r), GetRectMaxY(r))
    endfunction

//library RegionUtils ends
//library StringUtils:
    function RepeatString takes string s,integer times,integer gap1,integer gap2 returns string
        local integer i
        set StringUtils___temp=""
        set i=1
        loop
        exitwhen ( i > times )
            set StringUtils___temp=StringUtils___temp + s
            if ( ModuloInteger(i, gap1) == 0 ) then
                set StringUtils___temp=StringUtils___temp + " "
            endif
            if ( ModuloInteger(i, gap2) == 0 ) then
                set StringUtils___temp=StringUtils___temp + "\n"
            endif
        set i=i + 1
        endloop
        return StringUtils___temp
    endfunction  //判断一个字符串是否有东西
    function IsNotEmpty takes string s returns boolean
        return ( s != null and s != "" )
    endfunction
    function I2SM takes integer num,integer bit returns string
        local integer i
        local integer count
        local string s
        if ( num < 0 ) then
            return I2S(num)
        endif
        set s=I2S(num)
        set count=bit - StringLength(s)
        set i=1
        loop
        exitwhen ( i > count )
            set s="0" + s
        set i=i + 1
        endloop
        return s
    endfunction  //赞助系统：循环Hash
    function GetCycleHash takes string s,integer times returns integer
        local string result=s
        local integer i
        set i=1
        loop
        exitwhen ( i > times )
            set result=I2S(StringHash(result))
        set i=i + 1
        endloop
        return S2I(result)
    endfunction  //拼接式存放数据的API
    function IMendS takes integer num,integer bit returns string
        local integer abs=IAbsBJ(num)
        local string result=I2S(abs)
        local integer i
        local integer length=StringLength(result)
        set i=1
        loop
        exitwhen ( i > bit - length )
            set result="0" + result
        set i=i + 1
        endloop
        return result
    endfunction

//library StringUtils ends
//library UnitFilter:
    function IsEnemy takes player p,unit u returns boolean
        return GetUnitState(u, UNIT_STATE_LIFE) > .405 and ( not ( IsUnitType(u, UNIT_TYPE_STRUCTURE) ) ) and ( not ( IsUnitHidden(u) ) ) and IsUnitEnemy(u, p) and GetUnitAbilityLevel(u, 'Avul') == 0
    endfunction  //旧名：IsEnemy2
    function IsEnemyIncludeInvul takes player p,unit u returns boolean
        return GetUnitState(u, UNIT_STATE_LIFE) > .405 and ( not ( IsUnitType(u, UNIT_TYPE_STRUCTURE) ) ) and ( not ( IsUnitHidden(u) ) ) and IsUnitEnemy(u, p)
    endfunction  //判断是否是友方
    function IsAlly takes player p,unit u returns boolean
        return GetUnitState(u, UNIT_STATE_LIFE) > .405 and ( not ( IsUnitType(u, UNIT_TYPE_STRUCTURE) ) ) and ( not ( IsUnitHidden(u) ) ) and IsUnitAlly(u, p)
    endfunction

//library UnitFilter ends
//library YDLua:

    function initializeLua takes nothing returns integer
        call Cheat("exec-lua:plugin_main")
        return 0
    endfunction
        function YDLua___anon__0 takes nothing returns nothing
            call BJDebugMsg("调用了YDLua引擎")
            call DestroyTrigger(GetTriggeringTrigger())
        endfunction
    function YDLua___onInit takes nothing returns nothing
        local trigger tr=CreateTrigger()
        call TriggerRegisterTimerEventSingle(tr, 0.0)
        call TriggerAddCondition(tr, Condition(function YDLua___anon__0))
        set tr=null
    endfunction

//library YDLua ends
//library YDTriggerSaveLoadSystem:
//#  define YDTRIGGER_handle(SG)                          YDTRIGGER_HT##SG##(HashtableHandle)
    function YDTriggerSaveLoadSystem___Init takes nothing returns nothing
            set YDHT=InitHashtable()
        set YDLOC=InitHashtable()
    endfunction

//library YDTriggerSaveLoadSystem ends
//library YDWEBase:
//===========================================================================
//HashTable
//===========================================================================
//===========================================================================
//Return bug
//===========================================================================
function YDWEH2I takes handle h returns integer
    return GetHandleId(h)
endfunction
//����
function YDWEFlushAllData takes nothing returns nothing
    call FlushParentHashtable(YDHT)
endfunction
function YDWEFlushMissionByInteger takes integer i returns nothing
    call FlushChildHashtable(YDHT, i)
endfunction
function YDWEFlushMissionByString takes string s returns nothing
    call FlushChildHashtable(YDHT, StringHash(s))
endfunction
function YDWEFlushStoredIntegerByInteger takes integer i,integer j returns nothing
    call RemoveSavedInteger(YDHT, i, j)
endfunction
function YDWEFlushStoredIntegerByString takes string s1,string s2 returns nothing
    call RemoveSavedInteger(YDHT, StringHash(s1), StringHash(s2))
endfunction
function YDWEHaveSavedIntegerByInteger takes integer i,integer j returns boolean
    return HaveSavedInteger(YDHT, i, j)
endfunction
function YDWEHaveSavedIntegerByString takes string s1,string s2 returns boolean
    return HaveSavedInteger(YDHT, StringHash(s1), StringHash(s2))
endfunction
//store and get integer
function YDWESaveIntegerByInteger takes integer pTable,integer pKey,integer i returns nothing
    call SaveInteger(YDHT, pTable, pKey, i)
endfunction
function YDWESaveIntegerByString takes string pTable,string pKey,integer i returns nothing
    call SaveInteger(YDHT, StringHash(pTable), StringHash(pKey), i)
endfunction
function YDWEGetIntegerByInteger takes integer pTable,integer pKey returns integer
    return LoadInteger(YDHT, pTable, pKey)
endfunction
function YDWEGetIntegerByString takes string pTable,string pKey returns integer
    return LoadInteger(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//store and get real
function YDWESaveRealByInteger takes integer pTable,integer pKey,real r returns nothing
    call SaveReal(YDHT, pTable, pKey, r)
endfunction
function YDWESaveRealByString takes string pTable,string pKey,real r returns nothing
    call SaveReal(YDHT, StringHash(pTable), StringHash(pKey), r)
endfunction
function YDWEGetRealByInteger takes integer pTable,integer pKey returns real
    return LoadReal(YDHT, pTable, pKey)
endfunction
function YDWEGetRealByString takes string pTable,string pKey returns real
    return LoadReal(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//store and get string
function YDWESaveStringByInteger takes integer pTable,integer pKey,string s returns nothing
    call SaveStr(YDHT, pTable, pKey, s)
endfunction
function YDWESaveStringByString takes string pTable,string pKey,string s returns nothing
    call SaveStr(YDHT, StringHash(pTable), StringHash(pKey), s)
endfunction
function YDWEGetStringByInteger takes integer pTable,integer pKey returns string
    return LoadStr(YDHT, pTable, pKey)
endfunction
function YDWEGetStringByString takes string pTable,string pKey returns string
    return LoadStr(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//store and get boolean
function YDWESaveBooleanByInteger takes integer pTable,integer pKey,boolean b returns nothing
    call SaveBoolean(YDHT, pTable, pKey, b)
endfunction
function YDWESaveBooleanByString takes string pTable,string pKey,boolean b returns nothing
    call SaveBoolean(YDHT, StringHash(pTable), StringHash(pKey), b)
endfunction
function YDWEGetBooleanByInteger takes integer pTable,integer pKey returns boolean
    return LoadBoolean(YDHT, pTable, pKey)
endfunction
function YDWEGetBooleanByString takes string pTable,string pKey returns boolean
    return LoadBoolean(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert Unit
function YDWESaveUnitByInteger takes integer pTable,integer pKey,unit u returns nothing
    call SaveUnitHandle(YDHT, pTable, pKey, u)
endfunction
function YDWESaveUnitByString takes string pTable,string pKey,unit u returns nothing
    call SaveUnitHandle(YDHT, StringHash(pTable), StringHash(pKey), u)
endfunction
function YDWEGetUnitByInteger takes integer pTable,integer pKey returns unit
    return LoadUnitHandle(YDHT, pTable, pKey)
endfunction
function YDWEGetUnitByString takes string pTable,string pKey returns unit
    return LoadUnitHandle(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert UnitID
function YDWESaveUnitIDByInteger takes integer pTable,integer pKey,integer uid returns nothing
    call SaveInteger(YDHT, pTable, pKey, uid)
endfunction
function YDWESaveUnitIDByString takes string pTable,string pKey,integer uid returns nothing
    call SaveInteger(YDHT, StringHash(pTable), StringHash(pKey), uid)
endfunction
function YDWEGetUnitIDByInteger takes integer pTable,integer pKey returns integer
    return LoadInteger(YDHT, pTable, pKey)
endfunction
function YDWEGetUnitIDByString takes string pTable,string pKey returns integer
    return LoadInteger(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert AbilityID
function YDWESaveAbilityIDByInteger takes integer pTable,integer pKey,integer abid returns nothing
    call SaveInteger(YDHT, pTable, pKey, abid)
endfunction
function YDWESaveAbilityIDByString takes string pTable,string pKey,integer abid returns nothing
    call SaveInteger(YDHT, StringHash(pTable), StringHash(pKey), abid)
endfunction
function YDWEGetAbilityIDByInteger takes integer pTable,integer pKey returns integer
    return LoadInteger(YDHT, pTable, pKey)
endfunction
function YDWEGetAbilityIDByString takes string pTable,string pKey returns integer
    return LoadInteger(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert Player
function YDWESavePlayerByInteger takes integer pTable,integer pKey,player p returns nothing
    call SavePlayerHandle(YDHT, pTable, pKey, p)
endfunction
function YDWESavePlayerByString takes string pTable,string pKey,player p returns nothing
    call SavePlayerHandle(YDHT, StringHash(pTable), StringHash(pKey), p)
endfunction
function YDWEGetPlayerByInteger takes integer pTable,integer pKey returns player
    return LoadPlayerHandle(YDHT, pTable, pKey)
endfunction
function YDWEGetPlayerByString takes string pTable,string pKey returns player
    return LoadPlayerHandle(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert Item
function YDWESaveItemByInteger takes integer pTable,integer pKey,item it returns nothing
    call SaveItemHandle(YDHT, pTable, pKey, it)
endfunction
function YDWESaveItemByString takes string pTable,string pKey,item it returns nothing
    call SaveItemHandle(YDHT, StringHash(pTable), StringHash(pKey), it)
endfunction
function YDWEGetItemByInteger takes integer pTable,integer pKey returns item
    return LoadItemHandle(YDHT, pTable, pKey)
endfunction
function YDWEGetItemByString takes string pTable,string pKey returns item
    return LoadItemHandle(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert ItemID
function YDWESaveItemIDByInteger takes integer pTable,integer pKey,integer itid returns nothing
    call SaveInteger(YDHT, pTable, pKey, itid)
endfunction
function YDWESaveItemIDByString takes string pTable,string pKey,integer itid returns nothing
    call SaveInteger(YDHT, StringHash(pTable), StringHash(pKey), itid)
endfunction
function YDWEGetItemIDByInteger takes integer pTable,integer pKey returns integer
    return LoadInteger(YDHT, pTable, pKey)
endfunction
function YDWEGetItemIDByString takes string pTable,string pKey returns integer
    return LoadInteger(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert Timer
function YDWESaveTimerByInteger takes integer pTable,integer pKey,timer t returns nothing
    call SaveTimerHandle(YDHT, pTable, pKey, t)
endfunction
function YDWESaveTimerByString takes string pTable,string pKey,timer t returns nothing
    call SaveTimerHandle(YDHT, StringHash(pTable), StringHash(pKey), t)
endfunction
function YDWEGetTimerByInteger takes integer pTable,integer pKey returns timer
    return LoadTimerHandle(YDHT, pTable, pKey)
endfunction
function YDWEGetTimerByString takes string pTable,string pKey returns timer
    return LoadTimerHandle(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert Trigger
function YDWESaveTriggerByInteger takes integer pTable,integer pKey,trigger trg returns nothing
    call SaveTriggerHandle(YDHT, pTable, pKey, trg)
endfunction
function YDWESaveTriggerByString takes string pTable,string pKey,trigger trg returns nothing
    call SaveTriggerHandle(YDHT, StringHash(pTable), StringHash(pKey), trg)
endfunction
function YDWEGetTriggerByInteger takes integer pTable,integer pKey returns trigger
    return LoadTriggerHandle(YDHT, pTable, pKey)
endfunction
function YDWEGetTriggerByString takes string pTable,string pKey returns trigger
    return LoadTriggerHandle(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert Location
function YDWESaveLocationByInteger takes integer pTable,integer pKey,location pt returns nothing
    call SaveLocationHandle(YDHT, pTable, pKey, pt)
endfunction
function YDWESaveLocationByString takes string pTable,string pKey,location pt returns nothing
    call SaveLocationHandle(YDHT, StringHash(pTable), StringHash(pKey), pt)
endfunction
function YDWEGetLocationByInteger takes integer pTable,integer pKey returns location
    return LoadLocationHandle(YDHT, pTable, pKey)
endfunction
function YDWEGetLocationByString takes string pTable,string pKey returns location
    return LoadLocationHandle(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert Group
function YDWESaveGroupByInteger takes integer pTable,integer pKey,group g returns nothing
    call SaveGroupHandle(YDHT, pTable, pKey, g)
endfunction
function YDWESaveGroupByString takes string pTable,string pKey,group g returns nothing
    call SaveGroupHandle(YDHT, StringHash(pTable), StringHash(pKey), g)
endfunction
function YDWEGetGroupByInteger takes integer pTable,integer pKey returns group
    return LoadGroupHandle(YDHT, pTable, pKey)
endfunction
function YDWEGetGroupByString takes string pTable,string pKey returns group
    return LoadGroupHandle(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert Multiboard
function YDWESaveMultiboardByInteger takes integer pTable,integer pKey,multiboard m returns nothing
    call SaveMultiboardHandle(YDHT, pTable, pKey, m)
endfunction
function YDWESaveMultiboardByString takes string pTable,string pKey,multiboard m returns nothing
    call SaveMultiboardHandle(YDHT, StringHash(pTable), StringHash(pKey), m)
endfunction
function YDWEGetMultiboardByInteger takes integer pTable,integer pKey returns multiboard
    return LoadMultiboardHandle(YDHT, pTable, pKey)
endfunction
function YDWEGetMultiboardByString takes string pTable,string pKey returns multiboard
    return LoadMultiboardHandle(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert MultiboardItem
function YDWESaveMultiboardItemByInteger takes integer pTable,integer pKey,multiboarditem mt returns nothing
    call SaveMultiboardItemHandle(YDHT, pTable, pKey, mt)
endfunction
function YDWESaveMultiboardItemByString takes string pTable,string pKey,multiboarditem mt returns nothing
    call SaveMultiboardItemHandle(YDHT, StringHash(pTable), StringHash(pKey), mt)
endfunction
function YDWEGetMultiboardItemByInteger takes integer pTable,integer pKey returns multiboarditem
    return LoadMultiboardItemHandle(YDHT, pTable, pKey)
endfunction
function YDWEGetMultiboardItemByString takes string pTable,string pKey returns multiboarditem
    return LoadMultiboardItemHandle(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert TextTag
function YDWESaveTextTagByInteger takes integer pTable,integer pKey,texttag tt returns nothing
    call SaveTextTagHandle(YDHT, pTable, pKey, tt)
endfunction
function YDWESaveTextTagByString takes string pTable,string pKey,texttag tt returns nothing
    call SaveTextTagHandle(YDHT, StringHash(pTable), StringHash(pKey), tt)
endfunction
function YDWEGetTextTagByInteger takes integer pTable,integer pKey returns texttag
    return LoadTextTagHandle(YDHT, pTable, pKey)
endfunction
function YDWEGetTextTagByString takes string pTable,string pKey returns texttag
    return LoadTextTagHandle(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert Lightning
function YDWESaveLightningByInteger takes integer pTable,integer pKey,lightning ln returns nothing
    call SaveLightningHandle(YDHT, pTable, pKey, ln)
endfunction
function YDWESaveLightningByString takes string pTable,string pKey,lightning ln returns nothing
    call SaveLightningHandle(YDHT, StringHash(pTable), StringHash(pKey), ln)
endfunction
function YDWEGetLightningByInteger takes integer pTable,integer pKey returns lightning
    return LoadLightningHandle(YDHT, pTable, pKey)
endfunction
function YDWEGetLightningByString takes string pTable,string pKey returns lightning
    return LoadLightningHandle(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert Region
function YDWESaveRegionByInteger takes integer pTable,integer pKey,region rn returns nothing
    call SaveRegionHandle(YDHT, pTable, pKey, rn)
endfunction
function YDWESaveRegionByString takes string pTable,string pKey,region rt returns nothing
    call SaveRegionHandle(YDHT, StringHash(pTable), StringHash(pKey), rt)
endfunction
function YDWEGetRegionByInteger takes integer pTable,integer pKey returns region
    return LoadRegionHandle(YDHT, pTable, pKey)
endfunction
function YDWEGetRegionByString takes string pTable,string pKey returns region
    return LoadRegionHandle(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert Rect
function YDWESaveRectByInteger takes integer pTable,integer pKey,rect rn returns nothing
    call SaveRectHandle(YDHT, pTable, pKey, rn)
endfunction
function YDWESaveRectByString takes string pTable,string pKey,rect rt returns nothing
    call SaveRectHandle(YDHT, StringHash(pTable), StringHash(pKey), rt)
endfunction
function YDWEGetRectByInteger takes integer pTable,integer pKey returns rect
    return LoadRectHandle(YDHT, pTable, pKey)
endfunction
function YDWEGetRectByString takes string pTable,string pKey returns rect
    return LoadRectHandle(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert Leaderboard
function YDWESaveLeaderboardByInteger takes integer pTable,integer pKey,leaderboard lb returns nothing
    call SaveLeaderboardHandle(YDHT, pTable, pKey, lb)
endfunction
function YDWESaveLeaderboardByString takes string pTable,string pKey,leaderboard lb returns nothing
    call SaveLeaderboardHandle(YDHT, StringHash(pTable), StringHash(pKey), lb)
endfunction
function YDWEGetLeaderboardByInteger takes integer pTable,integer pKey returns leaderboard
    return LoadLeaderboardHandle(YDHT, pTable, pKey)
endfunction
function YDWEGetLeaderboardByString takes string pTable,string pKey returns leaderboard
    return LoadLeaderboardHandle(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert Effect
function YDWESaveEffectByInteger takes integer pTable,integer pKey,effect e returns nothing
    call SaveEffectHandle(YDHT, pTable, pKey, e)
endfunction
function YDWESaveEffectByString takes string pTable,string pKey,effect e returns nothing
    call SaveEffectHandle(YDHT, StringHash(pTable), StringHash(pKey), e)
endfunction
function YDWEGetEffectByInteger takes integer pTable,integer pKey returns effect
    return LoadEffectHandle(YDHT, pTable, pKey)
endfunction
function YDWEGetEffectByString takes string pTable,string pKey returns effect
    return LoadEffectHandle(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert Destructable
function YDWESaveDestructableByInteger takes integer pTable,integer pKey,destructable da returns nothing
    call SaveDestructableHandle(YDHT, pTable, pKey, da)
endfunction
function YDWESaveDestructableByString takes string pTable,string pKey,destructable da returns nothing
    call SaveDestructableHandle(YDHT, StringHash(pTable), StringHash(pKey), da)
endfunction
function YDWEGetDestructableByInteger takes integer pTable,integer pKey returns destructable
    return LoadDestructableHandle(YDHT, pTable, pKey)
endfunction
function YDWEGetDestructableByString takes string pTable,string pKey returns destructable
    return LoadDestructableHandle(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert triggercondition
function YDWESaveTriggerConditionByInteger takes integer pTable,integer pKey,triggercondition tc returns nothing
    call SaveTriggerConditionHandle(YDHT, pTable, pKey, tc)
endfunction
function YDWESaveTriggerConditionByString takes string pTable,string pKey,triggercondition tc returns nothing
    call SaveTriggerConditionHandle(YDHT, StringHash(pTable), StringHash(pKey), tc)
endfunction
function YDWEGetTriggerConditionByInteger takes integer pTable,integer pKey returns triggercondition
    return LoadTriggerConditionHandle(YDHT, pTable, pKey)
endfunction
function YDWEGetTriggerConditionByString takes string pTable,string pKey returns triggercondition
    return LoadTriggerConditionHandle(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert triggeraction
function YDWESaveTriggerActionByInteger takes integer pTable,integer pKey,triggeraction ta returns nothing
    call SaveTriggerActionHandle(YDHT, pTable, pKey, ta)
endfunction
function YDWESaveTriggerActionByString takes string pTable,string pKey,triggeraction ta returns nothing
    call SaveTriggerActionHandle(YDHT, StringHash(pTable), StringHash(pKey), ta)
endfunction
function YDWEGetTriggerActionByInteger takes integer pTable,integer pKey returns triggeraction
    return LoadTriggerActionHandle(YDHT, pTable, pKey)
endfunction
function YDWEGetTriggerActionByString takes string pTable,string pKey returns triggeraction
    return LoadTriggerActionHandle(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert event
function YDWESaveTriggerEventByInteger takes integer pTable,integer pKey,event et returns nothing
    call SaveTriggerEventHandle(YDHT, pTable, pKey, et)
endfunction
function YDWESaveTriggerEventByString takes string pTable,string pKey,event et returns nothing
    call SaveTriggerEventHandle(YDHT, StringHash(pTable), StringHash(pKey), et)
endfunction
function YDWEGetTriggerEventByInteger takes integer pTable,integer pKey returns event
    return LoadTriggerEventHandle(YDHT, pTable, pKey)
endfunction
function YDWEGetTriggerEventByString takes string pTable,string pKey returns event
    return LoadTriggerEventHandle(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert force
function YDWESaveForceByInteger takes integer pTable,integer pKey,force fc returns nothing
    call SaveForceHandle(YDHT, pTable, pKey, fc)
endfunction
function YDWESaveForceByString takes string pTable,string pKey,force fc returns nothing
    call SaveForceHandle(YDHT, StringHash(pTable), StringHash(pKey), fc)
endfunction
function YDWEGetForceByInteger takes integer pTable,integer pKey returns force
    return LoadForceHandle(YDHT, pTable, pKey)
endfunction
function YDWEGetForceByString takes string pTable,string pKey returns force
    return LoadForceHandle(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert boolexpr
function YDWESaveBoolexprByInteger takes integer pTable,integer pKey,boolexpr be returns nothing
    call SaveBooleanExprHandle(YDHT, pTable, pKey, be)
endfunction
function YDWESaveBoolexprByString takes string pTable,string pKey,boolexpr be returns nothing
    call SaveBooleanExprHandle(YDHT, StringHash(pTable), StringHash(pKey), be)
endfunction
function YDWEGetBoolexprByInteger takes integer pTable,integer pKey returns boolexpr
    return LoadBooleanExprHandle(YDHT, pTable, pKey)
endfunction
function YDWEGetBoolexprByString takes string pTable,string pKey returns boolexpr
    return LoadBooleanExprHandle(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert sound
function YDWESaveSoundByInteger takes integer pTable,integer pKey,sound sd returns nothing
    call SaveSoundHandle(YDHT, pTable, pKey, sd)
endfunction
function YDWESaveSoundByString takes string pTable,string pKey,sound sd returns nothing
    call SaveSoundHandle(YDHT, StringHash(pTable), StringHash(pKey), sd)
endfunction
function YDWEGetSoundByInteger takes integer pTable,integer pKey returns sound
    return LoadSoundHandle(YDHT, pTable, pKey)
endfunction
function YDWEGetSoundByString takes string pTable,string pKey returns sound
    return LoadSoundHandle(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert timerdialog
function YDWESaveTimerDialogByInteger takes integer pTable,integer pKey,timerdialog td returns nothing
    call SaveTimerDialogHandle(YDHT, pTable, pKey, td)
endfunction
function YDWESaveTimerDialogByString takes string pTable,string pKey,timerdialog td returns nothing
    call SaveTimerDialogHandle(YDHT, StringHash(pTable), StringHash(pKey), td)
endfunction
function YDWEGetTimerDialogByInteger takes integer pTable,integer pKey returns timerdialog
    return LoadTimerDialogHandle(YDHT, pTable, pKey)
endfunction
function YDWEGetTimerDialogByString takes string pTable,string pKey returns timerdialog
    return LoadTimerDialogHandle(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert trackable
function YDWESaveTrackableByInteger takes integer pTable,integer pKey,trackable ta returns nothing
    call SaveTrackableHandle(YDHT, pTable, pKey, ta)
endfunction
function YDWESaveTrackableByString takes string pTable,string pKey,trackable ta returns nothing
    call SaveTrackableHandle(YDHT, StringHash(pTable), StringHash(pKey), ta)
endfunction
function YDWEGetTrackableByInteger takes integer pTable,integer pKey returns trackable
    return LoadTrackableHandle(YDHT, pTable, pKey)
endfunction
function YDWEGetTrackableByString takes string pTable,string pKey returns trackable
    return LoadTrackableHandle(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert dialog
function YDWESaveDialogByInteger takes integer pTable,integer pKey,dialog d returns nothing
    call SaveDialogHandle(YDHT, pTable, pKey, d)
endfunction
function YDWESaveDialogByString takes string pTable,string pKey,dialog d returns nothing
    call SaveDialogHandle(YDHT, StringHash(pTable), StringHash(pKey), d)
endfunction
function YDWEGetDialogByInteger takes integer pTable,integer pKey returns dialog
    return LoadDialogHandle(YDHT, pTable, pKey)
endfunction
function YDWEGetDialogByString takes string pTable,string pKey returns dialog
    return LoadDialogHandle(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert button
function YDWESaveButtonByInteger takes integer pTable,integer pKey,button bt returns nothing
    call SaveButtonHandle(YDHT, pTable, pKey, bt)
endfunction
function YDWESaveButtonByString takes string pTable,string pKey,button bt returns nothing
    call SaveButtonHandle(YDHT, StringHash(pTable), StringHash(pKey), bt)
endfunction
function YDWEGetButtonByInteger takes integer pTable,integer pKey returns button
    return LoadButtonHandle(YDHT, pTable, pKey)
endfunction
function YDWEGetButtonByString takes string pTable,string pKey returns button
    return LoadButtonHandle(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert quest
function YDWESaveQuestByInteger takes integer pTable,integer pKey,quest qt returns nothing
    call SaveQuestHandle(YDHT, pTable, pKey, qt)
endfunction
function YDWESaveQuestByString takes string pTable,string pKey,quest qt returns nothing
    call SaveQuestHandle(YDHT, StringHash(pTable), StringHash(pKey), qt)
endfunction
function YDWEGetQuestByInteger takes integer pTable,integer pKey returns quest
    return LoadQuestHandle(YDHT, pTable, pKey)
endfunction
function YDWEGetQuestByString takes string pTable,string pKey returns quest
    return LoadQuestHandle(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
//Covert questitem
function YDWESaveQuestItemByInteger takes integer pTable,integer pKey,questitem qi returns nothing
    call SaveQuestItemHandle(YDHT, pTable, pKey, qi)
endfunction
function YDWESaveQuestItemByString takes string pTable,string pKey,questitem qi returns nothing
    call SaveQuestItemHandle(YDHT, StringHash(pTable), StringHash(pKey), qi)
endfunction
function YDWEGetQuestItemByInteger takes integer pTable,integer pKey returns questitem
    return LoadQuestItemHandle(YDHT, pTable, pKey)
endfunction
function YDWEGetQuestItemByString takes string pTable,string pKey returns questitem
    return LoadQuestItemHandle(YDHT, StringHash(pTable), StringHash(pKey))
endfunction
function YDWES2I takes string s returns integer
    return StringHash(s)
endfunction
function YDWESaveAbilityHandleBJ takes integer AbilityID,integer key,integer missionKey,hashtable table returns nothing
    call SaveInteger(table, missionKey, key, AbilityID)
endfunction
function YDWESaveAbilityHandle takes hashtable table,integer parentKey,integer childKey,integer AbilityID returns nothing
    call SaveInteger(table, parentKey, childKey, AbilityID)
endfunction
function YDWELoadAbilityHandleBJ takes integer key,integer missionKey,hashtable table returns integer
    return LoadInteger(table, missionKey, key)
endfunction
function YDWELoadAbilityHandle takes hashtable table,integer parentKey,integer childKey returns integer
    return LoadInteger(table, parentKey, childKey)
endfunction
//===========================================================================
//返回参数
//===========================================================================
//地图边界判断
function YDWECoordinateX takes real x returns real
    return RMinBJ(RMaxBJ(x, yd_MapMinX), yd_MapMaxX)
endfunction
function YDWECoordinateY takes real y returns real
    return RMinBJ(RMaxBJ(y, yd_MapMinY), yd_MapMaxY)
endfunction
//两个单位之间的距离
function YDWEDistanceBetweenUnits takes unit a,unit b returns real
    return SquareRoot(( GetUnitX(a) - GetUnitX(b) ) * ( GetUnitX(a) - GetUnitX(b) ) + ( GetUnitY(a) - GetUnitY(b) ) * ( GetUnitY(a) - GetUnitY(b) ))
endfunction
//两个单位之间的角度
function YDWEAngleBetweenUnits takes unit fromUnit,unit toUnit returns real
    return bj_RADTODEG * Atan2(GetUnitY(toUnit) - GetUnitY(fromUnit), GetUnitX(toUnit) - GetUnitX(fromUnit))
endfunction
//生成区域
function YDWEGetRect takes real x,real y,real width,real height returns rect
    return Rect(x - width * 0.5, y - height * 0.5, x + width * 0.5, y + height * 0.5)
endfunction
//===========================================================================
//设置单位可以飞行
//===========================================================================
function YDWEFlyEnable takes unit u returns nothing
    call UnitAddAbility(u, 'Amrf')
    call UnitRemoveAbility(u, 'Amrf')
endfunction
//===========================================================================
//字符窜与ID转换
//===========================================================================
function YDWEId2S takes integer value returns string
    local string charMap=bj_AllString
    local string result= ""
    local integer remainingValue= value
    local integer charValue
    local integer byteno
    set byteno=0
    loop
        set charValue=ModuloInteger(remainingValue, 256)
        set remainingValue=remainingValue / 256
        set result=SubString(charMap, charValue, charValue + 1) + result
        set byteno=byteno + 1
        exitwhen byteno == 4
    endloop
    return result
endfunction
function YDWES2Id takes string targetstr returns integer
    local string originstr=bj_AllString
    local integer strlength=StringLength(targetstr)
    local integer a=0
local integer b=0
local integer numx=1
local integer result=0
    loop
    exitwhen b > strlength - 1
        set numx=R2I(Pow(256, strlength - 1 - b))
        set a=1
        loop
            exitwhen a > 255
            if SubString(targetstr, b, b + 1) == SubString(originstr, a, a + 1) then
                set result=result + a * numx
                set a=256
            endif
            set a=a + 1
        endloop
        set b=b + 1
    endloop
    return result
endfunction
function YDWES2UnitId takes string targetstr returns integer
    return YDWES2Id(targetstr)
endfunction
function YDWES2ItemId takes string targetstr returns integer
    return YDWES2Id(targetstr)
endfunction
function GetLastAbilityCastingUnit takes nothing returns unit
    return bj_lastAbilityCastingUnit
endfunction
function GetLastAbilityTargetUnit takes nothing returns unit
    return bj_lastAbilityTargetUnit
endfunction
function YDWESetMapLimitCoordinate takes real MinX,real MaxX,real MinY,real MaxY returns nothing
    set yd_MapMaxX=MaxX
    set yd_MapMinX=MinX
    set yd_MapMaxY=MaxY
    set yd_MapMinY=MinY
endfunction
//===========================================================================
//===========================================================================
//地图初始化
//===========================================================================
//YDWE特殊技能结束事件
function YDWESyStemAbilityCastingOverTriggerAction takes unit u_hero,integer index returns nothing
 local integer i= 0
    loop
        exitwhen i >= YDWEBase___AbilityCastingOverEventNumber
        if YDWEBase___AbilityCastingOverEventType[i] == index then
            set bj_lastAbilityCastingUnit=u_hero
			if YDWEBase___AbilityCastingOverEventQueue[i] != null and TriggerEvaluate(YDWEBase___AbilityCastingOverEventQueue[i]) and IsTriggerEnabled(YDWEBase___AbilityCastingOverEventQueue[i]) then
				call TriggerExecute(YDWEBase___AbilityCastingOverEventQueue[i])
			endif
		endif
        set i=i + 1
    endloop
endfunction
//===========================================================================
//YDWE技能捕捉事件
//===========================================================================
function YDWESyStemAbilityCastingOverRegistTrigger takes trigger trg,integer index returns nothing
	set YDWEBase___AbilityCastingOverEventQueue[YDWEBase___AbilityCastingOverEventNumber]=trg
	set YDWEBase___AbilityCastingOverEventType[YDWEBase___AbilityCastingOverEventNumber]=index
	set YDWEBase___AbilityCastingOverEventNumber=YDWEBase___AbilityCastingOverEventNumber + 1
endfunction
//===========================================================================
//系统函数完善
//===========================================================================
function YDWECreateUnitPool takes nothing returns nothing
    set bj_lastCreatedUnitPool=CreateUnitPool()
endfunction
function YDWEPlaceRandomUnit takes unitpool up,player p,real x,real y,real face returns nothing
set bj_lastPoolAbstractedUnit=PlaceRandomUnit(up, p, x, y, face)
endfunction
function YDWEGetLastUnitPool takes nothing returns unitpool
    return bj_lastCreatedUnitPool
endfunction
function YDWEGetLastPoolAbstractedUnit takes nothing returns unit
    return bj_lastPoolAbstractedUnit
endfunction
function YDWECreateItemPool takes nothing returns nothing
    set bj_lastCreatedItemPool=CreateItemPool()
endfunction
function YDWEPlaceRandomItem takes itempool ip,real x,real y returns nothing
set bj_lastPoolAbstractedItem=PlaceRandomItem(ip, x, y)
endfunction
function YDWEGetLastItemPool takes nothing returns itempool
    return bj_lastCreatedItemPool
endfunction
function YDWEGetLastPoolAbstractedItem takes nothing returns item
    return bj_lastPoolAbstractedItem
endfunction
function YDWESetAttackDamageWeaponType takes attacktype at,damagetype dt,weapontype wt returns nothing
    set bj_lastSetAttackType=at
    set bj_lastSetDamageType=dt
    set bj_lastSetWeaponType=wt
endfunction
//unitpool bj_lastCreatedPool=null
//unit bj_lastPoolAbstractedUnit=null
function YDWEGetPlayerColorString takes player p,string s returns string
    return YDWEBase___yd_PlayerColor[GetHandleId(GetPlayerColor(p))] + s + "|r"
endfunction
//===========================================================================
//===========================================================================
//系统函数补充
//===========================================================================
//===========================================================================
function YDWEGetUnitItemSoftId takes unit u_hero,item it returns integer
    local integer i= 0
    loop
         exitwhen i > 5
         if UnitItemInSlot(u_hero, i) == it then
            return i + 1
         endif
         set i=i + 1
    endloop
    return 0
endfunction
//===========================================================================
//===========================================================================
//地图初始化
//===========================================================================
//===========================================================================
//显示版本
function YDWEVersion_Display takes nothing returns boolean
    call DisplayTimedTextToPlayer(GetTriggerPlayer(), 0, 0, 30, "|cFF1E90FF当前编辑器版本为： |r|cFF00FF00YDWE ")
    return false
endfunction
function YDWEVersion_Init takes nothing returns nothing
    local trigger t= CreateTrigger()
    local integer i= 0
    loop
        exitwhen i == 12
        call TriggerRegisterPlayerChatEvent(t, Player(i), "YDWE Version", true)
        set i=i + 1
    endloop
    call TriggerAddCondition(t, Condition(function YDWEVersion_Display))
    set t=null
endfunction
function InitializeYD takes nothing returns nothing
     set YDHT=InitHashtable()
	//=================设置变量=====================
	set yd_MapMinX=GetCameraBoundMinX() - GetCameraMargin(CAMERA_MARGIN_LEFT)
	set yd_MapMinY=GetCameraBoundMinY() - GetCameraMargin(CAMERA_MARGIN_BOTTOM)
	set yd_MapMaxX=GetCameraBoundMaxX() + GetCameraMargin(CAMERA_MARGIN_RIGHT)
	set yd_MapMaxY=GetCameraBoundMaxY() + GetCameraMargin(CAMERA_MARGIN_TOP)
    set YDWEBase___yd_PlayerColor[0]="|cFFFF0303"
    set YDWEBase___yd_PlayerColor[1]="|cFF0042FF"
    set YDWEBase___yd_PlayerColor[2]="|cFF1CE6B9"
    set YDWEBase___yd_PlayerColor[3]="|cFF540081"
    set YDWEBase___yd_PlayerColor[4]="|cFFFFFC01"
    set YDWEBase___yd_PlayerColor[5]="|cFFFE8A0E"
    set YDWEBase___yd_PlayerColor[6]="|cFF20C000"
    set YDWEBase___yd_PlayerColor[7]="|cFFE55BB0"
    set YDWEBase___yd_PlayerColor[8]="|cFF959697"
    set YDWEBase___yd_PlayerColor[9]="|cFF7EBFF1"
    set YDWEBase___yd_PlayerColor[10]="|cFF106246"
    set YDWEBase___yd_PlayerColor[11]="|cFF4E2A04"
    set YDWEBase___yd_PlayerColor[12]="|cFF282828"
    set YDWEBase___yd_PlayerColor[13]="|cFF282828"
    set YDWEBase___yd_PlayerColor[14]="|cFF282828"
    set YDWEBase___yd_PlayerColor[15]="|cFF282828"
    //=================显示版本=====================
    call YDWEVersion_Init()
endfunction

//library YDWEBase ends
//library YDWEGetForceOfPlayerNull:
function YDWEGetForceOfPlayerNull takes player whichPlayer returns force
    local force f= CreateForce()
    call ForceAddPlayer(f, whichPlayer)
    set yd_NullTempForce=f
    set f=null
    return yd_NullTempForce
endfunction

//library YDWEGetForceOfPlayerNull ends
//library YDWEGetItemOfTypeFromUnitBJNull:
function YDWEGetItemOfTypeFromUnitBJNull takes unit whichUnit,integer itemId returns item
    local integer index= 0
    loop
        set yd_NullTempItem=UnitItemInSlot(whichUnit, index)
        if GetItemTypeId(yd_NullTempItem) == itemId then
            return yd_NullTempItem
        endif
        set index=index + 1
        exitwhen index >= bj_MAX_INVENTORY
    endloop
    return null
endfunction

//library YDWEGetItemOfTypeFromUnitBJNull ends
//library YDWEGetUnitsInRectMatchingNull:
function YDWEGetUnitsInRectMatchingNull takes rect r,boolexpr filter returns group
    local group g= CreateGroup()
    call GroupEnumUnitsInRect(g, r, filter)
    call DestroyBoolExpr(filter)
    set yd_NullTempGroup=g
    set g=null
    return yd_NullTempGroup
endfunction

//library YDWEGetUnitsInRectMatchingNull ends
//library YDWEGetUnitsOfPlayerAndTypeIdNull:
function YDWEGetUnitsOfPlayerAndTypeIdNull takes player whichPlayer,integer unitid returns group
    local group g= CreateGroup()
    set bj_groupEnumTypeId=unitid
    call GroupEnumUnitsOfPlayer(g, whichPlayer, filterGetUnitsOfPlayerAndTypeId)
    set yd_NullTempGroup=g
    set g=null
    return yd_NullTempGroup
endfunction

//library YDWEGetUnitsOfPlayerAndTypeIdNull ends
//library YDWEGetUnitsOfPlayerMatchingNull:
function YDWEGetUnitsOfPlayerMatchingNull takes player whichPlayer,boolexpr filter returns group
    local group g= CreateGroup()
    call GroupEnumUnitsOfPlayer(g, whichPlayer, filter)
    call DestroyBoolExpr(filter)
    set yd_NullTempGroup=g
    set g=null
    return yd_NullTempGroup
endfunction

//library YDWEGetUnitsOfPlayerMatchingNull ends
//library YDWEGetUnitsOfTypeIdAllNull:
function YDWEGetUnitsOfTypeIdAllNull takes integer unitid returns group
    local group result= CreateGroup()
    local group g= CreateGroup()
    local integer index
    set index=0
    loop
        set bj_groupEnumTypeId=unitid
        call GroupClear(g)
        call GroupEnumUnitsOfPlayer(g, Player(index), filterGetUnitsOfTypeIdAll)
        call GroupAddGroup(g, result)
        set index=index + 1
        exitwhen index == bj_MAX_PLAYER_SLOTS
    endloop
    call DestroyGroup(g)
    set g=null
    set yd_NullTempGroup=result
    set result=null
    return yd_NullTempGroup
endfunction

//library YDWEGetUnitsOfTypeIdAllNull ends
//library YDWEMultiboardSetItemValueBJNull:
function YDWEMultiboardSetItemValueBJNull takes multiboard mb,integer col,integer row,string val returns nothing
    local integer curRow= 0
    local integer curCol= 0
    local integer numRows= MultiboardGetRowCount(mb)
    local integer numCols= MultiboardGetColumnCount(mb)
    local multiboarditem mbitem= null
    // Loop over rows, using 1-based index
    loop
        set curRow=curRow + 1
        exitwhen curRow > numRows
        // Apply setting to the requested row, or all rows (if row is 0)
        if ( row == 0 or row == curRow ) then
            // Loop over columns, using 1-based index
            set curCol=0
            loop
                set curCol=curCol + 1
                exitwhen curCol > numCols
                // Apply setting to the requested column, or all columns (if col is 0)
                if ( col == 0 or col == curCol ) then
                    set mbitem=MultiboardGetItem(mb, curRow - 1, curCol - 1)
                    call MultiboardSetItemValue(mbitem, val)
                    call MultiboardReleaseItem(mbitem)
                endif
            endloop
        endif
    endloop
    set mbitem=null
endfunction

//library YDWEMultiboardSetItemValueBJNull ends
//library YDWEPolledWaitNull:
function YDWEPolledWaitNull takes real duration returns nothing
    local timer t
    local real timeRemaining
    if ( duration > 0 ) then
        set t=CreateTimer()
        call TimerStart(t, duration, false, null)
        loop
            set timeRemaining=TimerGetRemaining(t)
            exitwhen timeRemaining <= 0
            // If we have a bit of time left, skip past 10% of the remaining
            // duration instead of checking every interval, to minimize the
            // polling on long waits.
            if ( timeRemaining > bj_POLLED_WAIT_SKIP_THRESHOLD ) then
                call TriggerSleepAction(0.1 * timeRemaining)
            else
                call TriggerSleepAction(bj_POLLED_WAIT_INTERVAL)
            endif
        endloop
        call DestroyTimer(t)
    endif
    set t=null
endfunction

//library YDWEPolledWaitNull ends
//library YDWETriggerEvent:
//===========================================================================
//任意单位伤害事件
//===========================================================================
function YDWEAnyUnitDamagedTriggerAction takes nothing returns nothing
    local integer i= 0
    loop
        exitwhen i >= YDWETriggerEvent___DamageEventNumber
        if YDWETriggerEvent___DamageEventQueue[i] != null and IsTriggerEnabled(YDWETriggerEvent___DamageEventQueue[i]) and TriggerEvaluate(YDWETriggerEvent___DamageEventQueue[i]) then
            call TriggerExecute(YDWETriggerEvent___DamageEventQueue[i])
        endif
        set i=i + 1
    endloop
endfunction
function YDWEAnyUnitDamagedFilter takes nothing returns boolean
    if GetUnitAbilityLevel(GetFilterUnit(), 'Aloc') <= 0 then
        call TriggerRegisterUnitEvent(yd_DamageEventTrigger, GetFilterUnit(), EVENT_UNIT_DAMAGED)
    endif
    return false
endfunction
function YDWEAnyUnitDamagedEnumUnit takes nothing returns nothing
    local group g= CreateGroup()
    local integer i= 0
    loop
        call GroupEnumUnitsOfPlayer(g, Player(i), Condition(function YDWEAnyUnitDamagedFilter))
        set i=i + 1
        exitwhen i >= bj_MAX_PLAYER_SLOTS
    endloop
    call DestroyGroup(g)
    set g=null
endfunction
function YDWEAnyUnitDamagedRegistTriggerUnitEnter takes nothing returns nothing
    local trigger t= CreateTrigger()
    local region r= CreateRegion()
    local rect world= GetWorldBounds()
    call RegionAddRect(r, world)
    call TriggerRegisterEnterRegion(t, r, Condition(function YDWEAnyUnitDamagedFilter))
    call RemoveRect(world)
    set t=null
    set r=null
    set world=null
endfunction
// 将 yd_DamageEventTrigger 移入销毁队列, 从而排泄触发器事件
function YDWESyStemAnyUnitDamagedSwap takes nothing returns nothing
    local boolean isEnabled= IsTriggerEnabled(yd_DamageEventTrigger)
    call DisableTrigger(yd_DamageEventTrigger)
    if YDWETriggerEvent___yd_DamageEventTriggerToDestory != null then
        call DestroyTrigger(YDWETriggerEvent___yd_DamageEventTriggerToDestory)
    endif
    set YDWETriggerEvent___yd_DamageEventTriggerToDestory=yd_DamageEventTrigger
    set yd_DamageEventTrigger=CreateTrigger()
    if not isEnabled then
        call DisableTrigger(yd_DamageEventTrigger)
    endif
    call TriggerAddAction(yd_DamageEventTrigger, function YDWEAnyUnitDamagedTriggerAction)
    call YDWEAnyUnitDamagedEnumUnit()
endfunction
function YDWESyStemAnyUnitDamagedRegistTrigger takes trigger trg returns nothing
    if trg == null then
        return
    endif
    if YDWETriggerEvent___DamageEventNumber == 0 then
        set yd_DamageEventTrigger=CreateTrigger()
        call TriggerAddAction(yd_DamageEventTrigger, function YDWEAnyUnitDamagedTriggerAction)
        call YDWEAnyUnitDamagedEnumUnit()
        call YDWEAnyUnitDamagedRegistTriggerUnitEnter()
        if YDWETriggerEvent___DAMAGE_EVENT_SWAP_ENABLE then
            // 每隔 DAMAGE_EVENT_SWAP_TIMEOUT 秒, 将正在使用的 yd_DamageEventTrigger 移入销毁队列
            call TimerStart(CreateTimer(), YDWETriggerEvent___DAMAGE_EVENT_SWAP_TIMEOUT, true, function YDWESyStemAnyUnitDamagedSwap)
        endif
    endif
    set YDWETriggerEvent___DamageEventQueue[YDWETriggerEvent___DamageEventNumber]=trg
    set YDWETriggerEvent___DamageEventNumber=YDWETriggerEvent___DamageEventNumber + 1
endfunction
//===========================================================================
//移动物品事件
//===========================================================================
function YDWESyStemItemUnmovableTriggerAction takes nothing returns nothing
    local integer i= 0
    if GetIssuedOrderId() >= 852002 and GetIssuedOrderId() <= 852007 then
		set bj_lastMovedItemInItemSlot=GetOrderTargetItem()
    	loop
        	exitwhen i >= YDWETriggerEvent___MoveItemEventNumber
        	if YDWETriggerEvent___MoveItemEventQueue[i] != null and IsTriggerEnabled(YDWETriggerEvent___MoveItemEventQueue[i]) and TriggerEvaluate(YDWETriggerEvent___MoveItemEventQueue[i]) then
        	    call TriggerExecute(YDWETriggerEvent___MoveItemEventQueue[i])
        	endif
        	set i=i + 1
    	endloop
	endif
endfunction
function YDWESyStemItemUnmovableRegistTrigger takes trigger trg returns nothing
    if trg == null then
        return
    endif
    if YDWETriggerEvent___MoveItemEventNumber == 0 then
        set YDWETriggerEvent___MoveItemEventTrigger=CreateTrigger()
        call TriggerAddAction(YDWETriggerEvent___MoveItemEventTrigger, function YDWESyStemItemUnmovableTriggerAction)
        call TriggerRegisterAnyUnitEventBJ(YDWETriggerEvent___MoveItemEventTrigger, EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER)
    endif
    set YDWETriggerEvent___MoveItemEventQueue[YDWETriggerEvent___MoveItemEventNumber]=trg
    set YDWETriggerEvent___MoveItemEventNumber=YDWETriggerEvent___MoveItemEventNumber + 1
endfunction
function GetLastMovedItemInItemSlot takes nothing returns item
    return bj_lastMovedItemInItemSlot
endfunction

//library YDWETriggerEvent ends
//library YDWETriggerRegisterEnterRectSimpleNull:
function YDWETriggerRegisterEnterRectSimpleNull takes trigger trig,rect r returns event
    local region rectRegion= CreateRegion()
    call RegionAddRect(rectRegion, r)
    set yd_NullTempRegion=rectRegion
    set rectRegion=null
    return TriggerRegisterEnterRegion(trig, yd_NullTempRegion, null)
endfunction

//library YDWETriggerRegisterEnterRectSimpleNull ends
//library YDWETriggerRegisterLeaveRectSimpleNull:
function YDWETriggerRegisterLeaveRectSimpleNull takes trigger trig,rect r returns event
    local region rectRegion= CreateRegion()
    call RegionAddRect(rectRegion, r)
    set yd_NullTempRegion=rectRegion
    set rectRegion=null
    return TriggerRegisterLeaveRegion(trig, yd_NullTempRegion, null)
endfunction

//library YDWETriggerRegisterLeaveRectSimpleNull ends
//library YDWEUnitHasItemOfTypeBJNull:
function YDWEUnitHasItemOfTypeBJNull takes unit whichUnit,integer itemId returns boolean
    local integer index= 0
	if itemId != 0 then
		loop
			if GetItemTypeId(UnitItemInSlot(whichUnit, index)) == itemId then
				return true
			endif
			set index=index + 1
			exitwhen index >= bj_MAX_INVENTORY
		endloop
	endif
    return false
endfunction

//library YDWEUnitHasItemOfTypeBJNull ends
//library Constant:
//---------------------------------------------------------------------------------------------------
	
 constant function GetVersion takes nothing returns string
		return "3.421B"
	endfunction
//---------------------------------------------------------------------------------------------------
	
 constant function Get11 takes nothing returns boolean
		return false
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsClassic takes nothing returns boolean
		return mode == 1
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsHighSpeed takes nothing returns boolean
		return mode == 2
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CModeH takes integer i1,integer i2 returns integer
		if ( IsClassic() ) then
			return i1
		else
			return i2
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function RCModeH takes real r1,real r2 returns real
		if ( IsClassic() ) then
			return r1
		else
			return r2
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsUnitIsSpin takes unit u returns boolean
		return GetUnitTypeId(u) == 'E00F' or GetUnitTypeId(u) == 'E00E' or GetUnitTypeId(u) == 'U001' or GetUnitTypeId(u) == 'H01V' or GetUnitTypeId(u) == 'H01W' or GetUnitTypeId(u) == 'E00G' or GetUnitTypeId(u) == 'O002' or GetUnitTypeId(u) == 'H01X' or GetUnitTypeId(u) == 'U002' or GetUnitTypeId(u) == 'O004' or GetUnitTypeId(u) == 'N01W' or GetUnitTypeId(u) == 'H026' or GetUnitTypeId(u) == 'H02C' or GetUnitTypeId(u) == 'N023' or GetUnitTypeId(u) == 'U003' or GetUnitTypeId(u) == 'H02E' or GetUnitTypeId(u) == 'E00H' or GetUnitTypeId(u) == 'H02L' or GetUnitTypeId(u) == 'H02O'
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetHeroIndex takes integer heroType returns integer
		if ( heroType == 'Ocbh' or heroType == 'O002' ) then
			return 1
		elseif ( heroType == 'Eevi' or heroType == 'E00F' ) then
			return 2
		elseif ( heroType == 'Hvwd' or heroType == 'H01X' ) then
			return 3
		elseif ( heroType == 'Uktl' or heroType == 'U002' ) then
			return 4
		elseif ( heroType == 'Nbbc' or heroType == 'N01W' ) then
			return 5
		elseif ( heroType == 'E00D' or heroType == 'E00E' ) then
			return 6
		elseif ( heroType == 'Usyl' or heroType == 'U001' ) then
			return 7
		elseif ( heroType == 'Hjai' or heroType == 'H01V' ) then
			return 8
		elseif ( heroType == 'Harf' or heroType == 'H01W' ) then
			return 9
		elseif ( heroType == 'E00C' or heroType == 'E00H' ) then
			return 10
		elseif ( heroType == 'Etyr' or heroType == 'E00G' ) then
			return 11
		elseif ( heroType == 'Othr' or heroType == 'O004' ) then
			return 12
		elseif ( heroType == 'Udea' or heroType == 'U003' ) then
			return 13
		elseif ( heroType == 'Hkal' ) then
			return 14
		elseif ( heroType == 'Hant' or heroType == 'H026' ) then
			return 15
		elseif ( heroType == 'Nsjs' or heroType == 'N023' ) then
			return 16
		elseif ( heroType == 'Hhkl' or heroType == 'H02C' ) then
			return 17
		elseif ( heroType == 'Hapm' or heroType == 'H01I' or heroType == 'H02L' or heroType == 'H02O' ) then
			return 18
		elseif ( heroType == 'H01Y' ) then
			return 19
		elseif ( heroType == 'H027' or heroType == 'H02E' ) then
			return 20
		endif
		return 0
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetIndexHeroName takes integer i returns string
   local string result= ""
			if ( i == 1 ) then
				set result="凯撒"
			elseif ( i == 2 ) then
				set result="湮灭"
			elseif ( i == 3 ) then
				set result="莫琪"
			elseif ( i == 4 ) then
				set result="玄雪"
			elseif ( i == 5 ) then
				set result="霸绝"
			elseif ( i == 6 ) then
				set result="瑟雨"
			elseif ( i == 7 ) then
				set result="晓月"
			elseif ( i == 8 ) then
				set result="凌雪"
			elseif ( i == 9 ) then
				set result="辰寂"
			elseif ( i == 10 ) then
				set result="寒殇"
			elseif ( i == 11 ) then
				set result="泰雅"
			elseif ( i == 12 ) then
				set result="摄焱"
			elseif ( i == 13 ) then
				set result="黑阎"
			elseif ( i == 14 ) then
				set result="梦霁"
			elseif ( i == 15 ) then
				set result="幻逸"
			elseif ( i == 16 ) then
				set result="苍凌"
			elseif ( i == 17 ) then
				set result="司宸"
			elseif ( i == 18 ) then
				set result="星胧"
			elseif ( i == 19 ) then
				set result="霄霆"
			elseif ( i == 20 ) then
				set result="离魑"
			endif
			return result
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetHeroTianFu takes unit u returns integer
  local integer id= GetHeroIndex(GetUnitTypeId(u))
		if ( id == 1 ) then
			return 'AOre'
		elseif ( id == 2 ) then
			return 'A072'
		elseif ( id == 3 ) then
			return 'A04G'
		elseif ( id == 4 ) then
			return 'A042'
		elseif ( id == 5 ) then
			return 'Absk'
		elseif ( id == 6 ) then
			return 'A0IL'
		elseif ( id == 7 ) then
			return 'ACfs'
		elseif ( id == 8 ) then
			return 'A0FV'
		elseif ( id == 9 ) then
			return 'A0F2'
		elseif ( id == 10 ) then
			return 'A0II'
		elseif ( id == 11 ) then
			return 'ACbc'
		elseif ( id == 12 ) then
			return 'A0E7'
		elseif ( id == 13 ) then
			return 'A0A3'
		elseif ( id == 14 ) then
			return 'A0GX'
		elseif ( id == 15 ) then
			return 'AHHD'
		elseif ( id == 16 ) then
			return 'A0HH'
		elseif ( id == 17 ) then
			return 'A0IP'
		elseif ( id == 18 ) then
			return I3(BSpinXinglong , 'A0NG' , 'AEme')
		elseif ( id == 19 ) then
			return 'A0LJ'
		elseif ( id == 20 ) then
			return 'A0MH'
		endif
		return 0
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetHeroDifficulty takes unit u returns string
  local integer id= GetHeroIndex(GetUnitTypeId(u))
		if ( id == 1 ) then
			return "|cffffff00操作难度：★☆☆☆☆|r"
		elseif ( id == 2 ) then
			return "|cffff8000操作难度：★★★☆☆|r"
		elseif ( id == 3 ) then
			return "|cffffff00操作难度：★☆☆☆☆|r"
		elseif ( id == 4 ) then
			return "|cffff8000操作难度：★★★☆☆|r"
		elseif ( id == 5 ) then
			return "|cffff4000操作难度：★★★★☆|r"
		elseif ( id == 6 ) then
			return "|cffffc000操作难度：★★☆☆☆|r"
		elseif ( id == 7 ) then
			return "|cffffff00操作难度：★☆☆☆☆|r"
		elseif ( id == 8 ) then
			return "|cffffff00操作难度：★☆☆☆☆|r"
		elseif ( id == 9 ) then
			return "|cffff4000操作难度：★★★★☆|r"
		elseif ( id == 10 ) then
			return "|cffff4000操作难度：★★★★☆|r"
		elseif ( id == 11 ) then
			return "|cffff8000操作难度：★★★☆☆|r"
		elseif ( id == 12 ) then
			return "|cffff4000操作难度：★★★★☆|r"
		elseif ( id == 13 ) then
			return "|cffffc000操作难度：★★☆☆☆|r"
		elseif ( id == 13 ) then
			return "|cffffc000操作难度：★★☆☆☆|r"
		elseif ( id == 14 ) then
			return "|cffffff00操作难度：★☆☆☆☆|r"
		elseif ( id == 15 ) then
			return "|cffff0000操作难度：★★★★★(极度不推荐新手使用)|r"
		elseif ( id == 16 ) then
			return "|cffffc000操作难度：★★☆☆☆|r"
		elseif ( id == 17 ) then
			return "|cffffc000操作难度：★★☆☆☆|r"
		elseif ( id == 18 ) then
			return "|cffff4000操作难度：★★★★☆|r"
		elseif ( id == 19 ) then
			return "|cffff0000操作难度：★★★★★(极度不推荐新手使用)|r"
		elseif ( id == 20 ) then
			return "|cffffff00操作难度：★☆☆☆☆|r"
		endif
		return ""
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetIndexHeroColorName takes integer i returns string
  local string result= ""
		if ( i == 1 ) then
			set result="|cffff0000凯撒|r"
		elseif ( i == 2 ) then
			set result="|cFFFFCC66湮灭|r"
		elseif ( i == 3 ) then
			set result="|cFF999900莫琪|r"
		elseif ( i == 4 ) then
			set result="|cFF33FF33玄雪|r"
		elseif ( i == 5 ) then
			set result="|cFFCCFF66霸绝|r"
		elseif ( i == 6 ) then
			set result="|cFFCCFF33瑟雨|r"
		elseif ( i == 7 ) then
			set result="|cffff00ff晓月|r"
		elseif ( i == 8 ) then
			set result="|cFFFF3399凌雪|r"
		elseif ( i == 9 ) then
			set result="|cFFCCFF00辰寂|r"
		elseif ( i == 10 ) then
			set result="|cFF33FF33寒殇|r"
		elseif ( i == 11 ) then
			set result="|cFFFF3399泰雅|r"
		elseif ( i == 12 ) then
			set result="|cff00ccff摄焱|r"
		elseif ( i == 13 ) then
			set result="|cffff6800黑阎|r"
		elseif ( i == 14 ) then
			set result="|cffff99cc梦霁|r"
		elseif ( i == 15 ) then
			set result="|cff00ccff幻逸|r"
		elseif ( i == 16 ) then
			set result="|cff80ff80苍凌|r"
		elseif ( i == 17 ) then
			set result="|cff993366司宸|r"
		elseif ( i == 18 ) then
			set result="|cff99cc00星胧|r"
		elseif ( i == 19 ) then
			set result="|cff00ff00霄霆|r"
		elseif ( i == 20 ) then
			set result="|cff3366ff离魑|r"
		endif
		return result
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetFanzhuanItemType takes unit u returns integer
  local integer id= GetHeroIndex(GetUnitTypeId(u))
		if ( id == 1 ) then
			return 'I046'
		elseif ( id == 2 ) then
			return 'I07U'
		elseif ( id == 3 ) then
			return 'I032'
		endif
		return 0
	endfunction
//---------------------------------------------------------------------------------------------------
    
 function GetRandomColor takes nothing returns string
  local integer random= GetRandomInt(1, 8)
		if ( random == 1 ) then
			return "|cff0000ff"
		elseif ( random == 2 ) then
			return "|cffcc99ff"
		elseif ( random == 3 ) then
			return "|cff99cc00"
		elseif ( random == 4 ) then
			return "|cffff0000"
		elseif ( random == 5 ) then
			return "|cffff6600"
		elseif ( random == 6 ) then
			return "|cffff00ff"
		elseif ( random == 7 ) then
			return "|cff808000"
		else
			return "|cffffff00"
		endif
	endfunction
    
    function GetColorString takes string s returns string
  local integer length= StringLength(s)
  local string result= ""
  local integer i=1
		if ( length == 0 ) then
			return ""
		endif
		loop
			exitwhen i > length
			set result=result + GetRandomColor() + SubStringBJ(s, i, i + 2)
			set i=i + 3
		endloop
        return result + "|r"
    endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsAchieveColor takes integer achieveID returns boolean
		return achieveID == 325 or achieveID == 24 or achieveID == 28 or achieveID == 29 or achieveID == 220 or achieveID == 226 or achieveID == 230 or achieveID == 35 or achieveID == 310 or achieveID == 314 or achieveID == 318 or achieveID == 326 or achieveID == 320 or achieveID == 321 or achieveID == 322 or achieveID == 323 or achieveID == 324 or achieveID == 327 or achieveID == 331 or achieveID == 42 or achieveID == 44 or achieveID == 45 or achieveID == 46 or achieveID == 47 or achieveID == 48 or achieveID == 49 or achieveID == 410 or achieveID == 411 or achieveID == 412 or achieveID == 413 or achieveID == 414 or achieveID == 415 or achieveID == 416 or achieveID == 417 or achieveID == 418 or achieveID == 420 or achieveID == 421 or achieveID == 422
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsAchieveWhite takes integer achieveID returns boolean
		return achieveID == 12 or achieveID == 216
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsAchieveLight takes integer achieveID returns boolean
		return IsAchieveColor(achieveID) or achieveID == 18 or achieveID == 210 or achieveID == 222
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetAchievementName takes integer achieveID returns string
		if ( achieveID == 325 ) then
			return GetColorString("【万劫录】")
		elseif ( achieveID == 18 ) then
			return "|cffff00ff【轮回舰】"
		elseif ( achieveID == 17 ) then
			return "|cffff0000【末日车】"
		elseif ( achieveID == 16 ) then
			return "|cffff6600【地狱使】"
		elseif ( achieveID == 15 ) then
			return "|cffffff00【灭炼狱】"
		elseif ( achieveID == 14 ) then
			return "|cff3366ff【定战争】"
		elseif ( achieveID == 13 ) then
			return "|cff99cc00【和谐世】"
		elseif ( achieveID == 12 ) then
			return "【太平源】"
		elseif ( achieveID == 11 ) then
			return "|cff999999【天国音】"
		elseif ( achieveID == 21 ) then
			return "|cff99cc00【定心魔】"
		elseif ( achieveID == 22 ) then
			return "|cffffff00【斩心魔】"
		elseif ( achieveID == 23 ) then
			return "|cffff0000【净心魔】"
		elseif ( achieveID == 24 ) then
			return GetColorString("【创心魔】")
		elseif ( achieveID == 25 ) then
			return "|cff99cc00【复世财】"
		elseif ( achieveID == 26 ) then
			return "|cffffff00【盛世财】"
		elseif ( achieveID == 27 ) then
			return "|cffff0000【灭世财】"
		elseif ( achieveID == 28 ) then
			return GetColorString("【造世财】")
		elseif ( achieveID == 29 ) then
			return GetColorString("【单轮回】")
		elseif ( achieveID == 210 ) then
			return "|cffff00ff【单末日】"
		elseif ( achieveID == 211 ) then
			return "|cffff0000【单地狱】"
		elseif ( achieveID == 212 ) then
			return "|cffff6600【单炼狱】"
		elseif ( achieveID == 213 ) then
			return "|cffffff00【单战争】"
		elseif ( achieveID == 214 ) then
			return "|cff3366ff【单和谐】"
		elseif ( achieveID == 215 ) then
			return "|cff99cc00【单太平】"
		elseif ( achieveID == 216 ) then
			return "【单天国】"
		elseif ( achieveID == 217 ) then
			return "|cff99cc00【知天地】"
		elseif ( achieveID == 218 ) then
			return "|cffffff00【探乾坤】"
		elseif ( achieveID == 219 ) then
			return "|cffff0000【五界主】"
		elseif ( achieveID == 220 ) then
			return GetColorString("【六界王】")
		elseif ( achieveID == 221 ) then
			return "|cff99cc00【千钧劫】"
		elseif ( achieveID == 222 ) then
			return "|cffff00ff【末世劫】"
		elseif ( achieveID == 223 ) then
			return "|cff99cc00【风驰者】"
		elseif ( achieveID == 224 ) then
			return "|cffffff00【电掣侠】"
		elseif ( achieveID == 225 ) then
			return "|cffff0000【无影客】"
		elseif ( achieveID == 226 ) then
			return GetColorString("【逆苍天】")
		elseif ( achieveID == 227 ) then
			return "|cff99cc00【逐天魔】"
		elseif ( achieveID == 228 ) then
			return "|cffffff00【驱天魔】"
		elseif ( achieveID == 229 ) then
			return "|cffff0000【伏天魔】"
		elseif ( achieveID == 230 ) then
			return GetColorString("【赦天魔】")
		elseif ( achieveID == 231 ) then
			return ( "|cffff0000【无心冢】" )
		elseif ( achieveID == 32 ) then
			return "|cff99cc00【触天式】"
		elseif ( achieveID == 33 ) then
			return "|cffffff00【伐天式】"
		elseif ( achieveID == 34 ) then
			return "|cffff0000【噬天式】"
		elseif ( achieveID == 35 ) then
			return GetColorString("【诛天式】")
		elseif ( achieveID == 36 ) then
			return "|cff99cc00【缘灭罐】"
		elseif ( achieveID == 37 ) then
			return "|cffffff00【彼岸花】"
		elseif ( achieveID == 38 ) then
			return "|cffff0000【仙瀑光】"
		elseif ( achieveID == 39 ) then
			return "|cffff0000【烛龙谱】"
		elseif ( achieveID == 310 ) then
			return GetColorString("【零失误】")
		elseif ( achieveID == 311 ) then
			return "|cff99cc00【破虚者】"
		elseif ( achieveID == 312 ) then
			return "|cffffff00【裂虚者】"
		elseif ( achieveID == 313 ) then
			return "|cffff0000【断虚者】"
		elseif ( achieveID == 314 ) then
			return GetColorString("【弑虚帝】")
		elseif ( achieveID == 315 ) then
			return "|cff99cc00【定无双】"
		elseif ( achieveID == 316 ) then
			return "|cffffff00【战无双】"
		elseif ( achieveID == 317 ) then
			return "|cffff0000【凛无双】"
		elseif ( achieveID == 318 ) then
			return GetColorString("【魄无双】")
		elseif ( achieveID == 326 ) then
			return GetColorString("【封神门】")
		elseif ( achieveID == 320 ) then
			return GetColorString("【圣洁玉】")
		elseif ( achieveID == 321 ) then
			return GetColorString("【孤心戒】")
		elseif ( achieveID == 322 ) then
			return GetColorString("【御天启】")
		elseif ( achieveID == 323 ) then
			return GetColorString("【九轮圣】")
		elseif ( achieveID == 324 ) then
			return GetColorString("【帝曜芒】")
		elseif ( achieveID == 327 ) then
			return GetColorString("【浩劫赋】")
		elseif ( achieveID == 328 ) then
			return "|cff99cc00【凶兽使】"
		elseif ( achieveID == 329 ) then
			return "|cffffff00【千里眼】"
		elseif ( achieveID == 330 ) then
			return "|cffff0000【执江山】"
		elseif ( achieveID == 331 ) then
			return GetColorString("【啻主宰】")
		elseif ( achieveID == 42 ) then
			return GetColorString("【傲临天魇】")
		elseif ( achieveID == 43 ) then
			return "|cffffff00【迷踪步】"
		elseif ( achieveID == 44 ) then
			return GetColorString("【影无缈】")
		elseif ( achieveID == 45 ) then
			return GetColorString("【破枷皇】")
		elseif ( achieveID == 46 ) then
			return GetColorString("【真言殿】")
		elseif ( achieveID == 47 ) then
			return GetColorString("【不败神话】")
		elseif ( achieveID == 48 ) then
			return GetColorString("【无上六界王】")
		elseif ( achieveID == 49 ) then
			return GetColorString("【荒神炼】")
		elseif ( achieveID == 410 ) then
			return GetColorString("【驻永恒】")
		elseif ( achieveID == 411 ) then
			return GetColorString("【创世篇】")
		elseif ( achieveID == 412 ) then
			return GetColorString("【若凰生】")
		elseif ( achieveID == 413 ) then
			return GetColorString("【淼无极】")
		elseif ( achieveID == 414 ) then
			return GetColorString("【金瓯体】")
		elseif ( achieveID == 415 ) then
			return GetColorString("【控神识】")
		elseif ( achieveID == 416 ) then
			return GetColorString("【契歃约】")
		elseif ( achieveID == 417 ) then
			return GetColorString("【宵无霁】")
		elseif ( achieveID == 418 ) then
			return GetColorString("【「白夜」奉天】")
		elseif ( achieveID == 420 ) then
			return GetColorString("【「黑日」释帝】")
		elseif ( achieveID == 421 ) then
			return GetColorString("【皆之初】")
		elseif ( achieveID == 422 ) then
			return GetColorString("【前之痕】")
		elseif ( achieveID == 423 ) then
			return GetColorString("【者之尘】")
		//完了再加到Achievement.j上的全成就.
		endif
		return ""
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetAchievementWhiteName takes integer achieveID returns string
		if ( achieveID == 325 ) then
			return "万劫录"
		elseif ( achieveID == 18 ) then
			return "轮回舰"
		elseif ( achieveID == 17 ) then
			return "末日车"
		elseif ( achieveID == 16 ) then
			return "地狱使"
		elseif ( achieveID == 15 ) then
			return "灭炼狱"
		elseif ( achieveID == 14 ) then
			return "定战争"
		elseif ( achieveID == 13 ) then
			return "和谐世"
		elseif ( achieveID == 12 ) then
			return "太平源"
		elseif ( achieveID == 11 ) then
			return "天国音"
		elseif ( achieveID == 21 ) then
			return "定心魔"
		elseif ( achieveID == 22 ) then
			return "斩心魔"
		elseif ( achieveID == 23 ) then
			return "净心魔"
		elseif ( achieveID == 24 ) then
			return "创心魔"
		elseif ( achieveID == 25 ) then
			return "复世财"
		elseif ( achieveID == 26 ) then
			return "盛世财"
		elseif ( achieveID == 27 ) then
			return "灭世财"
		elseif ( achieveID == 28 ) then
			return "造世财"
		elseif ( achieveID == 29 ) then
			return "单轮回"
		elseif ( achieveID == 210 ) then
			return "单末日"
		elseif ( achieveID == 211 ) then
			return "单地狱"
		elseif ( achieveID == 212 ) then
			return "单炼狱"
		elseif ( achieveID == 213 ) then
			return "单战争"
		elseif ( achieveID == 214 ) then
			return "单和谐"
		elseif ( achieveID == 215 ) then
			return "单太平"
		elseif ( achieveID == 216 ) then
			return "单天国"
		elseif ( achieveID == 217 ) then
			return "知天地"
		elseif ( achieveID == 218 ) then
			return "探乾坤"
		elseif ( achieveID == 219 ) then
			return "五界主"
		elseif ( achieveID == 220 ) then
			return "六界王"
		elseif ( achieveID == 221 ) then
			return "千钧劫"
		elseif ( achieveID == 222 ) then
			return "末世劫"
		elseif ( achieveID == 223 ) then
			return "风驰者"
		elseif ( achieveID == 224 ) then
			return "电掣侠"
		elseif ( achieveID == 225 ) then
			return "无影客"
		elseif ( achieveID == 226 ) then
			return "逆苍天"
		elseif ( achieveID == 227 ) then
			return "逐天魔"
		elseif ( achieveID == 228 ) then
			return "驱天魔"
		elseif ( achieveID == 229 ) then
			return "伏天魔"
		elseif ( achieveID == 230 ) then
			return "赦天魔"
		elseif ( achieveID == 231 ) then
			return "无心冢"
		elseif ( achieveID == 32 ) then
			return "触天式"
		elseif ( achieveID == 33 ) then
			return "伐天式"
		elseif ( achieveID == 34 ) then
			return "噬天式"
		elseif ( achieveID == 35 ) then
			return "诛天式"
		elseif ( achieveID == 36 ) then
			return "缘灭罐"
		elseif ( achieveID == 37 ) then
			return "彼岸花"
		elseif ( achieveID == 38 ) then
			return "仙瀑光"
		elseif ( achieveID == 39 ) then
			return "烛龙谱"
		elseif ( achieveID == 310 ) then
			return "零失误"
		elseif ( achieveID == 311 ) then
			return "破虚者"
		elseif ( achieveID == 312 ) then
			return "断虚者"
		elseif ( achieveID == 313 ) then
			return "裂虚者"
		elseif ( achieveID == 314 ) then
			return "弑虚帝"
		elseif ( achieveID == 315 ) then
			return "定无双"
		elseif ( achieveID == 316 ) then
			return "战无双"
		elseif ( achieveID == 317 ) then
			return "凛无双"
		elseif ( achieveID == 318 ) then
			return "魄无双"
		elseif ( achieveID == 326 ) then
			return "封神门"
		elseif ( achieveID == 320 ) then
			return "圣洁玉"
		elseif ( achieveID == 321 ) then
			return "孤心戒"
		elseif ( achieveID == 322 ) then
			return "御天启"
		elseif ( achieveID == 323 ) then
			return "九轮圣"
		elseif ( achieveID == 324 ) then
			return "帝曜芒"
		elseif ( achieveID == 327 ) then
			return "浩劫赋"
		elseif ( achieveID == 328 ) then
			return "凶兽使"
		elseif ( achieveID == 329 ) then
			return "千里眼"
		elseif ( achieveID == 330 ) then
			return "执江山"
		elseif ( achieveID == 331 ) then
			return "啻主宰"
		elseif ( achieveID == 42 ) then
			return "傲临天魇"
		elseif ( achieveID == 43 ) then
			return "迷踪步"
		elseif ( achieveID == 44 ) then
			return "影无缈"
		elseif ( achieveID == 45 ) then
			return "破枷皇"
		elseif ( achieveID == 46 ) then
			return "真言殿"
		elseif ( achieveID == 47 ) then
			return "不败神话"
		elseif ( achieveID == 48 ) then
			return "无上六界王"
		elseif ( achieveID == 49 ) then
			return "荒神炼"
		elseif ( achieveID == 410 ) then
			return "驻永恒"
		elseif ( achieveID == 411 ) then
			return "创世篇"
		elseif ( achieveID == 412 ) then
			return "若凰生"
		elseif ( achieveID == 413 ) then
			return "淼无极"
		elseif ( achieveID == 414 ) then
			return "金瓯体"
		elseif ( achieveID == 415 ) then
			return "控神识"
		elseif ( achieveID == 416 ) then
			return "契歃约"
		elseif ( achieveID == 417 ) then
			return "宵无霁"
		elseif ( achieveID == 418 ) then
			return "「白夜」奉天"
		elseif ( achieveID == 420 ) then
			return "「黑日」释帝"
		elseif ( achieveID == 421 ) then
			return "皆之初"
		elseif ( achieveID == 422 ) then
			return "前之痕"
		elseif ( achieveID == 423 ) then
			return "者之尘"
		endif
		return ""
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetAchievementCondition takes integer achieveID returns string
		if ( achieveID == 325 ) then
			return "通关|cff008000\"万劫\"难度|r后可以自动获得该成就.\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|r|cff99ccff若你通关了该难度可以加轮回之狱主群申请上|r|cff99cc00封帝万劫录|r|cff99ccff哦!|r"
		elseif ( achieveID == 18 ) then
			return "通关|cffff00ff\"轮回\"难度|r后可以自动获得该成就.\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!|r"
		elseif ( achieveID == 17 ) then
			return "通关|cffff0000\"末日\"难度|r后可以自动获得该成就.\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 16 ) then
			return "通关|cffff6600\"地狱\"难度|r后可以自动获得该成就.\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 15 ) then
			return "通关|cffffff00\"炼狱\"难度|r后可以自动获得该成就.\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 14 ) then
			return "通关|cff3366ff\"战争\"难度|r后可以自动获得该成就.\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 13 ) then
			return "通关|cff99cc00\"和谐\"难度|r后可以自动获得该成就.\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 12 ) then
			return "通关\"太平\"难度后可以自动获得该成就.\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 11 ) then
			return "通关|cff999999\"天国\"难度|r后可以自动获得该成就.\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 21 ) then
			return "完成20次转生即可自动获得该成就.\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 22 ) then
			return "完成50次转生即可自动获得该成就.\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 23 ) then
			return "完成100次转生即可自动获得该成就.\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 24 ) then
			return "完成150次转生即可自动获得该成就.\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 25 ) then
			return "木材大于20000即可自动获得该成就.\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 26 ) then
			return "木材大于50000即可自动获得该成就.\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 27 ) then
			return "木材大于100000即可自动获得该成就.\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 28 ) then
			return "木材大于200000即可自动获得该成就.\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 29 ) then
			return "单通|cffff00ff\"轮回\"难度|r即可自动获得该成就.\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 210 ) then
			return "单通|cffff0000\"末日\"难度|r即可自动获得该成就.\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 211 ) then
			return "单通|cffff6600\"地狱\"难度|r后可以自动获得该成就.\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 212 ) then
			return "单通|cffffff00\"炼狱\"难度|r后可以自动获得该成就.\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 213 ) then
			return "单通|cff3366ff\"战争\"难度|r后可以自动获得该成就.\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 214 ) then
			return "单通|cff99cc00\"和谐\"难度|r后可以自动获得该成就.\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 215 ) then
			return "单通\"太平\"难度后可以自动获得该成就.\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 216 ) then
			return "单通|cff999999\"天国\"难度|r后可以自动获得该成就.\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 217 ) then
			return "使用至少12个英雄，每个进行至少1场游戏.\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 218 ) then
			return "使用至少12个英雄，每个进行至少5场游戏.\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 219 ) then
			return "使用至少12个英雄，每个进行至少10场游戏.\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 220 ) then
			return "使用至少12个英雄，每个进行至少30场游戏.\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 221 ) then
			return "在基地剩余0次防护罩时通关游戏.\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 222 ) then
			return "在基地剩余0次防护罩,且生命低于25%时通关游戏.\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 223 ) then
			return "在经典模式中135分钟内击败冥刹.\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 224 ) then
			return "在经典模式中120分钟内击败冥刹.\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 225 ) then
			return "在经典模式中90分钟内击败冥刹.\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 226 ) then
			return "在经典模式中60分钟内击败冥刹.\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 227 ) then
			return "在单场游戏中杀敌数达到1.5万。\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 228 ) then
			return "在单场游戏中杀敌数达到4万。\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 229 ) then
			return "在单场游戏中杀敌数达到8万。\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 230 ) then
			return "在单场游戏中杀敌数达到15万。\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 231 ) then
			return "单局游戏死亡次数达到100次。（凯撒触发天赋技能也算死亡）\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 32 ) then
			return "在单场游戏中造成的总伤害达500亿。\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 33 ) then
			return "在单场游戏中造成的总伤害达4000亿。\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 34 ) then
			return "在单场游戏中造成的总伤害达30000亿。\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 35 ) then
			return "在单场游戏中造成的总伤害达600000亿。\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 36 ) then
			return "通过秘境挑战13层。\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 37 ) then
			return "通过秘境挑战15层。\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 38 ) then
			return "通过秘境挑战17层。\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 39 ) then
			return "通过秘境挑战20层。\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 310 ) then
			return "击败冥刹时所有玩家均0死亡。（凯撒触发天赋技能也算死亡）\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 311 ) then
			return "击败任意难度巨能融合石6次。\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 312 ) then
			return "击败任意难度巨能融合石20次。\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 313 ) then
			return "击败轮回难度巨能融合石12次。\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 314 ) then
			return "击败轮回难度巨能融合石40次。\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 315 ) then
			return "总属性之和达到300 W.（成就获取在1分钟内，请耐心等待）\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 316 ) then
			return "总属性之和达到800 W.（成就获取在1分钟内，请耐心等待）\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 317 ) then
			return "总属性之和达到2000 W.（成就获取在1分钟内，请耐心等待）\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 318 ) then
			return "总属性之和达到5000 W.（成就获取在1分钟内，请耐心等待）\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 326 ) then
			return "在8分钟内将复活点处的门毁坏。\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 320 ) then
			return "到通关为止基地未受到任何伤害。\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 321 ) then
			return "鬼MAX戒指或者超鬼戒指吸收灵魂层数达到120.\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 322 ) then
			return "使用至少12个英雄击败擂台十英雄-辕煞.\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 323 ) then
			return "自己与所有队友从头到尾不打任何宝石,不打任何秘境,不打任何擂台,不合成任何翅膀通关游戏.\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 324 ) then
			return "与低于(或等于)5级的玩家进行游戏通关满100人.\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 327 ) then
			return "自己与所有队友不学2级技能，10级技能，20级技能，40级技能，100级技能通关游戏。\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 328 ) then
			return "使用中型捕兽网（50 W上限）成功捕捉大于或等于50级的怪物。\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 329 ) then
			return "使用中型捕兽网（50 W上限）成功捕捉大于或等于70级的怪物。\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 330 ) then
			return "使用中型捕兽网（50 W上限）成功捕捉大于或等于100级的怪物。\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 331 ) then
			return "使用中型捕兽网（50 W上限）成功捕捉大于或等于150级的怪物。\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 43 ) then
			return "在迷你挑战1-骷髅海中里面的时间成功超过35秒.\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 44 ) then
			return "在迷你挑战1-骷髅海中里面的时间成功超过80秒.\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 45 ) then
			return "4人及以上游戏时,在击败人王傀儡与妖王傀儡时从未触发过BOSS生命联结技能.\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 46 ) then
			return "单次技能伤害达到300亿.\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 49 ) then
			return "从头到尾全地图同时存在的进攻怪从未超过20个.\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 410 ) then
			return "完成任意难度的挑战模式中的\"驻永恒挑战\"\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 411 ) then
			return "完成任意难度的挑战模式中的\"创世篇挑战\"\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 412 ) then
			return "输入-hs1进行生命检测，此时你的英雄生命达到1%以下却未死。\n			(检测时英雄不能带有瘟疫或者中毒的BUFF)\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 413 ) then
			return "输入-hs2进行生命检测，使用非霸绝英雄进行游戏，生命值达到5亿或以上。\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 414 ) then
			return "输入-hs3进行防御检测，防御达到100 W或以上。\n			（注意检测结果将不包含于装备中的防御定值光环与装备中的短暂BUFF效果）\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 415 ) then
			return "在一局游戏中成功答对30次仙帝傀儡——樱乐的问题.\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 416 ) then
			return "在一局游戏中所有队友从未说过一句话通关游戏.\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 417 ) then
			return "成功击杀秘境BOSS(21-25层)——夜袭使者。\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 421 ) then
			return "使用\"皆\"字传承施放伤害时对超过120个单位同时造成伤害.(英雄需要在三级野区以左的地区施放.)\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 422 ) then
			return "使用\"前\"字传承,利用前字幻影超过击杀6700个来进攻基地的怪物.\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		elseif ( achieveID == 423 ) then
			return "使用\"者\"字传承,在一次性时间(5秒,不能拥有霄霆加的光环)内累计死亡18次.\n			|r|cff3366ff使用该成就进行游戏英雄会有能量之光的特效哦!\n			|cffffff00该成就会显示在官方对战平台游戏大厅内哦,也会显示在你的名字前面!|r"
		endif
		return ""
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetAchievementIndex takes integer page,integer index returns integer
		if ( page == 1 ) then
			return I3(index == 9 , 325 , page * 10 + index)
		elseif ( page == 2 ) then
			return ( page * 10 + index )
		elseif ( page == 3 ) then
			return I3(index < 8 , 217 - index , 29)
		elseif ( page == 4 ) then
			return index + 216
		elseif ( page == 5 ) then
			return I3(index < 8 , index + 224 , 310)
		elseif ( page == 6 ) then
			return index + 31
		elseif ( page == 7 ) then
			return index + 310
		elseif ( page == 8 ) then
			return I3(index == 7 , 327 , I3(index == 1 , 326 , index + 318))
		elseif ( page == 9 ) then
			return I3(index <= 4 , index + 327 , index + 38)
		elseif ( page == 10 ) then
			return I3(index == 1 , 49 , index + 408)
		elseif ( page == 11 ) then
			return index + 420
		endif
		return 0
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetHeroChallenageName takes integer i,integer page returns string
		if ( page == 1 ) then
			if ( i == 2 ) then
				return "瑟雨：|cffff66cc赤血白燕|r"
			elseif ( i == 3 ) then
				return "晓月：|cff99ccff月轮绯狱|r"
			elseif ( i == 4 ) then
				return "湮灭：|cFFFF0000殛霆无迹|r"
			elseif ( i == 5 ) then
				return "玄雪：|cFF33FF33末日权杖|r"
			elseif ( i == 6 ) then
				return "泰雅：|cFFCCFF66三弦星谧|r"
			elseif ( i == 7 ) then
				return "辰寂：|cFFFF3333霜夜之哀|r"
			elseif ( i == 8 ) then
				return "寒殇：|cFF3333FF獠牙之匕|r"
			elseif ( i == 9 ) then
				return "凌雪：|cFF339933沐雪无瑕|r"
			elseif ( i == 10 ) then
				return "辰寂：|cFFFF3333双流贯恒|r"
			endif
		elseif ( page == 2 ) then
			if ( i == 1 ) then
				return "莫琪：|cFFFF00CC星界麒麟|r"
			elseif ( i == 2 ) then
				return "凯撒：|cFF6699FF熔日煌世|r"
			elseif ( i == 3 ) then
				return "玄雪：|cFFFF0000凝冰红灯|r"
			elseif ( i == 4 ) then
				return "摄焱：|cffff0000凰迹天知|r"
			elseif ( i == 5 ) then
				return "霸绝：|cFF6699FF封霜玄锋|r"
			elseif ( i == 6 ) then
				return "幻逸：|cffff6800天罚四界|r"
			elseif ( i == 7 ) then
				return "司宸：|cff33cccc白莲圣日·黑羽魔月|r"
			elseif ( i == 8 ) then
				return "苍凌：|cff993366翎翼浮灵|r"
			elseif ( i == 9 ) then
				return "黑阎：|cff0000ff七阴之恸|r"
			elseif ( i == 10 ) then
				return "离魑：|cffff6800谜幻逸空|r"
			endif
		elseif ( page == 3 ) then
			if ( i == 1 ) then
				return "寒殇：|cFF3333FF耀金独心|r"
			elseif ( i == 2 ) then
				return "星胧：|cffff00ff绯想龙域|r"
			elseif ( i == 3 ) then
				return "梦霁：|cffff00ff独步帝弓|r"
			endif
		endif
		return ""
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetSuperChallenageName takes integer i returns string
		if ( i == 1 ) then
			return "全成就达成"
		elseif ( i == 2 ) then
			return "通关|cff993366天魇|r"
		elseif ( i == 3 ) then
			return "连续登录20天"
		elseif ( i == 4 ) then
			return "所有英雄99次使用"
		elseif ( i == 5 ) then
			return "狂欢模式中单通万劫"
		elseif ( i == 6 ) then
			return "狂欢模式中多通天魇"
		endif
		return ""
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetHeroChallenageContent takes integer i,integer page returns string
		if ( page == 1 ) then
			if ( i == 2 ) then
				return "使用瑟雨在1秒内将能量从0%直接增加至105%(或以上).\n				完成该项挑战后你将获得瑟雨的皮肤\"|cffff66cc赤血白燕|r\"(拥有少量的属性加成)!"
			elseif ( i == 3 ) then
				return "使用晓月在一局游戏内成功在黯黑杀阵内成功复活满150人.\n				完成该项挑战后你将获得晓月的皮肤\"|cff99ccff月轮绯狱|r\"(拥有少量的属性加成)!"
			elseif ( i == 4 ) then
				return "使用湮灭在一局游戏内成功完成125次转生.\n				完成该项挑战后你将获得湮灭的皮肤\"|cFFFF0000殛霆无迹|r\"(拥有少量的属性加成)!"
			elseif ( i == 5 ) then
				return "使用玄雪在一局游戏内成功单通战争难度(或以上).\n				完成该项挑战后你将获得玄雪的模型法杖\"|cFF33FF33末日权杖|r\"(拥有少量的属性加成)!"
			elseif ( i == 6 ) then
				return "使用泰雅在一局游戏中成功使用月神之箭技能触发\"秒\"效果杀死至少2500个单位.\n				完成该项挑战后你将获得泰雅的皮肤\"|cFFCCFF66三弦星谧|r\"(拥有少量的属性加成)!"
			elseif ( i == 7 ) then
				return "使用辰寂在一局游戏中成功使用满7次90剑灵技能-引渡.\n				完成该项挑战后你将获得辰寂的模型特效\"|cFFFF3333霜夜之哀|r\"(拥有少量的属性加成)!"
			elseif ( i == 8 ) then
				return "使用寒殇在一局游戏内成功使用无穷吞噬技能获得超过500万的总和属性.\n				完成该项挑战后你将获得寒殇的模型武器\"|cFF3333FF獠牙之匕|r\"(拥有少量的属性加成)!"
			elseif ( i == 9 ) then
				return "在每天的连续签到中达到14天。\n				完成该项挑战后你将获得凌雪的皮肤\"|cFF339933沐雪无瑕|r\"(拥有少量的属性加成)!"
			elseif ( i == 10 ) then
				return "输入-chenji可以进行检测，若此时英雄的生命低于1%，则完成该挑战。\n				完成该项挑战后你将获得辰寂的皮肤\"|cFFFF3333双流贯恒|r\"(拥有少量的属性加成)!"
			endif
		elseif ( page == 2 ) then
			if ( i == 1 ) then
				return "使用莫琪在使用|cffffcc00裁决|r技能时的施法角度在89.9-90.1度之内.\n						(换句话说即为完全垂直向上射)\n				完成该项挑战后你将获得莫琪的皮肤\"|cFFFF00CC星界麒麟|r\"(拥有少量的属性加成)!"
			elseif ( i == 2 ) then
				return "使用凯撒在一局游戏中只靠|cffff6800忠诚之躯|r技能杀死攻击基地的敌人2500个.\n				完成该项挑战后你将获得凯撒的皮肤\"|cFF6699FF熔日煌世|r\"(拥有少量的属性加成)!"
			elseif ( i == 3 ) then
				return "使用玄雪在一局游戏内成功侵入134种不同的生物.(注意,如果你需要进行该挑战,请在第一波前输入-xx以开启该英雄挑战)\n				完成该项挑战后你将获得玄雪的皮肤\"|cFFFF0000凝冰红灯|r\"(拥有少量的属性加成)!"
			elseif ( i == 4 ) then
				return "使用摄焱在一局游戏中杀敌数满125000.\n				完成该项挑战后你将获得摄焱的皮肤\"|cffff0000凰迹天知|r\"(拥有少量的属性加成)!"
			elseif ( i == 5 ) then
				return "使用霸绝在使用|cFFFF0099剑法IV式 - 永恒|r技能结束后的落点距离英雄在施放该技能的位置有8000码远.(注意,如果你需要进行该挑战,请在第一波前输入-bj以开启该英雄挑战,注意要使用主英雄施放,其他分身施放无效)\n				完成该项挑战后你将获得霸绝的皮肤\"|cFF6699FF封霜玄锋|r\"(拥有少量的属性加成)!"
			elseif ( i == 6 ) then
				return "\n				使用幻逸输入-hy后进入挑战:将会随机出现一个技能名字,切换到对应名字的技能即可,然后继续随机出现下一个技能名字,30秒内成功切换25次即为挑战成功.\n				完成该项挑战后你将获得幻逸的皮肤\"|cffff6800天罚四界|r\"(拥有少量的属性加成)!"
			elseif ( i == 7 ) then
				return "\n				使用司宸属性总和达到3500 W.\n				完成该项挑战后你将获得司宸的皮肤\"|cff33cccc白莲圣日·黑羽魔月|r\"(拥有少量的属性加成)!"
			elseif ( i == 8 ) then
				return "\n				使用苍凌在一局游戏中不灭真炎时间叠加到750秒.\n				完成该项挑战后你将获得苍凌的皮肤\"|cff993366翎翼浮灵|r\"(拥有少量的属性加成)!"
			elseif ( i == 9 ) then
				return "\n				使用黑阎在一局使用泣罗刹祭品替死达到300次,且自身不能死亡一次.\n				完成该项挑战后你将获得黑阎的皮肤\"|cff0000ff七阴之恸|r\"(拥有少量的属性加成)!"
			elseif ( i == 10 ) then
				return "\n				使用离魑在一局触发影爆次数达到100次.\n				完成该项挑战后你将获得离魑的皮肤\"|cffff6800谜幻逸空|r\"(拥有少量的属性加成)!"
			endif
		elseif ( page == 3 ) then
			if ( i == 1 ) then
				return "\n				使用寒殇在一局游戏中总共获得(捡起)过520种不同的物品(包括升级装备的书本).(需要输入-lj来开启该挑战)\n				完成该项挑战后你将获得寒殇的皮肤\"|cFF3333FF耀金独心|r\"(拥有少量的属性加成)!"
			elseif ( i == 2 ) then
				return "\n				使用星胧在一局游戏中总共升级累计30000次.\n				完成该项挑战后你将获得星胧的皮肤\"|cffff00ff绯想龙域|r\"(拥有少量的属性加成)!"
			endif
		endif
		return ""
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetSuperChallenageContent takes integer i returns string
		if ( i == 1 ) then
			return "解锁截止上个版本以来的所有成就.(输入-cj可以查看所有成就情况)\n			完成该项挑战后你将可以使用-qm指令自定义你的成就名!"
		elseif ( i == 2 ) then
			return "通关隐藏难度|cff993366天魇|r(通关|cff008000万劫|r难度解锁)\n			完成该项挑战后你的名字将在以后始终置顶于|cff008000\"封帝万劫录\"|r中!\n			并获得四字成就名" + GetAchievementName(42) + "。"
		elseif ( i == 3 ) then
			return "在嘉年华活动版本中连续签到达20天.\n			完成该项挑战后可以在每次开局选英雄后接受来自六界的欢迎。\n			并获得四字成就名" + GetAchievementName(47) + "。"
		elseif ( i == 4 ) then
			return "全英雄99次达成!\n			完成该项挑战后每局游戏中在基地出现罩子时有着不一样的文字提醒哦!\n			并获得五字成就名" + GetAchievementName(48) + "。"
		elseif ( i == 5 ) then
			return "在狂欢模式中单人通关万劫难度.\n			获得成就名" + GetAchievementName(418) + "。\n			如果你同时完成了" + GetAchievementName(420) + ",那么你将可以在许愿时获得额外的奖励.\n			"
		elseif ( i == 6 ) then
			return "在狂欢模式中多人通关天魇难度.\n			获得成就名" + GetAchievementName(420) + "。\n			如果你同时完成了" + GetAchievementName(418) + ",那么你将可以在许愿时获得额外的奖励.\n			"
		endif
		return ""
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetWanjieluName takes nothing returns string
		set Constant___WPointer=Constant___WPointer - 1
		if ( Constant___WPointer <= 0 ) then
			set Constant___WPointer=COUNT_WANJIE
		endif
		if ( Constant___WPointer == 1 ) then
			return "话唠。"
		elseif ( Constant___WPointer == 2 ) then
			return "与你童在"
		elseif ( Constant___WPointer == 3 ) then
			return "丶念少。"
		elseif ( Constant___WPointer == 4 ) then
			return "祭轮回丶"
		elseif ( Constant___WPointer == 5 ) then
			return "嚣张城"
		elseif ( Constant___WPointer == 6 ) then
			return "神天羽"
		endif
		return ""
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Constant___InitConstant takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > 6
			if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) ) then
				set renshu=renshu + 1
			endif
			set i=i + 1
		endloop
	endfunction

//library Constant ends
//library GroupUtils:
    function GroupEnumUnitsInRangeEx takes group whichGroup,real x,real y,real radius,boolexpr filter returns nothing
        call GroupEnumUnitsInRange(whichGroup, x, y, radius, filter)
        call DestroyBoolExpr(filter)
    endfunction  //库补充,防内存泄漏
    function GroupEnumUnitsInRectEx takes group whichGroup,rect r,boolexpr filter returns nothing
        call GroupEnumUnitsInRect(whichGroup, r, filter)
        call DestroyBoolExpr(filter)
    endfunction  //获取单位组:[敌方]
        function GroupUtils___anon__0 takes nothing returns boolean
            if ( IsEnemy(GetOwningPlayer(GroupUtils___tempU) , GetFilterUnit()) ) then
                return true
            endif
            return false
        endfunction
    function GetEnemyGroup takes unit u,real x,real y,real radius returns group
        set GroupUtils___tempG=CreateGroup()
        set GroupUtils___tempU=u
        call GroupEnumUnitsInRangeEx(GroupUtils___tempG , x , y , radius , Filter(function GroupUtils___anon__0))
        set GroupUtils___tempU=null
        return GroupUtils___tempG
    endfunction  //获取圆形随机单位
    function GetRandomEnemy takes unit u,real x,real y,real radius returns unit
        return GroupPickRandomUnit(GetEnemyGroup(u , x , y , radius))
    endfunction

//library GroupUtils ends
//library Logger:

    function Trace takes string msg returns nothing
        set logger_msg=msg
        set logger_level=0
        set logger_p=GetLocalPlayer()
        call TriggerEvaluate(logger_tr)
    endfunction  // 调试级别日志(绿色),用于输出变量值等调试信息
    function Debug takes string msg returns nothing
        set logger_msg=msg
        set logger_level=1
        set logger_p=GetLocalPlayer()
        call TriggerEvaluate(logger_tr)
    endfunction  // 信息级别日志(白色),用于输出普通提示信息
    function Info takes string msg returns nothing
        set logger_msg=msg
        set logger_level=2
        set logger_p=GetLocalPlayer()
        call TriggerEvaluate(logger_tr)
    endfunction  // 警告级别日志(黄色),用于输出警告信息
    function Warn takes string msg returns nothing
        set logger_msg=msg
        set logger_level=3
        set logger_p=GetLocalPlayer()
        call TriggerEvaluate(logger_tr)
    endfunction  // 错误级别日志(红色),用于输出错误信息
    function Error takes string msg returns nothing
        set logger_msg=msg
        set logger_level=4
        set logger_p=GetLocalPlayer()
        call TriggerEvaluate(logger_tr)
    endfunction  // 向指定玩家输出追踪日志(灰色)
    function TraceToPlayer takes player p,string msg returns nothing
        set logger_msg=msg
        set logger_level=0
        set logger_p=p
        call TriggerEvaluate(logger_tr)
    endfunction  // 向指定玩家输出调试日志(绿色)
    function DebugToPlayer takes player p,string msg returns nothing
        set logger_msg=msg
        set logger_level=1
        set logger_p=p
        call TriggerEvaluate(logger_tr)
    endfunction  // 向指定玩家输出信息日志(白色)
    function InfoToPlayer takes player p,string msg returns nothing
        set logger_msg=msg
        set logger_level=2
        set logger_p=p
        call TriggerEvaluate(logger_tr)
    endfunction  // 向指定玩家输出警告日志(黄色)
    function WarnToPlayer takes player p,string msg returns nothing
        set logger_msg=msg
        set logger_level=3
        set logger_p=p
        call TriggerEvaluate(logger_tr)
    endfunction  // 向指定玩家输出错误日志(红色)
    function ErrorToPlayer takes player p,string msg returns nothing
        set logger_msg=msg
        set logger_level=4
        set logger_p=p
        call TriggerEvaluate(logger_tr)
    endfunction
    function Logger___onInit takes nothing returns nothing
        call Cheat("exec-lua:depends.debug.logger")
    endfunction

//library Logger ends
//library YDWEAroundSystem:
//library TP1 requires YDWEBase
    function YDWEAroundSystem___spin takes nothing returns nothing
        local integer d= 0
        local real x= 0.
        local real y= 0.
        local integer inst= 0
        
        loop
            exitwhen ( inst == s__YDWEAroundSystem___Data_Total )
            set d=s__YDWEAroundSystem___Data_Structs[inst]
            if ( s__YDWEAroundSystem___Data_dur[d] > 0 ) and ( GetUnitState(s__YDWEAroundSystem___Data_caster[d], UNIT_STATE_LIFE) > 0 ) and ( GetUnitState(s__YDWEAroundSystem___Data_obj[d], UNIT_STATE_LIFE) > 0 ) then
                set s__YDWEAroundSystem___Data_each[d]=s__YDWEAroundSystem___Data_each[d] + YDWEAroundSystem___AROUND_INTER
                if ( s__YDWEAroundSystem___Data_each[d] >= s__YDWEAroundSystem___Data_inter[d] ) then
                    set s__YDWEAroundSystem___Data_angle[d]=s__YDWEAroundSystem___Data_angle[d] + s__YDWEAroundSystem___Data_rate[d]
                    set s__YDWEAroundSystem___Data_radius[d]=s__YDWEAroundSystem___Data_radius[d] + s__YDWEAroundSystem___Data_dis[d]
                    set s__YDWEAroundSystem___Data_height[d]=s__YDWEAroundSystem___Data_height[d] + s__YDWEAroundSystem___Data_rise[d]
                    set x=GetUnitX(s__YDWEAroundSystem___Data_caster[d]) + s__YDWEAroundSystem___Data_radius[d] * Cos(s__YDWEAroundSystem___Data_angle[d])
                    set y=GetUnitY(s__YDWEAroundSystem___Data_caster[d]) + s__YDWEAroundSystem___Data_radius[d] * Sin(s__YDWEAroundSystem___Data_angle[d])
                    set x=YDWECoordinateX(x)
                    set y=YDWECoordinateY(y)
                    call SetUnitX(s__YDWEAroundSystem___Data_obj[d], x)
                    call SetUnitY(s__YDWEAroundSystem___Data_obj[d], y)
                    call SetUnitFlyHeight(s__YDWEAroundSystem___Data_obj[d], s__YDWEAroundSystem___Data_height[d], 0.)
                    set s__YDWEAroundSystem___Data_each[d]=0.
                endif
                set s__YDWEAroundSystem___Data_dur[d]=s__YDWEAroundSystem___Data_dur[d] - YDWEAroundSystem___AROUND_INTER
            else
                set bj_lastAbilityTargetUnit=s__YDWEAroundSystem___Data_caster[d]
                call YDWESyStemAbilityCastingOverTriggerAction(s__YDWEAroundSystem___Data_obj[d] , 10)
                set s__YDWEAroundSystem___Data_caster[d]=null
                set s__YDWEAroundSystem___Data_obj[d]=null
                call s__YDWEAroundSystem___Data_deallocate(d)
                set s__YDWEAroundSystem___Data_Total=s__YDWEAroundSystem___Data_Total - 1
                set s__YDWEAroundSystem___Data_Structs[inst]=s__YDWEAroundSystem___Data_Structs[s__YDWEAroundSystem___Data_Total]
                set inst=inst - 1
            endif
            set inst=inst + 1
        endloop
        if ( s__YDWEAroundSystem___Data_Total == 0 ) then
            call PauseTimer(YDWEAroundSystem___AROUND_TIM)
        endif
    endfunction
    function YDWEAroundSystem takes unit satellite,unit star,real angleRate,real displacement,real riseRate,real timeout,real interval returns nothing
        local integer d= s__YDWEAroundSystem___Data__allocate()
        local real x1= GetUnitX(star)
        local real y1= GetUnitY(star)
        local real x2= GetUnitX(satellite)
        local real y2= GetUnitY(satellite)
        set s__YDWEAroundSystem___Data_caster[d]=star
        set s__YDWEAroundSystem___Data_obj[d]=satellite
        set s__YDWEAroundSystem___Data_dur[d]=timeout
        set s__YDWEAroundSystem___Data_inter[d]=interval
        set s__YDWEAroundSystem___Data_rate[d]=angleRate * ( 3.14159 / 180. )
        set s__YDWEAroundSystem___Data_dis[d]=displacement
        set s__YDWEAroundSystem___Data_rise[d]=riseRate
        set s__YDWEAroundSystem___Data_angle[d]=Atan2(y2 - y1, x2 - x1)
        set s__YDWEAroundSystem___Data_radius[d]=SquareRoot(( x2 - x1 ) * ( x2 - x1 ) + ( y2 - y1 ) * ( y2 - y1 ))
        set s__YDWEAroundSystem___Data_height[d]=GetUnitFlyHeight(s__YDWEAroundSystem___Data_obj[d])
        set s__YDWEAroundSystem___Data_Structs[s__YDWEAroundSystem___Data_Total]=(d)
        set s__YDWEAroundSystem___Data_Total=s__YDWEAroundSystem___Data_Total + 1
        if ( s__YDWEAroundSystem___Data_Total - 1 == 0 ) then
            call TimerStart(YDWEAroundSystem___AROUND_TIM, YDWEAroundSystem___AROUND_INTER, true, function YDWEAroundSystem___spin)
        endif
    endfunction
    

//library YDWEAroundSystem ends
//library YDWESetGuard:
function YDWESetGuard___IsUnitIdle takes unit u returns boolean
    return OrderId2String(GetUnitCurrentOrder(u)) == null
endfunction
function YDWERemoveGuard takes unit pet returns nothing
    local integer tm= YDWEGetIntegerByString(I2S(YDWEH2I(pet)) , "Timer")
    call YDWEFlushMissionByString(I2S(YDWEH2I(pet)))
    call YDWEFlushMissionByString(I2S(tm))
    call DestroyTimer(YDWEGetTimerByString(I2S(YDWEH2I(pet)) , "Timer"))
endfunction
function SetGuardTimer takes nothing returns nothing
  local timer tm= GetExpiredTimer()
  local unit pet= ( YDWEGetUnitByString(I2S(YDWEH2I(tm)) , "Pet") )
  local unit captain= ( YDWEGetUnitByString(I2S(YDWEH2I(tm)) , "Captain") )
  local real x= GetUnitX(captain) - GetUnitX(pet)
  local real y= GetUnitY(captain) - GetUnitY(pet)
  local real d= x * x + y * y
  local real v
  local real a
  local effect e=null
  local real life= YDWEGetRealByString(I2S(YDWEH2I(tm)) , "Life")
  local integer p= YDWEGetIntegerByString(I2S(YDWEH2I(tm)) , "Percent")
  set v=YDWEGetRealByString(I2S(YDWEH2I(tm)) , "GuardRanger")
  if GetUnitState(pet, UNIT_STATE_LIFE) > 0 and GetUnitState(captain, UNIT_STATE_LIFE) > 0 then
      if d < v * v then
         if YDWESetGuard___IsUnitIdle(pet) and GetRandomInt(0, 100) < p then
           set x=GetUnitX(captain)
           set y=GetUnitY(captain)
           set d=GetRandomReal(0, v)
           set a=GetRandomReal(0, 360)
           call IssuePointOrder(pet, "patrol", x + d * CosBJ(a), y + d * SinBJ(a))
         endif
      else
        set v=YDWEGetRealByString(I2S(YDWEH2I(tm)) , "ReturnRanger")
        if d < v * v then
          if YDWESetGuard___IsUnitIdle(pet) then
            call IssuePointOrder(pet, "patrol", GetUnitX(captain), GetUnitY(captain))
          endif
        else
          set v=YDWEGetRealByString(I2S(YDWEH2I(tm)) , "OutRanger")
            if d != 0 and d > v * v then
              call SetUnitPosition(pet, GetUnitX(captain), GetUnitY(captain))
              set e=AddSpecialEffectTarget("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTarget.mdl", captain, "chest")
              call DestroyEffect(e)
            else
              call IssuePointOrder(pet, "move", GetUnitX(captain), GetUnitY(captain))
            endif
          endif
       endif
     else
       call IssuePointOrder(pet, "attack", GetUnitX(captain), GetUnitY(captain))
       call YDWERemoveGuard(pet)
  endif
  set tm=null
  set pet=null
  set captain=null
  set e=null
endfunction
function YDWESetGuard takes unit pet,unit captain,real timeout,real guardRanger,real returnRanger,real outRanger,integer percent returns nothing
    local timer tm= CreateTimer()
    call YDWESaveTimerByString(I2S(YDWEH2I(pet)) , "Timer" , tm)
    call YDWESaveUnitByString(I2S(YDWEH2I(tm)) , "pet" , pet)
    call YDWESaveUnitByString(I2S(YDWEH2I(tm)) , "Captain" , captain)
    call YDWESaveIntegerByString(I2S(YDWEH2I(tm)) , "Percent" , percent)
    call YDWESaveRealByString(I2S(YDWEH2I(tm)) , "GuardRanger" , guardRanger)
    call YDWESaveRealByString(I2S(YDWEH2I(tm)) , "ReturnRanger" , returnRanger)
    call YDWESaveRealByString(I2S(YDWEH2I(tm)) , "OutRanger" , outRanger)
    call TimerStart(tm, timeout, true, function SetGuardTimer)
    set tm=null
endfunction

//library YDWESetGuard ends
//library YDWETimerPattern:
//***************************************************
//*  - Matrix ģ庯
//*--------------------
//* ߣWarft_TigerCN  ŻFetrix_sai
//***************************************************
//processed:     function interface AfterCollied takes YDWETimerPattern___Thread t,real nx,real ny returns nothing
    //-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
    //                                       Timer Pattern Union                                              //
    //-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
    function YDWETimerPattern___SingleMagic takes unit sour,unit targ,real x,real y,real h,integer uid,integer aid,integer lv,integer order returns nothing
        local unit dummy= CreateUnit(GetOwningPlayer(sour), uid, x, y, GetUnitFacing(sour))
        call UnitApplyTimedLife(dummy, 'BHwe', 1.0)
        call UnitAddAbility(dummy, aid)
        call SetUnitAbilityLevel(dummy, aid, lv)
        call SetUnitFlyHeight(dummy, h, 0.0)
        call IssueTargetOrderById(dummy, order, targ)
        //debug call BJDebugMsg("Target order")
        set dummy=null
    endfunction
    function YDWETimerPattern___GetUnitZ takes unit u returns real
        call MoveLocation(YDWETimerPattern___yd_loc, GetUnitX(u), GetUnitY(u))
        return GetUnitFlyHeight(u) + GetLocationZ(YDWETimerPattern___yd_loc)
    endfunction
    //-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
    //                                            Filter Funcs                                                //
    //-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
    function YDWETimerPattern___EnemyFilter takes unit u,unit caster returns boolean
        return IsUnitType(u, UNIT_TYPE_MAGIC_IMMUNE) == false and IsUnitType(u, UNIT_TYPE_RESISTANT) == false and IsUnitType(u, UNIT_TYPE_SLEEPING) == false and GetUnitState(u, UNIT_STATE_LIFE) > 0.405 and IsUnitType(u, UNIT_TYPE_STRUCTURE) == false and IsUnitIllusion(u) == false and IsUnitHidden(u) == false and IsUnitEnemy(u, GetOwningPlayer(caster)) and IsUnitVisible(u, GetOwningPlayer(caster))
    endfunction
    function YDWETimerPattern___TreeFilter takes nothing returns boolean
        local integer id= GetDestructableTypeId(GetFilterDestructable())
        return id == 'LTlt' or id == 'ATtr' or id == 'BTtw' or id == 'KTtw' or id == 'YTft' or id == 'JTct' or id == 'YTst' or id == 'YTct' or id == 'YTwt' or id == 'JTtw' or id == 'DTsh' or id == 'FTtw' or id == 'CTtr' or id == 'ITtw' or id == 'NTtw' or id == 'OTtw' or id == 'ZTtw' or id == 'WTst' or id == 'GTsh' or id == 'VTlt' or id == 'WTtw' or id == 'ATtc' or id == 'BTtc' or id == 'CTtc' or id == 'ITtc' or id == 'NTtc' or id == 'ZTtc'
    endfunction
    function YDWETimerPattern___DamageFilter takes nothing returns boolean
        local unit u= GetFilterUnit()
        local integer d= YDWETimerPattern___tmp_data
        //call BJDebugMsg("outer:"+I2S(CountUnitsInGroup(d.g)))
        if not ( IsUnitInGroup(u, s__YDWETimerPattern___Thread_g[d]) ) and s__YDWETimerPattern___Thread_switch[d] != 0 and YDWETimerPattern___EnemyFilter(u , s__YDWETimerPattern___Thread_caster[d]) then
            call GroupAddUnit(s__YDWETimerPattern___Thread_g[d], u)
            call BJDebugMsg(I2S(YDWEH2I(u)))
            call UnitDamageTarget(s__YDWETimerPattern___Thread_caster[d], u, s__YDWETimerPattern___Thread_amount[d], true, true, bj_lastSetAttackType, bj_lastSetDamageType, bj_lastSetWeaponType)
            //call DestroyEffect(AddSpecialEffectTarget(d.dsfx, u, d.part))
            call DestroyEffect(AddSpecialEffect(s__YDWETimerPattern___Thread_dsfx[d], GetUnitX(u), GetUnitY(u)))
           // call BJDebugMsg(":" + d.dsfx)
            if s__YDWETimerPattern___Thread_skills[d] > '0000' and s__YDWETimerPattern___Thread_skills[d] != null and s__YDWETimerPattern___Thread_order[d] > 0 and s__YDWETimerPattern___Thread_order[d] != null then
                call YDWETimerPattern___SingleMagic(s__YDWETimerPattern___Thread_caster[d] , u , s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_pos[d]] , s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_pos[d]] , GetUnitFlyHeight(s__YDWETimerPattern___Thread_obj[d]) , s__YDWETimerPattern___Thread_unitid[d] , s__YDWETimerPattern___Thread_skills[d] , s__YDWETimerPattern___Thread_level[d] , s__YDWETimerPattern___Thread_order[d])
            endif
            if not ( s__YDWETimerPattern___Thread_recycle[d] ) then
                //debug call BJDebugMsg("|cff00ff00[YDWE] Timer Pattern : |r A one-time.")
                set s__YDWETimerPattern___Thread_switch[d]=0
            endif
            set s__YDWETimerPattern___Thread_target[d]=u
            set u=null
            return true
        endif
        set u=null
        return false
    endfunction
    function YDWETimerPattern___TreeKill takes nothing returns nothing
        local destructable d= GetEnumDestructable()
        if GetWidgetLife(d) > 0.405 then
            call KillDestructable(d)
        endif
        set d=null
    endfunction
    //-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
    //                                         Major Structure Code                                           //
    //-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=
        function s__YDWETimerPattern___Thread__staticgetindex takes handle h returns integer
            return YDWEGetIntegerByString("YDWETimerPattern." , I2S(YDWEH2I(h)))
        endfunction
        function s__YDWETimerPattern___Thread__staticsetindex takes handle h,integer value returns nothing
            call YDWESaveIntegerByString("YDWETimerPattern." , I2S(YDWEH2I(h)) , value)
        endfunction
        function s__YDWETimerPattern___Thread_flush takes handle h returns nothing
            call YDWEFlushStoredIntegerByString("YDWETimerPattern." , I2S(YDWEH2I(h)))
        endfunction
        function s__YDWETimerPattern___Thread__set_x takes integer this,real value returns nothing
            set s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_pos[this]]=value
            call SetUnitX(s__YDWETimerPattern___Thread_obj[this], value)
        endfunction
        function s__YDWETimerPattern___Thread__set_y takes integer this,real value returns nothing
            set s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_pos[this]]=value
            call SetUnitY(s__YDWETimerPattern___Thread_obj[this], value)
        endfunction
        function s__YDWETimerPattern___Thread__set_z takes integer this,real value returns nothing
            set s__YDWETimerPattern___YDVector3_z[s__YDWETimerPattern___Thread_pos[this]]=value
            call MoveLocation(YDWETimerPattern___yd_loc, s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_pos[this]], s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_pos[this]])
            call SetUnitFlyHeight(s__YDWETimerPattern___Thread_obj[this], value - GetLocationZ(YDWETimerPattern___yd_loc), 0)
        endfunction
        function s__YDWETimerPattern___Thread_onDestroy takes integer this returns nothing
            //debug call BJDebugMsg("|cff00ff00[YDWE] Timer Pattern : |r Knockback stopped!")
            call s__YDWETimerPattern___Thread_flush(s__YDWETimerPattern___Thread_obj[this])
            call s__YDWETimerPattern___Thread_flush(s__YDWETimerPattern___Thread_t[this])
            call GroupClear(s__YDWETimerPattern___Thread_g[this])
            call DestroyGroup(s__YDWETimerPattern___Thread_g[this])
            call PauseTimer(s__YDWETimerPattern___Thread_t[this])
            call DestroyTimer(s__YDWETimerPattern___Thread_t[this])
            call s__YDWETimerPattern___YDVector3_deallocate(s__YDWETimerPattern___Thread_des[this])
            call s__YDWETimerPattern___YDVector3_deallocate(s__YDWETimerPattern___Thread_pos[this])
            call s__YDWETimerPattern___YDVector3_deallocate(s__YDWETimerPattern___Thread_vel[this])
            set s__YDWETimerPattern___Thread_caster[this]=null
            set s__YDWETimerPattern___Thread_target[this]=null
            set s__YDWETimerPattern___Thread_obj[this]=null
            set s__YDWETimerPattern___Thread_g[this]=null
            set s__YDWETimerPattern___Thread_t[this]=null
            set s__YDWETimerPattern___Thread_amount[this]=0
            set s__YDWETimerPattern___Thread_skills[this]=0
            set s__YDWETimerPattern___Thread_order[this]=0
            set s__YDWETimerPattern___Thread_afc[this]=0
            set s__YDWETimerPattern___Thread_dsfx[this]=""
            set s__YDWETimerPattern___Thread_gsfx[this]=""
            set s__YDWETimerPattern___Thread_wsfx[this]=""
            set s__YDWETimerPattern___Thread_part[this]=""
        endfunction
        function s__YDWETimerPattern___Parabola_move takes nothing returns nothing
            local integer this= s__YDWETimerPattern___Thread__staticgetindex(GetExpiredTimer())
            //local real vx = .des.x - .pos.x
            //local real vy = .des.y - .pos.y
            //local real vz = .des.z - .pos.z
            //if vx * vx + vy * vy + vz * vz > 900.0 then
                call s__YDWETimerPattern___Thread__set_x(this,GetUnitX(s__YDWETimerPattern___Thread_obj[this]) + s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_vel[this]]) //.pos.x + .vel.x
call s__YDWETimerPattern___Thread__set_y(this,GetUnitY(s__YDWETimerPattern___Thread_obj[this]) + s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_vel[this]]) //.pos.y + .vel.y
call s__YDWETimerPattern___Thread__set_z(this,YDWETimerPattern___GetUnitZ(s__YDWETimerPattern___Thread_obj[this]) + s__YDWETimerPattern___Thread_ac[this] * s__YDWETimerPattern___Thread_step[this] * 2 + s__YDWETimerPattern___Thread_ac[this] * s__YDWETimerPattern___Thread_dist[this] + s__YDWETimerPattern___Thread_bc[this]) //.pos.z + .ac * .step * 2 + .ac * .dist + .bc
set s__YDWETimerPattern___Thread_step[this]=s__YDWETimerPattern___Thread_step[this] + s__YDWETimerPattern___Thread_dist[this]
                //debug call BJDebugMsg("|cff00ff00[YDWE] Timer Pattern : |r high = ." + R2S(GetLocationZ(yd_loc)))
                if YDWECoordinateX(s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_pos[this]]) != s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_pos[this]] or YDWECoordinateY(s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_pos[this]]) != s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_pos[this]] or s__YDWETimerPattern___YDVector3_z[s__YDWETimerPattern___Thread_pos[this]] <= GetLocationZ(YDWETimerPattern___yd_loc) then
                    set s__YDWETimerPattern___Thread_switch[this]=0
                endif
                if s__YDWETimerPattern___Thread_amount[this] > 0.0 then
                    //call this.damage(.caster, .pos.x + .vel.x, .pos.y + .vel.y, GetUnitZ(.obj), false, false)
                    set YDWETimerPattern___tmp_data=(this)
                    call GroupEnumUnitsInRange(s__YDWETimerPattern___Thread_g[this], s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_pos[this]] + s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_vel[this]], s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_pos[this]] + s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_vel[this]], 120.0, Condition(function YDWETimerPattern___DamageFilter))
                    //debug call BJDebugMsg("|cff00ff00[YDWE] Timer Pattern : |r Area damage.")
                endif
            //else
                //set .switch = 0
            //endif
            if s__YDWETimerPattern___Thread_switch[this] == 0 then
                call SetUnitFlyHeight(s__YDWETimerPattern___Thread_obj[this], GetUnitDefaultFlyHeight(s__YDWETimerPattern___Thread_obj[this]), 200.0)
                call SetUnitTimeScale(s__YDWETimerPattern___Thread_obj[this], 1)
                //YDWETriggerEvent
                call YDWESyStemAbilityCastingOverTriggerAction(s__YDWETimerPattern___Thread_obj[this] , 7)
                call sc__YDWETimerPattern___Thread_deallocate(this)
            endif
        endfunction
        function s__YDWETimerPattern___Parabola_create takes unit source,unit object,real angle,real distance,real time,real interval,real high,real damage,string attach,string deff returns integer
            local integer this= s__YDWETimerPattern___Parabola__allocate()
            local real vx= 0.0
            local real vy= 0.0
            local real vz= 0.0
            set s__YDWETimerPattern___Thread_des[this]=s__YDWETimerPattern___YDVector3__allocate()
            set s__YDWETimerPattern___Thread_pos[this]=s__YDWETimerPattern___YDVector3__allocate()
            set s__YDWETimerPattern___Thread_vel[this]=s__YDWETimerPattern___YDVector3__allocate()
            set s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_pos[this]]=GetUnitX(object)
            set s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_pos[this]]=GetUnitY(object)
            set s__YDWETimerPattern___YDVector3_z[s__YDWETimerPattern___Thread_pos[this]]=YDWETimerPattern___GetUnitZ(object)
            set s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_des[this]]=s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_pos[this]] + distance * Cos(angle)
            set s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_des[this]]=s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_pos[this]] + distance * Sin(angle)
            call MoveLocation(YDWETimerPattern___yd_loc, s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_des[this]], s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_des[this]])
            set s__YDWETimerPattern___YDVector3_z[s__YDWETimerPattern___Thread_des[this]]=GetLocationZ(YDWETimerPattern___yd_loc)
            if s__YDWETimerPattern___YDVector3_z[s__YDWETimerPattern___Thread_pos[this]] > s__YDWETimerPattern___YDVector3_z[s__YDWETimerPattern___Thread_des[this]] then
                set high=high + s__YDWETimerPattern___YDVector3_z[s__YDWETimerPattern___Thread_pos[this]]
            else
                set high=high + s__YDWETimerPattern___YDVector3_z[s__YDWETimerPattern___Thread_des[this]]
            endif
            set s__YDWETimerPattern___Thread_ac[this]=( 2 * ( s__YDWETimerPattern___YDVector3_z[s__YDWETimerPattern___Thread_pos[this]] + s__YDWETimerPattern___YDVector3_z[s__YDWETimerPattern___Thread_des[this]] ) - 4 * high ) / ( distance * distance )
            set s__YDWETimerPattern___Thread_bc[this]=( s__YDWETimerPattern___YDVector3_z[s__YDWETimerPattern___Thread_des[this]] - s__YDWETimerPattern___YDVector3_z[s__YDWETimerPattern___Thread_pos[this]] - s__YDWETimerPattern___Thread_ac[this] * distance * distance ) / distance
            set s__YDWETimerPattern___Thread_dist[this]=distance * interval / time
            set s__YDWETimerPattern___Thread_ac[this]=s__YDWETimerPattern___Thread_ac[this] * s__YDWETimerPattern___Thread_dist[this]
            set s__YDWETimerPattern___Thread_bc[this]=s__YDWETimerPattern___Thread_bc[this] * s__YDWETimerPattern___Thread_dist[this]
            set s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_vel[this]]=s__YDWETimerPattern___Thread_dist[this] * Cos(angle)
            set s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_vel[this]]=s__YDWETimerPattern___Thread_dist[this] * Sin(angle)
            set s__YDWETimerPattern___Thread_step[this]=0.0
            set s__YDWETimerPattern___Thread_caster[this]=source
            set s__YDWETimerPattern___Thread_obj[this]=object
            set s__YDWETimerPattern___Thread_amount[this]=damage
            set s__YDWETimerPattern___Thread_dsfx[this]=deff
            set s__YDWETimerPattern___Thread_part[this]=attach
            set s__YDWETimerPattern___Thread_switch[this]=1
            set s__YDWETimerPattern___Thread_recycle[this]=true
            set s__YDWETimerPattern___Thread_t[this]=CreateTimer()
            set s__YDWETimerPattern___Thread_g[this]=CreateGroup()
            call UnitAddAbility(s__YDWETimerPattern___Thread_obj[this], 'Amrf')
            call UnitRemoveAbility(s__YDWETimerPattern___Thread_obj[this], 'Amrf')
            call TimerStart(s__YDWETimerPattern___Thread_t[this], interval, true, function s__YDWETimerPattern___Parabola_move)
            call GroupAddUnit(s__YDWETimerPattern___Thread_g[this], object)
            call s__YDWETimerPattern___Thread__staticsetindex(object, (this))
            call s__YDWETimerPattern___Thread__staticsetindex(s__YDWETimerPattern___Thread_t[this], (this))
            return this
        endfunction
    // uniform speed
        function s__YDWETimerPattern___Linear_move takes nothing returns nothing
            local integer this= s__YDWETimerPattern___Thread__staticgetindex(GetExpiredTimer())
            if s__YDWETimerPattern___Thread_step[this] > s__YDWETimerPattern___Thread_dist[this] then
                call s__YDWETimerPattern___Thread__set_x(this,GetUnitX(s__YDWETimerPattern___Thread_obj[this]) + s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_vel[this]]) //.pos.x + .vel.x
call s__YDWETimerPattern___Thread__set_y(this,GetUnitY(s__YDWETimerPattern___Thread_obj[this]) + s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_vel[this]]) //.pos.y + .vel.y
//set .pos.z = GetUnitZ(.obj)
set s__YDWETimerPattern___Thread_step[this]=s__YDWETimerPattern___Thread_step[this] - s__YDWETimerPattern___Thread_dist[this]
                //call this.damage(.caster, .pos.x, .pos.y, .pos.z, true, true)
                set YDWETimerPattern___tmp_data=(this)
                call GroupEnumUnitsInRange(s__YDWETimerPattern___Thread_g[this], s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_pos[this]] + s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_vel[this]], s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_pos[this]] + s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_vel[this]], 120.0, Condition(function YDWETimerPattern___DamageFilter))
                if YDWECoordinateX(s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_pos[this]]) != s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_pos[this]] or YDWECoordinateY(s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_pos[this]]) != s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_pos[this]] then
                    set s__YDWETimerPattern___Thread_switch[this]=0
                endif
            else
                set s__YDWETimerPattern___Thread_switch[this]=0
            endif
            if s__YDWETimerPattern___Thread_switch[this] == 0 then
                // YDWETriggerEvent
                if s__YDWETimerPattern___Thread_target[this] != null then
                    //debug call BJDebugMsg("|cff00ff00[YDWE] Timer Pattern : |r  |cffff0000" + GetUnitName(.target) + "|r was hit!!!")
                    //call YDWESaveUnitByString(I2S(YDWEH2I(.caster)), "MoonPriestessArrow", .target)
                    set bj_lastAbilityTargetUnit=s__YDWETimerPattern___Thread_target[this]
                    call YDWESyStemAbilityCastingOverTriggerAction(s__YDWETimerPattern___Thread_caster[this] , 8)
                else
                    call YDWESyStemAbilityCastingOverTriggerAction(s__YDWETimerPattern___Thread_caster[this] , 9)
                endif
                //call KillUnit(.obj)
                call RemoveUnit(s__YDWETimerPattern___Thread_obj[this])
                call sc__YDWETimerPattern___Thread_deallocate(this)
            endif
        endfunction
        function s__YDWETimerPattern___Linear_create takes unit source,unit object,real angle,real distance,real time,real interval,integer uid,integer aid,integer lv,integer orderid,string attach,string sfx returns integer
            local integer this= s__YDWETimerPattern___Linear__allocate()
            set s__YDWETimerPattern___Thread_des[this]=s__YDWETimerPattern___YDVector3__allocate()
            set s__YDWETimerPattern___Thread_pos[this]=s__YDWETimerPattern___YDVector3__allocate()
            set s__YDWETimerPattern___Thread_vel[this]=s__YDWETimerPattern___YDVector3__allocate()
            set s__YDWETimerPattern___Thread_step[this]=distance
            set s__YDWETimerPattern___Thread_dist[this]=distance * interval / time
            set s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_vel[this]]=s__YDWETimerPattern___Thread_dist[this] * Cos(angle)
            set s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_vel[this]]=s__YDWETimerPattern___Thread_dist[this] * Sin(angle)
            set s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_pos[this]]=GetUnitX(object)
            set s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_pos[this]]=GetUnitY(object)
            set s__YDWETimerPattern___Thread_caster[this]=source
            set s__YDWETimerPattern___Thread_obj[this]=object
            set s__YDWETimerPattern___Thread_unitid[this]=uid
            set s__YDWETimerPattern___Thread_skills[this]=aid
            set s__YDWETimerPattern___Thread_level[this]=lv
            set s__YDWETimerPattern___Thread_order[this]=orderid
            set s__YDWETimerPattern___Thread_part[this]=attach
            set s__YDWETimerPattern___Thread_gsfx[this]=sfx
            set s__YDWETimerPattern___Thread_switch[this]=1
            set s__YDWETimerPattern___Thread_recycle[this]=false
            set s__YDWETimerPattern___Thread_t[this]=CreateTimer()
            set s__YDWETimerPattern___Thread_g[this]=CreateGroup()
            call TimerStart(s__YDWETimerPattern___Thread_t[this], interval, true, function s__YDWETimerPattern___Linear_move)
            call s__YDWETimerPattern___Thread__staticsetindex(s__YDWETimerPattern___Thread_t[this], (this))
            return this
        endfunction
    // Uniform deceleration
        function s__YDWETimerPattern___Deceleration_move takes nothing returns nothing
            local integer this= s__YDWETimerPattern___Thread__staticgetindex(GetExpiredTimer())
            local real xp= GetUnitX(s__YDWETimerPattern___Thread_obj[this]) + s__YDWETimerPattern___Thread_dist[this] * s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_vel[this]]
            local real yp= GetUnitY(s__YDWETimerPattern___Thread_obj[this]) + s__YDWETimerPattern___Thread_dist[this] * s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_vel[this]]
            local group ge= CreateGroup()
            if s__YDWETimerPattern___Thread_volume[this] == false then
                //debug call BJDebugMsg("|cff00ff00[YDWE] Timer Pattern : |rPathable without terrain.")
                if IsTerrainPathable(xp, yp, PATHING_TYPE_WALKABILITY) then
                    if ( s__YDWETimerPattern___Thread_afc[this] != 0 ) then
                        call sc___prototype223_execute(s__YDWETimerPattern___Thread_afc[this],this , xp , yp)
                    else
                        set s__YDWETimerPattern___Thread_switch[this]=0
                    endif
                else
                    call s__YDWETimerPattern___Thread__set_x(this,xp)
                    call s__YDWETimerPattern___Thread__set_y(this,yp)
                endif
            else
                call s__YDWETimerPattern___Thread__set_x(this,xp)
                call s__YDWETimerPattern___Thread__set_y(this,yp)
            endif
            if s__YDWETimerPattern___Thread_follow[this] == 0 then
                if GetUnitFlyHeight(s__YDWETimerPattern___Thread_obj[this]) < 5. then
                        call DestroyEffect(AddSpecialEffect(s__YDWETimerPattern___Thread_gsfx[this], s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_pos[this]], s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_pos[this]]))
                endif
            endif
            set s__YDWETimerPattern___Thread_follow[this]=s__YDWETimerPattern___Thread_follow[this] + 1
            if s__YDWETimerPattern___Thread_follow[this] == 2 then
                set s__YDWETimerPattern___Thread_follow[this]=0
            endif
            if s__YDWETimerPattern___Thread_killdest[this] then
                call MoveRectTo(YDWETimerPattern___Area, s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_pos[this]], s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_pos[this]])
                call EnumDestructablesInRect(YDWETimerPattern___Area, YDWETimerPattern___Bexpr, function YDWETimerPattern___TreeKill)
            endif
            if s__YDWETimerPattern___Thread_amount[this] > 0.0 then
                //call this.damage(.caster, .pos.x, .pos.y, 0.0, false, .recycle)
                set YDWETimerPattern___tmp_data=(this)
                call GroupEnumUnitsInRange(ge, s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_pos[this]], s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_pos[this]], s__YDWETimerPattern___Thread_radius[this], Condition(function YDWETimerPattern___DamageFilter))
            endif
            set s__YDWETimerPattern___Thread_step[this]=s__YDWETimerPattern___Thread_step[this] - 1.
            if s__YDWETimerPattern___Thread_step[this] <= 0.0 or YDWECoordinateX(s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_pos[this]]) != s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_pos[this]] or YDWECoordinateY(s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_pos[this]]) != s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_pos[this]] then
                set s__YDWETimerPattern___Thread_switch[this]=0
            endif
            call DestroyGroup(ge)
            set ge=null
            if not ( IsUnitAliveBJ(s__YDWETimerPattern___Thread_obj[this]) ) then
                set s__YDWETimerPattern___Thread_switch[this]=0
            endif
            if s__YDWETimerPattern___Thread_switch[this] == 0 then
                call SetUnitFlyHeight(s__YDWETimerPattern___Thread_obj[this], GetUnitDefaultFlyHeight(s__YDWETimerPattern___Thread_obj[this]), 200.0)
                call SetUnitTimeScale(s__YDWETimerPattern___Thread_obj[this], 1)
                // YDWETriggerEvent
                call YDWESyStemAbilityCastingOverTriggerAction(s__YDWETimerPattern___Thread_obj[this] , 6)
                call sc__YDWETimerPattern___Thread_deallocate(this)
            endif
        endfunction
        function s__YDWETimerPattern___Deceleration_create takes unit source,unit object,real angle,real distance,real time,real interval,real damage,real radius,boolean killtrees,boolean cycle,boolean path,string part,string geff,string weff,integer f returns integer
            local integer this= s__YDWETimerPattern___Deceleration__allocate()
local real vx= 0.0
            local real vy= 0.0
            local real l= 0.0
            set s__YDWETimerPattern___Thread_des[this]=s__YDWETimerPattern___YDVector3__allocate()
            set s__YDWETimerPattern___Thread_pos[this]=s__YDWETimerPattern___YDVector3__allocate()
            set s__YDWETimerPattern___Thread_vel[this]=s__YDWETimerPattern___YDVector3__allocate()
            set s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_vel[this]]=Cos(angle)
            set s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_vel[this]]=Sin(angle)
            set s__YDWETimerPattern___Thread_dist[this]=distance * interval / time
            //stepĳ˶
            set s__YDWETimerPattern___Thread_step[this]=time / interval
            set s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_pos[this]]=GetUnitX(object)
            set s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_pos[this]]=GetUnitY(object)
            set s__YDWETimerPattern___Thread_caster[this]=source
            set s__YDWETimerPattern___Thread_obj[this]=object
            set s__YDWETimerPattern___Thread_radius[this]=radius
            set s__YDWETimerPattern___Thread_amount[this]=damage
            set s__YDWETimerPattern___Thread_killdest[this]=killtrees
            set s__YDWETimerPattern___Thread_recycle[this]=cycle
            set s__YDWETimerPattern___Thread_volume[this]=path
            set s__YDWETimerPattern___Thread_gsfx[this]=geff
            set s__YDWETimerPattern___Thread_dsfx[this]=weff
            set s__YDWETimerPattern___Thread_switch[this]=1
            set s__YDWETimerPattern___Thread_follow[this]=0
            set s__YDWETimerPattern___Thread_afc[this]=f
            set s__YDWETimerPattern___Thread_g[this]=CreateGroup()
            set s__YDWETimerPattern___Thread_t[this]=CreateTimer()
            call TimerStart(s__YDWETimerPattern___Thread_t[this], interval, true, function s__YDWETimerPattern___Deceleration_move)
            call s__YDWETimerPattern___Thread__staticsetindex(s__YDWETimerPattern___Thread_t[this], (this))
            return this
        endfunction
    // Jump Attack PUI
    function YDWETimerPatternJumpAttack takes unit u,real face,real dis,real lasttime,real timeout,real high,real damage,string part,string dsfx returns nothing
        if u == null then
            //debug call BJDebugMsg("|cff00ff00[YDWE] Timer Pattern : |r No object!")
            return
        endif
        call s__YDWETimerPattern___Parabola_create(u , u , Deg2Rad(face) , RMaxBJ(dis, 0) , RMaxBJ(lasttime, 0) , RMaxBJ(timeout, 0) , high , damage , part , dsfx)
    endfunction
    // Moon Priestess Arrow PUI
    function YDWETimerPatternMoonPriestessArrow takes unit u,real face,real dis,real lasttime,real timeout,integer lv,integer aid,integer uid,string order,string part,string dsfx returns nothing
        local unit sour= null
        if u == null then
            //debug call BJDebugMsg("|cff00ff00[YDWE] Timer Pattern : |r No object!")
            return
        endif
        set sour=YDWEGetUnitByString(I2S(YDWEH2I(u)) , "MoonPriestessArrow")
        if sour == null then
            set sour=u
        endif
        call s__YDWETimerPattern___Linear_create(sour , u , Deg2Rad(face) , RMaxBJ(dis, 0) , RMaxBJ(lasttime, 0) , RMaxBJ(timeout, 0) , uid , aid , IMaxBJ(lv, 1) , OrderId(order) , part , dsfx)
        //call YDWEFlushMissionByString(I2S(YDWEH2I(u)))
        set sour=null
    endfunction
    // Rush Slide PUI
    function YDWETimerPatternRushSlide takes unit u,real face,real dis,real lasttime,real timeout,real damage,real radius,boolean killtrees,boolean cycle,boolean path,string part,string gsfx,string wsfx returns nothing
        if u == null then
            //debug call BJDebugMsg("|cff00ff00[YDWE] Timer Pattern : |r No object!")
            return
        endif
        call s__YDWETimerPattern___Deceleration_create(u , u , Deg2Rad(face) , RMaxBJ(dis, 0) , RMaxBJ(lasttime, 0) , RMaxBJ(timeout, 0) , damage , RMaxBJ(radius, 0) , killtrees , cycle , path , part , gsfx , wsfx , 0)
    endfunction
    function YDWETimerPattern___Rebound takes integer t,real nx,real ny returns nothing
        
        if not ( IsTerrainPathable(nx, s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_pos[t]], PATHING_TYPE_WALKABILITY) ) then
            set s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_vel[t]]=- 1 * s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_vel[t]]
        elseif not ( IsTerrainPathable(s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_pos[t]], ny, PATHING_TYPE_WALKABILITY) ) then
            set s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_vel[t]]=- 1 * s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_vel[t]]
        else
            set s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_vel[t]]=- 1 * s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_vel[t]]
            set s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_vel[t]]=- 1 * s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_vel[t]]
        endif
        call GroupClear(s__YDWETimerPattern___Thread_g[t])
        call SetUnitFacing(s__YDWETimerPattern___Thread_obj[t], Atan2BJ(s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_vel[t]], s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_vel[t]]))
    endfunction
    
    function DIYRushSlide takes unit u,real face,real dis,real lasttime,real timeout,real damage,real radius,boolean killtrees,boolean cycle,boolean path,string part,string gsfx,string wsfx returns nothing
         local integer rebound= (1)
         call s__YDWETimerPattern___Deceleration_create(u , u , Deg2Rad(face) , RMaxBJ(dis, 0) , RMaxBJ(lasttime, 0) , RMaxBJ(timeout, 0) , damage , RMaxBJ(radius, 0) , killtrees , cycle , path , part , gsfx , wsfx , (1))
    endfunction
    function YDWETimerPattern___Init takes nothing returns nothing
        set YDWETimerPattern___Area=Rect(- 120.0, - 120.0, 120.0, 120.0)
        set YDWETimerPattern___Bexpr=Filter(function YDWETimerPattern___TreeFilter)
    endfunction

//library YDWETimerPattern ends
//library YDWETimerSystem:
function YDWETimerSystem___NewTaskIndex takes nothing returns integer
 local integer h= YDWETimerSystem___TaskListIdleHead
	if YDWETimerSystem___TaskListIdleHead < 0 then
		if YDWETimerSystem___TaskListIdleMax >= 8000 then
    call BJDebugMsg("中心计时器任务队列溢出！")
			return 8100
		else
			set YDWETimerSystem___TaskListIdleMax=YDWETimerSystem___TaskListIdleMax + 1
			return YDWETimerSystem___TaskListIdleMax
		endif
	endif
	set YDWETimerSystem___TaskListIdleHead=YDWETimerSystem___TaskListIdle[h]
	return h
endfunction
function YDWETimerSystem___DeleteTaskIndex takes integer index returns nothing
	set YDWETimerSystem___TaskListIdle[index]=YDWETimerSystem___TaskListIdleHead
	set YDWETimerSystem___TaskListIdleHead=index
endfunction
//该函数序列处理
function YDWETimerSystem___NewTask takes real time,trigger proc returns integer
 local integer index= YDWETimerSystem___NewTaskIndex()
 local integer h= YDWETimerSystem___TaskListHead
 local integer t= R2I(100. * time) + YDWETimerSystem___CurrentTime
 local integer p
	set YDWETimerSystem___TaskListProc[index]=proc
	set YDWETimerSystem___TaskListTime[index]=t
	loop
		set p=YDWETimerSystem___TaskListNext[h]
		if p < 0 or YDWETimerSystem___TaskListTime[p] >= t then
		//	call BJDebugMsg("NewTask:"+I2S(index))
			set YDWETimerSystem___TaskListNext[h]=index
			set YDWETimerSystem___TaskListNext[index]=p
			return index
		endif
		set h=p
	endloop
	return index
endfunction
function YDWETimerSystemNewTask takes real time,trigger proc returns integer
	return YDWETimerSystem___NewTask(time , proc)
endfunction
function YDWETimerSystemGetCurrentTask takes nothing returns integer
	return YDWETimerSystem___CurrentIndex
endfunction
//删除单位
function YDWETimerSystem___RemoveUnit_CallBack takes nothing returns nothing
    call RemoveUnit(YDHashGet(YDHASH_HANDLE , unit , YDWETimerSystem___TimerHandle , YDWETimerSystem___CurrentIndex))
    call YDHashClear(YDHASH_HANDLE , unit , YDWETimerSystem___TimerHandle , YDWETimerSystem___CurrentIndex)
endfunction
function YDWETimerRemoveUnit takes real time,unit u returns nothing
    call YDHashSet(YDHASH_HANDLE , unit , YDWETimerSystem___TimerHandle , YDWETimerSystem___NewTask(time , YDWETimerSystem___fnRemoveUnit) , u)
endfunction
//摧毁计时器
function YDWETimerSystem___DestroyTimer_CallBack takes nothing returns nothing
    call DestroyTimer(YDHashGet(YDHASH_HANDLE , timer , YDWETimerSystem___TimerHandle , YDWETimerSystem___CurrentIndex))
    call YDHashClear(YDHASH_HANDLE , timer , YDWETimerSystem___TimerHandle , YDWETimerSystem___CurrentIndex)
endfunction
function YDWETimerDestroyTimer takes real time,timer t returns nothing
    call YDHashSet(YDHASH_HANDLE , timer , YDWETimerSystem___TimerHandle , YDWETimerSystem___NewTask(time , YDWETimerSystem___fnDestroyTimer) , t)
endfunction
//删除物品
function YDWETimerSystem___RemoveItem_CallBack takes nothing returns nothing
    call RemoveItem(YDHashGet(YDHASH_HANDLE , item , YDWETimerSystem___TimerHandle , YDWETimerSystem___CurrentIndex))
    call YDHashClear(YDHASH_HANDLE , item , YDWETimerSystem___TimerHandle , YDWETimerSystem___CurrentIndex)
endfunction
function YDWETimerRemoveItem takes real time,item it returns nothing
    call YDHashSet(YDHASH_HANDLE , item , YDWETimerSystem___TimerHandle , YDWETimerSystem___NewTask(time , YDWETimerSystem___fnRemoveItem) , it)
endfunction
//删除特效
function YDWETimerSystem___DestroyEffect_CallBack takes nothing returns nothing
    call DestroyEffect(YDHashGet(YDHASH_HANDLE , effect , YDWETimerSystem___TimerHandle , YDWETimerSystem___CurrentIndex))
    call YDHashClear(YDHASH_HANDLE , effect , YDWETimerSystem___TimerHandle , YDWETimerSystem___CurrentIndex)
endfunction
function YDWETimerDestroyEffect takes real time,effect e returns nothing
    call YDHashSet(YDHASH_HANDLE , effect , YDWETimerSystem___TimerHandle , YDWETimerSystem___NewTask(time , YDWETimerSystem___fnDestroyEffect) , e)
endfunction
//删除闪电特效
function YDWETimerSystem___DestroyLightning_CallBack takes nothing returns nothing
    call DestroyLightning(YDHashGet(YDHASH_HANDLE , lightning , YDWETimerSystem___TimerHandle , YDWETimerSystem___CurrentIndex))
    call YDHashClear(YDHASH_HANDLE , lightning , YDWETimerSystem___TimerHandle , YDWETimerSystem___CurrentIndex)
endfunction
function YDWETimerDestroyLightning takes real time,lightning lt returns nothing
 local integer i= YDWETimerSystem___NewTask(time , YDWETimerSystem___fnDestroyLightning)
    call YDHashSet(YDHASH_HANDLE , lightning , YDWETimerSystem___TimerHandle , i , lt)
endfunction
//运行触发器
function YDWETimerSystem___RunTrigger_CallBack takes nothing returns nothing
    call TriggerExecute(YDHashGet(YDHASH_HANDLE , trigger , YDWETimerSystem___TimerHandle , YDWETimerSystem___CurrentIndex))
    call YDHashClear(YDHASH_HANDLE , trigger , YDWETimerSystem___TimerHandle , YDWETimerSystem___CurrentIndex)
endfunction
function YDWETimerRunTrigger takes real time,trigger trg returns nothing
    call YDHashSet(YDHASH_HANDLE , trigger , YDWETimerSystem___TimerHandle , YDWETimerSystem___NewTask(time , YDWETimerSystem___fnRunTrigger) , trg)
endfunction
//删除漂浮文字
function YDWETimerDestroyTextTag takes real time,texttag tt returns nothing
    local integer N=0
    local integer i=0
    if time <= 0 then
        set time=0.01
    endif
    call SetTextTagPermanent(tt, false)
    call SetTextTagLifespan(tt, time)
    call SetTextTagFadepoint(tt, time)
endfunction
//中心计时器主函数
function YDWETimerSystem___Main takes nothing returns nothing
 local integer h= YDWETimerSystem___TaskListHead
 local integer p
	loop
		set YDWETimerSystem___CurrentIndex=YDWETimerSystem___TaskListNext[h]
		exitwhen YDWETimerSystem___CurrentIndex < 0 or YDWETimerSystem___CurrentTime < YDWETimerSystem___TaskListTime[YDWETimerSystem___CurrentIndex]
		//call BJDebugMsg("Task:"+I2S(CurrentIndex))
		call TriggerEvaluate(YDWETimerSystem___TaskListProc[YDWETimerSystem___CurrentIndex])
		call YDWETimerSystem___DeleteTaskIndex(YDWETimerSystem___CurrentIndex)
		set YDWETimerSystem___TaskListNext[h]=YDWETimerSystem___TaskListNext[YDWETimerSystem___CurrentIndex]
	endloop
	set YDWETimerSystem___CurrentTime=YDWETimerSystem___CurrentTime + 1
endfunction
//初始化函数
function YDWETimerSystem___Init takes nothing returns nothing
    set YDWETimerSystem___Timer=CreateTimer()
	set YDWETimerSystem___TimerHandle=YDHashAny2I(timer , YDWETimerSystem___Timer)
	set YDWETimerSystem___CurrentTime=0
	set YDWETimerSystem___TaskListHead=0
	set YDWETimerSystem___TaskListNext[0]=- 1
	set YDWETimerSystem___TaskListIdleHead=1
	set YDWETimerSystem___TaskListIdleMax=1
	set YDWETimerSystem___TaskListIdle[1]=- 1
	set YDWETimerSystem___fnRemoveUnit=CreateTrigger()
	set YDWETimerSystem___fnDestroyTimer=CreateTrigger()
	set YDWETimerSystem___fnRemoveItem=CreateTrigger()
	set YDWETimerSystem___fnDestroyEffect=CreateTrigger()
	set YDWETimerSystem___fnDestroyLightning=CreateTrigger()
	set YDWETimerSystem___fnRunTrigger=CreateTrigger()
	call TriggerAddCondition(YDWETimerSystem___fnRemoveUnit, Condition(function YDWETimerSystem___RemoveUnit_CallBack))
	call TriggerAddCondition(YDWETimerSystem___fnDestroyTimer, Condition(function YDWETimerSystem___DestroyTimer_CallBack))
	call TriggerAddCondition(YDWETimerSystem___fnRemoveItem, Condition(function YDWETimerSystem___RemoveItem_CallBack))
	call TriggerAddCondition(YDWETimerSystem___fnDestroyEffect, Condition(function YDWETimerSystem___DestroyEffect_CallBack))
	call TriggerAddCondition(YDWETimerSystem___fnDestroyLightning, Condition(function YDWETimerSystem___DestroyLightning_CallBack))
	call TriggerAddCondition(YDWETimerSystem___fnRunTrigger, Condition(function YDWETimerSystem___RunTrigger_CallBack))
    call TimerStart(YDWETimerSystem___Timer, 0.01, true, function YDWETimerSystem___Main)
endfunction
//循环类仍用独立计时器
function YDWETimerSystemGetRunIndex takes nothing returns integer
    return YDWETimerSystem___TimerSystem_RunIndex
endfunction
function YDWETimerSystem___RunPeriodicTriggerFunction takes nothing returns nothing
    local integer tid= YDHashAny2I(timer , GetExpiredTimer())
    local trigger trg= YDHashGet(YDHASH_HANDLE , trigger , tid , $D0001)
	call YDHashSetByString(YDHASH_HANDLE , integer , I2S(YDHashAny2I(trigger , trg)) , "RunIndex" , YDHashGet(YDHASH_HANDLE , integer , tid , $D0002))
    if TriggerEvaluate(trg) then
        call TriggerExecute(trg)
    endif
    set trg=null
endfunction
function YDWETimerSystem___RunPeriodicTriggerFunctionByTimes takes nothing returns nothing
    local integer tid= YDHashAny2I(timer , GetExpiredTimer())
    local trigger trg= YDHashGet(YDHASH_HANDLE , trigger , tid , $D0001)
    local integer times= YDHashGet(YDHASH_HANDLE , integer , tid , $D0003)
	call YDHashSetByString(YDHASH_HANDLE , integer , I2S(YDHashAny2I(trigger , trg)) , "RunIndex" , YDHashGet(YDHASH_HANDLE , integer , tid , $D0002))
    if TriggerEvaluate(trg) then
        call TriggerExecute(trg)
    endif
    set times=times - 1
    if times > 0 then
		call YDHashSet(YDHASH_HANDLE , integer , tid , $D0003 , times)
      else
        call DestroyTimer(GetExpiredTimer())
        call YDHashClearTable(YDHASH_HANDLE , tid)
    endif
    set trg=null
endfunction
function YDWETimerRunPeriodicTrigger takes real timeout,trigger trg,boolean b,integer times,integer data returns nothing
    local timer t
    local integer tid
    local integer index= 0
    if timeout < 0 then
        return
      else
        set t=CreateTimer()
		set tid=YDHashAny2I(timer , t)
    endif
    set YDWETimerSystem___TimerSystem_RunIndex=YDWETimerSystem___TimerSystem_RunIndex + 1
	call YDHashSet(YDHASH_HANDLE , trigger , tid , $D0001 , trg)
	call YDHashSet(YDHASH_HANDLE , integer , tid , $D0002 , YDWETimerSystem___TimerSystem_RunIndex)
	set index=YDHashGet(YDHASH_HANDLE , integer , YDHashAny2I(trigger , trg) , 'YDTS' + data)
    set index=index + 1
	call YDHashSet(YDHASH_HANDLE , integer , YDHashAny2I(trigger , trg) , 'YDTS' + data , index)
	call YDHashSet(YDHASH_HANDLE , timer , YDHashAny2I(trigger , trg) , ( 'YDTS' + data ) * index , t)
    if b == false then
		call YDHashSet(YDHASH_HANDLE , integer , tid , $D0003 , times)
        call TimerStart(t, timeout, true, function YDWETimerSystem___RunPeriodicTriggerFunctionByTimes)
      else
        call TimerStart(t, timeout, true, function YDWETimerSystem___RunPeriodicTriggerFunction)
    endif
    set t=null
endfunction
function YDWETimerRunPeriodicTriggerOver takes trigger trg,integer data returns nothing
 local integer trgid= YDHashAny2I(trigger , trg)
    local integer index= YDHashGet(YDHASH_HANDLE , integer , trgid , 'YDTS' + data)
    local timer t
    loop
        exitwhen index <= 0
        set t=YDHashGet(YDHASH_HANDLE , timer , trgid , ( 'YDTS' + data ) * index)
        call DestroyTimer(t)
        call YDHashClearTable(YDHASH_HANDLE , YDHashAny2I(timer , t))
		call YDHashClear(YDHASH_HANDLE , timer , trgid , ( 'YDTS' + data ) * index)
        set index=index - 1
    endloop
    call YDHashClear(YDHASH_HANDLE , integer , trgid , 'YDTS' + data)
    set t=null
endfunction

//library YDWETimerSystem ends
//library DamageUtils:
    function ApplyPhysicalDamage takes unit u,unit target,real dmg,boolean bj returns nothing
//#         static if LIBRARY_Damage then
//#             set dmgF.isBJ=bj
//#         endif
        call UnitDamageTarget(u, target, dmg, false, false, ATTACK_TYPE_HERO, DAMAGE_TYPE_NORMAL, WEAPON_TYPE_WHOKNOWS)
    endfunction  //单体伤害:真实
    function ApplyPureDamage takes unit u,unit target,real dmg,boolean bj returns nothing
//#         static if LIBRARY_Damage then
//#             set dmgF.isBJ=bj
//#         endif
        call UnitDamageTarget(u, target, dmg, false, false, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_SLOW_POISON, WEAPON_TYPE_WHOKNOWS)
    endfunction  //模拟普攻(最后一个参数代表额外的终伤,0)
    function SimulateBasicAttack takes unit u,unit target,real fd returns nothing
        call UnitDamageTarget(u, target, GetUnitState(u, ConvertUnitState(0x12)) * ( 1.0 + fd ), true, false, ATTACK_TYPE_HERO, DAMAGE_TYPE_NORMAL, WEAPON_TYPE_WHOKNOWS)
    endfunction  //伤害参数结构体
        function s__DamageUtils___DmgP_destroy takes integer this returns nothing
            set s__DamageUtils___DmgP_source[this]=null
            set s__DamageUtils___DmgP_eft[this]=null
        endfunction
        function s__DmgS_push takes integer params returns nothing
            set s__DmgS_top=s__DmgS_top + 1
            set s__s__DmgS_stack[s__DmgS_top]= params
        endfunction
        function s__DmgS_pop takes nothing returns integer
            local integer params=s__s__DmgS_stack[s__DmgS_top]
            set s__s__DmgS_stack[s__DmgS_top]= 0
            set s__DmgS_top=s__DmgS_top - 1
            return params
        endfunction
        function s__DmgS_getTop takes nothing returns integer
            return s__DmgS_top
        endfunction
        function s__DmgS_current takes nothing returns integer
            return s__s__DmgS_stack[s__DmgS_top]
        endfunction
        function DamageUtils___anon__0 takes nothing returns boolean
            local integer current=s__DmgS_current()
            if ( IsEnemy(GetOwningPlayer(s__DamageUtils___DmgP_source[current]) , GetFilterUnit()) ) then
                call ApplyPhysicalDamage(s__DamageUtils___DmgP_source[current] , GetFilterUnit() , s__DamageUtils___DmgP_damage[current] , s__DamageUtils___DmgP_isBj[current])
                if ( s__DamageUtils___DmgP_eft[current] != null ) then
                    call DestroyEffect(AddSpecialEffect(s__DamageUtils___DmgP_eft[current], GetUnitX(GetFilterUnit()), GetUnitY(GetFilterUnit())))
                endif
                return true
            endif
            return false
        endfunction
    function DamageArea takes unit u,real x,real y,real radius,real damage,boolean bj,string efx returns nothing
        local group g=CreateGroup()
        local integer params=s__DamageUtils___DmgP__allocate()
        set s__DamageUtils___DmgP_source[params]=u
        set s__DamageUtils___DmgP_eft[params]=efx
        set s__DamageUtils___DmgP_damage[params]=damage
        set s__DamageUtils___DmgP_isBj[params]=bj
        call s__DmgS_push(params)
        call GroupEnumUnitsInRangeEx(g , x , y , radius , Filter(function DamageUtils___anon__0))
        set params=s__DmgS_pop()
        call s__DamageUtils___DmgP_destroy(params)
        call DestroyGroup(g)
        set g=null
    endfunction  //范围真实伤害
        function DamageUtils___anon__1 takes nothing returns boolean
            local integer current=s__DmgS_current()
            if ( IsEnemy(GetOwningPlayer(s__DamageUtils___DmgP_source[current]) , GetFilterUnit()) ) then
                call ApplyPureDamage(s__DamageUtils___DmgP_source[current] , GetFilterUnit() , s__DamageUtils___DmgP_damage[current] , s__DamageUtils___DmgP_isBj[current])
                if ( s__DamageUtils___DmgP_eft[current] != null ) then
                    call DestroyEffect(AddSpecialEffect(s__DamageUtils___DmgP_eft[current], GetUnitX(GetFilterUnit()), GetUnitY(GetFilterUnit())))
                endif
                return true
            endif
            return false
        endfunction
    function DamageAreaPure takes unit u,real x,real y,real radius,real damage,boolean bj,string efx returns nothing
        local group g=CreateGroup()
        local integer params=s__DamageUtils___DmgP__allocate()
        set s__DamageUtils___DmgP_source[params]=u
        set s__DamageUtils___DmgP_eft[params]=efx
        set s__DamageUtils___DmgP_damage[params]=damage
        set s__DamageUtils___DmgP_isBj[params]=bj
        call s__DmgS_push(params)
        call GroupEnumUnitsInRangeEx(g , x , y , radius , Filter(function DamageUtils___anon__1))
        set params=s__DmgS_pop()
        call s__DamageUtils___DmgP_destroy(params)
        call DestroyGroup(g)
        set g=null
    endfunction

//library DamageUtils ends
//library LHBase:
//---------------------------------------------------------------------------------------------------
    
    function IsStrHero takes unit u returns boolean
        return u == kaisa or u == chenji or u == bajue or u == Heiyan or u == xinglong
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function IsAgiHero takes unit u returns boolean
        return u == taiya or u == xiaoyue or u == mengji or u == moqi or u == hanshang or u == cangling or u == seyu or u == yanmie or u == sichen or u == xiaoting
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function IsIntHero takes unit u returns boolean
        return u == lingxue or u == xuanxue or u == sheyan or u == Huanyi or u == lichi
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function IsMo takes unit u returns boolean
        return u == lichi
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function IsXianSpell takes integer spell returns boolean
        return ( spell == 'Acht' ) or ( spell == 'A03A' ) or ( spell == 'A0BM' ) or ( spell == 'A07Z' ) or ( spell == 'A07T' ) or ( spell == 'A05Z' ) or ( spell == 'ACro' ) or ( spell == 'Acht' ) or ( spell == 'A07X' ) or ( spell == 'A05Y' ) or ( spell == 'AChv' ) or ( spell == 'A07V' ) or ( spell == 'Awrg' ) or ( spell == 'A05X' ) or ( spell == 'A07C' ) or ( spell == 'A07D' ) or ( spell == 'Awrh' ) or ( spell == 'A075' ) or ( spell == 'A06W' ) or ( spell == 'A06Y' ) or ( spell == 'A06Q' ) or ( spell == 'A07R' ) or ( spell == 'ACcl' ) or ( spell == 'AOhw' ) or ( spell == 'AIin' ) or ( spell == 'AIil' ) or ( spell == 'A07S' ) or ( spell == 'AChx' )
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function IsYuansu takes unit u returns boolean
        return GetUnitTypeId(u) == 'nlv3' or GetUnitTypeId(u) == 'hwat' or GetUnitTypeId(u) == 'nbal' or GetUnitTypeId(u) == 'nvde' or GetUnitTypeId(u) == 'ehpr' or GetUnitTypeId(u) == 'nsll' or GetUnitTypeId(u) == 'nadr' or GetUnitTypeId(u) == 'nitp' or GetUnitTypeId(u) == 'nsgg' or GetUnitTypeId(u) == 'nehy' or GetUnitTypeId(u) == 'nbzd'
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function IsCanCopy takes item i returns boolean
        return ( ( GetItemTypeId(i) != 'mgtk' ) and ( GetItemTypeId(i) != 'k3m1' ) and ( GetItemTypeId(i) != 'pomn' ) and ( GetItemTypeId(i) != 'wild' ) and ( GetItemTypeId(i) != 'hlst' ) and ( GetItemTypeId(i) != 'totw' ) and ( GetItemTypeId(i) != 'sror' ) and ( GetItemTypeId(i) != 'fgrg' ) and ( GetItemTypeId(i) != 'wshs' ) and ( GetItemTypeId(i) != 'IXU1' ) and ( GetItemTypeId(i) != 'I049' ) and ( GetItemTypeId(i) != 'I04A' ) and ( GetItemTypeId(i) != 'I000' ) and ( GetItemTypeId(i) != 'I001' ) and ( GetItemTypeId(i) != 'I002' ) and ( GetItemTypeId(i) != 'I01D' ) and ( GetItemTypeId(i) != 'I02W' ) and ( GetItemTypeId(i) != 'sres' ) and ( GetItemTypeId(i) != 'I06A' ) and ( GetItemTypeId(i) != 'I06B' ) and ( GetItemTypeId(i) != 'I06C' ) and ( GetItemTypeId(i) != 'I06J' ) and ( GetItemTypeId(i) != 'I062' ) and ( GetItemTypeId(i) != 'ICS1' ) and ( GetItemTypeId(i) != 'I04W' ) and ( GetItemTypeId(i) != 'I04Y' ) and ( GetItemTypeId(i) != 'I05T' ) and ( GetItemTypeId(i) != 'I05W' ) and ( GetItemTypeId(i) != 'I05V' ) and ( GetItemTypeId(i) != 'ICY1' ) and ( GetItemTypeId(i) != 'I05X' ) and ( GetItemTypeId(i) != 'IB0A' ) and ( GetItemTypeId(i) != 'I04X' ) and ( GetItemTypeId(i) != 'ICX1' ) and ( GetItemTypeId(i) != 'I05Y' ) and ( GetItemTypeId(i) != 'I05Z' ) and ( GetItemTypeId(i) != 'I060' ) and ( GetItemTypeId(i) != 'I06N' ) and ( GetItemTypeId(i) != 'I07D' ) and ( GetItemTypeId(i) != 'I07T' ) and ( GetItemTypeId(i) != 'I07E' ) and ( GetItemTypeId(i) != 'I07F' ) and ( GetItemTypeId(i) != 'I07G' ) and ( GetItemTypeId(i) != 'I07H' ) and ( GetItemTypeId(i) != 'I07I' ) and ( GetItemTypeId(i) != 'I07J' ) and ( GetItemTypeId(i) != 'I07K' ) and ( GetItemTypeId(i) != 'I07O' ) and ( GetItemTypeId(i) != 'I07N' ) and ( GetItemTypeId(i) != 'I07P' ) and ( GetItemTypeId(i) != 'I07Q' ) and ( GetItemTypeId(i) != 'I07M' ) and ( GetItemTypeId(i) != 'I07L' ) and ( GetItemTypeId(i) != 'I05U' ) and ( GetItemTypeId(i) != 'I07R' ) and ( GetItemTypeId(i) != 'I02U' ) and ( GetItemTypeId(i) != 'I02V' ) and ( GetItemTypeId(i) != 'I02X' ) and ( GetItemTypeId(i) != 'I031' ) )
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function IsDiamond takes item i returns boolean
        return GetItemTypeId(i) == 'I02N' or GetItemTypeId(i) == 'I04S' or GetItemTypeId(i) == 'azhr' or GetItemTypeId(i) == 'gmfr' or GetItemTypeId(i) == 'jpnt' or GetItemTypeId(i) == 'glsk' or GetItemTypeId(i) == 'kygh' or GetItemTypeId(i) == 'sehr' or GetItemTypeId(i) == 'bzbf' or GetItemTypeId(i) == 'phlt' or GetItemTypeId(i) == 'dkfw' or GetItemTypeId(i) == 'thle'
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Is20Unit takes unit u returns boolean
        return ( ( ( GetUnitTypeId(u) == 'nanw' ) or ( GetUnitTypeId(u) == 'nbld' ) or ( GetUnitTypeId(u) == 'nbdo' ) or ( GetUnitTypeId(u) == 'ncnk' ) or ( GetUnitTypeId(u) == 'nenc' ) or ( GetUnitTypeId(u) == 'ngnw' ) ) )
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Is10Unit takes unit u returns boolean
        return ( ( ( GetUnitTypeId(u) == 'nano' ) or ( GetUnitTypeId(u) == 'nenf' ) or ( GetUnitTypeId(u) == 'nbda' ) or ( GetUnitTypeId(u) == 'ncim' ) or ( GetUnitTypeId(u) == 'ngns' ) or ( GetUnitTypeId(u) == 'nhfp' ) ) )
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function GetKillCount takes unit u returns integer
        if ( Is10Unit(u) ) then
            return 10 * CModeH(1 , 2)
        elseif ( Is20Unit(u) ) then
            return 20 * CModeH(1 , 2)
        else
            return 1 * CModeH(1 , 2)
        endif
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function IsWudi takes unit u returns boolean
        return GetUnitAbilityLevel(u, 'Avul') > 0
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function GetBasicRing takes unit u returns item
        if ( YDWEUnitHasItemOfTypeBJNull(u , 'rat9') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(u , 'rat9')
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'rlif') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(u , 'rlif')
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'lgdh') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(u , 'lgdh')
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'clfm') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(u , 'clfm')
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'bgst') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(u , 'bgst')
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'belv') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(u , 'belv')
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'hcun') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(u , 'hcun')
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'rag1') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(u , 'rag1')
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'penr') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(u , 'penr')
        endif
        return null
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function GetMaxRing takes unit u returns item
        if ( YDWEUnitHasItemOfTypeBJNull(u , 'brac') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(u , 'brac')
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'lhst') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(u , 'lhst')
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'I05W') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(u , 'I05W')
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'I05V') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(u , 'I05V')
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'I07M') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(u , 'I07M')
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'I07L') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(u , 'I07L')
        endif
        return null
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function IsMaxRing takes item i returns boolean
        return GetItemTypeId(i) == 'brac' or GetItemTypeId(i) == 'lhst' or GetItemTypeId(i) == 'I05W' or GetItemTypeId(i) == 'I05V' or GetItemTypeId(i) == 'I07M' or GetItemTypeId(i) == 'I07L'
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function GetRing takes unit u returns item
        if ( YDWEUnitHasItemOfTypeBJNull(u , 'rat9') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(u , 'rat9')
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'rlif') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(u , 'rlif')
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'lgdh') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(u , 'lgdh')
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'clfm') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(u , 'clfm')
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'bgst') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(u , 'bgst')
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'belv') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(u , 'belv')
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'hcun') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(u , 'hcun')
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'rag1') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(u , 'rag1')
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'penr') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(u , 'penr')
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'brac') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(u , 'brac')
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'lhst') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(u , 'lhst')
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'I05W') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(u , 'I05W')
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'I05V') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(u , 'I05V')
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'I07M') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(u , 'I07M')
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'I07L') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(u , 'I07L')
        endif
        return null
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function GetDeng takes unit u returns integer
        if ( YDWEUnitHasItemOfTypeBJNull(u , 'ILI1') ) then
            return 1
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'ILI2') ) then
            return 2
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'ILI3') ) then
            return 3
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'ILI4') ) then
            return 4
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'ILI5') ) then
            return 5
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'ILI6') ) then
            return 6
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'ILI7') ) then
            return 7
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'ILI8') ) then
            return 8
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'ILI9') ) then
            return 9
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'ILIA') ) then
            return 10
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'ILIB') ) then
            return 11
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'ILIC') ) then
            return 12
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'ILID') ) then
            return 13
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'ILIE') ) then
            return 14
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'ILIF') ) then
            return 15
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'ILIG') ) then
            return 16
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'ILIH') ) then
            return 17
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'ILII') ) then
            return 18
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'ILIJ') ) then
            return 19
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'ILIK') ) then
            return 20
        elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'I07D') ) then
            return 21
        endif
        return 0
    endfunction
//---------------------------------------------------------------------------------------------------
    
    //判断超
    function IsZhanfaChao takes item i returns boolean
        local integer id= GetItemTypeId(i)
        return id == 'rst1' or id == 'I05U' or id == 'ICX1'
    endfunction
    function IsZhan0 takes item i returns boolean
        local integer id= GetItemTypeId(i)
        return IsZhanfaChao(i) or id == 'rde2' or id == 'vamp' or id == 'skul' or id == 'tsct' or id == 'tcas' or id == 'plcl' or id == 'tgrh' or id == 'I01E'
    endfunction
    function IsFa0 takes item i returns boolean
        local integer id= GetItemTypeId(i)
        return IsZhanfaChao(i) or id == 'rnec' or id == 'shas' or id == 'spro' or id == 'phea' or id == 'rin1' or id == 'ward' or id == 'rde1'
    endfunction
    function IsZhanfa3 takes item i returns boolean
        local integer id= GetItemTypeId(i)
        return IsZhanfaChao(i) or id == 'spro' or id == 'tcas' or id == 'shas' or id == 'plcl' or id == 'rnec' or id == 'tgrh' or id == 'phea' or id == 'tsct'
    endfunction
    function IsZhanfahun takes item i returns boolean
        local integer id= GetItemTypeId(i)
        return IsFa0(i) or IsZhan0(i)
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function GetYeai takes nothing returns item
        if ( YDWEUnitHasItemOfTypeBJNull(chenji , 'stel') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(chenji , 'stel')
        elseif ( YDWEUnitHasItemOfTypeBJNull(chenji , 'I04M') ) then
            return YDWEGetItemOfTypeFromUnitBJNull(chenji , 'I04M')
        endif
        return null
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function IsMinganItem takes item i returns boolean
        return i == GetYeai() or GetItemTypeId(i) == 'I079'
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function IsDeng takes item i returns boolean
        local integer t= GetItemTypeId(i)
        return ( t == 'ILI1' ) or ( t == 'ILI2' ) or ( t == 'ILI3' ) or ( t == 'ILI4' ) or ( t == 'ILI5' ) or ( t == 'ILI6' ) or ( t == 'ILI7' ) or ( t == 'ILI8' ) or ( t == 'ILI9' ) or ( t == 'ILIA' ) or ( t == 'ILIB' ) or ( t == 'ILIC' ) or ( t == 'ILID' ) or ( t == 'ILIE' ) or ( t == 'ILIF' ) or ( t == 'ILIG' ) or ( t == 'ILIH' ) or ( t == 'ILII' ) or ( t == 'ILIJ' ) or ( t == 'ILIK' ) or ( t == 'I07D' )
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function IsEnemyMP takes unit u,player p returns boolean
        return IsUnitType(u, UNIT_TYPE_SLEEPING) == false and GetUnitState(u, UNIT_STATE_LIFE) > 0.405 and IsUnitType(u, UNIT_TYPE_STRUCTURE) == false and IsUnitAliveBJ(u) == true and IsUnitHidden(u) == false and IsUnitEnemy(u, p) and IsUnitVisible(u, p) and GetUnitAbilityLevel(u, 'Avul') < 1 and GetUnitPointValue(u) != 123 and GetUnitPointValue(u) != 0
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function IsEnemyM takes unit u,unit caster returns boolean
        return IsEnemyMP(u , GetOwningPlayer(caster))
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function IsSolider takes unit u returns boolean
        return ( GetUnitTypeId(u) == 'uG01' ) or ( GetUnitTypeId(u) == 'uG02' ) or ( GetUnitTypeId(u) == 'uG03' ) or ( GetUnitTypeId(u) == 'uG04' ) or ( GetUnitTypeId(u) == 'uG05' ) or ( GetUnitTypeId(u) == 'uG06' )
    endfunction
//---------------------------------------------------------------------------------------------------
    
   function IsEnemyP takes unit u,player p returns boolean
        return IsUnitType(u, UNIT_TYPE_MAGIC_IMMUNE) == false and IsEnemyMP(u , p) and IsUnitType(u, UNIT_TYPE_RESISTANT) == false
    endfunction
//---------------------------------------------------------------------------------------------------
    
   function IsEnemy2 takes unit u,unit caster returns boolean
        return GetUnitState(u, UNIT_STATE_LIFE) > 0.405 and IsUnitAliveBJ(u) == true and IsUnitEnemy(u, GetOwningPlayer(caster)) and GetUnitPointValue(u) != 123 and GetUnitPointValue(u) != 0
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function KillAreaPlayerEnemy takes unit attacker,real x,real y,real radius,player p returns nothing
        local group l_group= CreateGroup()
        local unit l_unit
        call GroupEnumUnitsInRange(l_group, x, y, radius, null)
        loop
            set l_unit=FirstOfGroup(l_group)
            exitwhen l_unit == null
            call GroupRemoveUnit(l_group, l_unit)
            if ( IsEnemyMP(l_unit , p) ) then
                call UnitDamageTarget(attacker, l_unit, GetUnitState(l_unit, UNIT_STATE_MAX_LIFE) * 2, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_SLOW_POISON, WEAPON_TYPE_WHOKNOWS)
            endif
        endloop
        call DestroyGroup(l_group)
        set l_group=null
        set l_unit=null
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function IsLoyalUnit takes unit u returns boolean
        return ( ( GetUnitTypeId(u) == 'owyv' ) or ( GetUnitTypeId(u) == 'nzom' ) or ( GetUnitTypeId(u) == 'nsog' ) or ( GetUnitTypeId(u) == 'nsoc' ) or ( GetUnitTypeId(u) == 'ninc' ) or ( GetUnitTypeId(u) == 'ninm' ) or ( GetUnitTypeId(u) == 'nsrn' ) or ( GetUnitTypeId(u) == 'nsrh' ) or ( GetUnitTypeId(u) == 'nmit' ) )
    endfunction
//---------------------------------------------------------------------------------------------------
    
   function IsEnemy3 takes unit u,player p returns boolean
        return GetUnitState(u, UNIT_STATE_LIFE) > 0.405 and IsUnitAliveBJ(u) == true and IsUnitEnemy(u, p) and GetUnitPointValue(u) != 123 and GetUnitPointValue(u) != 0
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function DeleteGroup takes group g returns nothing
        local unit l_unit
        loop
            set l_unit=FirstOfGroup(g)
            exitwhen l_unit == null
            call GroupRemoveUnit(g, l_unit)
            call FlushChildHashtable(YDHT, GetHandleId(l_unit))
            call RemoveUnit(l_unit)
        endloop
        set l_unit=null
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function HG takes unit u returns nothing
        call SetUnitPositionLoc(u, udg_Point_Fuhuo)
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function ShengliAll takes nothing returns nothing
        call CustomVictoryBJ(GetEnumPlayer(), true, true)
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function GetFacingBetweenXY takes real x1,real y1,real x2,real y2 returns real
        return Atan2BJ(y2 - y1, x2 - x1)
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function GetUnitDistance takes unit u1,unit u2 returns real
        return GetDistance(GetUnitX(u1) , GetUnitY(u1) , GetUnitX(u2) , GetUnitY(u2))
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function IsUnitInUnitBack takes unit u1,unit u2,real angle returns boolean
        return CosBJ(GetUnitFacing(u1) - YDWEAngleBetweenUnits(u2 , u1)) >= CosBJ(angle)
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function CreateTextTagA takes string name,unit u,real red,real green,real blue,real time,real size returns nothing
        local texttag t= CreateTextTagUnitBJ(name, u, 0, size, red, green, blue, 0)
        call SetTextTagVelocityBJ(t, 64, 90.00)
        if time <= 0 then
            set time=0.01
        endif
        call SetTextTagPermanent(t, false)
        call SetTextTagLifespan(t, time)
        call SetTextTagFadepoint(t, time)
    endfunction
    
    function CreateSpellTextTag takes string name,unit u,real red,real green,real blue,real time returns nothing
        call CreateTextTagA(name , u , red , green , blue , time , 16)
    endfunction
    
    function SimulateSpell takes unit caster,unit target,integer spellId,integer spellLevel,real lifeTime,string orderId,boolean isPoint,boolean isImmediate,boolean isTarget returns nothing
        local unit u= CreateUnit(GetOwningPlayer(caster), 'h000', GetUnitX(target), GetUnitY(target), 0)
        call UnitApplyTimedLifeBJ(5.00, 'BHwe', u)
        call UnitAddAbilityBJ(spellId, u)
        call SetUnitAbilityLevel(u, spellId, spellLevel)
        if ( isPoint ) then
            call IssuePointOrder(u, orderId, GetUnitX(target), GetUnitY(target))
        elseif ( isImmediate ) then
            call IssueImmediateOrder(u, orderId)
        elseif ( isTarget ) then
            call IssueTargetOrder(u, orderId, target)
        endif
        set u=null
    endfunction
    
    function SimulateSpell4 takes unit caster,real x,real y,integer spellId,integer spellLevel,real lifeTime,string orderId returns nothing
        local unit u= CreateUnit(GetOwningPlayer(caster), 'h01B', x, y, 0)
        call UnitApplyTimedLifeBJ(5.00, 'BHwe', u)
        call UnitAddAbilityBJ(spellId, u)
        call SetUnitAbilityLevel(u, spellId, spellLevel)
        call IssuePointOrder(u, orderId, x, y)
        set u=null
    endfunction
    
    function CreateUnitEffectSpecifyTime takes player whichPlayer,integer unitType,real x,real y,real facing,real time returns nothing
        call UnitApplyTimedLifeBJ(time, 'BHwe', CreateUnit(whichPlayer, unitType, x, y, facing))
    endfunction
    function CreateUnitEffect takes player whichPlayer,integer unitType,real x,real y,real facing returns nothing
        call CreateUnitEffectSpecifyTime(whichPlayer , unitType , x , y , facing , 5)
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function DamageAreaMirror takes unit attacker,real x,real y,real radius,real damage returns nothing
        local group l_group= CreateGroup()
        local unit l_unit
        call GroupEnumUnitsInRange(l_group, x, y, radius, null)
        loop
            set l_unit=FirstOfGroup(l_group)
            exitwhen l_unit == null
            call GroupRemoveUnit(l_group, l_unit)
            if ( IsEnemy(l_unit , attacker) and ( udg_U_Zhuansheng_Dantiao[2] != l_unit or udg_U_Zhuansheng_Dantiao[1] == attacker ) ) then
                call UnitDamageTarget(attacker, l_unit, damage, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
            endif
        endloop
        call DestroyGroup(l_group)
        set l_group=null
        set l_unit=null
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function DamageAreaEffMirror takes unit attacker,real x,real y,real radius,real damage,string eff returns nothing
        local group l_group= CreateGroup()
        local unit l_unit
        call GroupEnumUnitsInRange(l_group, x, y, radius, null)
        loop
            set l_unit=FirstOfGroup(l_group)
            exitwhen l_unit == null
            call GroupRemoveUnit(l_group, l_unit)
            if ( IsEnemy(l_unit , attacker) and ( udg_U_Zhuansheng_Dantiao[2] != l_unit or udg_U_Zhuansheng_Dantiao[1] == attacker ) ) then
                call UnitDamageTarget(attacker, l_unit, damage, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
                call DestroyEffect(AddSpecialEffect(eff, GetUnitX(l_unit), GetUnitY(l_unit)))
            endif
        endloop
        call DestroyGroup(l_group)
        set l_group=null
        set l_unit=null
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function DamageAreaEff takes unit attacker,real x,real y,real radius,real damage,string eff returns nothing
        local group l_group= CreateGroup()
        local unit l_unit
        call GroupEnumUnitsInRange(l_group, x, y, radius, null)
        loop
            set l_unit=FirstOfGroup(l_group)
            exitwhen l_unit == null
            call GroupRemoveUnit(l_group, l_unit)
            if ( IsEnemy(l_unit , attacker) ) then
                call UnitDamageTarget(attacker, l_unit, damage, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
                call DestroyEffect(AddSpecialEffect(eff, GetUnitX(l_unit), GetUnitY(l_unit)))
            endif
        endloop
        call DestroyGroup(l_group)
        set l_group=null
        set l_unit=null
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function AddHero3W takes unit u,integer value returns nothing
        local unit hero= udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
        if ( hero == chenji ) then
            call SetHeroStr(hero, GetHeroStr(hero, true) + value * 3, true)
        else
            call SetHeroInt(hero, GetHeroInt(hero, true) + value, true)
            call SetHeroAgi(hero, GetHeroAgi(hero, true) + value, true)
            call SetHeroStr(hero, GetHeroStr(hero, true) + value, true)
        endif
        set hero=null
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function GetLimit takes integer i returns integer
        if ( i < 0 or i > 2100000000 ) then
            return 2100000000
        else
            return i
        endif
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function ShowGameHint takes player p,string content returns nothing
        local dialog d= DialogCreate()
        local string s= "\n            " + content
        call DialogSetMessage(d, s)
        call DialogAddButton(d, "我知道了|cffff6800(Esc)|r", 512)
        call DialogDisplay(p, d, true)
        set d=null
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function ChooseSpinHero takes player p,unit u returns nothing
        call ShowGameHint(p , "\n        这是英雄" + GetUnitName(u) + "的皮肤。" + S3(true , "\n        双击中间的旗子查看挑战内容,\n        完成对应挑战即可永久解锁该皮肤。" , "\n        使用魔兽争霸官方对战平台(dz .163.com)进行游戏\n        完成挑战即可获取该皮肤。"))
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function ShowGameHintAll takes string content returns nothing
        local integer i= 1
        local dialog d= DialogCreate()
        local string s= "\n            " + content
        call DialogSetMessage(d, s)
        call DialogAddButton(d, "我知道了|cffff6800(Esc)|r", 512)
        loop
            exitwhen i > 6
            call DialogDisplay(ConvertedPlayer(i), d, true)
            set i=i + 1
        endloop
        set d=null
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function GetNextPlayerID takes nothing returns integer
        local integer i= 1
        loop
            exitwhen i > 6
            set INextPlayerID=I3(INextPlayerID >= 6 , 1 , INextPlayerID + 1)
            if ( ( GetPlayerSlotState(ConvertedPlayer(INextPlayerID)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(INextPlayerID)) == MAP_CONTROL_USER ) and udg_H[INextPlayerID] != null ) then
                exitwhen true
            endif
            set i=i + 1
        endloop
        return INextPlayerID
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function BuyerFilter takes unit buyer returns boolean
        return ( GetUnitTypeId(buyer) != 'N018' ) and ( GetUnitTypeId(buyer) != 'N01X' ) and ( GetUnitTypeId(buyer) != 'N01Y' )
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function HasLiuli takes unit u returns boolean
        return ( GetItemTypeId(YDWEGetItemOfTypeFromUnitBJNull(u , 'IXU1')) == 'IXU1' )
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function RecoverUnitHP takes unit u,real volume returns nothing
        call SetUnitLifeBJ(u, GetUnitState(u, UNIT_STATE_LIFE) + GetUnitState(u, UNIT_STATE_MAX_LIFE) * volume)
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function RecoverUnitMP takes unit u,real volume returns nothing
        call SetUnitManaBJ(u, GetUnitState(u, UNIT_STATE_MANA) + volume)
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function KillSelf takes unit u returns nothing
        call UnitDamageTarget(u, u, GetUnitState(u, UNIT_STATE_MAX_LIFE) * 2, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_POISON, WEAPON_TYPE_WHOKNOWS)
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function UnitAddAbilityP takes unit u,integer i returns nothing
            call UnitAddAbility(u, i)
            if ( u == xinglong ) then
                call UnitMakeAbilityPermanent(u, true, i)
            endif
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function IsUnitHasSlot takes unit u returns boolean
        local integer i= 1
        loop
            exitwhen i > 6
            if ( UnitItemInSlotBJ(u, i) == null ) then
                return true
            endif
            set i=i + 1
        endloop
        return false
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function IsInRect takes real x,real y,rect reg returns boolean
        return ( GetRectMaxX(reg) >= x and GetRectMinX(reg) <= x and GetRectMaxY(reg) >= y and GetRectMinY(reg) <= y )
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function IsInForbitRegion takes real x,real y,unit u returns boolean
        return ( IsInRect(x , y , gg_rct_______a3) and ( not ( RectContainsUnit(gg_rct_______a3, u) ) ) ) or ( IsInRect(x , y , gg_rct_Arena_forbit) and ( not ( RectContainsUnit(gg_rct_Arena_forbit, u) ) ) )
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function GetFirstPlayer takes nothing returns player
        local integer i= 1
        loop
            exitwhen i > 6
            if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) ) then
                return ConvertedPlayer(i)
            endif
            set i=i + 1
        endloop
        return ConvertedPlayer(1)
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Jidibaozha takes string s returns nothing
        local integer i= 1
        loop
            exitwhen i > 6
            call CustomDefeatBJ(ConvertedPlayer(i), s)
            set i=i + 1
        endloop
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function LHBase___StartWanjieTimer takes nothing returns nothing
        local timer t= GetExpiredTimer()
        local integer id= GetHandleId(t)
        local integer value= LoadInteger(LHTable, id, 1)
        local texttag tt= null
        local location point= null
        if ( value <= 200 ) then
            call SaveInteger(LHTable, GetHandleId(t), 1, value + 1)
            set point=Location(GetUnitX(Uwanjie) - 100, GetUnitY(Uwanjie))
            set tt=CreateTextTagLocBJ("|cffFFD700【万劫录】" + GetWanjieluName(), point, 50.00, 12, 100, 100, 100, 0)
            call SetTextTagVelocityBJ(tt, 64, 90.00)
            call SetTextTagPermanent(tt, false)
            call SetTextTagLifespan(tt, 5)
            call SetTextTagFadepoint(tt, 5)
            call RemoveLocation(point)
            set point=null
            set tt=null
        else
            call PauseTimer(t)
            call FlushChildHashtable(LHTable, id)
            call DestroyTimer(t)
        endif
        set t=null
    endfunction
//---------------------------------------------------------------------------------------------------
    function LHBase___InitLHBase takes nothing returns nothing
        local timer t= CreateTimer()
        local integer i= 1
        loop
            exitwhen i > 6
            if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) ) then
                set BMoshou[i]=false
            endif
            set i=i + 1
        endloop
        
        set UDepot[1]=CreateUnit(Player(0), 'nmgv', 10175.0, - 691.0, 270.000)
        set UDepot[2]=CreateUnit(Player(1), 'nmgv', 10307.0, - 691.0, 270.000)
        set UDepot[3]=CreateUnit(Player(2), 'nmgv', 10431.0, - 691.0, 270.000)
        set UDepot[4]=CreateUnit(Player(3), 'nmgv', 10175.0, - 60.6, 270.000)
        set UDepot[5]=CreateUnit(Player(4), 'nmgv', 10307.0, - 60.6, 270.000)
        set UDepot[6]=CreateUnit(Player(5), 'nmgv', 10431.0, - 60.6, 270.000)
        set Uwanjie=CreateUnit(Player(PLAYER_NEUTRAL_PASSIVE), 'n01F', - 14394.0, - 15446.0, 270.000)
        call SaveInteger(LHTable, GetHandleId(t), 1, 0)
        call TimerStart(t, 2, true, function LHBase___StartWanjieTimer)
        set t=null
    endfunction

//library LHBase ends
//library Attr:
//---------------------------------------------------------------------------------------------------
	
 function GetAgiPercent takes integer playerID returns real
		return udg_I_Xianglian[( playerID + 6 )]
	endfunction
	
 function GetStrPercent takes integer playerID returns real
		return udg_I_Xianglian[( playerID )]
	endfunction
	
 function GetIntPercent takes integer playerID returns real
		return udg_I_Xianglian[( playerID + 12 )]
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function FlashHeroStr takes player p returns nothing
  local integer index= GetConvertedPlayerId(p)
  local integer temp= 0
		if ( ( GetPlayerSlotState(p) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(p) == MAP_CONTROL_USER ) and ( GetStrPercent(index) != 0 or IStr[index] != 0 ) ) then
			set temp=R2I(I2R(GetHeroStr(udg_H[index], true) - IStr[index]) * GetStrPercent(index))
			if ( temp != IStr[index] ) then
				call SetHeroStr(udg_H[index], GetHeroStr(udg_H[index], true) - IStr[index] + temp, true)
				set IStr[index]=temp
			endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function FlashAllHeroStr takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > 6
			call FlashHeroStr(ConvertedPlayer(i))
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function FlashHeroAgi takes player p returns nothing
  local integer index= GetConvertedPlayerId(p)
  local integer temp= 0
		if ( ( GetPlayerSlotState(p) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(p) == MAP_CONTROL_USER ) and ( GetAgiPercent(index) != 0 or IAgi[index] != 0 ) ) then
			set temp=R2I(I2R(GetHeroAgi(udg_H[index], true) - IAgi[index]) * GetAgiPercent(index))
			if ( temp != IAgi[index] ) then
				call SetHeroAgi(udg_H[index], GetHeroAgi(udg_H[index], true) - IAgi[index] + temp, true)
				set IAgi[index]=temp
			endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function FlashAllHeroAgi takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > 6
			call FlashHeroAgi(ConvertedPlayer(i))
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function FlashHeroInt takes player p returns nothing
  local integer index= GetConvertedPlayerId(p)
  local integer temp= 0
		if ( ( GetPlayerSlotState(p) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(p) == MAP_CONTROL_USER ) and ( GetIntPercent(index) != 0 or IInt[index] != 0 ) ) then
			set temp=R2I(I2R(GetHeroInt(udg_H[index], true) - IInt[index]) * GetIntPercent(index))
			if ( temp != IInt[index] ) then
				call SetHeroInt(udg_H[index], GetHeroInt(udg_H[index], true) - IInt[index] + temp, true)
				set IInt[index]=temp
			endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function FlashAllHeroInt takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > 6
			call FlashHeroInt(ConvertedPlayer(i))
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ReduceHeroStrF takes unit hero,integer i returns nothing
  local integer delta
  local integer index
		if ( GetHeroStr(hero, true) - i >= 0 ) then
			call SetHeroStr(hero, GetHeroStr(hero, true) - i, true)
			call FlashHeroStr(GetOwningPlayer(hero))
		else
			set index=GetConvertedPlayerId(GetOwningPlayer(hero))
			set delta=R2I(I2R(i) * GetStrPercent(index))
			set IStr[index]=IStr[index] - delta
			call SetHeroStr(hero, GetHeroStr(hero, true) - i - delta, true)
			call FlashHeroStr(GetOwningPlayer(hero))
		endif
	endfunction
 function ReduceHeroAgiF takes unit hero,integer i returns nothing
  local integer delta
  local integer index
		if ( GetHeroAgi(hero, true) - i >= 0 ) then
			call SetHeroAgi(hero, GetHeroAgi(hero, true) - i, true)
			call FlashHeroAgi(GetOwningPlayer(hero))
		else
			set index=GetConvertedPlayerId(GetOwningPlayer(hero))
			set delta=R2I(I2R(i) * GetAgiPercent(index))
			set IAgi[index]=IAgi[index] - delta
			call SetHeroAgi(hero, GetHeroAgi(hero, true) - i - delta, true)
			call FlashHeroAgi(GetOwningPlayer(hero))
		endif
	endfunction
 function ReduceHeroIntF takes unit hero,integer i returns nothing
  local integer delta
  local integer index
		if ( GetHeroInt(hero, true) - i >= 0 ) then
			call SetHeroInt(hero, GetHeroInt(hero, true) - i, true)
			call FlashHeroInt(GetOwningPlayer(hero))
		else
			set index=GetConvertedPlayerId(GetOwningPlayer(hero))
			set delta=R2I(I2R(i) * GetIntPercent(index))
			set IInt[index]=IInt[index] - delta
			call SetHeroInt(hero, GetHeroInt(hero, true) - i - delta, true)
			call FlashHeroInt(GetOwningPlayer(hero))
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function AddHPPercent takes integer playerID,real value returns nothing
		set udg_I_Xianglian[( playerID + 18 )]=udg_I_Xianglian[( playerID + 18 )] + value
		call TriggerExecute(gg_trg_D7)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function AddAgiPercent takes integer playerID,real value returns nothing
		set udg_I_Xianglian[( playerID + 6 )]=udg_I_Xianglian[( playerID + 6 )] + value
		call TriggerExecute(gg_trg_D7)
	endfunction
	
 function AddAgiPercentImme takes integer playerID,real value returns nothing
		call AddAgiPercent(playerID , value)
    	call FlashHeroAgi(ConvertedPlayer(playerID))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function AddStrPercent takes integer playerID,real value returns nothing
		set udg_I_Xianglian[( playerID )]=udg_I_Xianglian[( playerID )] + value
		call TriggerExecute(gg_trg_D7)
	endfunction
	
 function AddStrPercentImme takes integer playerID,real value returns nothing
		call AddStrPercent(playerID , value)
    	call FlashHeroStr(ConvertedPlayer(playerID))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function AddIntPercent takes integer playerID,real value returns nothing
		set udg_I_Xianglian[( playerID + 12 )]=udg_I_Xianglian[( playerID + 12 )] + value
		call TriggerExecute(gg_trg_D7)
	endfunction
	
 function AddIntPercentImme takes integer playerID,real value returns nothing
		call AddIntPercent(playerID , value)
    	call FlashHeroInt(ConvertedPlayer(playerID))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function AddMoneyPercent takes integer playerID,real value returns nothing
		set udg_I_Jinqianhuodelv[playerID]=udg_I_Jinqianhuodelv[playerID] + value
		call TriggerExecute(gg_trg_D7)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function AddAttackPercent takes integer playerID,real value returns nothing
		set udg_I_Xianglian[playerID + 24]=udg_I_Xianglian[playerID + 24] + value
		call TriggerExecute(gg_trg_D7)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function AddDefensePercent takes integer playerID,real value returns nothing
		set udg_I_Xianglian[playerID + 30]=udg_I_Xianglian[playerID + 30] + value
		call TriggerExecute(gg_trg_D7)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function AddSpellPercent takes integer playerID,real value returns nothing
		set udg_I_Jinengjiacheng[playerID]=udg_I_Jinengjiacheng[playerID] + value
		call TriggerExecute(gg_trg_D7)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function AddDamagePercent takes integer playerID,real value returns nothing
		set udg_I_Shanghai[playerID]=udg_I_Shanghai[playerID] + value
		call TriggerExecute(gg_trg_D7)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetAttack takes unit u,integer attack returns nothing
	    set udg_Unit=u
	    call SaveInteger(YDHT, GetHandleId(u), 0x5039AFFB, attack)
	    call TriggerExecute(gg_trg_____________800W)
	endfunction
 function GetAttack takes unit u returns integer
		return LoadInteger(YDHT, GetHandleId(u), 0x5039AFFB)
	endfunction
 function AddAttack takes unit u,integer attack returns nothing
		call SetAttack(u , GetAttack(u) + attack)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetDefense takes unit u,integer defense returns nothing
	    set udg_Unit=u
	    call SaveInteger(YDHT, GetHandleId(u), 0x81FD3994, defense)
	    call TriggerExecute(gg_trg___________________4000______u)
	endfunction
 function GetDefense takes unit u returns integer
		return LoadInteger(YDHT, GetHandleId(u), 0x81FD3994)
	endfunction
 function AddDefense takes unit u,integer defense returns nothing
		call SetDefense(u , GetDefense(u) + defense)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetHP takes unit u,integer hp returns nothing
	    set udg_Unit=u
	    call SaveInteger(YDHT, GetHandleId(u), 0xFCD961C9, hp)
    	call TriggerExecute(gg_trg_HP_____________________u)
	endfunction
 function GetHP takes unit u returns integer
		return LoadInteger(YDHT, GetHandleId(u), 0xFCD961C9)
	endfunction
 function AddHP takes unit u,integer hp returns nothing
		call SetHP(u , GetHP(u) + hp)
	endfunction
//---------------------------------------------------------------------------------------------------
 function Attr___InitAttr takes nothing returns nothing
	endfunction

//library Attr ends
//library ChallangerDZ:
//---------------------------------------------------------------------------------------------------
	
 function GetAndSaveCangku takes player p,integer i returns nothing
  local integer index= GetConvertedPlayerId(p)
  local string temp= null
		//if (GetBit(Greward[index],i) < 1 and i < 9) then
		//	set Greward[index] = Greward[index] + R2I(Pow(10,i-1))
		//	call DisplayTextToPlayer(p, 0., 0., "//|cff3366ff【消息】恭喜你成功新的仓库模型！|r")
		//	call DisplayTextToPlayer(p, 0., 0., "//|cff3366ff【消息】恭喜你成功新的仓库模型！|r")
		//	call DisplayTextToPlayer(p, 0., 0., "//|cff3366ff【消息】恭喜你成功新的仓库模型！|r")
		//	call DzAPI_Map_StoreInteger( p,  "Greward", Greward[index] )
		//endif
		if ( StringLength(Greward2[index]) < 62 ) then
			set Greward2[index]="00000000000000000000000000000000000000000000000000000000000000"
		endif
		if ( S2I(SubStringBJ(Greward2[index], i, i)) != 1 ) then
			set temp=Greward2[index]
			set Greward2[index]=SubStringBJ(temp, 1, i - 1)
			set Greward2[index]=Greward2[index] + "1"
			set Greward2[index]=Greward2[index] + SubStringBJ(temp, i + 1, StringLength(temp))
			set temp=null
			call DisplayTextToPlayer(p, 0., 0., "|cff3366ff【消息】恭喜你成功新的仓库模型！|r")
			call DisplayTextToPlayer(p, 0., 0., "|cff3366ff【消息】恭喜你成功新的仓库模型！|r")
			call DisplayTextToPlayer(p, 0., 0., "|cff3366ff【消息】恭喜你成功新的仓库模型！|r")
    call DzAPI_Map_StoreString(p , "Greward2" , Greward2[index])
		endif
	endfunction
 function IsHasCangku takes player p,integer i returns boolean
		return S2I(SubStringBJ(Greward2[GetConvertedPlayerId(p)], i, i)) == 1
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Huoqucangku takes player p,string chat returns nothing
  local integer i= 1
  local integer result= 0
		loop
			exitwhen i > 10
			if ( chat == I2S(GetCycleHash(playerName[GetConvertedPlayerId(p)] + "ck" + I2S(i) , 1)) ) then
				call GetAndSaveCangku(p , i)
				exitwhen true
			endif
			set i=i + 1
		endloop
		set BBuqian2=false
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ChallangerDZ___C3 takes integer i1,integer i2,integer i3 returns integer
		if ( CDiff == 1 ) then
			return i1
		elseif ( CDiff == 2 ) then
			return i2
		elseif ( CDiff == 3 ) then
			return i3
		else
			return 0
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CT1 takes nothing returns boolean
		return CType == 1
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CT2 takes nothing returns boolean
		return CType == 2
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CT3 takes nothing returns boolean
		return CType == 3
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CT4 takes nothing returns boolean
		return CType == 4
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CT5 takes nothing returns boolean
		return CType == 5
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CT6 takes nothing returns boolean
		return CType == 6
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CT7 takes nothing returns boolean
		return CType == 7
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsKuanghuan takes nothing returns boolean
		return CType == - 1
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetEasyComplete takes player p returns integer
  local integer index= GetConvertedPlayerId(p)
  local integer i= 1
  local integer result= 0
		if ( StringLength(easyCString[index]) < 62 ) then
			set easyCString[index]="00000000000000000000000000000000000000000000000000000000000000"
		endif
		loop
			exitwhen i > COUNT_CHALLANGER
			if ( S2I(SubStringBJ(easyCString[index], i, i)) > 0 ) then
				set result=result + 1
			endif
			set i=i + 1
		endloop
		return result
	endfunction
 function GetMiddleComplete takes player p returns integer
  local integer index= GetConvertedPlayerId(p)
  local integer i= 1
  local integer result= 0
		if ( StringLength(middleCString[index]) < 62 ) then
			set middleCString[index]="00000000000000000000000000000000000000000000000000000000000000"
		endif
		loop
			exitwhen i > COUNT_CHALLANGER
			if ( S2I(SubStringBJ(middleCString[index], i, i)) > 0 ) then
				set result=result + 1
			endif
			set i=i + 1
		endloop
		return result
	endfunction
 function GetHardComplete takes player p returns integer
  local integer index= GetConvertedPlayerId(p)
  local integer i= 1
  local integer result= 0
		if ( StringLength(hardCString[index]) < 62 ) then
			set hardCString[index]="00000000000000000000000000000000000000000000000000000000000000"
		endif
		loop
			exitwhen i > COUNT_CHALLANGER
			if ( S2I(SubStringBJ(hardCString[index], i, i)) > 0 ) then
				set result=result + 1
			endif
			set i=i + 1
		endloop
		return result
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetAllComplete takes player p returns integer
		return GetHardComplete(p) + GetEasyComplete(p) + GetMiddleComplete(p)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetCompleteRate takes player p returns real
		return I2R(GetAllComplete(p)) / ( 3.0 * I2R(COUNT_CHALLANGER) )
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitChallangerData takes player p returns nothing
		if ( Bdudang[GetConvertedPlayerId(p)] ) then
       call DzAPI_Map_Stat_SetStat(p , "chal" , I2S(GetAllComplete(p)) + "/" + I2S(3 * COUNT_CHALLANGER))
    call DzAPI_Map_StoreString(p , "easyCString" , easyCString[GetConvertedPlayerId(p)])
    call DzAPI_Map_StoreString(p , "middleCString" , middleCString[GetConvertedPlayerId(p)])
    call DzAPI_Map_StoreString(p , "hardCString" , hardCString[GetConvertedPlayerId(p)])
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ChallangerSuccess takes player p returns nothing
  local string temp= ""
  local integer index= GetConvertedPlayerId(p)
		if ( CType == - 1 ) then
			set temp=null
			return
		endif
		if ( CDiff == 1 ) then
			set temp=easyCString[index]
			set easyCString[index]=SubStringBJ(temp, 1, CType - 1)
			set easyCString[index]=easyCString[index] + "1"
			set easyCString[index]=easyCString[index] + SubStringBJ(temp, CType + 1, StringLength(temp))
		elseif ( CDiff == 2 ) then
			set temp=middleCString[index]
			set middleCString[index]=SubStringBJ(temp, 1, CType - 1)
			set middleCString[index]=middleCString[index] + "1"
			set middleCString[index]=middleCString[index] + SubStringBJ(temp, CType + 1, StringLength(temp))
		elseif ( CDiff == 3 ) then
			set temp=hardCString[index]
			set hardCString[index]=SubStringBJ(temp, 1, CType - 1)
			set hardCString[index]=hardCString[index] + "1"
			set hardCString[index]=hardCString[index] + SubStringBJ(temp, CType + 1, StringLength(temp))
		endif
		call InitChallangerData(p)
		call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r你成功的完成了" + SgameMode + ".")
		set temp=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsChallangerComplete takes player p,integer bit returns boolean
  local integer index= GetConvertedPlayerId(p)
  local string s= ""
		if ( CDiff == 1 ) then
			return S2I(SubStringBJ(easyCString[index], bit, bit)) > 0
		elseif ( CDiff == 2 ) then
			return S2I(SubStringBJ(middleCString[index], bit, bit)) > 0
		elseif ( CDiff == 3 ) then
			return S2I(SubStringBJ(hardCString[index], bit, bit)) > 0
		endif
		return false
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetChallangerTitle takes integer i returns string
		if ( i == 1 ) then
			return "力量透支挑战"
		elseif ( i == 2 ) then
			return "纯装备挑战"
		elseif ( i == 3 ) then
			return "驻永恒挑战"
		elseif ( i == 4 ) then
			return "创世篇挑战"
		elseif ( i == 5 ) then
			return "镜像挑战"
		elseif ( i == 6 ) then
			return "随机英雄挑战"
		elseif ( i == 7 ) then
			return "金钟罩挑战"
		endif
		return ""
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetChallangerContent takes integer i returns string
		if ( i == 1 ) then
			return "\n			力量透支挑战内容如下:\n			英雄初始等级为450级.\n			但是英雄初始属性为负95%.\n			该模式下禁止捕捉超过20级的宠物.\n			简单最低通关要求:(天国)\n			中等最低通关要求:(炼狱)\n			困难最低通关要求:(轮回)\n			|cff00ccff在该模式下不能获得成就及皮肤.|r\n			"
		elseif ( i == 2 ) then
			return "\n			纯装备挑战如下:\n			所有玩家英雄只有1个装备栏.\n			英雄获取任何装备时,\n			都增加该装备的6倍属性.\n			简单最低通关要求:(天国)\n			中等最低通关要求:(炼狱)\n			困难最低通关要求:(轮回)\n			|cff00ccff在该模式下不能获得成就及皮肤.|r\n			"
		elseif ( i == 3 ) then
			return "\n			驻永恒挑战如下:\n			该挑战下英雄攻击速度极慢,\n			移动速度-10000000%.\n			简单最低通关要求:(天国)\n			中等最低通关要求:(炼狱)\n			困难最低通关要求:(轮回)\n			|cff00ccff在该模式下不能获得成就及皮肤.|r\n			"
		elseif ( i == 4 ) then
			return "\n			创世篇挑战如下:\n			该挑战下英雄获得金钱为1%,\n			英雄每秒减少10%的生命.\n			(13波开始每秒减少30%的生命)\n			简单最低通关要求:(天国)\n			中等最低通关要求:(炼狱)\n			困难最低通关要求:(轮回)\n			|cff00ccff在该模式下不能获得成就及皮肤.|r\n			"
		elseif ( i == 5 ) then
			return "\n			镜像挑战如下:\n			该挑战下进攻怪为英雄的转生镜像,\n			与转生类似的属性,不拥有转生技能,\n			拥有与英雄一样的物品,\n			波数对应为转数,怪物数量会少3倍.\n			(进攻怪的经验固定在100/个)\n			简单最低通关要求:(天国)\n			中等最低通关要求:(炼狱)\n			困难最低通关要求:(轮回)\n			难度越大每波怪对应的转数越大。\n			|cff00ccff在该模式下不能获得成就及皮肤.|r\n			"
		elseif ( i == 6 ) then
			return "\n			随机英雄挑战如下:\n			只能选取随机英雄.\n			但是可以额外获得5000金币.\n			简单最低通关要求:(天国)\n			中等最低通关要求:(炼狱)\n			困难最低通关要求:(轮回)\n			|cff00ccff在该模式下不能获得成就及皮肤.|r\n			"
		elseif ( i == 7 ) then
			return "\n			金钟罩挑战如下:\n			所有进攻怪与BOSS只会攻击基地,\n			包括部分副本BOSS.\n			但是你兑换防护罩时额外获得2个.\n			简单最低通关要求:(天国)\n			中等最低通关要求:(炼狱)\n			困难最低通关要求:(轮回)\n			|cff00ccff在该模式下不能获得成就及皮肤.|r\n			"
		endif
		return ""
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetChallangerDifficulty takes nothing returns integer
		if ( CType == 1 ) then
			return ChallangerDZ___C3(1 , 5 , 8)
		elseif ( CType == 2 ) then
			return ChallangerDZ___C3(1 , 5 , 8)
		elseif ( CType == 3 ) then
			return ChallangerDZ___C3(1 , 5 , 8)
		elseif ( CType == 4 ) then
			return ChallangerDZ___C3(1 , 5 , 8)
		elseif ( CType == 5 ) then
			return ChallangerDZ___C3(1 , 5 , 8)
		elseif ( CType == 6 ) then
			return ChallangerDZ___C3(1 , 5 , 8)
		elseif ( CType == 7 ) then
			return ChallangerDZ___C3(1 , 5 , 8)
		endif
		return 0
	endfunction

//library ChallangerDZ ends
//library Exercise:
//---------------------------------------------------------------------------------------------------
	
 function TMonsterFilter1 takes nothing returns boolean
	    return ( ( GetOwningPlayer(GetFilterUnit()) == Player(10) ) and ( ( GetUnitTypeId(GetFilterUnit()) == 'nano' ) or ( GetUnitTypeId(GetFilterUnit()) == 'nanw' ) ) )
	endfunction
 function TMonsterFilter2 takes nothing returns boolean
	    return ( ( GetOwningPlayer(GetFilterUnit()) == Player(10) ) and ( ( GetUnitTypeId(GetFilterUnit()) == 'nenf' ) or ( GetUnitTypeId(GetFilterUnit()) == 'nbld' ) ) )
	endfunction
 function TMonsterFilter3 takes nothing returns boolean
	    return ( ( GetOwningPlayer(GetFilterUnit()) == Player(10) ) and ( ( GetUnitTypeId(GetFilterUnit()) == 'nbda' ) or ( GetUnitTypeId(GetFilterUnit()) == 'nbdo' ) ) )
	endfunction
 function TMonsterFilter4 takes nothing returns boolean
	    return ( ( GetOwningPlayer(GetFilterUnit()) == Player(10) ) and ( ( GetUnitTypeId(GetFilterUnit()) == 'ncim' ) or ( GetUnitTypeId(GetFilterUnit()) == 'ncnk' ) ) )
	endfunction
 function TMonsterFilter5 takes nothing returns boolean
	    return ( ( GetOwningPlayer(GetFilterUnit()) == Player(10) ) and ( ( GetUnitTypeId(GetFilterUnit()) == 'ngns' ) or ( GetUnitTypeId(GetFilterUnit()) == 'ngnw' ) ) )
	endfunction
 function TMonsterFilter6 takes nothing returns boolean
	    return ( ( GetOwningPlayer(GetFilterUnit()) == Player(10) ) and ( ( GetUnitTypeId(GetFilterUnit()) == 'nhfp' ) or ( GetUnitTypeId(GetFilterUnit()) == 'nenc' ) ) )
	endfunction
	
 function TMonsterPlayerFilter takes nothing returns boolean
	    return ( ( GetPlayerController(GetOwningPlayer(GetFilterUnit())) == MAP_CONTROL_USER ) and ( IsUnitAliveBJ(GetFilterUnit()) == true ) )
	endfunction
//---------------------------------------------------------------------------------------------------
	
//textmacro instance: FlashMonster("1")
 function FlashMonsterPlayer1 takes nothing returns nothing
  local group g
  local group g2
		//区域1
		set g=YDWEGetUnitsInRectMatchingNull(regionM1[1] , Condition(function TMonsterFilter1))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM1[1] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[1], g2) != true ) then
			        call CreateUnit(Player(10), 'nano', GetRectCenterX(regionM1[1]), GetRectCenterY(regionM1[1]), 270)
			    else
			        call CreateUnit(Player(10), 'nanw', GetRectCenterX(regionM1[1]), GetRectCenterY(regionM1[1]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
		//区域2
		set g=YDWEGetUnitsInRectMatchingNull(regionM2[1] , Condition(function TMonsterFilter2))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM2[1] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[1], g2) != true ) then
			        call CreateUnit(Player(10), 'nenf', GetRectCenterX(regionM2[1]), GetRectCenterY(regionM2[1]), 270)
			    else
			        call CreateUnit(Player(10), 'nbld', GetRectCenterX(regionM2[1]), GetRectCenterY(regionM2[1]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
	    //区域3
		set g=YDWEGetUnitsInRectMatchingNull(regionM3[1] , Condition(function TMonsterFilter3))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM3[1] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[1], g2) != true ) then
			        call CreateUnit(Player(10), 'nbda', GetRectCenterX(regionM3[1]), GetRectCenterY(regionM3[1]), 270)
			    else
			        call CreateUnit(Player(10), 'nbdo', GetRectCenterX(regionM3[1]), GetRectCenterY(regionM3[1]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
	    //区域4
		set g=YDWEGetUnitsInRectMatchingNull(regionM4[1] , Condition(function TMonsterFilter4))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM4[1] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[1], g2) != true ) then
			        call CreateUnit(Player(10), 'ncim', GetRectCenterX(regionM4[1]), GetRectCenterY(regionM4[1]), 270)
			    else
			        call CreateUnit(Player(10), 'ncnk', GetRectCenterX(regionM4[1]), GetRectCenterY(regionM4[1]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
	    //区域5
		set g=YDWEGetUnitsInRectMatchingNull(regionM5[1] , Condition(function TMonsterFilter5))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM5[1] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[1], g2) != true ) then
			        call CreateUnit(Player(10), 'ngns', GetRectCenterX(regionM5[1]), GetRectCenterY(regionM5[1]), 270)
			    else
			        call CreateUnit(Player(10), 'ngnw', GetRectCenterX(regionM5[1]), GetRectCenterY(regionM5[1]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
	    //区域6
		set g=YDWEGetUnitsInRectMatchingNull(regionM6[1] , Condition(function TMonsterFilter6))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM6[1] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[1], g2) != true ) then
			        call CreateUnit(Player(10), 'nhfp', GetRectCenterX(regionM6[1]), GetRectCenterY(regionM6[1]), 270)
			    else
			        call CreateUnit(Player(10), 'nenc', GetRectCenterX(regionM6[1]), GetRectCenterY(regionM6[1]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
	    set g=null
	    set g2=null
	endfunction
//end of: FlashMonster("1")
//textmacro instance: FlashMonster("2")
 function FlashMonsterPlayer2 takes nothing returns nothing
  local group g
  local group g2
		//区域1
		set g=YDWEGetUnitsInRectMatchingNull(regionM1[2] , Condition(function TMonsterFilter1))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM1[2] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[2], g2) != true ) then
			        call CreateUnit(Player(10), 'nano', GetRectCenterX(regionM1[2]), GetRectCenterY(regionM1[2]), 270)
			    else
			        call CreateUnit(Player(10), 'nanw', GetRectCenterX(regionM1[2]), GetRectCenterY(regionM1[2]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
		//区域2
		set g=YDWEGetUnitsInRectMatchingNull(regionM2[2] , Condition(function TMonsterFilter2))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM2[2] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[2], g2) != true ) then
			        call CreateUnit(Player(10), 'nenf', GetRectCenterX(regionM2[2]), GetRectCenterY(regionM2[2]), 270)
			    else
			        call CreateUnit(Player(10), 'nbld', GetRectCenterX(regionM2[2]), GetRectCenterY(regionM2[2]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
	    //区域3
		set g=YDWEGetUnitsInRectMatchingNull(regionM3[2] , Condition(function TMonsterFilter3))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM3[2] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[2], g2) != true ) then
			        call CreateUnit(Player(10), 'nbda', GetRectCenterX(regionM3[2]), GetRectCenterY(regionM3[2]), 270)
			    else
			        call CreateUnit(Player(10), 'nbdo', GetRectCenterX(regionM3[2]), GetRectCenterY(regionM3[2]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
	    //区域4
		set g=YDWEGetUnitsInRectMatchingNull(regionM4[2] , Condition(function TMonsterFilter4))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM4[2] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[2], g2) != true ) then
			        call CreateUnit(Player(10), 'ncim', GetRectCenterX(regionM4[2]), GetRectCenterY(regionM4[2]), 270)
			    else
			        call CreateUnit(Player(10), 'ncnk', GetRectCenterX(regionM4[2]), GetRectCenterY(regionM4[2]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
	    //区域5
		set g=YDWEGetUnitsInRectMatchingNull(regionM5[2] , Condition(function TMonsterFilter5))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM5[2] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[2], g2) != true ) then
			        call CreateUnit(Player(10), 'ngns', GetRectCenterX(regionM5[2]), GetRectCenterY(regionM5[2]), 270)
			    else
			        call CreateUnit(Player(10), 'ngnw', GetRectCenterX(regionM5[2]), GetRectCenterY(regionM5[2]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
	    //区域6
		set g=YDWEGetUnitsInRectMatchingNull(regionM6[2] , Condition(function TMonsterFilter6))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM6[2] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[2], g2) != true ) then
			        call CreateUnit(Player(10), 'nhfp', GetRectCenterX(regionM6[2]), GetRectCenterY(regionM6[2]), 270)
			    else
			        call CreateUnit(Player(10), 'nenc', GetRectCenterX(regionM6[2]), GetRectCenterY(regionM6[2]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
	    set g=null
	    set g2=null
	endfunction
//end of: FlashMonster("2")
//textmacro instance: FlashMonster("3")
 function FlashMonsterPlayer3 takes nothing returns nothing
  local group g
  local group g2
		//区域1
		set g=YDWEGetUnitsInRectMatchingNull(regionM1[3] , Condition(function TMonsterFilter1))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM1[3] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[3], g2) != true ) then
			        call CreateUnit(Player(10), 'nano', GetRectCenterX(regionM1[3]), GetRectCenterY(regionM1[3]), 270)
			    else
			        call CreateUnit(Player(10), 'nanw', GetRectCenterX(regionM1[3]), GetRectCenterY(regionM1[3]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
		//区域2
		set g=YDWEGetUnitsInRectMatchingNull(regionM2[3] , Condition(function TMonsterFilter2))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM2[3] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[3], g2) != true ) then
			        call CreateUnit(Player(10), 'nenf', GetRectCenterX(regionM2[3]), GetRectCenterY(regionM2[3]), 270)
			    else
			        call CreateUnit(Player(10), 'nbld', GetRectCenterX(regionM2[3]), GetRectCenterY(regionM2[3]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
	    //区域3
		set g=YDWEGetUnitsInRectMatchingNull(regionM3[3] , Condition(function TMonsterFilter3))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM3[3] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[3], g2) != true ) then
			        call CreateUnit(Player(10), 'nbda', GetRectCenterX(regionM3[3]), GetRectCenterY(regionM3[3]), 270)
			    else
			        call CreateUnit(Player(10), 'nbdo', GetRectCenterX(regionM3[3]), GetRectCenterY(regionM3[3]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
	    //区域4
		set g=YDWEGetUnitsInRectMatchingNull(regionM4[3] , Condition(function TMonsterFilter4))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM4[3] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[3], g2) != true ) then
			        call CreateUnit(Player(10), 'ncim', GetRectCenterX(regionM4[3]), GetRectCenterY(regionM4[3]), 270)
			    else
			        call CreateUnit(Player(10), 'ncnk', GetRectCenterX(regionM4[3]), GetRectCenterY(regionM4[3]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
	    //区域5
		set g=YDWEGetUnitsInRectMatchingNull(regionM5[3] , Condition(function TMonsterFilter5))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM5[3] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[3], g2) != true ) then
			        call CreateUnit(Player(10), 'ngns', GetRectCenterX(regionM5[3]), GetRectCenterY(regionM5[3]), 270)
			    else
			        call CreateUnit(Player(10), 'ngnw', GetRectCenterX(regionM5[3]), GetRectCenterY(regionM5[3]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
	    //区域6
		set g=YDWEGetUnitsInRectMatchingNull(regionM6[3] , Condition(function TMonsterFilter6))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM6[3] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[3], g2) != true ) then
			        call CreateUnit(Player(10), 'nhfp', GetRectCenterX(regionM6[3]), GetRectCenterY(regionM6[3]), 270)
			    else
			        call CreateUnit(Player(10), 'nenc', GetRectCenterX(regionM6[3]), GetRectCenterY(regionM6[3]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
	    set g=null
	    set g2=null
	endfunction
//end of: FlashMonster("3")
//textmacro instance: FlashMonster("4")
 function FlashMonsterPlayer4 takes nothing returns nothing
  local group g
  local group g2
		//区域1
		set g=YDWEGetUnitsInRectMatchingNull(regionM1[4] , Condition(function TMonsterFilter1))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM1[4] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[4], g2) != true ) then
			        call CreateUnit(Player(10), 'nano', GetRectCenterX(regionM1[4]), GetRectCenterY(regionM1[4]), 270)
			    else
			        call CreateUnit(Player(10), 'nanw', GetRectCenterX(regionM1[4]), GetRectCenterY(regionM1[4]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
		//区域2
		set g=YDWEGetUnitsInRectMatchingNull(regionM2[4] , Condition(function TMonsterFilter2))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM2[4] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[4], g2) != true ) then
			        call CreateUnit(Player(10), 'nenf', GetRectCenterX(regionM2[4]), GetRectCenterY(regionM2[4]), 270)
			    else
			        call CreateUnit(Player(10), 'nbld', GetRectCenterX(regionM2[4]), GetRectCenterY(regionM2[4]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
	    //区域3
		set g=YDWEGetUnitsInRectMatchingNull(regionM3[4] , Condition(function TMonsterFilter3))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM3[4] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[4], g2) != true ) then
			        call CreateUnit(Player(10), 'nbda', GetRectCenterX(regionM3[4]), GetRectCenterY(regionM3[4]), 270)
			    else
			        call CreateUnit(Player(10), 'nbdo', GetRectCenterX(regionM3[4]), GetRectCenterY(regionM3[4]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
	    //区域4
		set g=YDWEGetUnitsInRectMatchingNull(regionM4[4] , Condition(function TMonsterFilter4))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM4[4] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[4], g2) != true ) then
			        call CreateUnit(Player(10), 'ncim', GetRectCenterX(regionM4[4]), GetRectCenterY(regionM4[4]), 270)
			    else
			        call CreateUnit(Player(10), 'ncnk', GetRectCenterX(regionM4[4]), GetRectCenterY(regionM4[4]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
	    //区域5
		set g=YDWEGetUnitsInRectMatchingNull(regionM5[4] , Condition(function TMonsterFilter5))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM5[4] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[4], g2) != true ) then
			        call CreateUnit(Player(10), 'ngns', GetRectCenterX(regionM5[4]), GetRectCenterY(regionM5[4]), 270)
			    else
			        call CreateUnit(Player(10), 'ngnw', GetRectCenterX(regionM5[4]), GetRectCenterY(regionM5[4]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
	    //区域6
		set g=YDWEGetUnitsInRectMatchingNull(regionM6[4] , Condition(function TMonsterFilter6))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM6[4] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[4], g2) != true ) then
			        call CreateUnit(Player(10), 'nhfp', GetRectCenterX(regionM6[4]), GetRectCenterY(regionM6[4]), 270)
			    else
			        call CreateUnit(Player(10), 'nenc', GetRectCenterX(regionM6[4]), GetRectCenterY(regionM6[4]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
	    set g=null
	    set g2=null
	endfunction
//end of: FlashMonster("4")
//textmacro instance: FlashMonster("5")
 function FlashMonsterPlayer5 takes nothing returns nothing
  local group g
  local group g2
		//区域1
		set g=YDWEGetUnitsInRectMatchingNull(regionM1[5] , Condition(function TMonsterFilter1))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM1[5] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[5], g2) != true ) then
			        call CreateUnit(Player(10), 'nano', GetRectCenterX(regionM1[5]), GetRectCenterY(regionM1[5]), 270)
			    else
			        call CreateUnit(Player(10), 'nanw', GetRectCenterX(regionM1[5]), GetRectCenterY(regionM1[5]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
		//区域2
		set g=YDWEGetUnitsInRectMatchingNull(regionM2[5] , Condition(function TMonsterFilter2))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM2[5] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[5], g2) != true ) then
			        call CreateUnit(Player(10), 'nenf', GetRectCenterX(regionM2[5]), GetRectCenterY(regionM2[5]), 270)
			    else
			        call CreateUnit(Player(10), 'nbld', GetRectCenterX(regionM2[5]), GetRectCenterY(regionM2[5]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
	    //区域3
		set g=YDWEGetUnitsInRectMatchingNull(regionM3[5] , Condition(function TMonsterFilter3))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM3[5] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[5], g2) != true ) then
			        call CreateUnit(Player(10), 'nbda', GetRectCenterX(regionM3[5]), GetRectCenterY(regionM3[5]), 270)
			    else
			        call CreateUnit(Player(10), 'nbdo', GetRectCenterX(regionM3[5]), GetRectCenterY(regionM3[5]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
	    //区域4
		set g=YDWEGetUnitsInRectMatchingNull(regionM4[5] , Condition(function TMonsterFilter4))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM4[5] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[5], g2) != true ) then
			        call CreateUnit(Player(10), 'ncim', GetRectCenterX(regionM4[5]), GetRectCenterY(regionM4[5]), 270)
			    else
			        call CreateUnit(Player(10), 'ncnk', GetRectCenterX(regionM4[5]), GetRectCenterY(regionM4[5]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
	    //区域5
		set g=YDWEGetUnitsInRectMatchingNull(regionM5[5] , Condition(function TMonsterFilter5))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM5[5] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[5], g2) != true ) then
			        call CreateUnit(Player(10), 'ngns', GetRectCenterX(regionM5[5]), GetRectCenterY(regionM5[5]), 270)
			    else
			        call CreateUnit(Player(10), 'ngnw', GetRectCenterX(regionM5[5]), GetRectCenterY(regionM5[5]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
	    //区域6
		set g=YDWEGetUnitsInRectMatchingNull(regionM6[5] , Condition(function TMonsterFilter6))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM6[5] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[5], g2) != true ) then
			        call CreateUnit(Player(10), 'nhfp', GetRectCenterX(regionM6[5]), GetRectCenterY(regionM6[5]), 270)
			    else
			        call CreateUnit(Player(10), 'nenc', GetRectCenterX(regionM6[5]), GetRectCenterY(regionM6[5]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
	    set g=null
	    set g2=null
	endfunction
//end of: FlashMonster("5")
//textmacro instance: FlashMonster("6")
 function FlashMonsterPlayer6 takes nothing returns nothing
  local group g
  local group g2
		//区域1
		set g=YDWEGetUnitsInRectMatchingNull(regionM1[6] , Condition(function TMonsterFilter1))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM1[6] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[6], g2) != true ) then
			        call CreateUnit(Player(10), 'nano', GetRectCenterX(regionM1[6]), GetRectCenterY(regionM1[6]), 270)
			    else
			        call CreateUnit(Player(10), 'nanw', GetRectCenterX(regionM1[6]), GetRectCenterY(regionM1[6]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
		//区域2
		set g=YDWEGetUnitsInRectMatchingNull(regionM2[6] , Condition(function TMonsterFilter2))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM2[6] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[6], g2) != true ) then
			        call CreateUnit(Player(10), 'nenf', GetRectCenterX(regionM2[6]), GetRectCenterY(regionM2[6]), 270)
			    else
			        call CreateUnit(Player(10), 'nbld', GetRectCenterX(regionM2[6]), GetRectCenterY(regionM2[6]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
	    //区域3
		set g=YDWEGetUnitsInRectMatchingNull(regionM3[6] , Condition(function TMonsterFilter3))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM3[6] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[6], g2) != true ) then
			        call CreateUnit(Player(10), 'nbda', GetRectCenterX(regionM3[6]), GetRectCenterY(regionM3[6]), 270)
			    else
			        call CreateUnit(Player(10), 'nbdo', GetRectCenterX(regionM3[6]), GetRectCenterY(regionM3[6]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
	    //区域4
		set g=YDWEGetUnitsInRectMatchingNull(regionM4[6] , Condition(function TMonsterFilter4))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM4[6] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[6], g2) != true ) then
			        call CreateUnit(Player(10), 'ncim', GetRectCenterX(regionM4[6]), GetRectCenterY(regionM4[6]), 270)
			    else
			        call CreateUnit(Player(10), 'ncnk', GetRectCenterX(regionM4[6]), GetRectCenterY(regionM4[6]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
	    //区域5
		set g=YDWEGetUnitsInRectMatchingNull(regionM5[6] , Condition(function TMonsterFilter5))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM5[6] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[6], g2) != true ) then
			        call CreateUnit(Player(10), 'ngns', GetRectCenterX(regionM5[6]), GetRectCenterY(regionM5[6]), 270)
			    else
			        call CreateUnit(Player(10), 'ngnw', GetRectCenterX(regionM5[6]), GetRectCenterY(regionM5[6]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
	    //区域6
		set g=YDWEGetUnitsInRectMatchingNull(regionM6[6] , Condition(function TMonsterFilter6))
		set g2=YDWEGetUnitsInRectMatchingNull(regionM6[6] , Condition(function TMonsterPlayerFilter))
		if ( CountUnitsInGroup(g2) != 0 ) then
			//刷怪
			if ( CountUnitsInGroup(g) == 0 ) then
			    if ( IsUnitInGroup(udg_H[6], g2) != true ) then
			        call CreateUnit(Player(10), 'nhfp', GetRectCenterX(regionM6[6]), GetRectCenterY(regionM6[6]), 270)
			    else
			        call CreateUnit(Player(10), 'nenc', GetRectCenterX(regionM6[6]), GetRectCenterY(regionM6[6]), 270)
			    endif
			endif
		else
			if ( CountUnitsInGroup(g) != 0 ) then
				//不刷且删兵
				call DeleteGroup(g)
			endif
		endif
	    call DestroyGroup(g)
	    call DestroyGroup(g2)
	    set g=null
	    set g2=null
	endfunction
//end of: FlashMonster("6")
//---------------------------------------------------------------------------------------------------
	
//textmacro instance: TExerciseForbitCon("1")
  function Exercise__TExerciseForbitCon1 takes nothing returns boolean
			return ( ( ConvertedPlayer(1) != GetOwningPlayer(GetTriggerUnit()) ) and ( IsEnemy3(GetTriggerUnit() , Player(10)) ) )
		endfunction
//end of: TExerciseForbitCon("1")
//textmacro instance: TExerciseForbitCon("2")
  function Exercise__TExerciseForbitCon2 takes nothing returns boolean
			return ( ( ConvertedPlayer(2) != GetOwningPlayer(GetTriggerUnit()) ) and ( IsEnemy3(GetTriggerUnit() , Player(10)) ) )
		endfunction
//end of: TExerciseForbitCon("2")
//textmacro instance: TExerciseForbitCon("3")
  function Exercise__TExerciseForbitCon3 takes nothing returns boolean
			return ( ( ConvertedPlayer(3) != GetOwningPlayer(GetTriggerUnit()) ) and ( IsEnemy3(GetTriggerUnit() , Player(10)) ) )
		endfunction
//end of: TExerciseForbitCon("3")
//textmacro instance: TExerciseForbitCon("4")
  function Exercise__TExerciseForbitCon4 takes nothing returns boolean
			return ( ( ConvertedPlayer(4) != GetOwningPlayer(GetTriggerUnit()) ) and ( IsEnemy3(GetTriggerUnit() , Player(10)) ) )
		endfunction
//end of: TExerciseForbitCon("4")
//textmacro instance: TExerciseForbitCon("5")
  function Exercise__TExerciseForbitCon5 takes nothing returns boolean
			return ( ( ConvertedPlayer(5) != GetOwningPlayer(GetTriggerUnit()) ) and ( IsEnemy3(GetTriggerUnit() , Player(10)) ) )
		endfunction
//end of: TExerciseForbitCon("5")
//textmacro instance: TExerciseForbitCon("6")
  function Exercise__TExerciseForbitCon6 takes nothing returns boolean
			return ( ( ConvertedPlayer(6) != GetOwningPlayer(GetTriggerUnit()) ) and ( IsEnemy3(GetTriggerUnit() , Player(10)) ) )
		endfunction
//end of: TExerciseForbitCon("6")
 function Exercise__TExerciseForbitAct takes nothing returns nothing
		call SetUnitX(GetTriggerUnit(), GetUnitX(gg_unit_haro_0030))
		call SetUnitY(GetTriggerUnit(), GetUnitY(gg_unit_haro_0030))
		call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【消息】|r你不能进入其他玩家的房间！")
		if ( IsSolider(GetTriggerUnit()) ) then
			call RemoveUnit(GetTriggerUnit())
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Exercise__InitExerciseTrigger takes nothing returns nothing
  local trigger t
//textmacro instance: CreateMonsterTrigger("1")
			if ( ( GetPlayerSlotState(ConvertedPlayer(1)) == PLAYER_SLOT_STATE_PLAYING ) and GetPlayerController(ConvertedPlayer(1)) == MAP_CONTROL_USER ) then
				set t=CreateTrigger()
			    call YDWETriggerRegisterEnterRectSimpleNull(t , regionAll[1])
			    call TriggerAddCondition(t, Condition(function Exercise__TExerciseForbitCon1))
			    call TriggerAddAction(t, function Exercise__TExerciseForbitAct)
				call CreateUnit(Player(15), 'uS02', GetRectCenterX(regionM1[1]) + 300, GetRectCenterY(regionM1[1]) - 300, 270)
			    set Exercise__TiExercise[1]=CreateTimer()
			    call TimerStart(Exercise__TiExercise[1], 5, true, function FlashMonsterPlayer1)
			endif
//end of: CreateMonsterTrigger("1")
//textmacro instance: CreateMonsterTrigger("2")
			if ( ( GetPlayerSlotState(ConvertedPlayer(2)) == PLAYER_SLOT_STATE_PLAYING ) and GetPlayerController(ConvertedPlayer(2)) == MAP_CONTROL_USER ) then
				set t=CreateTrigger()
			    call YDWETriggerRegisterEnterRectSimpleNull(t , regionAll[2])
			    call TriggerAddCondition(t, Condition(function Exercise__TExerciseForbitCon2))
			    call TriggerAddAction(t, function Exercise__TExerciseForbitAct)
				call CreateUnit(Player(15), 'uS02', GetRectCenterX(regionM1[2]) + 300, GetRectCenterY(regionM1[2]) - 300, 270)
			    set Exercise__TiExercise[2]=CreateTimer()
			    call TimerStart(Exercise__TiExercise[2], 5, true, function FlashMonsterPlayer2)
			endif
//end of: CreateMonsterTrigger("2")
//textmacro instance: CreateMonsterTrigger("3")
			if ( ( GetPlayerSlotState(ConvertedPlayer(3)) == PLAYER_SLOT_STATE_PLAYING ) and GetPlayerController(ConvertedPlayer(3)) == MAP_CONTROL_USER ) then
				set t=CreateTrigger()
			    call YDWETriggerRegisterEnterRectSimpleNull(t , regionAll[3])
			    call TriggerAddCondition(t, Condition(function Exercise__TExerciseForbitCon3))
			    call TriggerAddAction(t, function Exercise__TExerciseForbitAct)
				call CreateUnit(Player(15), 'uS02', GetRectCenterX(regionM1[3]) + 300, GetRectCenterY(regionM1[3]) - 300, 270)
			    set Exercise__TiExercise[3]=CreateTimer()
			    call TimerStart(Exercise__TiExercise[3], 5, true, function FlashMonsterPlayer3)
			endif
//end of: CreateMonsterTrigger("3")
//textmacro instance: CreateMonsterTrigger("4")
			if ( ( GetPlayerSlotState(ConvertedPlayer(4)) == PLAYER_SLOT_STATE_PLAYING ) and GetPlayerController(ConvertedPlayer(4)) == MAP_CONTROL_USER ) then
				set t=CreateTrigger()
			    call YDWETriggerRegisterEnterRectSimpleNull(t , regionAll[4])
			    call TriggerAddCondition(t, Condition(function Exercise__TExerciseForbitCon4))
			    call TriggerAddAction(t, function Exercise__TExerciseForbitAct)
				call CreateUnit(Player(15), 'uS02', GetRectCenterX(regionM1[4]) + 300, GetRectCenterY(regionM1[4]) - 300, 270)
			    set Exercise__TiExercise[4]=CreateTimer()
			    call TimerStart(Exercise__TiExercise[4], 5, true, function FlashMonsterPlayer4)
			endif
//end of: CreateMonsterTrigger("4")
//textmacro instance: CreateMonsterTrigger("5")
			if ( ( GetPlayerSlotState(ConvertedPlayer(5)) == PLAYER_SLOT_STATE_PLAYING ) and GetPlayerController(ConvertedPlayer(5)) == MAP_CONTROL_USER ) then
				set t=CreateTrigger()
			    call YDWETriggerRegisterEnterRectSimpleNull(t , regionAll[5])
			    call TriggerAddCondition(t, Condition(function Exercise__TExerciseForbitCon5))
			    call TriggerAddAction(t, function Exercise__TExerciseForbitAct)
				call CreateUnit(Player(15), 'uS02', GetRectCenterX(regionM1[5]) + 300, GetRectCenterY(regionM1[5]) - 300, 270)
			    set Exercise__TiExercise[5]=CreateTimer()
			    call TimerStart(Exercise__TiExercise[5], 5, true, function FlashMonsterPlayer5)
			endif
//end of: CreateMonsterTrigger("5")
//textmacro instance: CreateMonsterTrigger("6")
			if ( ( GetPlayerSlotState(ConvertedPlayer(6)) == PLAYER_SLOT_STATE_PLAYING ) and GetPlayerController(ConvertedPlayer(6)) == MAP_CONTROL_USER ) then
				set t=CreateTrigger()
			    call YDWETriggerRegisterEnterRectSimpleNull(t , regionAll[6])
			    call TriggerAddCondition(t, Condition(function Exercise__TExerciseForbitCon6))
			    call TriggerAddAction(t, function Exercise__TExerciseForbitAct)
				call CreateUnit(Player(15), 'uS02', GetRectCenterX(regionM1[6]) + 300, GetRectCenterY(regionM1[6]) - 300, 270)
			    set Exercise__TiExercise[6]=CreateTimer()
			    call TimerStart(Exercise__TiExercise[6], 5, true, function FlashMonsterPlayer6)
			endif
//end of: CreateMonsterTrigger("6")
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CloseExerciseTimer takes player p returns nothing
		call PauseTimer(Exercise__TiExercise[GetConvertedPlayerId(p)])
		call DestroyTimer(Exercise__TiExercise[GetConvertedPlayerId(p)])
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Exercise__InitExerciseRegions takes nothing returns nothing
		set regionM1[1]=Rect(- 15488.0, 13952.0, - 14240.0, 15232.0)
	    set regionM2[1]=Rect(- 13280.0, 13952.0, - 12096.0, 15232.0)
	    set regionM3[1]=Rect(- 15488.0, 12288.0, - 14208.0, 13536.0)
	    set regionM4[1]=Rect(- 13312.0, 12288.0, - 12064.0, 13568.0)
	    set regionM5[1]=Rect(- 15488.0, 10624.0, - 14208.0, 11904.0)
	    set regionM6[1]=Rect(- 13312.0, 10624.0, - 12032.0, 11904.0)
	    set regionM1[2]=Rect(- 15488.0, 8960.0, - 14240.0, 10240.0)
	    set regionM2[2]=Rect(- 13280.0, 8960.0, - 12096.0, 10240.0)
	    set regionM3[2]=Rect(- 15488.0, 7296.0, - 14208.0, 8544.0)
	    set regionM4[2]=Rect(- 13312.0, 7296.0, - 12064.0, 8576.0)
	    set regionM5[2]=Rect(- 15488.0, 5632.0, - 14208.0, 6912.0)
	    set regionM6[2]=Rect(- 13312.0, 5632.0, - 12032.0, 6912.0)
	    set regionM1[3]=Rect(- 11104.0, 13984.0, - 9888.0, 15232.0)
	    set regionM2[3]=Rect(- 8960.0, 13952.0, - 7680.0, 15232.0)
	    set regionM3[3]=Rect(- 11136.0, 12288.0, - 9888.0, 13536.0)
	    set regionM4[3]=Rect(- 8928.0, 12288.0, - 7680.0, 13568.0)
	    set regionM5[3]=Rect(- 11136.0, 10624.0, - 9856.0, 11904.0)
	    set regionM6[3]=Rect(- 8960.0, 10624.0, - 7680.0, 11904.0)
	    set regionM1[4]=Rect(- 11104.0, 8992.0, - 9888.0, 10240.0)
	    set regionM2[4]=Rect(- 8960.0, 8960.0, - 7680.0, 10240.0)
	    set regionM3[4]=Rect(- 11136.0, 7296.0, - 9888.0, 8544.0)
	    set regionM4[4]=Rect(- 8928.0, 7296.0, - 7680.0, 8576.0)
	    set regionM5[4]=Rect(- 11136.0, 5632.0, - 9856.0, 6912.0)
	    set regionM6[4]=Rect(- 8960.0, 5632.0, - 7680.0, 6912.0)
	    set regionM1[5]=Rect(- 6752.0, 13952.0, - 5536.0, 15200.0)
	    set regionM2[5]=Rect(- 4736.0, 13952.0, - 3456.0, 15232.0)
	    set regionM3[5]=Rect(- 6784.0, 12256.0, - 5536.0, 13504.0)
	    set regionM4[5]=Rect(- 4704.0, 12288.0, - 3456.0, 13568.0)
	    set regionM5[5]=Rect(- 6784.0, 10592.0, - 5504.0, 11872.0)
	    set regionM6[5]=Rect(- 4736.0, 10624.0, - 3456.0, 11904.0)
	    set regionM1[6]=Rect(- 6752.0, 8960.0, - 5536.0, 10208.0)
	    set regionM2[6]=Rect(- 4736.0, 8960.0, - 3456.0, 10240.0)
	    set regionM3[6]=Rect(- 6784.0, 7264.0, - 5536.0, 8512.0)
	    set regionM4[6]=Rect(- 4704.0, 7296.0, - 3456.0, 8576.0)
	    set regionM5[6]=Rect(- 6784.0, 5600.0, - 5504.0, 6880.0)
	    set regionM6[6]=Rect(- 4736.0, 5632.0, - 3456.0, 6912.0)
	    set regionAll[1]=Rect(- 15808.0, 10400.0, - 11744.0, 15456.0)
	    set regionAll[2]=Rect(- 15808.0, 5344.0, - 11712.0, 10400.0)
	    set regionAll[3]=Rect(- 11744.0, 10400.0, - 7232.0, 15456.0)
	    set regionAll[4]=Rect(- 11744.0, 5312.0, - 7232.0, 10400.0)
	    set regionAll[5]=Rect(- 7264.0, 10432.0, - 3136.0, 15456.0)
	    set regionAll[6]=Rect(- 7264.0, 5312.0, - 3136.0, 10432.0)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function EnterExerciseRegion takes nothing returns nothing
  local real x
  local real y
//textmacro instance: EnterSpecifyExercise("I05J","1")
		if ( ( GetItemTypeId(GetSoldItem()) == 'I05J' ) ) then
			set x=GetRectCenterX(regionM1[GetConvertedPlayerId(GetOwningPlayer(GetBuyingUnit()))])
			set y=GetRectCenterY(regionM1[GetConvertedPlayerId(GetOwningPlayer(GetBuyingUnit()))])
	        call SetUnitX(GetBuyingUnit(), x)
	        call SetUnitY(GetBuyingUnit(), y)
	        call PanCameraToTimedForPlayer(GetOwningPlayer(GetBuyingUnit()), x, y, 0.2)
	        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", x, y))
	        call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r回去输入“HG”。")
	    endif
//end of: EnterSpecifyExercise("I05J","1")
//textmacro instance: EnterSpecifyExercise("I053","2")
		if ( ( GetItemTypeId(GetSoldItem()) == 'I053' ) ) then
			set x=GetRectCenterX(regionM2[GetConvertedPlayerId(GetOwningPlayer(GetBuyingUnit()))])
			set y=GetRectCenterY(regionM2[GetConvertedPlayerId(GetOwningPlayer(GetBuyingUnit()))])
	        call SetUnitX(GetBuyingUnit(), x)
	        call SetUnitY(GetBuyingUnit(), y)
	        call PanCameraToTimedForPlayer(GetOwningPlayer(GetBuyingUnit()), x, y, 0.2)
	        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", x, y))
	        call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r回去输入“HG”。")
	    endif
//end of: EnterSpecifyExercise("I053","2")
//textmacro instance: EnterSpecifyExercise("I05K","3")
		if ( ( GetItemTypeId(GetSoldItem()) == 'I05K' ) ) then
			set x=GetRectCenterX(regionM3[GetConvertedPlayerId(GetOwningPlayer(GetBuyingUnit()))])
			set y=GetRectCenterY(regionM3[GetConvertedPlayerId(GetOwningPlayer(GetBuyingUnit()))])
	        call SetUnitX(GetBuyingUnit(), x)
	        call SetUnitY(GetBuyingUnit(), y)
	        call PanCameraToTimedForPlayer(GetOwningPlayer(GetBuyingUnit()), x, y, 0.2)
	        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", x, y))
	        call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r回去输入“HG”。")
	    endif
//end of: EnterSpecifyExercise("I05K","3")
//textmacro instance: EnterSpecifyExercise("I06Y","4")
		if ( ( GetItemTypeId(GetSoldItem()) == 'I06Y' ) ) then
			set x=GetRectCenterX(regionM4[GetConvertedPlayerId(GetOwningPlayer(GetBuyingUnit()))])
			set y=GetRectCenterY(regionM4[GetConvertedPlayerId(GetOwningPlayer(GetBuyingUnit()))])
	        call SetUnitX(GetBuyingUnit(), x)
	        call SetUnitY(GetBuyingUnit(), y)
	        call PanCameraToTimedForPlayer(GetOwningPlayer(GetBuyingUnit()), x, y, 0.2)
	        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", x, y))
	        call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r回去输入“HG”。")
	    endif
//end of: EnterSpecifyExercise("I06Y","4")
//textmacro instance: EnterSpecifyExercise("I06Z","5")
		if ( ( GetItemTypeId(GetSoldItem()) == 'I06Z' ) ) then
			set x=GetRectCenterX(regionM5[GetConvertedPlayerId(GetOwningPlayer(GetBuyingUnit()))])
			set y=GetRectCenterY(regionM5[GetConvertedPlayerId(GetOwningPlayer(GetBuyingUnit()))])
	        call SetUnitX(GetBuyingUnit(), x)
	        call SetUnitY(GetBuyingUnit(), y)
	        call PanCameraToTimedForPlayer(GetOwningPlayer(GetBuyingUnit()), x, y, 0.2)
	        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", x, y))
	        call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r回去输入“HG”。")
	    endif
//end of: EnterSpecifyExercise("I06Z","5")
//textmacro instance: EnterSpecifyExercise("I03Z","6")
		if ( ( GetItemTypeId(GetSoldItem()) == 'I03Z' ) ) then
			set x=GetRectCenterX(regionM6[GetConvertedPlayerId(GetOwningPlayer(GetBuyingUnit()))])
			set y=GetRectCenterY(regionM6[GetConvertedPlayerId(GetOwningPlayer(GetBuyingUnit()))])
	        call SetUnitX(GetBuyingUnit(), x)
	        call SetUnitY(GetBuyingUnit(), y)
	        call PanCameraToTimedForPlayer(GetOwningPlayer(GetBuyingUnit()), x, y, 0.2)
	        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", x, y))
	        call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r回去输入“HG”。")
	    endif
//end of: EnterSpecifyExercise("I03Z","6")
	endfunction
//---------------------------------------------------------------------------------------------------
 function Exercise__InitExercise takes nothing returns nothing
		call Exercise__InitExerciseRegions()
		call Exercise__InitExerciseTrigger()
	endfunction

//library Exercise ends
//library Printer:
//---------------------------------------------------------------------------------------------------
	
 function PrintSpellAdd takes player whichPlayer,string spellName,real damage,string addtional returns nothing
		if ( BHideDamage[GetConvertedPlayerId(whichPlayer)] ) then
			return
		endif
		if ( damage > 10000 ) then
	    	call DisplayTextToPlayer(whichPlayer, 0, 0, ( "|cFFFF66CC【|r" + spellName + "|cFFFF66CC】|r伤害加成" + I2S(R2I(( ( udg_I_Jinengjiacheng[GetConvertedPlayerId(whichPlayer)] * 100.00 ) - 99.00 ))) + ( "%,伤害" + ( I2S(R2I(damage / 10000)) + "万" + addtional + "." ) ) ))
	    else
	    	call DisplayTextToPlayer(whichPlayer, 0, 0, ( "|cFFFF66CC【|r" + spellName + "|cFFFF66CC】|r伤害加成" + I2S(R2I(( ( udg_I_Jinengjiacheng[GetConvertedPlayerId(whichPlayer)] * 100.00 ) - 99.00 ))) + ( "%,伤害" + ( I2S(R2I(damage)) + addtional + "." ) ) ))
		endif
	endfunction
 function PrintSpell takes player whichPlayer,string spellName,real damage returns nothing
		call PrintSpellAdd(whichPlayer , spellName , damage , "")
	endfunction
 function PrintSpellContent takes player whichPlayer,string spellName,string content returns nothing
		if ( BHideDamage[GetConvertedPlayerId(whichPlayer)] ) then
			return
		endif
	    call DisplayTextToPlayer(whichPlayer, 0, 0, ( "|cFFFF66CC【|r" + spellName + "|cFFFF66CC】|r" + content ))
	endfunction
 function PrintSpellName takes player whichPlayer,string spellName returns nothing
		call PrintSpellContent(whichPlayer , spellName , "")
	endfunction
//---------------------------------------------------------------------------------------------------
 function Printer___InitPrinter takes nothing returns nothing
	endfunction

//library Printer ends
//library SpellBase:
//---------------------------------------------------------------------------------------------------
	
 function SpellBase___ImmuteDamageTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local unit u= LoadUnitHandle(spellTable, id, kUImmuteDamage)
		call PauseTimer(t)
		call DestroyTimer(t)
		call FlushChildHashtable(spellTable, id)
		call UnitRemoveAbility(u, 'Avul')
		set u=null
		set t=null
	endfunction
 function ImmuteDamageInterval takes unit u,real time returns nothing
  local timer t= CreateTimer()
		call UnitAddAbility(u, 'Avul')
		call SaveUnitHandle(spellTable, GetHandleId(t), kUImmuteDamage, u)
		call TimerStart(t, time, false, function SpellBase___ImmuteDamageTimer)
		set t=null
	endfunction
 function ImmuteDamage takes unit u returns nothing
		call ImmuteDamageInterval(u , 0)
	endfunction
//---------------------------------------------------------------------------------------------------
	
  function s__OnlyAttackBase_flashAttack takes nothing returns nothing
   local integer this= sc__OnlyAttackBase__staticgetindex(GetExpiredTimer())
			if ( IsUnitAliveBJ(s__OnlyAttackBase_u[this]) or GetUnitAbilityLevel(s__OnlyAttackBase_u[this], 'A0KH') > 0 ) then
				call IssueTargetOrder(s__OnlyAttackBase_u[this], "attack", gg_unit_haro_0030)
			else
				call sc__OnlyAttackBase_deallocate(this)
			endif
  endfunction
        function s__OnlyAttackBase__staticgetindex takes handle h returns integer
            return YDWEGetIntegerByString("SpellBase" , I2S(YDWEH2I(h)))
        endfunction
        function s__OnlyAttackBase__staticsetindex takes handle h,integer value returns nothing
            call YDWESaveIntegerByString("SpellBase" , I2S(YDWEH2I(h)) , value)
        endfunction
        function s__OnlyAttackBase_flush takes handle h returns nothing
            call YDWEFlushStoredIntegerByString("SpellBase" , I2S(YDWEH2I(h)))
        endfunction
  function s__OnlyAttackBase_create takes unit u returns integer
      local integer this= s__OnlyAttackBase__allocate()
		   	set s__OnlyAttackBase_u[this]=u
			set s__OnlyAttackBase_t[this]=CreateTimer()
			call s__OnlyAttackBase__staticsetindex(s__OnlyAttackBase_t[this], (this))
			call TimerStart(s__OnlyAttackBase_t[this], 3, true, function s__OnlyAttackBase_flashAttack)
			call IssueTargetOrder(u, "attack", gg_unit_haro_0030)
			return this
  endfunction
  function s__OnlyAttackBase_onDestroy takes integer this returns nothing
			call s__OnlyAttackBase_flush(s__OnlyAttackBase_t[this])
			set s__OnlyAttackBase_u[this]=null
			call PauseTimer(s__OnlyAttackBase_t[this])
			call DestroyTimer(s__OnlyAttackBase_t[this])
			set s__OnlyAttackBase_t[this]=null
  endfunction

//Generated destructor of OnlyAttackBase
function s__OnlyAttackBase_deallocate takes integer this returns nothing
    if this==null then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: OnlyAttackBase")
        return
    elseif (si__OnlyAttackBase_V[this]!=-1) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: OnlyAttackBase")
        return
    endif
    call s__OnlyAttackBase_onDestroy(this)
    set si__OnlyAttackBase_V[this]=si__OnlyAttackBase_F
    set si__OnlyAttackBase_F=this
endfunction
//---------------------------------------------------------------------------------------------------
	
  function s__Connect_connect takes nothing returns nothing
   local integer this= sc__Connect__staticgetindex(GetExpiredTimer())
			if ( s__Connect_BDie[this] ) then
				if ( not ( IsUnitAliveBJ(s__Connect_unit1[this]) ) or not ( IsUnitAliveBJ(s__Connect_unit2[this]) ) ) then
					call DestroyLightningBJ(s__Connect_l[this])
					set s__Connect_l[this]=null
				else
					if ( s__Connect_l[this] != null ) then
						call MoveLightning(s__Connect_l[this], true, GetUnitX(s__Connect_unit1[this]), GetUnitY(s__Connect_unit1[this]), GetUnitX(s__Connect_unit2[this]), GetUnitY(s__Connect_unit2[this]))
					endif
				endif
			else
				call MoveLightning(s__Connect_l[this], true, GetUnitX(s__Connect_unit1[this]), GetUnitY(s__Connect_unit1[this]), GetUnitX(s__Connect_unit2[this]), GetUnitY(s__Connect_unit2[this]))
			endif
  endfunction
        function s__Connect__staticgetindex takes handle h returns integer
            return YDWEGetIntegerByString("SpellBase" , I2S(YDWEH2I(h)))
        endfunction
        function s__Connect__staticsetindex takes handle h,integer value returns nothing
            call YDWESaveIntegerByString("SpellBase" , I2S(YDWEH2I(h)) , value)
        endfunction
        function s__Connect_flush takes handle h returns nothing
            call YDWEFlushStoredIntegerByString("SpellBase" , I2S(YDWEH2I(h)))
        endfunction
  function s__Connect_create takes unit unit1,unit unit2,string lightningType returns integer
      local integer this= s__Connect__allocate()
		   	set s__Connect_unit1[this]=unit1
		   	set s__Connect_unit2[this]=unit2
		   	set s__Connect_BDie[this]=false
			set s__Connect_l[this]=AddLightning(lightningType, true, GetUnitX(unit1), GetUnitY(unit1), GetUnitX(unit2), GetUnitY(unit2))
			set s__Connect_t[this]=CreateTimer()
			call s__Connect__staticsetindex(s__Connect_t[this], (this))
			call TimerStart(s__Connect_t[this], 0.05, true, function s__Connect_connect)
			return this
  endfunction
  function s__Connect_setDieVanish takes integer this returns nothing
			set s__Connect_BDie[this]=true
  endfunction
  function s__Connect_onDestroy takes integer this returns nothing
			call s__Connect_flush(s__Connect_t[this])
			set s__Connect_unit1[this]=null
			set s__Connect_unit2[this]=null
			call DestroyLightningBJ(s__Connect_l[this])
			set s__Connect_l[this]=null
			call PauseTimer(s__Connect_t[this])
			call DestroyTimer(s__Connect_t[this])
			set s__Connect_t[this]=null
  endfunction

//Generated destructor of Connect
function s__Connect_deallocate takes integer this returns nothing
    if this==null then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: Connect")
        return
    elseif (si__Connect_V[this]!=-1) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: Connect")
        return
    endif
    call s__Connect_onDestroy(this)
    set si__Connect_V[this]=si__Connect_F
    set si__Connect_F=this
endfunction
//---------------------------------------------------------------------------------------------------
  function s__Attract_attract takes nothing returns nothing
   local real x1
   local real y1
   local real x2
   local real y2
   local real facing
   local real distance
   local integer this= sc__Attract__staticgetindex(GetExpiredTimer())
   local group l_group= CreateGroup()
   local unit l_unit
			if ( IsUnitAliveBJ(s__Attract_caster[this]) ) then
				call GroupEnumUnitsInRange(l_group, GetUnitX(s__Attract_caster[this]), GetUnitY(s__Attract_caster[this]), s__Attract_radius[this], null)
				loop
				    set l_unit=FirstOfGroup(l_group)
				    exitwhen l_unit == null
				    call GroupRemoveUnit(l_group, l_unit)
				    if ( IsEnemyM(l_unit , s__Attract_caster[this]) and ( GetUnitMoveSpeed(l_unit) > 0 ) and ( not ( s__Attract_forbitHero[this] and IsUnitType(l_unit, UNIT_TYPE_HERO) ) ) and GetUnitAbilityLevel(l_unit, 'A0IH') < 1 ) then
				    	set x2=GetUnitX(l_unit)
				    	set y2=GetUnitY(l_unit)
				    	set x1=GetUnitX(s__Attract_caster[this])
				    	set y1=GetUnitY(s__Attract_caster[this])
				    	set distance=SquareRoot(( x1 - x2 ) * ( x1 - x2 ) + ( y1 - y2 ) * ( y1 - y2 ))
				    	if ( distance > 80 ) then
				    	set facing=Atan2BJ(y1 - y2, x1 - x2)
				    	call SetUnitX(l_unit, YDWECoordinateX(x2 + CosBJ(facing) * s__Attract_speed[this]))
				    	call SetUnitY(l_unit, YDWECoordinateY(y2 + SinBJ(facing) * s__Attract_speed[this]))
				    	endif
				    endif
				endloop
				call DestroyGroup(l_group)
			else
				if not ( s__Attract_deathContinue[this] ) then
					call sc__Attract_deallocate(this)
				endif
			endif
			set l_group=null
			set l_unit=null
  endfunction
        function s__Attract__staticgetindex takes handle h returns integer
            return YDWEGetIntegerByString("SPellBase" , I2S(YDWEH2I(h)))
        endfunction
        function s__Attract__staticsetindex takes handle h,integer value returns nothing
            call YDWESaveIntegerByString("SPellBase" , I2S(YDWEH2I(h)) , value)
        endfunction
        function s__Attract_flush takes handle h returns nothing
            call YDWEFlushStoredIntegerByString("SPellBase" , I2S(YDWEH2I(h)))
        endfunction
  function s__Attract_create takes unit caster,real radius,real interval,real speed returns integer
      local integer this= s__Attract__allocate()
      local timer t
			set s__Attract_caster[this]=caster
			set s__Attract_radius[this]=radius
			set s__Attract_interval[this]=interval
			set s__Attract_speed[this]=speed
			set s__Attract_forbitHero[this]=false
			set s__Attract_deathContinue[this]=false
			return this
  endfunction
  function s__Attract_SetForbitHero takes integer this returns nothing
			set s__Attract_forbitHero[this]=true
  endfunction
  function s__Attract_SetDeathContinue takes integer this returns nothing
			set s__Attract_deathContinue[this]=true
  endfunction
  function s__Attract_setSpeed takes integer this,real speed returns nothing
			set s__Attract_speed[this]=speed
  endfunction
  function s__Attract_start takes integer this returns nothing
			set s__Attract_t[this]=CreateTimer()
			call s__Attract__staticsetindex(s__Attract_t[this], (this))
			call TimerStart(s__Attract_t[this], s__Attract_interval[this], true, function s__Attract_attract)
  endfunction
  function s__Attract_onDestroy takes integer this returns nothing
			call s__Attract_flush(s__Attract_t[this])
			set s__Attract_caster[this]=null
			call PauseTimer(s__Attract_t[this])
			call DestroyTimer(s__Attract_t[this])
			set s__Attract_t[this]=null
  endfunction

//Generated destructor of Attract
function s__Attract_deallocate takes integer this returns nothing
    if this==null then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: Attract")
        return
    elseif (si__Attract_V[this]!=-1) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: Attract")
        return
    endif
    call s__Attract_onDestroy(this)
    set si__Attract_V[this]=si__Attract_F
    set si__Attract_F=this
endfunction
//---------------------------------------------------------------------------------------------------
  function s__Missile_explode takes nothing returns nothing
   local integer this= sc__Missile__staticgetindex(GetExpiredTimer())
   local group l_group= CreateGroup()
   local unit l_unit
			call GroupEnumUnitsInRange(l_group, s__Missile_x[this], s__Missile_y[this], s__Missile_radius[this], null)
			loop
			    set l_unit=FirstOfGroup(l_group)
			    exitwhen l_unit == null
			    call GroupRemoveUnit(l_group, l_unit)
			    if ( IsEnemyM(l_unit , s__Missile_caster[this]) == true ) then
			    	call UnitDamageTarget(s__Missile_caster[this], l_unit, s__Missile_damage[this], false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_SLOW_POISON, WEAPON_TYPE_WHOKNOWS)
			    endif
			endloop
			call DestroyGroup(l_group)
			set l_group=null
			set l_unit=null
			call sc__Missile_deallocate(this)
  endfunction
  function s__Missile_launch takes nothing returns nothing
   local integer this= sc__Missile__staticgetindex(GetExpiredTimer())
			call DestroyEffect(AddSpecialEffect(s__Missile_effx[this], s__Missile_x[this], s__Missile_y[this]))
			call PauseTimer(s__Missile_t[this])
			call TimerStart(s__Missile_t[this], s__Missile_interval2[this], false, function s__Missile_explode)
  endfunction
        function s__Missile__staticgetindex takes handle h returns integer
            return YDWEGetIntegerByString("SPellBase" , I2S(YDWEH2I(h)))
        endfunction
        function s__Missile__staticsetindex takes handle h,integer value returns nothing
            call YDWESaveIntegerByString("SPellBase" , I2S(YDWEH2I(h)) , value)
        endfunction
        function s__Missile_flush takes handle h returns nothing
            call YDWEFlushStoredIntegerByString("SPellBase" , I2S(YDWEH2I(h)))
        endfunction
  function s__Missile_createXY takes unit caster,integer preview,string effx,real radius,real x,real y,real interval1,real interval2,real damage returns integer
      local integer this= s__Missile__allocate()
		   	set s__Missile_x[this]=x
		   	set s__Missile_y[this]=y
			set s__Missile_caster[this]=caster
			set s__Missile_effx[this]=effx
			set s__Missile_radius[this]=radius
			set s__Missile_interval1[this]=interval1
			set s__Missile_interval2[this]=interval2
			set s__Missile_damage[this]=damage
			set s__Missile_t[this]=CreateTimer()
			call s__Missile__staticsetindex(s__Missile_t[this], (this))
			call UnitApplyTimedLifeBJ(interval1 + interval2, 'BHwe', CreateUnit(GetOwningPlayer(s__Missile_caster[this]), preview, s__Missile_x[this], s__Missile_y[this], 0))
			call TimerStart(s__Missile_t[this], s__Missile_interval1[this], false, function s__Missile_launch)
			return this
  endfunction
  function s__Missile_create takes unit caster,integer preview,string effx,real radius,real range,real interval1,real interval2,real damage returns integer
      local real Rangel= GetRandomReal(- 180, 180)
      local real Rradius= GetRandomReal(0, range)
			return s__Missile_createXY(caster , preview , effx , radius , GetUnitX(caster) + Rradius * CosBJ(Rangel) , GetUnitY(caster) + Rradius * SinBJ(Rangel) , interval1 , interval2 , damage)
  endfunction
  function s__Missile_onDestroy takes integer this returns nothing
			call s__Missile_flush(s__Missile_t[this])
			set s__Missile_caster[this]=null
			call PauseTimer(s__Missile_t[this])
			call DestroyTimer(s__Missile_t[this])
			set s__Missile_t[this]=null
  endfunction

//Generated destructor of Missile
function s__Missile_deallocate takes integer this returns nothing
    if this==null then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: Missile")
        return
    elseif (si__Missile_V[this]!=-1) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: Missile")
        return
    endif
    call s__Missile_onDestroy(this)
    set si__Missile_V[this]=si__Missile_F
    set si__Missile_F=this
endfunction
//---------------------------------------------------------------------------------------------------
	
//processed:     function interface AfterSucceed takes nothing returns nothing
		//失败
  function s__Questions_fail takes integer this returns nothing
	    	call PlaySoundBJ(gg_snd_kill_boss)
			set udg_I_Er_diansi[1]=IMaxBJ(0, udg_I_Er_diansi[1] - ( IMaxBJ(1, R2I(0.2 * udg_I_Er_diansi[1])) ))
        	call BJDebugMsg("|cFFFF66CC【消息】|r问题回答错误,你们失去了五分之一的防护罩,还剩" + I2S(udg_I_Er_diansi[1]) + "个...")
			call sc__Questions_deallocate(this)
  endfunction
		//成功
  function s__Questions_succeed takes integer this returns nothing
        	call PlaySoundBJ(gg_snd_GoodJob)
        	call BJDebugMsg("|cFFFF66CC【消息】|r问题回答正确,BOSS失去10%的生命.")
        	if ( s__Questions_as[this] != 0 ) then
                call sc___prototype51_execute(s__Questions_as[this])
        	endif
			call sc__Questions_deallocate(this)
  endfunction
  function s__Questions_flashTimeout takes nothing returns nothing
   local integer this= LoadInteger(LHTable, GetHandleId(GetExpiredTimer()), 1)
			set s__Questions_time[this]=s__Questions_time[this] - 1
			if ( s__Questions_time[this] <= 0 ) then
				call s__Questions_fail(this)
			else
				call DialogSetMessage(s__Questions_d[this], s__Questions_question[this] + "(剩余时间:" + I2S(s__Questions_time[this]) + "s)")
			endif
  endfunction
  function s__Questions_chooseAnswer takes nothing returns nothing
   local integer this= LoadInteger(LHTable, GetHandleId(LoadTimerHandle(LHTable, GetHandleId(GetTriggeringTrigger()), 1)), 1)
   local integer i= 1
			loop
				exitwhen i > 10
		        if ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(s__Questions_d[this]), i) ) then
		        	if ( i == s__Questions_rightPos[this] ) then
		        		call s__Questions_succeed(this)
		        		return
		        	else
		        		call s__Questions_fail(this)
		        		return
		        	endif
		        endif
				set i=i + 1
			endloop
  endfunction
        function s__Questions_GetRightAnswer takes integer shu1,integer shu2,boolean jia returns integer
        	if ( jia ) then
        		return shu1 + shu2
        	else
        		return shu1 * shu2
        	endif
        endfunction
        function s__Questions_GetWrongAnswer takes integer shu,integer diff returns integer
         local integer result= 0
         local integer result2= 0
        	if ( GetRandomInt(1, 2) == 1 ) then
        		set result=shu + GetRandomInt(1, R2I(Pow(2, diff)))
        		if ( diff >= 10 ) then
        			set result2=S2I(SubStringBJ(I2S(result), 1, StringLength(I2S(result)) - 2) + SubStringBJ(I2S(shu), StringLength(I2S(shu)) - 1, StringLength(I2S(shu))))
        			if ( result2 != shu ) then
        				return result2
        			endif
        		endif
        		return result
        	else
        		set result=shu - GetRandomInt(1, R2I(Pow(2, diff)))
        		if ( diff >= 10 ) then
        			set result2=S2I(SubStringBJ(I2S(result), 1, StringLength(I2S(result)) - 2) + SubStringBJ(I2S(shu), StringLength(I2S(shu)) - 1, StringLength(I2S(shu))))
        			if ( result2 != shu ) then
        				return result2
        			endif
        		endif
        		return result
        	endif
        endfunction
        function s__Questions_create takes player p,integer diff,integer count,integer as returns integer
      local integer this= s__Questions__allocate()
      local string s= ""
      local boolean jia= ( GetRandomInt(1, 2) == 1 )
      local integer shu1= GetRandomInt(R2I(Pow(2, diff - 1)), R2I(Pow(2, diff)))
      local integer shu2= GetRandomInt(R2I(Pow(2, diff - 1)), R2I(Pow(2, diff)))
      local integer right= s__Questions_GetRightAnswer(shu1 , shu2 , jia)
      local integer i= 1
		   	if ( as != 0 ) then
		   		set s__Questions_as[this]=as
		   	endif
		   	set s__Questions_rightPos[this]=GetRandomInt(1, count)
		   	set s__Questions_time[this]=5
		   	set s__Questions_click[this]=CreateTrigger()
			set s__Questions_p[this]=p
			set s__Questions_t[this]=CreateTimer()
			set s__Questions_d[this]=DialogCreate()
			set s__Questions_question[this]=I2S(shu1) + S3(jia , "+" , "x") + I2S(shu2) + "=?"
			call DialogSetMessage(s__Questions_d[this], s__Questions_question[this] + "(剩余时间:5s)")
			loop
				exitwhen i > count
				if ( i == s__Questions_rightPos[this] ) then
					call SaveButtonHandle(LHTable, GetHandleId(s__Questions_d[this]), i, DialogAddButtonBJ(s__Questions_d[this], I2S(right)))
				else
					call SaveButtonHandle(LHTable, GetHandleId(s__Questions_d[this]), i, DialogAddButtonBJ(s__Questions_d[this], I2S(s__Questions_GetWrongAnswer(right , diff))))
				endif
				set i=i + 1
			endloop
			call SaveTimerHandle(LHTable, GetHandleId(s__Questions_click[this]), 1, s__Questions_t[this])
			call SaveInteger(LHTable, GetHandleId(s__Questions_t[this]), 1, this)
			call DialogDisplay(s__Questions_p[this], s__Questions_d[this], true)
			call TriggerRegisterDialogEvent(s__Questions_click[this], s__Questions_d[this])
			call TriggerAddAction(s__Questions_click[this], function s__Questions_chooseAnswer)
			call TimerStart(s__Questions_t[this], 1, true, function s__Questions_flashTimeout)
			return this
  endfunction
  function s__Questions_onDestroy takes integer this returns nothing
			call PauseTimer(s__Questions_t[this])
			call DestroyTimer(s__Questions_t[this])
			call FlushChildHashtable(LHTable, GetHandleId(s__Questions_t[this]))
			set s__Questions_t[this]=null
			set s__Questions_time[this]=0
			set s__Questions_rightPos[this]=0
			call FlushChildHashtable(LHTable, GetHandleId(s__Questions_click[this]))
			call FlushChildHashtable(LHTable, GetHandleId(s__Questions_d[this]))
			call DestroyTrigger(s__Questions_click[this])
	    	call DialogDisplay(s__Questions_p[this], s__Questions_d[this], false)
	        call DialogClear(s__Questions_d[this])
	        call DialogDestroy(s__Questions_d[this])
			set s__Questions_click[this]=null
			set s__Questions_p[this]=null
			set s__Questions_question[this]=null
			set s__Questions_d[this]=null
  endfunction

//Generated destructor of Questions
function s__Questions_deallocate takes integer this returns nothing
    if this==null then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: Questions")
        return
    elseif (si__Questions_V[this]!=-1) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: Questions")
        return
    endif
    call s__Questions_onDestroy(this)
    set si__Questions_V[this]=si__Questions_F
    set si__Questions_F=this
endfunction
//---------------------------------------------------------------------------------------------------
	
  function s__Roubang_roubangrotate takes nothing returns nothing
   local integer this= sc__Roubang__staticgetindex(GetExpiredTimer())
   local integer i= 1
			if ( not ( IsUnitAliveBJ(s__Roubang_caster[this]) ) and GetUnitAbilityLevel(s__Roubang_caster[this], 'A0KH') < 1 ) then
				call sc__Roubang_deallocate(this)
			endif
			set s__Roubang_cAngle[this]=ModuloReal(s__Roubang_cAngle[this] + s__Roubang_aSpeed[this], 360.)
			loop
				exitwhen i > s__Roubang_number[this]
				if ( s___Roubang_URou[s__Roubang_URou[this]+i] != null ) then
					call SetUnitX(s___Roubang_URou[s__Roubang_URou[this]+i], YDWECoordinateX(GetUnitX(s__Roubang_caster[this]) + s__Roubang_radius[this] * ( 2 * i - 1 ) * CosBJ(s__Roubang_cAngle[this])))
					call SetUnitY(s___Roubang_URou[s__Roubang_URou[this]+i], YDWECoordinateY(GetUnitY(s__Roubang_caster[this]) + s__Roubang_radius[this] * ( 2 * i - 1 ) * SinBJ(s__Roubang_cAngle[this])))
					call SetUnitFacing(s___Roubang_URou[s__Roubang_URou[this]+i], s__Roubang_cAngle[this] + 90)
				endif
				set i=i + 1
			endloop
  endfunction
        function s__Roubang__staticgetindex takes handle h returns integer
            return YDWEGetIntegerByString("SPellBase" , I2S(YDWEH2I(h)))
        endfunction
        function s__Roubang__staticsetindex takes handle h,integer value returns nothing
            call YDWESaveIntegerByString("SPellBase" , I2S(YDWEH2I(h)) , value)
        endfunction
        function s__Roubang_flush takes handle h returns nothing
            call YDWEFlushStoredIntegerByString("SPellBase" , I2S(YDWEH2I(h)))
        endfunction
  function s__Roubang_create takes unit caster,integer number,real radius,real aSpeed,real angle,integer utype returns integer
   local integer i= 2
      local integer this= s__Roubang__allocate()
			set s__Roubang_caster[this]=caster
			set s__Roubang_number[this]=IMinBJ(29, number)
			set s__Roubang_radius[this]=radius
			set s__Roubang_aSpeed[this]=aSpeed
			set s__Roubang_cAngle[this]=angle
			set s__Roubang_t[this]=CreateTimer()
			call s__Roubang__staticsetindex(s__Roubang_t[this], (this))
			set s___Roubang_URou[s__Roubang_URou[this]+1]=null
		   	loop
		   		exitwhen i > IMinBJ(29, number)
	   			set s___Roubang_URou[s__Roubang_URou[this]+i]=CreateUnit(GetOwningPlayer(caster), utype, YDWECoordinateX(GetUnitX(caster) + radius * ( 2 * i - 1 ) * CosBJ(angle)), YDWECoordinateY(GetUnitY(caster) + radius * ( 2 * i - 1 ) * SinBJ(angle)), angle + 90)
		   		set i=i + 1
		   	endloop
			call TimerStart(s__Roubang_t[this], 0.05, true, function s__Roubang_roubangrotate)
			return this
  endfunction
  function s__Roubang_onDestroy takes integer this returns nothing
   local integer i= 1
			call s__Roubang_flush(s__Roubang_t[this])
			set s__Roubang_caster[this]=null
			loop
				exitwhen i > s__Roubang_number[this]
				if ( s___Roubang_URou[s__Roubang_URou[this]+i] != null ) then
					call RemoveUnit(s___Roubang_URou[s__Roubang_URou[this]+i])
					set s___Roubang_URou[s__Roubang_URou[this]+i]=null
				endif
				set i=i + 1
			endloop
			call PauseTimer(s__Roubang_t[this])
			call DestroyTimer(s__Roubang_t[this])
			set s__Roubang_aSpeed[this]=0.
			set s__Roubang_cAngle[this]=0.
			set s__Roubang_radius[this]=0.
			set s__Roubang_number[this]=0
			set s__Roubang_t[this]=null
  endfunction

//Generated destructor of Roubang
function s__Roubang_deallocate takes integer this returns nothing
    if this==null then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: Roubang")
        return
    elseif (si__Roubang_V[this]!=-1) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: Roubang")
        return
    endif
    call s__Roubang_onDestroy(this)
    set si__Roubang_V[this]=si__Roubang_F
    set si__Roubang_F=this
endfunction
//---------------------------------------------------------------------------------------------------
	
//processed:     function interface AfterLessLife takes unit u returns nothing
  function s__MultiLife_flashLoc takes nothing returns nothing
   local integer this= sc__MultiLife__staticgetindex(GetExpiredTimer())
			if ( s__MultiLife_times[this] < 2 ) then
				call UnitRemoveAbility(s__MultiLife_caster[this], 'A0KH')
			endif
			if ( s__MultiLife_current[this] >= s__MultiLife_times[this] ) then
				return
			endif
			call SetTextTagPosUnitBJ(s__MultiLife_ttHint[this], s__MultiLife_caster[this], 20)
			if not ( IsUnitAliveBJ(s__MultiLife_caster[this]) ) then
				set s__MultiLife_current[this]=s__MultiLife_current[this] + 1
				call SetUnitLifePercentBJ(s__MultiLife_caster[this], 100)
				call SetTextTagTextBJ(s__MultiLife_ttHint[this], I2S(s__MultiLife_current[this]) + "/" + I2S(s__MultiLife_times[this]) + "次生命", 20)
				if ( s__MultiLife_current[this] >= s__MultiLife_times[this] ) then
					call UnitRemoveAbility(s__MultiLife_caster[this], 'A0KH')
				endif
				if ( s__MultiLife_al[this] != 0 ) then
					call sc___prototype189_execute(s__MultiLife_al[this],s__MultiLife_caster[this])
				endif
			endif
  endfunction
  function s__MultiLife_getTimes takes integer this returns integer
			return s__MultiLife_current[this]
  endfunction
  function s__MultiLife_setAL takes integer this,integer al returns nothing
			set s__MultiLife_al[this]=al
  endfunction
  function s__MultiLife__staticgetindex takes handle h returns integer
            return YDWEGetIntegerByString("SPellBase" , I2S(YDWEH2I(h)))
        endfunction
        function s__MultiLife__staticsetindex takes handle h,integer value returns nothing
            call YDWESaveIntegerByString("SPellBase" , I2S(YDWEH2I(h)) , value)
        endfunction
        function s__MultiLife_flush takes handle h returns nothing
            call YDWEFlushStoredIntegerByString("SPellBase" , I2S(YDWEH2I(h)))
        endfunction
        function s__MultiLife_create takes unit caster,integer times returns integer
      local integer this
		   	set this=s__MultiLife__allocate()
			set s__MultiLife_caster[this]=caster
			set s__MultiLife_times[this]=times
			set s__MultiLife_al[this]=0
			set s__MultiLife_ttHint[this]=CreateTextTagUnitBJ("1/" + I2S(times) + "次生命", caster, 0, 20, 0, 100, 100, 0)
			set s__MultiLife_current[this]=1
			//加上复活技能
			call UnitAddAbility(caster, 'A0KH')
			set s__MultiLife_t[this]=CreateTimer()
			call s__MultiLife__staticsetindex(s__MultiLife_t[this], (this))
			call TimerStart(s__MultiLife_t[this], 0.05, true, function s__MultiLife_flashLoc)
			return this
  endfunction
  function s__MultiLife_onDestroy takes integer this returns nothing
			call s__MultiLife_flush(s__MultiLife_t[this])
			call UnitRemoveAbility(s__MultiLife_caster[this], 'A0KH')
			call DestroyTextTag(s__MultiLife_ttHint[this])
			set s__MultiLife_ttHint[this]=null
			set s__MultiLife_caster[this]=null
			call PauseTimer(s__MultiLife_t[this])
			call DestroyTimer(s__MultiLife_t[this])
			set s__MultiLife_t[this]=null
  endfunction

//Generated destructor of MultiLife
function s__MultiLife_deallocate takes integer this returns nothing
    if this==null then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: MultiLife")
        return
    elseif (si__MultiLife_V[this]!=-1) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: MultiLife")
        return
    endif
    call s__MultiLife_onDestroy(this)
    set si__MultiLife_V[this]=si__MultiLife_F
    set si__MultiLife_F=this
endfunction
//---------------------------------------------------------------------------------------------------
	
  function s__SuperShield_flashLife takes nothing returns nothing
   local integer this= sc__SuperShield__staticgetindex(GetExpiredTimer())
			if ( IsUnitAliveBJ(s__SuperShield_caster[this]) ) then
				if ( s__SuperShield_current[this] <= s__SuperShield_times[this] and GetUnitState(s__SuperShield_caster[this], UNIT_STATE_LIFE) < ( GetUnitState(s__SuperShield_caster[this], UNIT_STATE_MAX_LIFE) * ( 1.0 - ( ( I2R(s__SuperShield_current[this]) ) / ( I2R(s__SuperShield_times[this] + 1) ) ) ) ) ) then
					call ImmuteDamageInterval(s__SuperShield_caster[this] , 5)
					call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl", GetUnitX(s__SuperShield_caster[this]), GetUnitY(s__SuperShield_caster[this])))
		    		call CreateSpellTextTag(I2S(s__SuperShield_current[this]) + "/" + I2S(s__SuperShield_times[this]) + "段无敌" , s__SuperShield_caster[this] , 100 , 0 , 0 , 4)
		    		call SetUnitLifePercentBJ(s__SuperShield_caster[this], 100.0 * ( 1.0 - ( ( I2R(s__SuperShield_current[this]) ) / ( I2R(s__SuperShield_times[this] + 1) ) ) ))
					call UnitRemoveBuffsBJ(bj_REMOVEBUFFS_ALL, s__SuperShield_caster[this])
					set s__SuperShield_current[this]=s__SuperShield_current[this] + 1
				endif
			else
				if not ( s__SuperShield_deathContinue[this] ) then
					call sc__SuperShield_deallocate(this)
				endif
			endif
  endfunction
        function s__SuperShield__staticgetindex takes handle h returns integer
            return YDWEGetIntegerByString("SPellBase" , I2S(YDWEH2I(h)))
        endfunction
        function s__SuperShield__staticsetindex takes handle h,integer value returns nothing
            call YDWESaveIntegerByString("SPellBase" , I2S(YDWEH2I(h)) , value)
        endfunction
        function s__SuperShield_flush takes handle h returns nothing
            call YDWEFlushStoredIntegerByString("SPellBase" , I2S(YDWEH2I(h)))
        endfunction
  function s__SuperShield_create takes unit caster,integer times returns integer
      local integer this= s__SuperShield__allocate()
			set s__SuperShield_caster[this]=caster
			set s__SuperShield_times[this]=times
			set s__SuperShield_current[this]=1
			set s__SuperShield_deathContinue[this]=false
			set s__SuperShield_t[this]=CreateTimer()
			call s__SuperShield__staticsetindex(s__SuperShield_t[this], (this))
			call TimerStart(s__SuperShield_t[this], 0.5, true, function s__SuperShield_flashLife)
			return this
  endfunction
  function s__SuperShield_SetDeathContinue takes integer this returns nothing
			set s__SuperShield_deathContinue[this]=true
  endfunction
  function s__SuperShield_onDestroy takes integer this returns nothing
			call s__SuperShield_flush(s__SuperShield_t[this])
			set s__SuperShield_caster[this]=null
			call PauseTimer(s__SuperShield_t[this])
			call DestroyTimer(s__SuperShield_t[this])
			set s__SuperShield_t[this]=null
  endfunction

//Generated destructor of SuperShield
function s__SuperShield_deallocate takes integer this returns nothing
    if this==null then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: SuperShield")
        return
    elseif (si__SuperShield_V[this]!=-1) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: SuperShield")
        return
    endif
    call s__SuperShield_onDestroy(this)
    set si__SuperShield_V[this]=si__SuperShield_F
    set si__SuperShield_F=this
endfunction
//---------------------------------------------------------------------------------------------------
	
 function IJ1 takes unit u,integer i1,integer i2 returns integer
		if ( BJuexing1[GetConvertedPlayerId(GetOwningPlayer(u))] ) then
			return i1
		else
			return i2
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function RJ1 takes unit u,real r1,real r2 returns real
		if ( BJuexing1[GetConvertedPlayerId(GetOwningPlayer(u))] ) then
			return r1
		else
			return r2
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IJ2 takes unit u,integer i1,integer i2 returns integer
		if ( BJuexing2[GetConvertedPlayerId(GetOwningPlayer(u))] ) then
			return i1
		else
			return i2
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function RJ2 takes unit u,real r1,real r2 returns real
		if ( BJuexing2[GetConvertedPlayerId(GetOwningPlayer(u))] ) then
			return r1
		else
			return r2
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IJ3 takes unit u,integer i1,integer i2 returns integer
		if ( BJuexing3[GetConvertedPlayerId(GetOwningPlayer(u))] ) then
			return i1
		else
			return i2
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function RJ3 takes unit u,real r1,real r2 returns real
		if ( BJuexing3[GetConvertedPlayerId(GetOwningPlayer(u))] ) then
			return r1
		else
			return r2
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetDamageStr takes unit u returns real
  local unit uH= udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
  local real damage= ( ( GetHeroStr(uH, true) * 1.80 ) + ( GetHeroAgi(uH, true) ) + ( GetHeroInt(uH, true) * 1.20 ) ) * SquareRoot(GetHeroLevel(uH)) * udg_I_Jinengjiacheng[GetConvertedPlayerId(GetOwningPlayer(uH))]
		set uH=null
		return damage
	endfunction
	
 function GetDamageChenji takes unit u returns real
  local unit uH= udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
  local real damage= ( GetHeroStr(uH, true) ) * 2 * SquareRoot(GetHeroLevel(uH)) * udg_I_Jinengjiacheng[GetConvertedPlayerId(GetOwningPlayer(uH))]
		set uH=null
		return damage
	endfunction
	
 function GetDamageAgi takes unit u returns real
  local unit uH= udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
  local real damage= ( ( GetHeroStr(uH, true) ) + ( GetHeroAgi(uH, true) * 1.80 ) + ( GetHeroInt(uH, true) * 1.20 ) ) * SquareRoot(GetHeroLevel(uH)) * udg_I_Jinengjiacheng[GetConvertedPlayerId(GetOwningPlayer(uH))]
		set uH=null
		return damage
	endfunction
	
 function GetDamageInt takes unit u returns real
  local unit uH= udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
  local real damage= ( ( GetHeroStr(uH, true) ) + ( GetHeroAgi(uH, true) ) + ( GetHeroInt(uH, true) * 2.0 ) ) * SquareRoot(GetHeroLevel(uH)) * udg_I_Jinengjiacheng[GetConvertedPlayerId(GetOwningPlayer(uH))]
		set uH=null
		return damage
	endfunction
	
 function GetDamageBase takes unit u returns real
  local unit uH= udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
  local real damage= ( ( GetHeroStr(uH, true) * 1.30 ) + ( GetHeroAgi(uH, true) * 1.30 ) + ( GetHeroInt(uH, true) * 1.3 ) ) * SquareRoot(GetHeroLevel(uH)) * udg_I_Jinengjiacheng[GetConvertedPlayerId(GetOwningPlayer(uH))]
		set uH=null
		return damage
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsSecondSpellOK takes unit hero returns boolean
		return GetPlayerTechCountSimple('R006', GetOwningPlayer(hero)) == 1
	endfunction
	
 function IsThirdSpellOK takes unit hero returns boolean
		return GetPlayerTechCountSimple('R007', GetOwningPlayer(hero)) == 1
	endfunction
	
 function IsFourthSpellOK takes unit hero returns boolean
		return GetPlayerTechCountSimple('R008', GetOwningPlayer(hero)) == 1
	endfunction
	
 function IsFifthSpellOK takes unit hero returns boolean
		return ( GetPlayerTechCountSimple('R009', GetOwningPlayer(hero)) == 1 ) and ( GetPlayerTechCountSimple('R00A', GetOwningPlayer(hero)) == 1 ) and ( GetPlayerTechCountSimple('R00B', GetOwningPlayer(hero)) == 1 )
	endfunction
//---------------------------------------------------------------------------------------------------

//library SpellBase ends
//library Structs:
//---------------------------------------------------------------------------------------------------
	
  function s__TextTagBind_flash takes nothing returns nothing
   local integer this= sc__TextTagBind__staticgetindex(GetExpiredTimer())
			call SetTextTagPos(s__TextTagBind_tt[this], YDWECoordinateX(GetUnitX(s__TextTagBind_caster[this]) - s__TextTagBind_xOff[this]), YDWECoordinateY(GetUnitY(s__TextTagBind_caster[this]) - s__TextTagBind_yOff[this]), 20)
  endfunction
        function s__TextTagBind__staticgetindex takes handle h returns integer
            return YDWEGetIntegerByString("TextTagBind" , I2S(YDWEH2I(h)))
        endfunction
        function s__TextTagBind__staticsetindex takes handle h,integer value returns nothing
            call YDWESaveIntegerByString("TextTagBind" , I2S(YDWEH2I(h)) , value)
        endfunction
        function s__TextTagBind_flush takes handle h returns nothing
            call YDWEFlushStoredIntegerByString("TextTagBind" , I2S(YDWEH2I(h)))
        endfunction
  function s__TextTagBind_create takes unit caster,real xOff,real yOff returns integer
      local integer this= s__TextTagBind__allocate()
      local location point= Location(YDWECoordinateX(GetUnitX(caster) - xOff), YDWECoordinateY(GetUnitY(caster) - yOff))
			set s__TextTagBind_xOff[this]=xOff
			set s__TextTagBind_yOff[this]=yOff
			set s__TextTagBind_caster[this]=caster
			set s__TextTagBind_size[this]=20.
			set s__TextTagBind_tt[this]=CreateTextTagLocBJ("", point, 0, 20.00, 0, 100, 100, 0)
			set s__TextTagBind_t[this]=CreateTimer()
			call s__TextTagBind__staticsetindex(s__TextTagBind_t[this], (this))
			call TimerStart(s__TextTagBind_t[this], 0.05, true, function s__TextTagBind_flash)
			call RemoveLocation(point)
			set point=null
			return this
  endfunction
  function s__TextTagBind_setSize takes integer this,real size returns nothing
			set s__TextTagBind_size[this]=size
			call SetTextTagTextBJ(s__TextTagBind_tt[this], s__TextTagBind_content[this], size)
  endfunction
  function s__TextTagBind_setContent takes integer this,string s returns nothing
			set s__TextTagBind_content[this]=s
			call SetTextTagTextBJ(s__TextTagBind_tt[this], s, s__TextTagBind_size[this])
  endfunction
  function s__TextTagBind_onDestroy takes integer this returns nothing
			call s__TextTagBind_flush(s__TextTagBind_t[this])
			set s__TextTagBind_caster[this]=null
			call DestroyTextTag(s__TextTagBind_tt[this])
			set s__TextTagBind_tt[this]=null
			set s__TextTagBind_xOff[this]=0.
			set s__TextTagBind_yOff[this]=0.
			call PauseTimer(s__TextTagBind_t[this])
			call DestroyTimer(s__TextTagBind_t[this])
			set s__TextTagBind_t[this]=null
  endfunction

//Generated destructor of TextTagBind
function s__TextTagBind_deallocate takes integer this returns nothing
    if this==null then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: TextTagBind")
        return
    elseif (si__TextTagBind_V[this]!=-1) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: TextTagBind")
        return
    endif
    call s__TextTagBind_onDestroy(this)
    set si__TextTagBind_V[this]=si__TextTagBind_F
    set si__TextTagBind_F=this
endfunction
//---------------------------------------------------------------------------------------------------
	
//processed:     function interface AfterBuffTime takes player p returns nothing
  function s__Buff_timeout takes nothing returns nothing
   local integer this= sc__Buff__staticgetindex(GetExpiredTimer())
            call sc___prototype261_execute(s__Buff_ab[this],s__Buff_p[this])
            call sc__Buff_deallocate(this)
  endfunction
        function s__Buff__staticgetindex takes handle h returns integer
            return YDWEGetIntegerByString("TextTagBind" , I2S(YDWEH2I(h)))
        endfunction
        function s__Buff__staticsetindex takes handle h,integer value returns nothing
            call YDWESaveIntegerByString("TextTagBind" , I2S(YDWEH2I(h)) , value)
        endfunction
        function s__Buff_flush takes handle h returns nothing
            call YDWEFlushStoredIntegerByString("TextTagBind" , I2S(YDWEH2I(h)))
        endfunction
  function s__Buff_create takes player p,real time,integer ab returns integer
      local integer this= s__Buff__allocate()
			set s__Buff_p[this]=p
			set s__Buff_ab[this]=ab
			set s__Buff_t[this]=CreateTimer()
			call s__Buff__staticsetindex(s__Buff_t[this], (this))
			call TimerStart(s__Buff_t[this], time, false, function s__Buff_timeout)
			return this
  endfunction
  function s__Buff_onDestroy takes integer this returns nothing
			call s__Buff_flush(s__Buff_t[this])
			set s__Buff_p[this]=null
			set s__Buff_ab[this]=0
			call PauseTimer(s__Buff_t[this])
			call DestroyTimer(s__Buff_t[this])
			set s__Buff_t[this]=null
  endfunction

//Generated destructor of Buff
function s__Buff_deallocate takes integer this returns nothing
    if this==null then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: Buff")
        return
    elseif (si__Buff_V[this]!=-1) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: Buff")
        return
    endif
    call s__Buff_onDestroy(this)
    set si__Buff_V[this]=si__Buff_F
    set si__Buff_F=this
endfunction
//---------------------------------------------------------------------------------------------------
	
  function s__JudgeInvu_timeout takes nothing returns nothing
   local integer this= LoadInteger(LHTable, GetHandleId(GetExpiredTimer()), 1)
   local group g= null
			if ( IsUnitAliveBJ(s__JudgeInvu_u[this]) ) then
				set g=GetEnemyGroup(Player(10) , GetUnitX(s__JudgeInvu_u[this]) , GetUnitY(s__JudgeInvu_u[this]) , 900)
				if ( GetUnitAbilityLevel(s__JudgeInvu_u[this], 'Avul') < 1 and CountUnitsInGroup(g) == 0 ) then
					call UnitAddAbility(s__JudgeInvu_u[this], 'Avul')
					call PauseUnit(s__JudgeInvu_u[this], true)
					call SetUnitLifePercentBJ(s__JudgeInvu_u[this], 100)
				elseif ( GetUnitAbilityLevel(s__JudgeInvu_u[this], 'Avul') >= 1 and CountUnitsInGroup(g) != 0 ) then
					call UnitRemoveAbility(s__JudgeInvu_u[this], 'Avul')
					call PauseUnit(s__JudgeInvu_u[this], false)
				endif
				call DestroyGroup(g)
				set g=null
			else
            	call sc__JudgeInvu_deallocate(this)
			endif
  endfunction
  function s__JudgeInvu_create takes unit u,real time returns integer
      local integer this= s__JudgeInvu__allocate()
			set s__JudgeInvu_u[this]=u
			set s__JudgeInvu_t[this]=CreateTimer()
			call SaveInteger(LHTable, GetHandleId(s__JudgeInvu_t[this]), 1, this)
			call TimerStart(s__JudgeInvu_t[this], time, true, function s__JudgeInvu_timeout)
			return this
  endfunction
  function s__JudgeInvu_onDestroy takes integer this returns nothing
			call FlushChildHashtable(LHTable, GetHandleId(s__JudgeInvu_t[this]))
			set s__JudgeInvu_u[this]=null
			call PauseTimer(s__JudgeInvu_t[this])
			call DestroyTimer(s__JudgeInvu_t[this])
			set s__JudgeInvu_t[this]=null
  endfunction

//Generated destructor of JudgeInvu
function s__JudgeInvu_deallocate takes integer this returns nothing
    if this==null then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: JudgeInvu")
        return
    elseif (si__JudgeInvu_V[this]!=-1) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: JudgeInvu")
        return
    endif
    call s__JudgeInvu_onDestroy(this)
    set si__JudgeInvu_V[this]=si__JudgeInvu_F
    set si__JudgeInvu_F=this
endfunction
//---------------------------------------------------------------------------------------------------
	
  function s__Boom_move takes nothing returns nothing
   local integer this= LoadInteger(LHTable, GetHandleId(GetExpiredTimer()), 1)
			if ( GetDistance(GetUnitX(s__Boom_caster[this]) , GetUnitY(s__Boom_caster[this]) , s__Boom_x[this] , s__Boom_y[this]) > s__Boom_speed[this] ) then
				call SetUnitX(s__Boom_caster[this], GetUnitX(s__Boom_caster[this]) + CosBJ(s__Boom_facing[this]) * s__Boom_speed[this])
				call SetUnitY(s__Boom_caster[this], GetUnitY(s__Boom_caster[this]) + SinBJ(s__Boom_facing[this]) * s__Boom_speed[this])
			else
				call DamageAreaMirror(udg_H[GetConvertedPlayerId(GetOwningPlayer(s__Boom_caster[this]))] , s__Boom_x[this] , s__Boom_y[this] , s__Boom_radius[this] , s__Boom_damage[this])
				call DestroyEffect(AddSpecialEffect(s__Boom_effx[this], s__Boom_x[this], s__Boom_y[this]))
				call sc__Boom_deallocate(this)
			endif
  endfunction
  function s__Boom_create takes unit u,real x,real y,real facing,real damage,real speed,real radius,real inteval,string effx returns integer
      local integer this= s__Boom__allocate()
			set s__Boom_caster[this]=u
			set s__Boom_x[this]=x
			set s__Boom_y[this]=y
			set s__Boom_facing[this]=facing
			set s__Boom_damage[this]=damage
			set s__Boom_speed[this]=speed
			set s__Boom_radius[this]=radius
			set s__Boom_effx[this]=effx
			call SetUnitFacing(u, facing)
			set s__Boom_t[this]=CreateTimer()
			call SaveInteger(LHTable, GetHandleId(s__Boom_t[this]), 1, this)
			call TimerStart(s__Boom_t[this], inteval, true, function s__Boom_move)
			return this
  endfunction
  function s__Boom_onDestroy takes integer this returns nothing
			call FlushChildHashtable(LHTable, GetHandleId(s__Boom_t[this]))
			call RemoveUnit(s__Boom_caster[this])
			set s__Boom_caster[this]=null
			set s__Boom_x[this]=0.0
			set s__Boom_y[this]=0.0
			set s__Boom_facing[this]=0.0
			set s__Boom_damage[this]=0.0
			set s__Boom_speed[this]=0.0
			set s__Boom_radius[this]=0.0
			set s__Boom_effx[this]=null
			call PauseTimer(s__Boom_t[this])
			call DestroyTimer(s__Boom_t[this])
			set s__Boom_t[this]=null
  endfunction

//Generated destructor of Boom
function s__Boom_deallocate takes integer this returns nothing
    if this==null then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: Boom")
        return
    elseif (si__Boom_V[this]!=-1) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: Boom")
        return
    endif
    call s__Boom_onDestroy(this)
    set si__Boom_V[this]=si__Boom_F
    set si__Boom_F=this
endfunction

//library Structs ends
//library TouristTrap:
//---------------------------------------------------------------------------------------------------
	
 function TouristTrap___TTouristTrapSellCon takes nothing returns boolean
		return ( GetUnitTypeId(GetSellingUnit()) == 'uS01' )
	endfunction
 function TouristTrap___TTouristTrapSellAct takes nothing returns nothing
  local integer index= GetConvertedPlayerId(GetOwningPlayer(GetBuyingUnit()))
  local integer lumber
		if not ( HasCombineHalf[index] ) then
			call DisplayTextToPlayer(ConvertedPlayer(index), 0., 0., "|cFFFF66CC【消息】|r你从未合成过任一半超神器！")
			return
		endif
		if ( HasLiuli(GetBuyingUnit()) ) then
			set lumber=1000
		else
			set lumber=3000
		endif
		if ( GetPlayerState(GetOwningPlayer(GetBuyingUnit()), PLAYER_STATE_RESOURCE_LUMBER) < lumber ) then
			call DisplayTextToPlayer(ConvertedPlayer(index), 0., 0., "|cFFFF66CC【消息】|r你没有" + I2S(lumber) + "的木头！")
			return
		endif
		call AdjustPlayerStateBJ(- 1 * lumber, ConvertedPlayer(index), PLAYER_STATE_RESOURCE_LUMBER)
		call DisplayTextToPlayer(ConvertedPlayer(index), 0., 0., "|cFFFF66CC【消息】|r购买成功！")
//textmacro instance: GiveMaxShen("IXU2","olig")
			if ( ( GetItemTypeId(GetSoldItem()) == 'IXU2' ) ) then
				call UnitAddItemByIdSwapped('olig', GetBuyingUnit())
        		call SaveInteger(YDHT, GetHandleId(GetLastCreatedItem()), 0xA75AD423, GetConvertedPlayerId(GetOwningPlayer(GetBuyingUnit())))
	            return
			endif
//end of: GiveMaxShen("IXU2","olig")
//textmacro instance: GiveMaxShen("IXU3","srtl")
			if ( ( GetItemTypeId(GetSoldItem()) == 'IXU3' ) ) then
				call UnitAddItemByIdSwapped('srtl', GetBuyingUnit())
        		call SaveInteger(YDHT, GetHandleId(GetLastCreatedItem()), 0xA75AD423, GetConvertedPlayerId(GetOwningPlayer(GetBuyingUnit())))
	            return
			endif
//end of: GiveMaxShen("IXU3","srtl")
//textmacro instance: GiveMaxShen("IXU4","shhn")
			if ( ( GetItemTypeId(GetSoldItem()) == 'IXU4' ) ) then
				call UnitAddItemByIdSwapped('shhn', GetBuyingUnit())
        		call SaveInteger(YDHT, GetHandleId(GetLastCreatedItem()), 0xA75AD423, GetConvertedPlayerId(GetOwningPlayer(GetBuyingUnit())))
	            return
			endif
//end of: GiveMaxShen("IXU4","shhn")
//textmacro instance: GiveMaxShen("IXU5","flag")
			if ( ( GetItemTypeId(GetSoldItem()) == 'IXU5' ) ) then
				call UnitAddItemByIdSwapped('flag', GetBuyingUnit())
        		call SaveInteger(YDHT, GetHandleId(GetLastCreatedItem()), 0xA75AD423, GetConvertedPlayerId(GetOwningPlayer(GetBuyingUnit())))
	            return
			endif
//end of: GiveMaxShen("IXU5","flag")
//textmacro instance: GiveMaxShen("IXU6","shcw")
			if ( ( GetItemTypeId(GetSoldItem()) == 'IXU6' ) ) then
				call UnitAddItemByIdSwapped('shcw', GetBuyingUnit())
        		call SaveInteger(YDHT, GetHandleId(GetLastCreatedItem()), 0xA75AD423, GetConvertedPlayerId(GetOwningPlayer(GetBuyingUnit())))
	            return
			endif
//end of: GiveMaxShen("IXU6","shcw")
//textmacro instance: GiveMaxShen("IXU7","shtm")
			if ( ( GetItemTypeId(GetSoldItem()) == 'IXU7' ) ) then
				call UnitAddItemByIdSwapped('shtm', GetBuyingUnit())
        		call SaveInteger(YDHT, GetHandleId(GetLastCreatedItem()), 0xA75AD423, GetConvertedPlayerId(GetOwningPlayer(GetBuyingUnit())))
	            return
			endif
//end of: GiveMaxShen("IXU7","shtm")
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function TouristTrap___InitTouristTrap takes nothing returns nothing
  local trigger t= CreateTrigger()
		call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_SELL_ITEM)
		call TriggerAddCondition(t, Condition(function TouristTrap___TTouristTrapSellCon))
		call TriggerAddAction(t, function TouristTrap___TTouristTrapSellAct)
		set t=null
	endfunction

//library TouristTrap ends
//library UseItem:
//---------------------------------------------------------------------------------------------------
    
    function UseItem___TUseItem takes nothing returns nothing
        if ( ( GetItemTypeId(GetManipulatedItem()) == 'pomn' ) ) then
            call SetHeroLevelBJ(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))], ( GetHeroLevel(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]) + 50 ), true)
        elseif ( ( GetItemTypeId(GetManipulatedItem()) == 'I001' ) ) then
            call SetUnitLifeBJ(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))], ( GetUnitStateSwap(UNIT_STATE_LIFE, udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]) + 10000.00 ))
            call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\HealingWave\\HealingWaveTarget.mdl", GetUnitX(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]), GetUnitY(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))])))
        elseif ( ( GetItemTypeId(GetManipulatedItem()) == 'I02W' ) ) then
            call SetUnitLifeBJ(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))], ( GetUnitStateSwap(UNIT_STATE_LIFE, udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]) + 50000.00 ))
            call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\HealingWave\\HealingWaveTarget.mdl", GetUnitX(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]), GetUnitY(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))])))
        elseif ( ( GetItemTypeId(GetManipulatedItem()) == 'I000' ) ) then
            call SetUnitLifeBJ(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))], ( GetUnitStateSwap(UNIT_STATE_LIFE, udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]) + 250000.00 ))
            call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\HealingWave\\HealingWaveTarget.mdl", GetUnitX(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]), GetUnitY(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))])))
        elseif ( ( GetItemTypeId(GetManipulatedItem()) == 'I002' ) ) then
            call SetUnitLifeBJ(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))], ( GetUnitStateSwap(UNIT_STATE_LIFE, udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]) + 1250000.00 ))
            call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\HealingWave\\HealingWaveTarget.mdl", GetUnitX(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]), GetUnitY(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))])))
        elseif ( ( GetItemTypeId(GetManipulatedItem()) == 'I01D' ) ) then
            call SetUnitLifeBJ(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))], ( GetUnitStateSwap(UNIT_STATE_LIFE, udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]) + 20000000.00 ))
            call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\HealingWave\\HealingWaveTarget.mdl", GetUnitX(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]), GetUnitY(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))])))
        endif
    endfunction
//---------------------------------------------------------------------------------------------------
    function UseItem___InitUse takes nothing returns nothing
        local trigger t= CreateTrigger()
        call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_USE_ITEM)
        call TriggerAddAction(t, function UseItem___TUseItem)
        set t=null
    endfunction

//library UseItem ends
//library Wing:
//---------------------------------------------------------------------------------------------------
	
 function Wing__WingDialogClick takes nothing returns nothing
     local dialog d= GetClickedDialogBJ()
     local unit u= LoadUnitHandle(itemTable, GetHandleId(d), kWingUnit)
//textmacro instance: WingClick("1")
	        if ( GetClickedButtonBJ() == LoadButtonHandle(itemTable, GetHandleId(d), kWingDialog1) ) then
	        	call SetUnitX(u, GetRectCenterX(gg_rct____1))
	        	call SetUnitY(u, GetRectCenterY(gg_rct____1))
		        call PanCameraToTimedForPlayer(GetOwningPlayer(GetBuyingUnit()), GetRectCenterX(gg_rct____1), GetRectCenterY(gg_rct____1), 0.2)
		        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", GetRectCenterX(gg_rct____1), GetRectCenterY(gg_rct____1)))
		        call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r回去输入“HG”。")
	        endif
//end of: WingClick("1")
//textmacro instance: WingClick("2")
	        if ( GetClickedButtonBJ() == LoadButtonHandle(itemTable, GetHandleId(d), kWingDialog2) ) then
	        	call SetUnitX(u, GetRectCenterX(gg_rct____2))
	        	call SetUnitY(u, GetRectCenterY(gg_rct____2))
		        call PanCameraToTimedForPlayer(GetOwningPlayer(GetBuyingUnit()), GetRectCenterX(gg_rct____2), GetRectCenterY(gg_rct____2), 0.2)
		        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", GetRectCenterX(gg_rct____2), GetRectCenterY(gg_rct____2)))
		        call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r回去输入“HG”。")
	        endif
//end of: WingClick("2")
//textmacro instance: WingClick("3")
	        if ( GetClickedButtonBJ() == LoadButtonHandle(itemTable, GetHandleId(d), kWingDialog3) ) then
	        	call SetUnitX(u, GetRectCenterX(gg_rct____3))
	        	call SetUnitY(u, GetRectCenterY(gg_rct____3))
		        call PanCameraToTimedForPlayer(GetOwningPlayer(GetBuyingUnit()), GetRectCenterX(gg_rct____3), GetRectCenterY(gg_rct____3), 0.2)
		        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", GetRectCenterX(gg_rct____3), GetRectCenterY(gg_rct____3)))
		        call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r回去输入“HG”。")
	        endif
//end of: WingClick("3")
//textmacro instance: WingClick("4")
	        if ( GetClickedButtonBJ() == LoadButtonHandle(itemTable, GetHandleId(d), kWingDialog4) ) then
	        	call SetUnitX(u, GetRectCenterX(gg_rct____4))
	        	call SetUnitY(u, GetRectCenterY(gg_rct____4))
		        call PanCameraToTimedForPlayer(GetOwningPlayer(GetBuyingUnit()), GetRectCenterX(gg_rct____4), GetRectCenterY(gg_rct____4), 0.2)
		        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", GetRectCenterX(gg_rct____4), GetRectCenterY(gg_rct____4)))
		        call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r回去输入“HG”。")
	        endif
//end of: WingClick("4")
//textmacro instance: WingClick("5")
	        if ( GetClickedButtonBJ() == LoadButtonHandle(itemTable, GetHandleId(d), kWingDialog5) ) then
	        	call SetUnitX(u, GetRectCenterX(gg_rct____5))
	        	call SetUnitY(u, GetRectCenterY(gg_rct____5))
		        call PanCameraToTimedForPlayer(GetOwningPlayer(GetBuyingUnit()), GetRectCenterX(gg_rct____5), GetRectCenterY(gg_rct____5), 0.2)
		        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", GetRectCenterX(gg_rct____5), GetRectCenterY(gg_rct____5)))
		        call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r回去输入“HG”。")
	        endif
//end of: WingClick("5")
//textmacro instance: WingClick("6")
	        if ( GetClickedButtonBJ() == LoadButtonHandle(itemTable, GetHandleId(d), kWingDialog6) ) then
	        	call SetUnitX(u, GetRectCenterX(gg_rct____6))
	        	call SetUnitY(u, GetRectCenterY(gg_rct____6))
		        call PanCameraToTimedForPlayer(GetOwningPlayer(GetBuyingUnit()), GetRectCenterX(gg_rct____6), GetRectCenterY(gg_rct____6), 0.2)
		        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", GetRectCenterX(gg_rct____6), GetRectCenterY(gg_rct____6)))
		        call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r回去输入“HG”。")
	        endif
//end of: WingClick("6")
        call FlushChildHashtable(itemTable, GetHandleId(d))
    	call DialogDisplay(GetOwningPlayer(u), d, false)
        call DialogClear(d)
        call DialogDestroy(d)
        set d=null
        set u=null
        call DestroyTrigger(GetTriggeringTrigger())
	endfunction
 function CreateWingDialog takes unit u returns nothing
     local trigger t= CreateTrigger()
     local dialog d= DialogCreate()
	    call DialogSetMessage(d, "请选择进入的翅膀区")
	    call SaveButtonHandle(itemTable, GetHandleId(d), kWingDialog1, DialogAddButton(d, "翅膀1区", '1'))
	    call SaveButtonHandle(itemTable, GetHandleId(d), kWingDialog2, DialogAddButton(d, "翅膀2区", '2'))
	    call SaveButtonHandle(itemTable, GetHandleId(d), kWingDialog3, DialogAddButton(d, "翅膀3区", '3'))
	    call SaveButtonHandle(itemTable, GetHandleId(d), kWingDialog4, DialogAddButton(d, "翅膀4区", '4'))
	    call SaveButtonHandle(itemTable, GetHandleId(d), kWingDialog5, DialogAddButton(d, "翅膀5区", '5'))
	    call SaveButtonHandle(itemTable, GetHandleId(d), kWingDialog6, DialogAddButton(d, "翅膀6区", '6'))
	    call SaveUnitHandle(itemTable, GetHandleId(d), kWingUnit, u)
	    call DialogDisplay(GetOwningPlayer(u), d, true)
	    call TriggerRegisterDialogEvent(t, d)
	    call TriggerAddAction(t, function Wing__WingDialogClick)
	    set d=null
	    set t=null
	endfunction

//library Wing ends
//library Achievement:
//---------------------------------------------------------------------------------------------------
	
 function Int2Bin takes integer num returns string
  local string result= ""
  local integer mod= 0
  local integer number= num
  local integer i= 1
		loop
			exitwhen i > 31
			if ( number == 0 ) then
				set result="0" + result
			else
				set mod=ModuloInteger(number, 2)
				set result=I2S(mod) + result
				set number=number / 2
			endif
			set i=i + 1
		endloop
		if ( num < 0 ) then
			set result="1" + result
		else
			set result="0" + result
		endif
		return result
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Bin2Int takes string bin returns integer
  local integer i= StringLength(bin)
  local integer result= 0
  local integer mi= 0
		if ( i < 1 ) then
			return 0
		endif
		loop
			exitwhen i == 1
			set result=result + R2I(Pow(2, mi)) * S2I(SubStringBJ(bin, i, i))
			set mi=mi + 1
			set i=i - 1
		endloop
		if ( S2I(SubStringBJ(bin, 1, 1)) == 1 ) then
			set result=result * - 1
		endif
		return result
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetBinBit takes string bin,integer bit,boolean isOne returns string
  local string result
  local integer length= StringLength(bin)
		if ( length < bit or bit <= 0 ) then
			return bin
		endif
		set result=SubStringBJ(bin, 1, bit - 1)
		if ( isOne ) then
			set result=result + "1"
		else
			set result=result + "0"
		endif
		return result + SubStringBJ(bin, bit + 1, length)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetIntegerBit takes integer int,integer bit,boolean isOne returns integer
		return Bin2Int(SetBinBit(Int2Bin(int) , bit , isOne))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetIntegerBit takes integer int,integer bit returns integer
		return S2I(SubStringBJ(Int2Bin(int), bit, bit))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetIntegerHasOne takes integer num returns integer
  local integer result= 0
  local integer number= num
  local integer i= 1
		loop
			exitwhen i > 31
			set result=ModuloInteger(number, 2) + result
			set number=number / 2
			set i=i + 1
		endloop
		if ( num < 0 ) then
			set result=1 + result
		endif
		return result
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetSpecifyHeroTimes takes player p,integer heroIndex returns integer
		if ( heroIndex > 0 ) then
			return S2I(SubStringBJ(heroCountString[GetConvertedPlayerId(p)], 2 * heroIndex - 1, 2 * heroIndex))
		else
			return 0
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetLowerHeroCount takes player p,integer limit,integer number returns boolean
  local integer count= 0
  local integer i= 1
		loop
			exitwhen i > HERO_COUNT
			if ( GetSpecifyHeroTimes(p , i) >= limit ) then
				set count=count + 1
			endif
			set i=i + 1
		endloop
		return count >= number
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Achievement___GetAchievePage takes integer i returns integer
		return S2I(SubStringBJ(I2S(i), 1, 1))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Achievement___GetAchieveTarget takes integer i returns integer
		return S2I(SubStringBJ(I2S(i), 2, StringLength(I2S(i))))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Achievement___SaveSpinData takes player p returns nothing
		if ( Bdudang[GetConvertedPlayerId(p)] ) then
			call DzAPI_Map_StoreInteger(p , "spin" , spin[GetConvertedPlayerId(p)])
			call DzAPI_Map_StoreInteger(p , "spin2" , spin2[GetConvertedPlayerId(p)])
			call DzAPI_Map_StoreInteger(p , "spin3" , spin3[GetConvertedPlayerId(p)])
		else
			call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r本局游戏皮肤数据读取失败,请重新开始游戏.")
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetSpecifySpin takes player p,integer page,integer index returns nothing
  local integer judge= 0
		if ( page == 1 ) then
			set judge=spin[GetConvertedPlayerId(p)]
		elseif ( page == 2 ) then
			set judge=spin2[GetConvertedPlayerId(p)]
		elseif ( page == 3 ) then
			set judge=spin3[GetConvertedPlayerId(p)]
		endif
		if ( CType != 0 ) then
			return
		endif
		if ( GetBit(judge , index) < 1 ) then
			if ( page == 1 ) then
				set spin[GetConvertedPlayerId(p)]=spin[GetConvertedPlayerId(p)] + R2I(Pow(10, index - 1))
			elseif ( page == 2 ) then
				set spin2[GetConvertedPlayerId(p)]=spin2[GetConvertedPlayerId(p)] + R2I(Pow(10, index - 1))
			elseif ( page == 3 ) then
				set spin3[GetConvertedPlayerId(p)]=spin3[GetConvertedPlayerId(p)] + R2I(Pow(10, index - 1))
			endif
			call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r恭喜你成功获取皮肤\"" + GetHeroChallenageName(index , page) + "\"！")
			call Achievement___SaveSpinData(p)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Huoquspin takes player p,string chat returns nothing
  local integer i= 1
  local integer j= 1
  local integer result= 0
		loop
			exitwhen j > 3
			set i=1
			loop
				exitwhen i > 10
				if ( chat == I2S(GetCycleHash(playerName[GetConvertedPlayerId(p)] + "sp" + I2S(j) + I2S(i) , 1)) ) then
					call GetSpecifySpin(p , j , i)
					exitwhen true
				endif
				set i=i + 1
			endloop
			set j=j + 1
		endloop
		set BBuqian2=false
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetSeyu1Spin takes player p returns boolean
		return GetBit(spin[GetConvertedPlayerId(p)] , 2) > 0
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetSeyuSpinOK takes player p returns nothing
		call GetSpecifySpin(p , 1 , 2)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetXiaoyue1Spin takes player p returns boolean
		return GetBit(spin[GetConvertedPlayerId(p)] , 3) > 0
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetXiaoyueSpinOK takes player p returns nothing
		call GetSpecifySpin(p , 1 , 3)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetYanmie1Spin takes player p returns boolean
		return GetBit(spin[GetConvertedPlayerId(p)] , 4) > 0
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetYanmieSpinOK takes player p returns nothing
		call GetSpecifySpin(p , 1 , 4)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetXuanxue1Spin takes player p returns boolean
		return GetBit(spin[GetConvertedPlayerId(p)] , 5) > 0
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetXuanxue1SpinOK takes player p returns nothing
		call GetSpecifySpin(p , 1 , 5)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetTaiya1Spin takes player p returns boolean
		return GetBit(spin[GetConvertedPlayerId(p)] , 6) > 0
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetTaiyaSpinOK takes player p returns nothing
		call GetSpecifySpin(p , 1 , 6)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetChenji1Spin takes player p returns boolean
		return GetBit(spin[GetConvertedPlayerId(p)] , 7) > 0
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetChenji1SpinOK takes player p returns nothing
		call GetSpecifySpin(p , 1 , 7)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetHanshang1Spin takes player p returns boolean
		return GetBit(spin[GetConvertedPlayerId(p)] , 8) > 0
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetHanshang1SpinOK takes player p returns nothing
		call GetSpecifySpin(p , 1 , 8)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetLingxue1Spin takes player p returns boolean
		return GetBit(spin[GetConvertedPlayerId(p)] , 9) > 0
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetLingxueSpinOK takes player p returns nothing
		call GetSpecifySpin(p , 1 , 9)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetChenji2Spin takes player p returns boolean
		return GetBit(spin[GetConvertedPlayerId(p)] , 10) > 0
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetChenji2SpinOK takes player p returns nothing
		call GetSpecifySpin(p , 1 , 10)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetMoqiSpin takes player p returns boolean
		return GetBit(spin2[GetConvertedPlayerId(p)] , 1) > 0
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetMoqiSpinOK takes player p returns nothing
		call GetSpecifySpin(p , 2 , 1)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetKaisaSpin takes player p returns boolean
		return GetBit(spin2[GetConvertedPlayerId(p)] , 2) > 0
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetKaisaSpinOK takes player p returns nothing
		call GetSpecifySpin(p , 2 , 2)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetXuanxue2Spin takes player p returns boolean
		return GetBit(spin2[GetConvertedPlayerId(p)] , 3) > 0
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetXuanxue2SpinOK takes player p returns nothing
		call GetSpecifySpin(p , 2 , 3)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetSheyan1Spin takes player p returns boolean
		return GetBit(spin2[GetConvertedPlayerId(p)] , 4) > 0
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetSheyanSpinOK takes player p returns nothing
		call GetSpecifySpin(p , 2 , 4)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetBajue1Spin takes player p returns boolean
		return GetBit(spin2[GetConvertedPlayerId(p)] , 5) > 0
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetBajueSpinOK takes player p returns nothing
		call GetSpecifySpin(p , 2 , 5)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetHuanyi1Spin takes player p returns boolean
		return GetBit(spin2[GetConvertedPlayerId(p)] , 6) > 0
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetHuanyiSpinOK takes player p returns nothing
		call GetSpecifySpin(p , 2 , 6)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetSichen1Spin takes player p returns boolean
		return GetBit(spin2[GetConvertedPlayerId(p)] , 7) > 0
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetSichenSpinOK takes player p returns nothing
		call GetSpecifySpin(p , 2 , 7)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetCangling1Spin takes player p returns boolean
		return GetBit(spin2[GetConvertedPlayerId(p)] , 8) > 0
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetCanglingSpinOK takes player p returns nothing
		call GetSpecifySpin(p , 2 , 8)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetHeiyan1Spin takes player p returns boolean
		return GetBit(spin2[GetConvertedPlayerId(p)] , 9) > 0
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetHeiyanSpinOK takes player p returns nothing
		call GetSpecifySpin(p , 2 , 9)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetLichi1Spin takes player p returns boolean
		return GetBit(spin2[GetConvertedPlayerId(p)] , 10) > 0
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetLichiSpinOK takes player p returns nothing
		call GetSpecifySpin(p , 2 , 10)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetHanshang2Spin takes player p returns boolean
		return GetBit(spin3[GetConvertedPlayerId(p)] , 1) > 0
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetHanshang2SpinOK takes player p returns nothing
		call GetSpecifySpin(p , 3 , 1)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetXinglong1Spin takes player p returns boolean
		return GetBit(spin3[GetConvertedPlayerId(p)] , 2) > 0
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetXinglong1SpinOK takes player p returns nothing
		call GetSpecifySpin(p , 3 , 2)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsAchieveOK takes player p,integer achieveID returns boolean
  local integer id= GetConvertedPlayerId(p)
  local integer page= Achievement___GetAchievePage(achieveID)
  local integer target= Achievement___GetAchieveTarget(achieveID)
		if ( achieveID == 48 ) then
			return GetLowerHeroCount(p , 99 , HERO_COUNT)
		endif
		if ( page == 1 ) then
			return ( GetBit(achieve[id] , target) > 0 )
		elseif ( page == 2 ) then
			return ( GetIntegerBit(achieve2[id] , target) > 0 )
		elseif ( page == 3 ) then
			return ( GetIntegerBit(achieve3[id] , target) > 0 )
		elseif ( page == 4 ) then
			return ( GetIntegerBit(achieve4[id] , target) > 0 )
		endif
		return false
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsQuanchengjiu takes player p returns boolean
  local boolean result= true
  local integer i= 11
		loop
			exitwhen i > 18
			set result=result and IsAchieveOK(p , i)
			set i=i + 1
		endloop
		set i=21
		loop
			exitwhen i > 29
			set result=result and IsAchieveOK(p , i)
			set i=i + 1
		endloop
		set i=210
		loop
			exitwhen i > 231
			set result=result and IsAchieveOK(p , i)
			set i=i + 1
		endloop
		set i=32
		loop
			exitwhen i > 39
			set result=result and IsAchieveOK(p , i)
			set i=i + 1
		endloop
		set i=310
		loop
			exitwhen i > 318
			set result=result and IsAchieveOK(p , i)
			set i=i + 1
		endloop
		set i=320
		loop
			exitwhen i > 331
			set result=result and IsAchieveOK(p , i)
			set i=i + 1
		endloop
		set i=43
		loop
			exitwhen i > 46
			set result=result and IsAchieveOK(p , i)
			set i=i + 1
		endloop
		set result=result and IsAchieveOK(p , 49)
		set i=410
		loop
			exitwhen i > 417
			set result=result and IsAchieveOK(p , i)
			set i=i + 1
		endloop
		set i=421
		loop
			exitwhen i > 423
			set result=result and IsAchieveOK(p , i)
			set i=i + 1
		endloop
		return result
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetAchievement takes player p,integer achieveID returns nothing
  local integer id= GetConvertedPlayerId(p)
		if ( udg_H[id] == null ) then
			return
		endif
		if ( IsAchieveOK(p , achieveID) ) then
			set achiPage[id]=achieveID
			//彩名
			if ( IsAchieveColor(achieveID) ) then
				call SetPlayerName(p, GetAchievementName(achieveID) + GetRandomColor() + playerName[id] + "|r")
			elseif ( IsAchieveWhite(achieveID) ) then
				call SetPlayerName(p, GetAchievementName(achieveID) + playerName[id])
			else
				call SetPlayerName(p, GetAchievementName(achieveID) + playerName[id] + "|r")
			endif
			//特效
			if ( IsAchieveLight(achieveID) ) then
				if ( achiEff[id] != null ) then
					call DestroyEffect(achiEff[id])
				endif
				set achiEff[id]=AddSpecialEffectTargetUnitBJ("origin", udg_H[id], "war3mapImported\\lunhuitexiao.mdl")
			endif
			call DzAPI_Map_Stat_SetStat(p , "achi" , GetAchievementWhiteName(achieveID))
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SaveAchievePointer takes player p returns nothing
		call DzAPI_Map_StoreInteger(p , "page" , achiPage[GetConvertedPlayerId(p)])
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SaveAchieveData1 takes player p returns nothing
		call DzAPI_Map_StoreString(p , "achieve" , I2S(achieve[GetConvertedPlayerId(p)]))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SaveAchieveData2 takes player p returns nothing
		call DzAPI_Map_StoreInteger(p , "achieve2" , achieve2[GetConvertedPlayerId(p)])
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SaveAchieveData3 takes player p returns nothing
		call DzAPI_Map_StoreInteger(p , "achieve3" , achieve3[GetConvertedPlayerId(p)])
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SaveAchieveData4 takes player p returns nothing
		call DzAPI_Map_StoreInteger(p , "achieve4" , achieve4[GetConvertedPlayerId(p)])
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetAchievementAndSave takes player p,integer achieveID returns nothing
  local integer id= GetConvertedPlayerId(p)
		if ( udg_H[id] == null ) then
			return
		endif
		//两个仅有的挑战成就
		if ( ( achieveID == 410 or achieveID == 411 ) and CType == 0 ) then
			return
		endif
		if ( achieveID != 410 and achieveID != 411 and CType > 0 ) then
			return
		endif
		if ( achieveID != 418 and achieveID != 420 and CType == - 1 ) then
			return
		endif
		//两个超级成就
		if not ( IsAchieveOK(p , achieveID) ) then
			if ( Achievement___GetAchievePage(achieveID) == 1 ) then
				set achieve[id]=achieve[id] + R2I(Pow(10, I2R(achieveID - 11)))
			elseif ( Achievement___GetAchievePage(achieveID) == 2 ) then
				set achieve2[id]=SetIntegerBit(achieve2[id] , Achievement___GetAchieveTarget(achieveID) , true)
			elseif ( Achievement___GetAchievePage(achieveID) == 3 ) then
				set achieve3[id]=SetIntegerBit(achieve3[id] , Achievement___GetAchieveTarget(achieveID) , true)
			elseif ( Achievement___GetAchievePage(achieveID) == 4 ) then
				set achieve4[id]=SetIntegerBit(achieve4[id] , Achievement___GetAchieveTarget(achieveID) , true)
			endif
			call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r恭喜你获得成就\"" + GetAchievementName(achieveID) + "|r\",该成就会显示在游戏大厅内及你的名字前面.")
		    call SetAchievement(p , achieveID)
			call SaveAchieveData1(p)
			call SaveAchieveData2(p)
			call SaveAchieveData3(p)
			call SaveAchieveData4(p)
		    call SaveAchievePointer(p)
			call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r如果你想使用其他的成就，请输入\"-cj\"来切换你的现有成就。")
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function NextPageAchievement takes player p,dialog d,integer page returns nothing
     local integer i= 1
		if ( page == 1 ) then
		    loop
		    	exitwhen i > 8
		    	call SaveButtonHandle(LHTable, GetHandleId(d), i, DialogAddButtonBJ(d, GetAchievementName(i + 10) + S3(IsAchieveOK(p , i + 10) , "|cffff9900(已解锁)|r" , "|cff33cccc(未解锁)|r")))
		    	set i=i + 1
		    endloop
	    	call SaveButtonHandle(LHTable, GetHandleId(d), 9, DialogAddButtonBJ(d, GetAchievementName(325) + S3(IsAchieveOK(p , 325) , "|cffff9900(已解锁)|r" , "|cff33cccc(未解锁)|r")))
		elseif ( page == 2 ) then
		    loop
		    	exitwhen i > 8
		    	call SaveButtonHandle(LHTable, GetHandleId(d), i, DialogAddButtonBJ(d, GetAchievementName(i + 20) + S3(IsAchieveOK(p , i + 20) , "|cffff9900(已解锁)|r" , "|cff33cccc(未解锁)|r")))
		    	set i=i + 1
		    endloop
		elseif ( page == 3 ) then
		    loop
		    	exitwhen i > 7
		    	call SaveButtonHandle(LHTable, GetHandleId(d), i, DialogAddButtonBJ(d, GetAchievementName(217 - i) + S3(IsAchieveOK(p , 217 - i) , "|cffff9900(已解锁)|r" , "|cff33cccc(未解锁)|r")))
		    	set i=i + 1
		    endloop
	    	call SaveButtonHandle(LHTable, GetHandleId(d), 8, DialogAddButtonBJ(d, GetAchievementName(29) + S3(IsAchieveOK(p , 29) , "|cffff9900(已解锁)|r" , "|cff33cccc(未解锁)|r")))
		elseif ( page == 4 ) then
		    loop
		    	exitwhen i > 8
		    	call SaveButtonHandle(LHTable, GetHandleId(d), i, DialogAddButtonBJ(d, GetAchievementName(i + 216) + S3(IsAchieveOK(p , i + 216) , "|cffff9900(已解锁)|r" , "|cff33cccc(未解锁)|r")))
		    	set i=i + 1
		    endloop
		elseif ( page == 5 ) then
		    loop
		    	exitwhen i > 7
		    	call SaveButtonHandle(LHTable, GetHandleId(d), i, DialogAddButtonBJ(d, GetAchievementName(i + 224) + S3(IsAchieveOK(p , i + 224) , "|cffff9900(已解锁)|r" , "|cff33cccc(未解锁)|r")))
		    	set i=i + 1
		    endloop
	    	call SaveButtonHandle(LHTable, GetHandleId(d), 8, DialogAddButtonBJ(d, GetAchievementName(310) + S3(IsAchieveOK(p , 310) , "|cffff9900(已解锁)|r" , "|cff33cccc(未解锁)|r")))
		elseif ( page == 6 ) then
		    loop
		    	exitwhen i > 8
		    	call SaveButtonHandle(LHTable, GetHandleId(d), i, DialogAddButtonBJ(d, GetAchievementName(i + 31) + S3(IsAchieveOK(p , i + 31) , "|cffff9900(已解锁)|r" , "|cff33cccc(未解锁)|r")))
		    	set i=i + 1
		    endloop
		elseif ( page == 7 ) then
		    loop
		    	exitwhen i > 8
		    	call SaveButtonHandle(LHTable, GetHandleId(d), i, DialogAddButtonBJ(d, GetAchievementName(i + 310) + S3(IsAchieveOK(p , i + 310) , "|cffff9900(已解锁)|r" , "|cff33cccc(未解锁)|r")))
		    	set i=i + 1
		    endloop
		elseif ( page == 8 ) then
	    	call SaveButtonHandle(LHTable, GetHandleId(d), 1, DialogAddButtonBJ(d, GetAchievementName(326) + S3(IsAchieveOK(p , 326) , "|cffff9900(已解锁)|r" , "|cff33cccc(未解锁)|r")))
			set i=2
		    loop
		    	exitwhen i > 6
		    	call SaveButtonHandle(LHTable, GetHandleId(d), i, DialogAddButtonBJ(d, GetAchievementName(i + 318) + S3(IsAchieveOK(p , i + 318) , "|cffff9900(已解锁)|r" , "|cff33cccc(未解锁)|r")))
		    	set i=i + 1
		    endloop
    	    	call SaveButtonHandle(LHTable, GetHandleId(d), 7, DialogAddButtonBJ(d, GetAchievementName(327) + S3(IsAchieveOK(p , 327) , "|cffff9900(已解锁)|r" , "|cff33cccc(未解锁)|r")))
		elseif ( page == 9 ) then
			set i=1
		    loop
		    	exitwhen i > 4
		    	call SaveButtonHandle(LHTable, GetHandleId(d), i, DialogAddButtonBJ(d, GetAchievementName(i + 327) + S3(IsAchieveOK(p , i + 327) , "|cffff9900(已解锁)|r" , "|cff33cccc(未解锁)|r")))
		    	set i=i + 1
		    endloop
			set i=5
		    loop
		    	exitwhen i > 8
		    	call SaveButtonHandle(LHTable, GetHandleId(d), i, DialogAddButtonBJ(d, GetAchievementName(i + 38) + S3(IsAchieveOK(p , i + 38) , "|cffff9900(已解锁)|r" , "|cff33cccc(未解锁)|r")))
		    	set i=i + 1
		    endloop
		elseif ( page == 10 ) then
	    	call SaveButtonHandle(LHTable, GetHandleId(d), 1, DialogAddButtonBJ(d, GetAchievementName(49) + S3(IsAchieveOK(p , 49) , "|cffff9900(已解锁)|r" , "|cff33cccc(未解锁)|r")))
			set i=2
		    loop
		    	exitwhen i > 9
		    	call SaveButtonHandle(LHTable, GetHandleId(d), i, DialogAddButtonBJ(d, GetAchievementName(i + 408) + S3(IsAchieveOK(p , i + 408) , "|cffff9900(已解锁)|r" , "|cff33cccc(未解锁)|r")))
		    	set i=i + 1
		    endloop
		elseif ( page == 11 ) then
			set i=1
		    loop
		    	exitwhen i > 3
		    	call SaveButtonHandle(LHTable, GetHandleId(d), i, DialogAddButtonBJ(d, GetAchievementName(i + 420) + S3(IsAchieveOK(p , i + 420) , "|cffff9900(已解锁)|r" , "|cff33cccc(未解锁)|r")))
		    	set i=i + 1
		    endloop
		endif
    	call SaveButtonHandle(LHTable, GetHandleId(d), 17, DialogAddButtonBJ(d, "上一页"))
    	call SaveButtonHandle(LHTable, GetHandleId(d), 10, DialogAddButtonBJ(d, "下一页"))
    	call SaveButtonHandle(LHTable, GetHandleId(d), 11, DialogAddButton(d, "关闭|cffff6800(Esc)|r", 512))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CreateHeroDialogContent takes player p,dialog d,integer page returns nothing
  local integer i= 1
		if ( page == 1 ) then
			set i=2
			loop
				exitwhen i > 10
				call SaveButtonHandle(LHTable, GetHandleId(d), i, DialogAddButtonBJ(d, GetHeroChallenageName(i , 1) + S3(GetBit(spin[GetConvertedPlayerId(p)] , i) > 0 , "|cffff9900(已完成)|r" , "|cff33cccc(未完成)|r")))
				set i=i + 1
			endloop
		elseif ( page == 2 ) then
			set i=1
			loop
				exitwhen i > 10
				call SaveButtonHandle(LHTable, GetHandleId(d), i, DialogAddButtonBJ(d, GetHeroChallenageName(i , 2) + S3(GetBit(spin2[GetConvertedPlayerId(p)] , i) > 0 , "|cffff9900(已完成)|r" , "|cff33cccc(未完成)|r")))
				set i=i + 1
			endloop
		elseif ( page == 3 ) then
			set i=1
			loop
				exitwhen i > 2
				call SaveButtonHandle(LHTable, GetHandleId(d), i, DialogAddButtonBJ(d, GetHeroChallenageName(i , 3) + S3(GetBit(spin3[GetConvertedPlayerId(p)] , i) > 0 , "|cffff9900(已完成)|r" , "|cff33cccc(未完成)|r")))
				set i=i + 1
			endloop
		endif
    	call SaveButtonHandle(LHTable, GetHandleId(d), 14, DialogAddButtonBJ(d, "下一页"))
    	call SaveButtonHandle(LHTable, GetHandleId(d), 11, DialogAddButton(d, "关闭|cffff6800(Esc)|r", 512))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CreateSuperDialogContent takes player p,dialog d returns nothing
		call SaveButtonHandle(LHTable, GetHandleId(d), 1, DialogAddButtonBJ(d, GetSuperChallenageName(1) + S3(IsQuanchengjiu(p) , "|cffff9900(已完成)|r" , "|cff33cccc(未完成)|r")))
		call SaveButtonHandle(LHTable, GetHandleId(d), 2, DialogAddButtonBJ(d, GetSuperChallenageName(2) + S3(IsAchieveOK(p , 42) , "|cffff9900(已完成)|r" , "|cff33cccc(未完成)|r")))
		call SaveButtonHandle(LHTable, GetHandleId(d), 3, DialogAddButtonBJ(d, GetSuperChallenageName(3) + S3(IsAchieveOK(p , 47) , "|cffff9900(已完成)|r" , "|cff33cccc(未完成)|r")))
		call SaveButtonHandle(LHTable, GetHandleId(d), 4, DialogAddButtonBJ(d, GetSuperChallenageName(4) + S3(GetLowerHeroCount(p , 99 , HERO_COUNT) , "|cffff9900(已完成)|r" , "|cff33cccc(未完成)|r")))
		call SaveButtonHandle(LHTable, GetHandleId(d), 5, DialogAddButtonBJ(d, GetSuperChallenageName(5) + S3(IsAchieveOK(p , 418) , "|cffff9900(已完成)|r" , "|cff33cccc(未完成)|r")))
		call SaveButtonHandle(LHTable, GetHandleId(d), 6, DialogAddButtonBJ(d, GetSuperChallenageName(6) + S3(IsAchieveOK(p , 420) , "|cffff9900(已完成)|r" , "|cff33cccc(未完成)|r")))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function AchievementDialogClick takes nothing returns nothing
  local dialog d= GetClickedDialogBJ()
     local integer i= 1
     local integer page= LoadInteger(LHTable, GetHandleId(d), 12)
     local player p= LoadPlayerHandle(LHTable, GetHandleId(d), 13)
     local integer achieveID= LoadInteger(LHTable, GetHandleId(d), 14)
        //查看条件与设置
	    if ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), 15) ) then
	    	call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r" + GetAchievementName(achieveID) + "|r成就的获取条件如下所示:")
	    	call DisplayTextToPlayer(p, 0., 0., GetAchievementCondition(achieveID))
	    elseif ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), 16) ) then
	    	call SetAchievement(p , achieveID)
	    	call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r你成功地将成就设置成了" + GetAchievementName(achieveID) + ".")
	    	//保存到服务器
	    	call SaveAchievePointer(p)
	    endif
	    //退出
	    if ( ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), 11) ) or ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), 15) ) or ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), 16) ) ) then
            call DialogClear(d)
	        call FlushChildHashtable(LHTable, GetHandleId(d))
        	call DialogDisplay(p, d, false)
	        call DialogDestroy(d)
	        set d=null
	        set p=null
	        call DestroyTrigger(GetTriggeringTrigger())
	        return
	    endif
	    //下一页
	    if ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), 10) ) then
            call DialogClear(d)
	    	set page=I3(page < PAGE_ACHIEVE , page + 1 , 1)
    		call SaveInteger(LHTable, GetHandleId(d), 12, page)
	    	call DialogSetMessage(d, "我的成就|cffff6800(第" + I2S(page) + "/" + I2S(PAGE_ACHIEVE) + "页)|r\n	    		收集全部成就可以自定义成就名")
	    	call NextPageAchievement(p , d , page)
        	call DialogDisplay(p, d, true)
		    set d=null
		    set p=null
	    	return
	    endif
	    //上一页
	    if ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), 17) ) then
            call DialogClear(d)
	    	set page=I3(page <= 1 , PAGE_ACHIEVE , page - 1)
    		call SaveInteger(LHTable, GetHandleId(d), 12, page)
	    	call DialogSetMessage(d, "我的成就|cffff6800(第" + I2S(page) + "/" + I2S(PAGE_ACHIEVE) + "页)|r\n	    		收集全部成就可以自定义成就名")
	    	call NextPageAchievement(p , d , page)
        	call DialogDisplay(p, d, true)
		    set d=null
		    set p=null
	    	return
	    endif
	    //点击指定的成就
	    loop
	        exitwhen i > 9
	        if ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), i) ) then
                call DialogClear(d)
	        	set achieveID=GetAchievementIndex(page , i)
	    		call SaveInteger(LHTable, GetHandleId(d), 14, achieveID)
	    		call DialogSetMessage(d, GetAchievementName(achieveID) + S3(IsAchieveOK(p , achieveID) , "|cffff9900(已解锁)|r" , "|cff33cccc(未解锁)|r"))
		    	call SaveButtonHandle(LHTable, GetHandleId(d), 15, DialogAddButtonBJ(d, "查看获取条件"))
		    	if ( IsAchieveOK(p , achieveID) ) then
		    		call SaveButtonHandle(LHTable, GetHandleId(d), 16, DialogAddButtonBJ(d, "使用该成就"))
		    	endif
		    	call SaveButtonHandle(LHTable, GetHandleId(d), 11, DialogAddButton(d, "关闭|cffff6800(Esc)|r", 512))
	            exitwhen true
	        endif
	        set i=i + 1
	    endloop
        call DialogDisplay(p, d, true)
	    set d=null
	    set p=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function HeroDialogClick takes nothing returns nothing
  local dialog d= GetClickedDialogBJ()
     local player p= LoadPlayerHandle(LHTable, GetHandleId(d), 13)
     local integer page= LoadInteger(LHTable, GetHandleId(d), 12)
  local integer i= 1
	    //退出
	    if ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), 11) ) then
            call DialogClear(d)
	        call FlushChildHashtable(LHTable, GetHandleId(d))
        	call DialogDisplay(p, d, false)
	        call DialogDestroy(d)
	        set d=null
	        set p=null
	        call DestroyTrigger(GetTriggeringTrigger())
	        return
	    endif
	    //下一页
	    if ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), 14) ) then
            call DialogClear(d)
	    	set page=I3(page < PAGE_HERO_CHALLANGER , page + 1 , 1)
	    	call DialogSetMessage(d, "英雄挑战|cffff6800(第" + I2S(page) + "/" + I2S(PAGE_HERO_CHALLANGER) + "页)|r")
    		call SaveInteger(LHTable, GetHandleId(d), 12, page)
	    	call CreateHeroDialogContent(p , d , page)
        	call DialogDisplay(p, d, true)
		    set d=null
		    set p=null
	    	return
	    endif
	    //点击
	    loop
	        exitwhen i > 10
	        if ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), i) ) then
                call DialogClear(d)
		    	call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r" + GetHeroChallenageName(i , page) + "|r英雄挑战的条件如下所示:")
		    	call DisplayTextToPlayer(p, 0., 0., GetHeroChallenageContent(i , page))
	            exitwhen true
	        endif
	        set i=i + 1
	    endloop
        call DialogClear(d)
        call FlushChildHashtable(LHTable, GetHandleId(d))
    	call DialogDisplay(p, d, false)
        call DialogDestroy(d)
        set d=null
        set p=null
        call DestroyTrigger(GetTriggeringTrigger())
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SuperAchievementClick takes nothing returns nothing
  local dialog d= GetClickedDialogBJ()
     local player p= LoadPlayerHandle(LHTable, GetHandleId(d), 13)
  local integer i= 1
	    loop
	        exitwhen i > 9
	        if ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), i) ) then
                call DialogClear(d)
		    	call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r" + GetSuperChallenageName(i) + "|r超级成就的完成条件如下所示:")
		    	call DisplayTextToPlayer(p, 0., 0., GetSuperChallenageContent(i))
		    	if ( i == 2 ) then
	    			call SetAchievement(p , 42)
	    			call SaveAchievePointer(p)
		    	elseif ( i == 3 ) then
	    			call SetAchievement(p , 47)
	    			call SaveAchievePointer(p)
		    	elseif ( i == 4 ) then
	    			call SetAchievement(p , 48)
	    			call SaveAchievePointer(p)
		    	elseif ( i == 5 ) then
	    			call SetAchievement(p , 418)
	    			call SaveAchievePointer(p)
		    	elseif ( i == 6 ) then
	    			call SetAchievement(p , 420)
	    			call SaveAchievePointer(p)
		    	endif
	            exitwhen true
	        endif
	        set i=i + 1
	    endloop
        call DialogClear(d)
        call FlushChildHashtable(LHTable, GetHandleId(d))
    	call DialogDisplay(p, d, false)
        call DialogDestroy(d)
        set d=null
        set p=null
        call DestroyTrigger(GetTriggeringTrigger())
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CreateAchievementDialog takes player p returns nothing
     local trigger t= CreateTrigger()
     local dialog d= DialogCreate()
	    call DialogSetMessage(d, "我的成就|cffff6800(第1/" + I2S(PAGE_ACHIEVE) + "页)|r\n	    	收集全部成就可以自定义成就名")
	    call NextPageAchievement(p , d , 1)
    	call SaveButtonHandle(LHTable, GetHandleId(d), 15, null)
    	call SaveButtonHandle(LHTable, GetHandleId(d), 16, null)
    	call SaveInteger(LHTable, GetHandleId(d), 12, 1)
	    call SavePlayerHandle(LHTable, GetHandleId(d), 13, p)
	    call SaveInteger(LHTable, GetHandleId(d), 14, 10)
	    call DialogDisplay(p, d, true)
	    call TriggerRegisterDialogEvent(t, d)
	    call TriggerAddAction(t, function AchievementDialogClick)
	    set d=null
	    set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CreateHeroChallenagerDialog takes player p returns nothing
  local trigger t= CreateTrigger()
     local dialog d= DialogCreate()
	    call DialogSetMessage(d, "英雄挑战|cffff6800(第1/" + I2S(PAGE_HERO_CHALLANGER) + "页)|r")
	    call CreateHeroDialogContent(p , d , 1)
	    call SavePlayerHandle(LHTable, GetHandleId(d), 13, p)
	    call SaveInteger(LHTable, GetHandleId(d), 12, 1)
	    call DialogDisplay(p, d, true)
	    call TriggerRegisterDialogEvent(t, d)
	    call TriggerAddAction(t, function HeroDialogClick)
	    set d=null
	    set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CreateSuperAchievementDialog takes player p returns nothing
  local trigger t= CreateTrigger()
     local dialog d= DialogCreate()
	    call DialogSetMessage(d, "超级成就")
	    call CreateSuperDialogContent(p , d)
	    call SavePlayerHandle(LHTable, GetHandleId(d), 13, p)
	    call DialogDisplay(p, d, true)
	    call TriggerRegisterDialogEvent(t, d)
	    call TriggerAddAction(t, function SuperAchievementClick)
	    set d=null
	    set t=null
	endfunction

//library Achievement ends
//library Aura:
//---------------------------------------------------------------------------------------------------
	
 function Aura___TSpellYanmie3Con takes nothing returns boolean
		return udg_H[GetConvertedPlayerId(GetOwningPlayer(GetKillingUnitBJ()))] != null and ( IsUnitType(GetDyingUnit(), UNIT_TYPE_STRUCTURE) != true ) and ( IsUnitIllusionBJ(GetDyingUnit()) != true ) and ( GetUnitPointValue(GetDyingUnit()) != 0 ) and ( GetUnitTypeId(GetDyingUnit()) != 'h000' ) and ( IsUnitAlly(GetDyingUnit(), GetOwningPlayer(GetKillingUnitBJ())) != true ) and ( GetPlayerController(GetOwningPlayer(GetKillingUnitBJ())) == MAP_CONTROL_USER )
	endfunction
 function Aura___TSpellYanmie3Act takes nothing returns nothing
  local integer i= GetKillCount(GetDyingUnit())
  local integer index= GetConvertedPlayerId(GetOwningPlayer(GetKillingUnitBJ()))
		set Aura___YKillCount[index]=Aura___YKillCount[index] + i
		if ( Aura___YKillCount[index] >= 100 ) then
			call AddHero3W(udg_H[index] , GetHeroLevel(udg_H[index]) + 200)
			set Aura___YKillCount[index]=0
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitKaisaAura takes nothing returns nothing
		call UnitAddAbility(gg_unit_n01S_0258, 'A0JU')
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitYanmieAura takes nothing returns nothing
		set Aura___TSpellYanmie3=CreateTrigger()
		call TriggerRegisterAnyUnitEventBJ(Aura___TSpellYanmie3, EVENT_PLAYER_UNIT_DEATH)
		call TriggerAddCondition(Aura___TSpellYanmie3, Condition(function Aura___TSpellYanmie3Con))
		call TriggerAddAction(Aura___TSpellYanmie3, function Aura___TSpellYanmie3Act)
		//湮灭新光环Todo
		call UnitAddAbility(gg_unit_n01S_0258, 'A0HF')
		call BJDebugMsg("|cffff66cc【消息】|r你已获得来自|cFF3333FF雷神寂灭|r光环的效果,杀怪可以增加|cffffff00(英雄等级/100 + 2)点全属性|r.")
		call BJDebugMsg("|cffff66cc【消息】|r你已获得来自|cFF3333FF雷神寂灭|r光环的效果,杀怪可以增加|cffffff00(英雄等级/100 + 2)点全属性|r.")
		call BJDebugMsg("|cffff66cc【消息】|r你已获得来自|cFF3333FF雷神寂灭|r光环的效果,杀怪可以增加|cffffff00(英雄等级/100 + 2)点全属性|r.")
		call BJDebugMsg("|cffff66cc【消息】|r你已获得来自|cFF3333FF雷神寂灭|r光环的效果,杀怪可以增加|cffffff00(英雄等级/100 + 2)点全属性|r.")
		call BJDebugMsg("|cffff66cc【消息】|r你已获得来自|cFF3333FF雷神寂灭|r光环的效果,杀怪可以增加|cffffff00(英雄等级/100 + 2)点全属性|r.")
		endfunction
//---------------------------------------------------------------------------------------------------
	
 function Aura___SanchuanShunTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local integer playerID= LoadInteger(spellTable, GetHandleId(t), 1)
		if not ( Aura___shunHints[playerID] ) then
			call DisplayTextToPlayer(ConvertedPlayer(playerID), 0., 0., "|cffff66cc【消息】|r你已获得来自|cffffff00阴阳三川箭|r光环的效果,|cffffcc00使用M键可以瞬移至任意地点|r,冷却2.5s.")
		else
			call PauseTimer(t)
			call FlushChildHashtable(spellTable, id)
			call DestroyTimer(t)
		endif
		set t=null
	endfunction
 function Aura___InitShunyi takes nothing returns nothing
  local timer t= null
  local integer i= 1
		loop
			exitwhen i > 6
			if ( udg_H[i] != null ) then
				set t=CreateTimer()
				call SaveInteger(spellTable, GetHandleId(t), 1, i)
				call TimerStart(t, 4, true, function Aura___SanchuanShunTimer)
				set Aura___shunHints[i]=false
    			call TriggerRegisterUnitEvent(Aura___TSpellMengji3, udg_H[i], EVENT_UNIT_ISSUED_POINT_ORDER)
			endif
			set i=i + 1
		endloop
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Aura___TSpellMengji3Con takes nothing returns boolean
	    return ( ( GetIssuedOrderIdBJ() == String2OrderIdBJ("move") ) and ( not ( Aura___shunHints[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] ) ) )
	endfunction
 function Aura___TSpellMengji3Act takes nothing returns nothing
		if ( IsInForbitRegion(GetOrderPointX() , GetOrderPointY() , GetTriggerUnit()) ) then
			call IssueImmediateOrder(GetTriggerUnit(), "stop")
	        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, "|cFFFF66CC【消息】|r此处禁止瞬移到达.")
	        return
		endif
	    if ( IsTerrainPathable(GetOrderPointX(), GetOrderPointY(), PATHING_TYPE_WALKABILITY) ) then
	    	call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【消息】|r目标地点不能通行,瞬移失败！")
	    	return
	    endif
		set Aura___shunHints[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]=true
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\Blink\\BlinkCaster.mdl", GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit())))
		call SetUnitX(GetTriggerUnit(), GetOrderPointX())
		call SetUnitY(GetTriggerUnit(), GetOrderPointY())
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\Blink\\BlinkCaster.mdl", GetOrderPointX(), GetOrderPointY()))
		call YDWEPolledWaitNull(2.5)
		set Aura___shunHints[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]=false
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitXiaoyueAura takes nothing returns nothing
		call UnitAddAbilityBJ('A0AJ', gg_unit_n01S_0258)
	    call EnableTrigger(gg_trg_____________71)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitXuanxueAura takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > 6
			call AddDamagePercent(i , 0.4)
			set i=i + 1
		endloop
		call UnitAddAbility(gg_unit_n01S_0258, 'A0JV')
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitBajueAura takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > 6
			call AddStrPercent(i , 0.4)
			set i=i + 1
		endloop
		call UnitAddAbility(gg_unit_n01S_0258, 'AOae')
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitSeyuAura takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > 6
			call AddAgiPercent(i , 0.4)
			set i=i + 1
		endloop
		call UnitAddAbility(gg_unit_n01S_0258, 'A0JW')
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitMoqiAura takes nothing returns nothing
		call UnitAddAbility(gg_unit_n01S_0258, 'A04I')
		call EnableTrigger(gg_trg_______21)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitLingxueAura takes nothing returns nothing
	    call UnitAddAbilityBJ('A0FY', gg_unit_n01S_0258)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitChenjiAura takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > 6
			call AddDefensePercent(i , 0.4)
			set i=i + 1
		endloop
		call UnitAddAbility(gg_unit_n01S_0258, 'A0JX')
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitHanshangAura takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > 6
            call AddMoneyPercent(i , 0.5)
			set i=i + 1
		endloop
		call UnitAddAbility(gg_unit_n01S_0258, 'A0JY')
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitTaiyaAura takes nothing returns nothing
		call UnitAddAbility(gg_unit_n01S_0258, 'A0JZ')
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitSheyanAura takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > 6
            call AddIntPercent(i , 0.4)
			set i=i + 1
		endloop
		call UnitAddAbility(gg_unit_n01S_0258, 'A0K0')
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitHeiyanAura takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > 6
			call AddHPPercent(i , 0.5)
			set i=i + 1
		endloop
		call UnitAddAbility(gg_unit_n01S_0258, 'A0GR')
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitCanglingAura takes nothing returns nothing
		call UnitAddAbility(gg_unit_n01S_0258, 'A0HR')
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitMengjiAura takes nothing returns nothing
	    //英雄第三个技能瞬移事件
	    set Aura___TSpellMengji3=CreateTrigger()
	    call TriggerAddCondition(Aura___TSpellMengji3, Condition(function Aura___TSpellMengji3Con))
	    call TriggerAddAction(Aura___TSpellMengji3, function Aura___TSpellMengji3Act)
		call UnitAddAbility(gg_unit_n01S_0258, 'A0EL')
		call Aura___InitShunyi()
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitHuanyiAura takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > 6
			call AddSpellPercent(i , 0.6)
			set i=i + 1
		endloop
		call UnitAddAbility(gg_unit_n01S_0258, 'A0GS')
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitSichenAura takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > 6
			call AddStrPercent(i , 0.2)
			call AddAgiPercent(i , 0.2)
			call AddIntPercent(i , 0.2)
			set i=i + 1
		endloop
		call UnitAddAbility(gg_unit_n01S_0258, 'A0JE')
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitXiaotingAura takes nothing returns nothing
		call UnitAddAbility(gg_unit_n01S_0258, 'A0M5')
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitLichiAura takes nothing returns nothing
		call UnitAddAbility(gg_unit_n01S_0258, 'A0MR')
		call UnitAddAbility(gg_unit_n01S_0258, 'A0MS')
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitSpecifyAura takes unit u returns nothing
  local integer index= GetHeroIndex(GetUnitTypeId(u))
		if ( index == 1 ) then
			call InitKaisaAura()
		elseif ( index == 2 ) then
			call InitYanmieAura()
		elseif ( index == 3 ) then
			call InitMoqiAura()
		elseif ( index == 4 ) then
			call InitXuanxueAura()
		elseif ( index == 5 ) then
			call InitBajueAura()
		elseif ( index == 6 ) then
			call InitSeyuAura()
		elseif ( index == 7 ) then
			call InitXiaoyueAura()
		elseif ( index == 8 ) then
			call InitLingxueAura()
		elseif ( index == 9 ) then
			call InitChenjiAura()
		elseif ( index == 10 ) then
			call InitHanshangAura()
		elseif ( index == 11 ) then
			call InitTaiyaAura()
		elseif ( index == 12 ) then
			call InitSheyanAura()
		elseif ( index == 13 ) then
			call InitHeiyanAura()
		elseif ( index == 14 ) then
			call InitMengjiAura()
		elseif ( index == 15 ) then
			call InitHuanyiAura()
		elseif ( index == 16 ) then
			call InitCanglingAura()
		elseif ( index == 17 ) then
			call InitSichenAura()
		elseif ( index == 19 ) then
			call InitXiaotingAura()
		elseif ( index == 20 ) then
			call InitLichiAura()
		endif
	endfunction

//library Aura ends
//library ItemAttr:
//---------------------------------------------------------------------------------------------------
	
 function ItemAttr___SetItemStr takes integer itemID,integer value returns nothing
		call SaveInteger(YDHT, itemID, 0x8D205575, value)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemAttr___SetItemAgi takes integer itemID,integer value returns nothing
		call SaveInteger(YDHT, itemID, 0x384C9D86, value)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemAttr___SetItemInt takes integer itemID,integer value returns nothing
		call SaveInteger(YDHT, itemID, 0x1B5C932E, value)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemAttr___SetItem3W takes integer itemID,integer value returns nothing
		call SaveInteger(YDHT, itemID, 0x5BAE281D, value)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemAttr___SetItemHP takes integer itemID,integer value returns nothing
		call SaveInteger(YDHT, itemID, 0xFCD961C9, value)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemAttr___SetItemDefense takes integer itemID,integer value returns nothing
		call SaveInteger(YDHT, itemID, 0x81FD3994, value)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemAttr___SetItemAttack takes integer itemID,integer value returns nothing
		call SaveInteger(YDHT, itemID, 0x5039AFFB, value)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemAttr___SetItemXixue takes integer itemID,integer value returns nothing
		call SaveInteger(YDHT, itemID, 0x1ADEDE7B, value)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemAttr___SetItemZhishang takes integer itemID,integer value returns nothing
		call SaveInteger(YDHT, itemID, 0xA6870C96, value)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemAttr___SetItemFanji takes integer itemID,integer value returns nothing
		call SaveInteger(YDHT, itemID, 0x0F3DF677, value)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemAttr___SetItemStrPerc takes integer itemID,real value returns nothing
		call SaveReal(YDHT, itemID, 0x06C64278, value)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemAttr___SetItemAgiPerc takes integer itemID,real value returns nothing
		call SaveReal(YDHT, itemID, 0x6FFF4132, value)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemAttr___SetItemIntPerc takes integer itemID,real value returns nothing
		call SaveReal(YDHT, itemID, 0xC0C6918C, value)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemAttr___SetItemAttackPerc takes integer itemID,real value returns nothing
		call SaveReal(YDHT, itemID, 0x4C0507D9, value)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemAttr___SetItemSpellPerc takes integer itemID,real value returns nothing
		call SaveReal(YDHT, itemID, 0xF374F3BD, value)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemAttr___SetItemDamagePerc takes integer itemID,real value returns nothing
		call SaveReal(YDHT, itemID, 0xA3BA0D94, value)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemAttr___SetItemJingyan takes integer itemID,real value returns nothing
		call SaveReal(YDHT, itemID, 0x3EBF688A, value)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemAttr___SetItemHPPer takes integer itemID,real value returns nothing
		call SaveReal(YDHT, itemID, 0xFAA305CD, value)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemAttr___SetItemDefensePer takes integer itemID,real value returns nothing
		call SaveReal(YDHT, itemID, 0x0B6FB20F, value)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemAttr___InitErdianQi takes nothing returns nothing
		
		call ItemAttr___SetItemStrPerc('I049' , 0.2)
		call ItemAttr___SetItemAgiPerc('I049' , 0.2)
		call ItemAttr___SetItemIntPerc('I049' , 0.2)
		call ItemAttr___SetItemAttackPerc('I049' , 0.5)
		call ItemAttr___SetItemSpellPerc('I049' , 0.4)
		call ItemAttr___SetItemDamagePerc('I049' , 0.2)
		call ItemAttr___SetItemStrPerc('I04A' , 1)
		call ItemAttr___SetItemAgiPerc('I04A' , 1)
		call ItemAttr___SetItemIntPerc('I04A' , 1)
		call ItemAttr___SetItemAttackPerc('I04A' , 1)
		call ItemAttr___SetItemSpellPerc('I04A' , 1)
		call ItemAttr___SetItemDamagePerc('I04A' , 0.4)
		
		call ItemAttr___SetItemStr('ciri' , 400000)
		call ItemAttr___SetItemAgi('ciri' , 400000)
		call ItemAttr___SetItemInt('ciri' , 400000)
		call ItemAttr___SetItemDefense('ciri' , 20000)
		call ItemAttr___SetItemHP('ciri' , 9000000)
		call ItemAttr___SetItemSpellPerc('ciri' , 0.8)
		call ItemAttr___SetItemDamagePerc('ciri' , 0.25)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemAttr___InitErdianBa takes nothing returns nothing
		
		call ItemAttr___SetItemStr('tlum' , 320000)
		call ItemAttr___SetItemAgi('tlum' , 470000)
		call ItemAttr___SetItemInt('tlum' , 420000)
		call ItemAttr___SetItemSpellPerc('tlum' , 1.3)
		call ItemAttr___SetItemXixue('tlum' , 40000)
		call ItemAttr___SetItemZhishang('tlum' , 8000000)
		call ItemAttr___SetItemAttack('tlum' , 2000000)
		
		call ItemAttr___SetItem3W('rat9' , 3000)
	    call ItemAttr___SetItem3W('rlif' , 9000)
	    call ItemAttr___SetItem3W('lgdh' , 18000)
	    call ItemAttr___SetItem3W('clfm' , 30000)
	    call ItemAttr___SetItem3W('bgst' , 45000)
	    call ItemAttr___SetItem3W('belv' , 63000)
	    call ItemAttr___SetItem3W('hcun' , 84000)
	    call ItemAttr___SetItem3W('rag1' , 108000)
	    call ItemAttr___SetItem3W('penr' , 135000)
	    call ItemAttr___SetItem3W('brac' , 165000)
	    call ItemAttr___SetItem3W('lhst' , 240000)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemAttr___InitDengClothes takes nothing returns nothing
		//灯
	    call ItemAttr___SetItem3W('ILI1' , 1000)
	    call ItemAttr___SetItem3W('ILI2' , 3000)
	    call ItemAttr___SetItem3W('ILI3' , 7500)
	    call ItemAttr___SetItem3W('ILI4' , 15000)
	    call ItemAttr___SetItem3W('ILI5' , 25000)
	    call ItemAttr___SetItem3W('ILI6' , 40000)
	    call ItemAttr___SetItem3W('ILI7' , 60000)
	    call ItemAttr___SetItem3W('ILI8' , 80000)
	    call ItemAttr___SetItem3W('ILI9' , 120000)
	    call ItemAttr___SetItem3W('ILIA' , 150000)
	    call ItemAttr___SetItem3W('ILIB' , 180000)
	    call ItemAttr___SetItem3W('ILIC' , 200000)
	    call ItemAttr___SetItem3W('ILID' , 220000)
	    call ItemAttr___SetItem3W('ILIE' , 250000)
	    call ItemAttr___SetItem3W('ILIF' , 290000)
	    call ItemAttr___SetItem3W('ILIG' , 340000)
	    call ItemAttr___SetItem3W('ILIH' , 380000)
	    call ItemAttr___SetItem3W('ILII' , 420000)
	    call ItemAttr___SetItem3W('ILIJ' , 450000)
	    call ItemAttr___SetItem3W('ILIK' , 490000)
	    call ItemAttr___SetItem3W('I07D' , 530000)
		call ItemAttr___SetItemXixue('ILI3' , 8000)
		call ItemAttr___SetItemXixue('ILI4' , 16000)
		call ItemAttr___SetItemXixue('ILI5' , 25000)
		call ItemAttr___SetItemXixue('ILI6' , 34000)
		call ItemAttr___SetItemXixue('ILI7' , 50000)
		call ItemAttr___SetItemXixue('ILI8' , 100000)
		call ItemAttr___SetItemXixue('ILI9' , 200000)
		call ItemAttr___SetItemXixue('ILIA' , 300000)
		call ItemAttr___SetItemXixue('ILIB' , 400000)
		call ItemAttr___SetItemXixue('ILIC' , 600000)
		call ItemAttr___SetItemXixue('ILID' , 800000)
		call ItemAttr___SetItemXixue('ILIE' , 1000000)
		call ItemAttr___SetItemXixue('ILIF' , 1300000)
		call ItemAttr___SetItemXixue('ILIG' , 1500000)
		call ItemAttr___SetItemXixue('ILIH' , 1800000)
		call ItemAttr___SetItemXixue('ILII' , 2200000)
		call ItemAttr___SetItemXixue('ILIJ' , 2800000)
		call ItemAttr___SetItemXixue('ILIK' , 3300000)
		call ItemAttr___SetItemXixue('I07D' , 4000000)
		//衣服
	    call ItemAttr___SetItemDefense('rej6' , 1500)
	    call ItemAttr___SetItemDefense('dtsb' , 2000)
	    call ItemAttr___SetItemDefense('tels' , 3000)
		call ItemAttr___SetItemDefense('ofir' , 3800)
		call ItemAttr___SetItemDefense('soul' , 5000)
		call ItemAttr___SetItemDefense('sbok' , 6000)
		call ItemAttr___SetItemDefense('arsc' , 9500)
		call ItemAttr___SetItemDefense('rde0' , 13000)
		call ItemAttr___SetItemDefense('oflg' , 13000)
		call ItemAttr___SetItemDefense('frgd' , 16000)
		call ItemAttr___SetItemDefense('rej4' , 2000)
		call ItemAttr___SetItemDefense('drph' , 3000)
		call ItemAttr___SetItemDefense('oven' , 3800)
		call ItemAttr___SetItemDefense('frhg' , 5000)
		call ItemAttr___SetItemDefense('mlst' , 6000)
		call ItemAttr___SetItemDefense('nspi' , 7000)
		call ItemAttr___SetItemDefense('oli2' , 10500)
		call ItemAttr___SetItemDefense('rump' , 13000)
		call ItemAttr___SetItemDefense('shen' , 15000)
		call ItemAttr___SetItemDefense('stpg' , 19000)
		call ItemAttr___SetItemDefense('pgin' , 1500)
		call ItemAttr___SetItemDefense('gobm' , 2000)
		call ItemAttr___SetItemDefense('gvsm' , 3000)
		call ItemAttr___SetItemDefense('gldo' , 3800)
		call ItemAttr___SetItemDefense('gsou' , 5000)
		call ItemAttr___SetItemDefense('envl' , 6000)
		call ItemAttr___SetItemDefense('rugt' , 7000)
		call ItemAttr___SetItemDefense('shdt' , 11000)
		call ItemAttr___SetItemDefense('crdt' , 13000)
		call ItemAttr___SetItemDefense('pspd' , 16000)
	    call ItemAttr___SetItemHP('rej6' , 200000)
		call ItemAttr___SetItemHP('dtsb' , 300000)
		call ItemAttr___SetItemHP('tels' , 400000)
		call ItemAttr___SetItemHP('ofir' , 500000)
		call ItemAttr___SetItemHP('soul' , 600000)
		call ItemAttr___SetItemHP('sbok' , 1750000)
		call ItemAttr___SetItemHP('arsc' , 2950000)
		call ItemAttr___SetItemHP('rde0' , 4200000)
		call ItemAttr___SetItemHP('oflg' , 4500000)
		call ItemAttr___SetItemHP('frgd' , 6000000)
		call ItemAttr___SetItemHP('rej4' , 300000)
		call ItemAttr___SetItemHP('drph' , 400000)
		call ItemAttr___SetItemHP('oven' , 500000)
		call ItemAttr___SetItemHP('frhg' , 600000)
		call ItemAttr___SetItemHP('mlst' , 750000)
		call ItemAttr___SetItemHP('nspi' , 1950000)
		call ItemAttr___SetItemHP('oli2' , 3200000)
		call ItemAttr___SetItemHP('rump' , 4500000)
		call ItemAttr___SetItemHP('shen' , 2000000)
		call ItemAttr___SetItemHP('stpg' , 6500000)
		call ItemAttr___SetItemHP('pgin' , 200000)
		call ItemAttr___SetItemHP('gobm' , 300000)
		call ItemAttr___SetItemHP('gvsm' , 400000)
		call ItemAttr___SetItemHP('gldo' , 500000)
		call ItemAttr___SetItemHP('gsou' , 600000)
		call ItemAttr___SetItemHP('envl' , 1750000)
		call ItemAttr___SetItemHP('rugt' , 2950000)
		call ItemAttr___SetItemHP('shdt' , 4200000)
		call ItemAttr___SetItemHP('crdt' , 4500000)
		call ItemAttr___SetItemHP('pspd' , 6000000)
    	call ItemAttr___SetItem3W('rej6' , 10000)
		call ItemAttr___SetItem3W('dtsb' , 16000)
		call ItemAttr___SetItem3W('tels' , 25000)
		call ItemAttr___SetItem3W('ofir' , 50000)
		call ItemAttr___SetItem3W('soul' , 80000)
		call ItemAttr___SetItem3W('sbok' , 120000)
		call ItemAttr___SetItem3W('arsc' , 150000)
		call ItemAttr___SetItem3W('rde0' , 210000)
		call ItemAttr___SetItem3W('oflg' , 270000)
		call ItemAttr___SetItem3W('frgd' , 320000)
		call ItemAttr___SetItem3W('rej4' , 6000)
		call ItemAttr___SetItem3W('drph' , 10000)
		call ItemAttr___SetItem3W('oven' , 16000)
		call ItemAttr___SetItem3W('frhg' , 35000)
		call ItemAttr___SetItem3W('mlst' , 60000)
		call ItemAttr___SetItem3W('nspi' , 100000)
		call ItemAttr___SetItem3W('oli2' , 130000)
		call ItemAttr___SetItem3W('rump' , 160000)
		call ItemAttr___SetItem3W('shen' , 220000)
		call ItemAttr___SetItem3W('stpg' , 280000)
		call ItemAttr___SetItem3W('pgin' , 6000)
		call ItemAttr___SetItem3W('gobm' , 10000)
		call ItemAttr___SetItem3W('gvsm' , 16000)
		call ItemAttr___SetItem3W('gldo' , 35000)
		call ItemAttr___SetItem3W('gsou' , 60000)
		call ItemAttr___SetItem3W('envl' , 100000)
		call ItemAttr___SetItem3W('rugt' , 130000)
		call ItemAttr___SetItem3W('shdt' , 160000)
		call ItemAttr___SetItem3W('crdt' , 220000)
		call ItemAttr___SetItem3W('pspd' , 280000)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemAttr___InitBeast takes nothing returns nothing
		call ItemAttr___SetItemJingyan('I01S' , 0.50)
	    call ItemAttr___SetItemJingyan('IB05' , 1.75)
	    call ItemAttr___SetItemJingyan('IB03' , 1.25)
	    call ItemAttr___SetItemJingyan('IB00' , 0.50)
	    call ItemAttr___SetItemJingyan('IB01' , 0.75)
	    call ItemAttr___SetItemJingyan('IB09' , 3.00)
	    call ItemAttr___SetItemJingyan('IB08' , 2.50)
	    call ItemAttr___SetItemJingyan('IB06' , 2.00)
	    call ItemAttr___SetItemJingyan('IB07' , 2.25)
	    call ItemAttr___SetItemJingyan('IB04' , 1.50)
	    call ItemAttr___SetItemJingyan('IB02' , 1.00)
	    call ItemAttr___SetItemJingyan('I04X' , 3.50)
	    call ItemAttr___SetItemJingyan('IB0A' , 3.50)
	    call ItemAttr___SetItemJingyan('I07O' , 4.00)
	    call ItemAttr___SetItemJingyan('I07N' , 4.00)
	    call ItemAttr___SetItemJingyan('ratc' , 5.00)
	    call ItemAttr___SetItemJingyan('I04L' , 6.00)
	    call ItemAttr___SetItemJingyan('I04M' , 6.00)
	    call ItemAttr___SetItemHP('IB05' , 3200000)
		call ItemAttr___SetItemHP('IB03' , 800000)
		call ItemAttr___SetItemHP('IB00' , 50000)
		call ItemAttr___SetItemHP('IB01' , 200000)
		call ItemAttr___SetItemHP('IB09' , 20000000)
		call ItemAttr___SetItemHP('I04X' , 30000000)
		call ItemAttr___SetItemHP('IB0A' , 30000000)
		call ItemAttr___SetItemHP('I07O' , 40000000)
		call ItemAttr___SetItemHP('I07N' , 40000000)
		call ItemAttr___SetItemHP('IB08' , 14000000)
		call ItemAttr___SetItemHP('IB06' , 5000000)
		call ItemAttr___SetItemHP('IB07' , 7000000)
		call ItemAttr___SetItemHP('IB04' , 1600000)
		call ItemAttr___SetItemHP('IB02' , 400000)
	    call ItemAttr___SetItem3W('IB05' , 32000)
	    call ItemAttr___SetItem3W('IB03' , 15000)
	    call ItemAttr___SetItem3W('IB01' , 5000)
	    call ItemAttr___SetItem3W('IB09' , 150000)
	    call ItemAttr___SetItem3W('I04X' , 220000)
	    call ItemAttr___SetItem3W('IB0A' , 220000)
	    call ItemAttr___SetItem3W('I07O' , 270000)
	    call ItemAttr___SetItem3W('I07N' , 270000)
	    call ItemAttr___SetItem3W('IB08' , 100000)
	    call ItemAttr___SetItem3W('IB06' , 50000)
	    call ItemAttr___SetItem3W('IB07' , 70000)
	    call ItemAttr___SetItem3W('IB04' , 24000)
	    call ItemAttr___SetItem3W('IB02' , 8000)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemAttr___InitLeitai takes nothing returns nothing
		//擂台
		call ItemAttr___SetItem3W('prvt' , 1500)
	    call ItemAttr___SetItem3W('cnob' , 5000)
	    call ItemAttr___SetItem3W('rhth' , 8000)
	    call ItemAttr___SetItemStr('hval' , 30000)
	    call ItemAttr___SetItem3W('afac' , 30000)
	    call ItemAttr___SetItem3W('pmna' , 80000)
	    call ItemAttr___SetItem3W('evtl' , 120000)
	    call ItemAttr___SetItem3W('bspd' , 160000)
	    call ItemAttr___SetItem3W('mcou' , 250000)
		call ItemAttr___SetItemSpellPerc('mcou' , 0.70)
		call ItemAttr___SetItemAttack('mcou' , 2300000)
		call ItemAttr___SetItemDefensePer('mcou' , 0.15)
		call ItemAttr___SetItemDamagePerc('mcou' , 0.20)
		//皎月
	    call ItemAttr___SetItem3W('I04L' , 250000)
		call ItemAttr___SetItemSpellPerc('I04L' , 0.70)
		call ItemAttr___SetItemAttack('I04L' , 2300000)
		call ItemAttr___SetItemDefensePer('I04L' , 0.15)
		call ItemAttr___SetItemDamagePerc('I04L' , 0.20)
		//混沌夜哀
	    call ItemAttr___SetItem3W('I04M' , 250000)
		call ItemAttr___SetItemSpellPerc('I04M' , 0.70)
		call ItemAttr___SetItemAttack('I04M' , 2300000)
		call ItemAttr___SetItemDefensePer('I04M' , 0.15)
		call ItemAttr___SetItemDamagePerc('I04M' , 0.20)
	    call ItemAttr___SetItemSpellPerc('cnob' , 0.15)
		call ItemAttr___SetItemSpellPerc('hval' , 0.25)
		call ItemAttr___SetItemSpellPerc('afac' , 0.40)
		call ItemAttr___SetItemSpellPerc('pmna' , 0.50)
		call ItemAttr___SetItemSpellPerc('evtl' , 0.55)
		call ItemAttr___SetItemSpellPerc('bspd' , 0.65)
		call ItemAttr___SetItemSpellPerc('rde3' , 0.30)
	    call ItemAttr___SetItemAttack('rhth' , 35000)
		call ItemAttr___SetItemAttack('afac' , 200000)
		call ItemAttr___SetItemAttack('bspd' , 1500000)
	    call ItemAttr___SetItemHP('rhth' , 100000)
	    call ItemAttr___SetItemHP('evtl' , 1000000)
	    call ItemAttr___SetItemDefense('hval' , 1000)
	    call ItemAttr___SetItemHPPer('pmna' , 0.10)
		call ItemAttr___SetItemHPPer('rde3' , 0.20)
		call ItemAttr___SetItemDefensePer('evtl' , 0.10)
		call ItemAttr___SetItemDefensePer('rde3' , 0.20)
		call ItemAttr___SetItemDamagePerc('evtl' , 0.10)
		call ItemAttr___SetItemDamagePerc('bspd' , 0.15)
		call ItemAttr___SetItemDamagePerc('rde3' , 0.20)
		call ItemAttr___SetItemStrPerc('rde3' , 0.20)
		call ItemAttr___SetItemAgiPerc('rde3' , 0.20)
		call ItemAttr___SetItemIntPerc('rde3' , 0.20)
		call ItemAttr___SetItemAttackPerc('rde3' , 0.50)
		call ItemAttr___SetItemHPPer('ssil' , 0.30)
		call ItemAttr___SetItemDefensePer('ssil' , 0.30)
		call ItemAttr___SetItemDamagePerc('ssil' , 0.30)
		call ItemAttr___SetItemStrPerc('ssil' , 0.30)
		call ItemAttr___SetItemAgiPerc('ssil' , 0.30)
		call ItemAttr___SetItemIntPerc('ssil' , 0.30)
		call ItemAttr___SetItemAttackPerc('ssil' , 0.75)
	    call ItemAttr___SetItemSpellPerc('ssil' , 0.45)
	    //极恶之镜
	    call ItemAttr___SetItem3W('I078' , 80000)
	    call ItemAttr___SetItemSpellPerc('I078' , 0.5)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitChaoshen takes nothing returns nothing
	    call ItemAttr___SetItemAttack('rst1' , 1500000)
	    call ItemAttr___SetItemSpellPerc('rst1' , 1.00)
	    call ItemAttr___SetItem3W('I05F' , 370000)
	    call ItemAttr___SetItemHP('I05F' , 2500000)
	    call ItemAttr___SetItemFanji('I05F' , 5000000)
	    call ItemAttr___SetItemSpellPerc('I05F' , 1.00)
	    call ItemAttr___SetItem3W('tbsm' , 350000)
	    call ItemAttr___SetItemDefense('tbsm' , 25000)
	    call ItemAttr___SetItemHP('tbsm' , 9000000)
	    call ItemAttr___SetItem3W('tfar' , 420000)
	    call ItemAttr___SetItemDefense('tfar' , 20000)
	    call ItemAttr___SetItemHP('tfar' , 7500000)
	    call ItemAttr___SetItem3W('tbak' , 350000)
	    call ItemAttr___SetItemHP('tbak' , 7500000)
	    call ItemAttr___SetItemDefense('tbak' , 20000)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitHundun takes nothing returns nothing
		
		call ItemAttr___SetItemStr('ICS1' , 360000)
		call ItemAttr___SetItemAgi('ICS1' , 510000)
		call ItemAttr___SetItemInt('ICS1' , 460000)
		call ItemAttr___SetItemSpellPerc('ICS1' , 1.4)
		call ItemAttr___SetItemXixue('ICS1' , 80000)
		call ItemAttr___SetItemZhishang('ICS1' , 10000000)
		call ItemAttr___SetItemAttack('ICS1' , 3000000)
		call ItemAttr___SetItemStr('I04W' , 360000)
		call ItemAttr___SetItemAgi('I04W' , 510000)
		call ItemAttr___SetItemInt('I04W' , 460000)
		call ItemAttr___SetItemSpellPerc('I04W' , 1.4)
		call ItemAttr___SetItemXixue('I04W' , 80000)
		call ItemAttr___SetItemZhishang('I04W' , 10000000)
		call ItemAttr___SetItemAttack('I04W' , 3000000)
		call ItemAttr___SetItemStr('I07E' , 420000)
		call ItemAttr___SetItemAgi('I07E' , 570000)
		call ItemAttr___SetItemInt('I07E' , 520000)
		call ItemAttr___SetItemSpellPerc('I07E' , 1.7)
		call ItemAttr___SetItemXixue('I07E' , 150000)
		call ItemAttr___SetItemZhishang('I07E' , 20000000)
		call ItemAttr___SetItemAttack('I07E' , 4000000)
		call ItemAttr___SetItemStr('I07F' , 420000)
		call ItemAttr___SetItemAgi('I07F' , 570000)
		call ItemAttr___SetItemInt('I07F' , 520000)
		call ItemAttr___SetItemSpellPerc('I07F' , 1.7)
		call ItemAttr___SetItemXixue('I07F' , 150000)
		call ItemAttr___SetItemZhishang('I07F' , 20000000)
		call ItemAttr___SetItemAttack('I07F' , 4000000)
		
		call ItemAttr___SetItemHPPer('I05T' , 0.35)
		call ItemAttr___SetItemDefensePer('I05T' , 0.35)
		call ItemAttr___SetItemDamagePerc('I05T' , 0.35)
		call ItemAttr___SetItemStrPerc('I05T' , 0.35)
		call ItemAttr___SetItemAgiPerc('I05T' , 0.35)
		call ItemAttr___SetItemIntPerc('I05T' , 0.35)
		call ItemAttr___SetItemAttackPerc('I05T' , 0.75)
	    call ItemAttr___SetItemSpellPerc('I05T' , 0.5)
		call ItemAttr___SetItemHPPer('I04Y' , 0.35)
		call ItemAttr___SetItemDefensePer('I04Y' , 0.35)
		call ItemAttr___SetItemDamagePerc('I04Y' , 0.35)
		call ItemAttr___SetItemStrPerc('I04Y' , 0.35)
		call ItemAttr___SetItemAgiPerc('I04Y' , 0.35)
		call ItemAttr___SetItemIntPerc('I04Y' , 0.35)
		call ItemAttr___SetItemAttackPerc('I04Y' , 0.75)
	    call ItemAttr___SetItemSpellPerc('I04Y' , 0.5)
		call ItemAttr___SetItemHPPer('I07G' , 0.4)
		call ItemAttr___SetItemDefensePer('I07G' , 0.4)
		call ItemAttr___SetItemDamagePerc('I07G' , 0.4)
		call ItemAttr___SetItemStrPerc('I07G' , 0.4)
		call ItemAttr___SetItemAgiPerc('I07G' , 0.4)
		call ItemAttr___SetItemIntPerc('I07G' , 0.4)
		call ItemAttr___SetItemAttackPerc('I07G' , 0.8)
	    call ItemAttr___SetItemSpellPerc('I07G' , 0.6)
		call ItemAttr___SetItemHPPer('I07H' , 0.4)
		call ItemAttr___SetItemDefensePer('I07H' , 0.4)
		call ItemAttr___SetItemDamagePerc('I07H' , 0.4)
		call ItemAttr___SetItemStrPerc('I07H' , 0.4)
		call ItemAttr___SetItemAgiPerc('I07H' , 0.4)
		call ItemAttr___SetItemIntPerc('I07H' , 0.4)
		call ItemAttr___SetItemAttackPerc('I07H' , 0.8)
	    call ItemAttr___SetItemSpellPerc('I07H' , 0.6)
		
	    call ItemAttr___SetItem3W('I05Y' , 400000)
	    call ItemAttr___SetItemDefense('I05Y' , 30000)
	    call ItemAttr___SetItemHP('I05Y' , 15000000)
	    call ItemAttr___SetItem3W('I05Z' , 470000)
	    call ItemAttr___SetItemDefense('I05Z' , 25000)
	    call ItemAttr___SetItemHP('I05Z' , 10000000)
	    call ItemAttr___SetItem3W('I060' , 400000)
	    call ItemAttr___SetItemDefense('I060' , 25000)
	    call ItemAttr___SetItemHP('I060' , 10000000)
	    call ItemAttr___SetItem3W('I07K' , 470000)
	    call ItemAttr___SetItemDefense('I07K' , 37000)
	    call ItemAttr___SetItemHP('I07K' , 20000000)
	    call ItemAttr___SetItem3W('I07J' , 540000)
	    call ItemAttr___SetItemDefense('I07J' , 30000)
	    call ItemAttr___SetItemHP('I07J' , 15000000)
	    call ItemAttr___SetItem3W('I07I' , 470000)
	    call ItemAttr___SetItemDefense('I07I' , 30000)
	    call ItemAttr___SetItemHP('I07I' , 15000000)
	    
	    call ItemAttr___SetItemSpellPerc('ICX1' , 1.5)
	    call ItemAttr___SetItemAttack('ICX1' , 2500000)
	    call ItemAttr___SetItemSpellPerc('I05U' , 1.7)
	    call ItemAttr___SetItemAttack('I05U' , 4000000)
	    
	    call ItemAttr___SetItem3W('I05W' , 400000)
	    call ItemAttr___SetItem3W('I05V' , 300000)
	    call ItemAttr___SetItem3W('I07M' , 470000)
	    call ItemAttr___SetItem3W('I07L' , 370000)
	    
	    call ItemAttr___SetItem3W('I05X' , 410000)
	    call ItemAttr___SetItemHP('I05X' , 5000000)
	    call ItemAttr___SetItemFanji('I05X' , 80000000)
	    call ItemAttr___SetItemSpellPerc('I05X' , 1.2)
	    call ItemAttr___SetItem3W('ICY1' , 470000)
	    call ItemAttr___SetItemHP('ICY1' , 5000000)
	    call ItemAttr___SetItemFanji('ICY1' , 80000000)
	    call ItemAttr___SetItemSpellPerc('ICY1' , 1.3)
	    call ItemAttr___SetItem3W('I07P' , 480000)
	    call ItemAttr___SetItemHP('I07P' , 8000000)
	    call ItemAttr___SetItemFanji('I07P' , 120000000)
	    call ItemAttr___SetItemSpellPerc('I07P' , 1.4)
	    call ItemAttr___SetItem3W('I07Q' , 550000)
	    call ItemAttr___SetItemHP('I07Q' , 8000000)
	    call ItemAttr___SetItemFanji('I07Q' , 120000000)
	    call ItemAttr___SetItemSpellPerc('I07Q' , 1.5)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemAttr___InitItemAttr takes nothing returns nothing
		call ItemAttr___InitErdianQi()
		call ItemAttr___InitErdianBa()
		call ItemAttr___InitDengClothes()
		call ItemAttr___InitBeast()
		call ItemAttr___InitLeitai()
		call InitChaoshen()
		call InitHundun()
	endfunction

//library ItemAttr ends
//library Mirror:
//---------------------------------------------------------------------------------------------------
    
    function SetUnitMirror takes unit mirror,unit u1,integer times returns nothing
        local integer i= 1
        loop
            exitwhen i > 6
            call UnitAddItemByIdSwapped(GetItemTypeId(UnitItemInSlotBJ(u1, i)), mirror)
            set i=i + 1
        endloop
        call SetHeroInt(mirror, GetLimit(GetHeroInt(u1, true) * times), true)
        call SetHeroAgi(mirror, GetLimit(GetHeroAgi(u1, true) * times), true)
        call SetHeroStr(mirror, GetLimit(GetHeroStr(u1, true) * times), true)
        call SetAttack(mirror , GetAttack(u1) * times)
        call SetDefense(mirror , GetDefense(u1) * times)
        call SetHP(mirror , GetHP(u1) * times)
        if ( u1 == kaisa ) then
            call UnitRemoveAbility(mirror, 'AOre')
        elseif ( u1 == taiya ) then
            call SetUnitAcquireRange(mirror, 600.00)
        endif
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function ShowLiuliProcess takes nothing returns nothing
        if ( udg_Z[GetConvertedPlayerId(GetOwningPlayer(udg_U_Zhuansheng_Dantiao[1]))] < 42 ) then
            call DisplayTextToPlayer(GetOwningPlayer(udg_U_Zhuansheng_Dantiao[1]), 0., 0., "|cffff00ff【虚】琉璃璞玉|r" + I2S(udg_Z[GetConvertedPlayerId(GetOwningPlayer(udg_U_Zhuansheng_Dantiao[1]))]) + "/42.")
        endif
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Mirror___MirrorTimeOut takes nothing returns nothing
        //移动单位回基地
        call DisplayTextToPlayer(GetOwningPlayer(udg_U_Zhuansheng_Dantiao[1]), 0., 0., "|cFFFF66CC【消息】|r你未能在限定时间内通过转生！")
        call SetUnitPositionLoc(udg_U_Zhuansheng_Dantiao[1], udg_Point_Fuhuo)
    endfunction
    function DestroyMirrorTimer takes nothing returns nothing
        call TimerDialogDisplay(TiDiaMirror, false)
        call DestroyTimerDialog(TiDiaMirror)
        call PauseTimer(TiMirror)
        call DestroyTimer(TiMirror)
        set TiMirror=null
        set TiDiaMirror=null
    endfunction
    function CreateMirrorTimer takes nothing returns nothing
        set TiMirror=CreateTimer()
        set TiDiaMirror=CreateTimerDialogBJ(TiMirror, "转生时间")
        call TimerStart(TiMirror, 60, false, function Mirror___MirrorTimeOut)
        call TimerDialogDisplay(TiDiaMirror, true)
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function AddMirrorSpell takes nothing returns nothing
        local unit mirror= udg_U_Zhuansheng_Dantiao[2]
        local unit defier= udg_U_Zhuansheng_Dantiao[1]
        local integer count= udg_Z[GetConvertedPlayerId(GetOwningPlayer(defier))]
        if ( count == 20 ) then
            call DisplayTextToPlayer(GetOwningPlayer(defier), 0., 0., "|cFFFF66CC【消息】|r从" + I2S(count) + "转开始镜像将获得33%30倍攻击与破隐技能。")
        elseif ( count == 40 ) then
            call DisplayTextToPlayer(GetOwningPlayer(defier), 0., 0., "|cFFFF66CC【消息】|r从" + I2S(count) + "转开始镜像将获得神圣护甲技能。")
        elseif ( count == 60 ) then
            call DisplayTextToPlayer(GetOwningPlayer(defier), 0., 0., "|cFFFF66CC【消息】|r从" + I2S(count) + "转开始镜像将获得10%回血技能。")
        elseif ( count == 80 ) then
            call DisplayTextToPlayer(GetOwningPlayer(defier), 0., 0., "|cFFFF66CC【消息】|r从" + I2S(count) + "转开始镜像将获得15秒重生技能。")
        elseif ( count == 100 ) then
            call DisplayTextToPlayer(GetOwningPlayer(defier), 0., 0., "|cFFFF66CC【消息】|r从" + I2S(count) + "转开始镜像将获得秒杀献祭技能。")
        elseif ( count == 120 ) then
            call DisplayTextToPlayer(GetOwningPlayer(defier), 0., 0., "|cFFFF66CC【消息】|r从" + I2S(count) + "转开始镜像将获得破防10万技能。")
        elseif ( count == 150 ) then
            call DisplayTextToPlayer(GetOwningPlayer(defier), 0., 0., "|cFFFF66CC【消息】|r从" + I2S(count) + "转开始镜像将获得急速破魔技能。")
        elseif ( count == 160 ) then
            call DisplayTextToPlayer(GetOwningPlayer(defier), 0., 0., "|cFFFF66CC【消息】|r从" + I2S(count) + "转开始镜像将获得减少50%魔法伤害技能。")
        elseif ( count == 170 ) then
            call DisplayTextToPlayer(GetOwningPlayer(defier), 0., 0., "|cFFFF66CC【消息】|r从" + I2S(count) + "转开始镜像将出生于英雄周围。")
        elseif ( count == 180 ) then
            call DisplayTextToPlayer(GetOwningPlayer(defier), 0., 0., "|cFFFF66CC【消息】|r从" + I2S(count) + "转开始镜像将更加厉害的破魔。")
        endif
        if ( count >= 20 ) then
            call UnitAddAbility(mirror, 'A0GL')
            call UnitAddAbility(mirror, 'Adtg')
        endif
        if ( count >= 40 ) then
            call UnitAddAbility(mirror, 'A0F1')
        endif
        if ( count >= 60 ) then
            call UnitAddAbility(mirror, 'A0GM')
        endif
        if ( count >= 80 ) then
            call UnitAddAbility(mirror, 'A0GN')
        endif
        if ( count >= 100 ) then
            call UnitAddAbility(mirror, 'A0GO')
        endif
        if ( count >= 120 ) then
            call UnitAddAbility(mirror, 'A0GP')
        endif
        if ( count >= 150 ) then
            call UnitAddAbility(mirror, 'A0GQ')
        endif
        if ( count >= 160 ) then
            call UnitAddAbility(mirror, 'A052')
        endif
        if ( count >= 170 ) then
            call SetUnitX(mirror, GetUnitX(defier))
            call SetUnitY(mirror, GetUnitY(defier))
        endif
        if ( count >= 180 ) then
            call SetUnitAbilityLevel(mirror, 'A0GQ', 2)
        endif
    endfunction

//library Mirror ends
//library Shen:
//---------------------------------------------------------------------------------------------------
	
	//清除精灵
 function Shen__ClearJingling takes nothing returns nothing
		call FlushChildHashtable(YDHT, GetHandleId(GetEnumUnit()))
	    call RemoveUnit(GetEnumUnit())
	endfunction
 function SummonJingling takes item i,unit caster returns nothing
  local integer attack= 0
  local integer defense= 0
  local integer hp= 0
  local integer unitType= 0
  local integer itemType= GetItemTypeId(i)
  local unit u= null
  local string s= null
  local group g= null
		//单位类型
		if ( ( ( itemType == 'tlum' ) or ( itemType == 'ICS1' ) or ( itemType == 'I04W' ) ) ) then
        	set s="Objects\\Spawnmodels\\Undead\\UDeathMedium\\UDeath.mdl"
        	set unitType='nehy'
		elseif ( itemType == 'I04Z' or itemType == 'nflg' or itemType == 'esaz' or itemType == 'sksh' or itemType == 'oslo' or itemType == 'grsl' or itemType == 'flag' ) then
        	set s="Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl"
        	set unitType='nbal'
		elseif ( itemType == 'I056' or itemType == 'spre' or itemType == 'asbl' or itemType == 'ocor' or itemType == 'blba' or itemType == 'cosl' or itemType == 'shhn' ) then
        	set s="Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl"
        	set unitType='nvde'
		elseif ( itemType == 'I057' or itemType == 'fwss' or itemType == 'ram4' or itemType == 'rat3' or itemType == 'pams' or itemType == 'jdrn' or itemType == 'shcw' ) then
        	set s="Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl"
        	set unitType='hwat'
		elseif ( itemType == 'I050' or itemType == 'uflg' or itemType == 'ram3' or itemType == 'stre' or itemType == 'shrs' or itemType == 'kgal' or itemType == 'shtm' ) then
        	set s="Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl"
        	set unitType='nlv3'
		elseif ( itemType == 'I055' or itemType == 'tgxp' or itemType == 'ram2' or itemType == 'lure' or itemType == 'thdm' or itemType == 'arsh' or itemType == 'srtl' ) then
        	set s="war3mapImported\\OrbitalRay.mdl"
        	set unitType='nsll'
		elseif ( itemType == 'I03Y' or itemType == 'dust' or itemType == 'ram1' or itemType == 'rots' or itemType == 'tmmt' or itemType == 'brag' or itemType == 'olig' ) then
        	set s="Abilities\\Spells\\NightElf\\Starfall\\StarfallCaster.mdl"
        	set unitType='ehpr'
		elseif ( itemType == 'tbar' ) then
        	set s="Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl"
        	set unitType='nitp'
		elseif ( itemType == 'ccmd' ) then
        	set s="war3mapImported\\OrbitalRay.mdl"
        	set unitType='nadr'
		elseif ( itemType == 'iwbr' ) then
        	set s="Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl"
        	set unitType='nsgg'
		elseif ( itemType == 'I07F' or itemType == 'I07E' ) then
        	set s="Abilities\\Spells\\Undead\\DeathCoil\\DeathCoilSpecialArt.mdl"
        	set unitType='nbzd'
		endif
		//属性
		if ( itemType == 'I04Z' or itemType == 'I056' or itemType == 'I057' or itemType == 'I050' or itemType == 'I055' or itemType == 'I03Y' ) then
	        set attack=10000
	    elseif ( itemType == 'nflg' or itemType == 'spre' or itemType == 'fwss' or itemType == 'uflg' or itemType == 'tgxp' or itemType == 'dust' ) then
	        set attack=300000
	        set defense=200
	        set hp=1000000
	    elseif ( itemType == 'esaz' or itemType == 'asbl' or itemType == 'ram4' or itemType == 'ram3' or itemType == 'ram2' or itemType == 'ram1' ) then
	        set attack=750000
	        set defense=500
	        set hp=2500000
	    elseif ( itemType == 'sksh' or itemType == 'ocor' or itemType == 'rat3' or itemType == 'stre' or itemType == 'lure' or itemType == 'rots' ) then
	        set attack=1200000
	        set defense=750
	        set hp=4000000
	    elseif ( itemType == 'oslo' or itemType == 'blba' or itemType == 'pams' or itemType == 'shrs' or itemType == 'thdm' or itemType == 'tmmt' ) then
	        set attack=1800000
	        set defense=1000
	        set hp=6000000
	    elseif ( itemType == 'grsl' or itemType == 'cosl' or itemType == 'jdrn' or itemType == 'kgal' or itemType == 'arsh' or itemType == 'brag' ) then
	        set attack=2800000
	        set defense=1500
	        set hp=10000000
	    elseif ( itemType == 'flag' or itemType == 'shhn' or itemType == 'shcw' or itemType == 'shtm' or itemType == 'srtl' or itemType == 'olig' ) then
	        set attack=5000000
	        set defense=2000
	        set hp=15000000
	    endif
	    //暗的等级
	    if ( itemType == 'nflg' ) then
	        call SetUnitAbilityLevelSwapped('ANpi', u, 2)
	    elseif ( itemType == 'esaz' ) then
	        call SetUnitAbilityLevelSwapped('ANpi', u, 3)
	    elseif ( itemType == 'sksh' ) then
	        call SetUnitAbilityLevelSwapped('ANpi', u, 4)
	    elseif ( itemType == 'oslo' ) then
	        call SetUnitAbilityLevelSwapped('ANpi', u, 5)
	    elseif ( itemType == 'grsl' ) then
	        call SetUnitAbilityLevelSwapped('ANpi', u, 6)
	    elseif ( itemType == 'flag' ) then
	        call SetUnitAbilityLevelSwapped('ANpi', u, 7)
	    endif
		if ( unitType != 0 ) then
		    set g=YDWEGetUnitsOfPlayerAndTypeIdNull(GetOwningPlayer(GetTriggerUnit()) , unitType)
		    call ForGroupBJ(g, function Shen__ClearJingling)
		    call DestroyGroup(g)
		    set u=CreateUnit(GetOwningPlayer(caster), unitType, GetUnitX(caster), GetUnitY(caster), 0)
			if ( s != null ) then
		    	call DestroyEffect(AddSpecialEffect(s, GetUnitX(u), GetUnitY(u)))
		    endif
		endif
		if ( attack != 0 ) then
			call SetAttack(u , attack)
		endif
		if ( defense != 0 ) then
			call SetDefense(u , defense)
		endif
		if ( hp != 0 ) then
			call SetHP(u , hp)
		endif
	    set s=null
	    set u=null
	    set g=null
	endfunction

//library Shen ends
//library Fanzhuan:
//---------------------------------------------------------------------------------------------------
	
 function FanzhuanCondition takes player p,integer i returns boolean
		if not ( true ) then
			return IsPIV(p)
		else
			return S2I(SubStringBJ(SFanzhaun[GetConvertedPlayerId(p)], i, i)) == 1 or GetSpecifyHeroTimes(p , i) >= 25 or IsPIV(p)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetFanzhuanFailString takes player p,integer i returns string
		if not ( true ) then
			return "\n			在该版本中获取赞助后永久解锁使用.(请看复活点介绍)\n			或者在官方平台使用该英雄25次后解锁.\n			"
		endif
		return "\n		该英雄使用次数达到25次.\n		进度:" + I2S(GetSpecifyHeroTimes(p , i)) + "/25"
		return ""
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetFanzhuanOK takes player p,integer i returns nothing
  local integer index= GetConvertedPlayerId(p)
  local string temp= null
		if ( StringLength(SFanzhaun[index]) < 62 ) then
			set SFanzhaun[index]="00000000000000000000000000000000000000000000000000000000000000"
		endif
		if ( S2I(SubStringBJ(SFanzhaun[index], i, i)) != 1 ) then
			set temp=SFanzhaun[index]
			set SFanzhaun[index]=SubStringBJ(temp, 1, i - 1)
			set SFanzhaun[index]=SFanzhaun[index] + "1"
			set SFanzhaun[index]=SFanzhaun[index] + SubStringBJ(temp, i + 1, StringLength(temp))
			set temp=null
			call DisplayTextToPlayer(p, 0., 0., "|cff3366ff【消息】恭喜你成功解锁英雄" + GetIndexHeroColorName(i) + "|cff3366ff新的技能形态!|r")
    call DzAPI_Map_StoreString(p , "SFanzhaun" , SFanzhaun[index])
		endif
	endfunction

//library Fanzhuan ends
//library Huodong:
//---------------------------------------------------------------------------------------------------
	
 function IsHuodong7 takes nothing returns boolean
		//return true
		return ( ( DzAPI_Map_GetGameStartTime() / 10 ) > 149978880 ) and ( ( DzAPI_Map_GetGameStartTime() / 10 ) < 150315840 )
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsJianianhua takes nothing returns boolean
		return true
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsKuanghuanTime takes nothing returns boolean
		return IKuanghuan == 1
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsTianyanOK takes nothing returns boolean
		return IsAchieveOK(Player(0) , 325)
	endfunction

//library Huodong ends
//library Jizi:
//---------------------------------------------------------------------------------------------------
	
 function Jizi___GetZhongqiuWord takes integer i returns string
		if ( i == 1 ) then
			return "平"
		elseif ( i == 2 ) then
			return "分"
		elseif ( i == 3 ) then
			return "秋"
		elseif ( i == 4 ) then
			return "色"
		elseif ( i == 5 ) then
			return "一"
		elseif ( i == 6 ) then
			return "轮"
		elseif ( i == 7 ) then
			return "满"
		elseif ( i == 8 ) then
			return "长"
		elseif ( i == 9 ) then
			return "伴"
		elseif ( i == 10 ) then
			return "云"
		elseif ( i == 11 ) then
			return "衢"
		elseif ( i == 12 ) then
			return "千"
		elseif ( i == 13 ) then
			return "里"
		elseif ( i == 14 ) then
			return "明"
		endif
		return ""
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Jizi___GetRewardName takes integer days returns string
		if ( days == 14 ) then
			return "全皮肤体验权[活动期间]\n+绝版中秋英雄死亡声效.[永久]"
		elseif ( days == 10 ) then
			return "湮灭皮肤[永久]"
		elseif ( days == 12 ) then
			return "司宸皮肤与仓库瞬息万年[永久]"
		elseif ( days == 8 ) then
			return "解锁星胧[活动期间]"
		endif
		return null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Jizi___GetStateName takes integer i returns string
		if ( i == 1 ) then
			return "|cff99cc00金钱获取率+100%持续3分钟。|r"
		elseif ( i == 2 ) then
			return "|cff99cc00技能伤害+50%持续4分钟。|r"
		elseif ( i == 3 ) then
			return "|cffff66003秒复活持续5分钟。|r"
		endif
		return ""
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Jizi___GetNewWord takes player p,integer i returns boolean
  local integer index= GetConvertedPlayerId(p)
  local string temp= null
		if ( StringLength(SJizi[index]) < 62 ) then
			set SJizi[index]="00000000000000000000000000000000000000000000000000000000000000"
		endif
		if ( S2I(SubStringBJ(SJizi[index], i, i)) != 1 ) then
			set temp=SJizi[index]
			set SJizi[index]=SubStringBJ(temp, 1, i - 1)
			set SJizi[index]=SJizi[index] + "1"
			set SJizi[index]=SJizi[index] + SubStringBJ(temp, i + 1, StringLength(temp))
			set temp=null
			if ( i != 15 ) then
				call DisplayTextToPlayer(p, 0., 0., "|cff3366ff【消息】恭喜你收集到从未获得的|r" + Jizi___GetZhongqiuWord(i) + "字.")
				call DisplayTextToPlayer(p, 0., 0., "|cff3366ff【消息】恭喜你收集到从未获得的|r" + Jizi___GetZhongqiuWord(i) + "字.")
				call DisplayTextToPlayer(p, 0., 0., "|cff3366ff【消息】恭喜你收集到从未获得的|r" + Jizi___GetZhongqiuWord(i) + "字.")
			endif
			call DzAPI_Map_StoreString(p , "SJizi" , SJizi[index])
			return true
		endif
		return false
	endfunction
 function Jizi___IsHasWord takes player p,integer i returns boolean
		return S2I(SubStringBJ(SJizi[GetConvertedPlayerId(p)], i, i)) == 1
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetPlayerWordCount takes player p returns integer
  local integer i= 1
  local integer count= 0
		loop
			exitwhen i > 14
			if ( Jizi___IsHasWord(p , i) ) then
				set count=count + 1
			endif
			set i=i + 1
		endloop
		return count
	endfunction
 function HasAll14Word takes player p returns boolean
		return Jizi___IsHasWord(p , 15)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Get14Word takes player p returns string
  local string s= ""
  local integer i= 1
		loop
			exitwhen i > 14
			set s=s + S3(Jizi___IsHasWord(p , i) , "|cffff00ff" , "|cffffffff") + Jizi___GetZhongqiuWord(i) + "|r"
			if ( i == 7 ) then
				set s=s + "|cffff00ff，|r"
			elseif ( i == 14 ) then
				set s=s + "|cffff00ff。|r"
			endif
			set i=i + 1
		endloop
		return s
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Jizi___GetWordCountReward takes player p returns nothing
		if ( GetPlayerWordCount(p) >= 10 ) then
			call SetYanmieSpinOK(p)
		endif
		if ( GetPlayerWordCount(p) >= 12 ) then
			call SetSichenSpinOK(p)
			call GetAndSaveCangku(p , 5)
		endif
		if ( GetPlayerWordCount(p) >= 14 ) then
			call Jizi___GetNewWord(p , 15)
		endif
	endfunction
 function Jizi___AfterMoneyBuffTime takes player p returns nothing
		call AddMoneyPercent(GetConvertedPlayerId(p) , - 1.0)
		call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r月饼给你提供的金钱时间到了.")
	endfunction
 function Jizi___AfterSpellBuffTime takes player p returns nothing
		call AddSpellPercent(GetConvertedPlayerId(p) , - 0.5)
		call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r月饼给你提供的技能伤害时间到了.")
	endfunction
 function Jizi___AfterReviveBuffTime takes player p returns nothing
		set B3SecondRevive[GetConvertedPlayerId(p)]=false
		call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r月饼给你提供的3秒复活时间到了.")
	endfunction
 function Jizi___GetStateReward takes player p,integer state returns nothing
		if ( state == 1 ) then
			call AddMoneyPercent(GetConvertedPlayerId(p) , 1.0)
			call s__Buff_create(p , 180 , (1))
		elseif ( state == 2 ) then
			call AddSpellPercent(GetConvertedPlayerId(p) , 0.5)
			call s__Buff_create(p , 240 , (2))
		elseif ( state == 3 ) then
			set B3SecondRevive[GetConvertedPlayerId(p)]=true
			call s__Buff_create(p , 300 , (3))
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function OpenTheYuebing takes player p returns nothing
  local integer iWord= GetRandomInt(1, 14)
  local integer iState= GetRandomInt(1, 3)
  local integer i= 1
  local string s= null
		call Jizi___GetNewWord(p , iWord)
		set s="\n			你开启该月饼获得了:\n			" + Jizi___GetStateName(iState) + "\n			活动字\"|cffff00ff" + Jizi___GetZhongqiuWord(iWord) + "|r\"\n			你目前收集到的总字数为:\n			" + Get14Word(p) + "\n			(" + I2S(GetPlayerWordCount(p)) + "个字)\n			"
		loop
			exitwhen i > 14
        	if ( Jizi___GetRewardName(i) != null ) then
        		set s=s + I2S(i) + "字:" + Jizi___GetRewardName(i) + S3(GetPlayerWordCount(p) >= i , "|cffff9900(已获得)|r" , "|cff33cccc(未获得)|r") + "\n"
        	endif
			set i=i + 1
		endloop
		call Jizi___GetWordCountReward(p)
		call Jizi___GetStateReward(p , iState)
		call ShowGameHint(p , s)
		set s=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CreateYuebingPlayer takes real x,real y,player p returns nothing
  local item it= null
		call BJDebugMsg("|cFFFF66CC【消息】|r地图出现了一个月饼!")
		call PingMinimapForForce(GetPlayersAll(), x, y, 5.00)
		call PlaySoundBJ(gg_snd_MapPing)
		set it=CreateItem('I07T', x, y)
		if ( p != null ) then
	        call SaveInteger(YDHT, GetHandleId(it), 0xA75AD423, GetConvertedPlayerId(p))
		endif
		set it=null
	endfunction
 function CreateYuebing takes real x,real y returns nothing
		call CreateYuebingPlayer(x , y , null)
	endfunction
	
 function CreateAllYuebing takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > 6
			if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) and udg_H[i] != null ) then
				call CreateYuebingPlayer(GetUnitX(udg_H[i]) , GetUnitY(udg_H[i]) , ConvertedPlayer(i))
			endif
			set i=i + 1
		endloop
	endfunction

//library Jizi ends
//library Mengji:
//---------------------------------------------------------------------------------------------------
	
 function SimulateDamageMengji takes unit u returns boolean
		if ( GetUnitTypeId(u) == 'hhm1' ) then
			call UnitDamageTarget(mengji, GetTriggerUnit(), GetDamageAgi(mengji) * 0.2, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
			return true
		endif
		if ( GetUnitTypeId(u) == 'hhm2' ) then
			call UnitDamageTarget(mengji, GetTriggerUnit(), GetUnitState(GetTriggerUnit(), UNIT_STATE_MAX_LIFE) * 0.02, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_SLOW_POISON, WEAPON_TYPE_WHOKNOWS)
			return true
		endif
		if ( GetUnitTypeId(u) == 'hhm3' ) then
			call RecoverUnitHP(GetTriggerUnit() , 0.1)
			return true
		endif
		//瞬伐心
		if ( GetUnitTypeId(u) == 'h01B' and udg_H[GetConvertedPlayerId(GetOwningPlayer(u))] == mengji ) then
			call UnitDamageTarget(mengji, GetTriggerUnit(), GetDamageAgi(mengji) * 0.35, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
			return true
		endif
		if ( GetUnitTypeId(u) == 'hhm4' ) then
			call UnitDamageTarget(mengji, GetTriggerUnit(), GetDamageAgi(mengji) * 0.4, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
			return true
		endif
		return false
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetOtherLiutao takes unit u,item it returns boolean
		if ( GetItemTypeId(it) == 'I049' or GetItemTypeId(it) == 'I04A' or it == Mengji___Nihe ) then
			return ( u == mengji )
		else
			return true
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Mengji___HasShenggong takes nothing returns boolean
		return UnitHasItem(mengji, Mengji___Liutao)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Mengji___ExchangeChao takes boolean higher returns nothing
  local integer charges= GetItemCharges(Mengji___Liutao)
		if ( GetItemTypeId(Mengji___Liutao) == I3(higher or BJuexing3[GetConvertedPlayerId(GetOwningPlayer(mengji))] , 'I04A' , 'I049') ) then
			return
		endif
		call FlushChildHashtable(YDHT, GetHandleId(Mengji___Liutao))
		call RemoveItem(Mengji___Liutao)
		set Mengji___Liutao=CreateItem(I3(higher or BJuexing3[GetConvertedPlayerId(GetOwningPlayer(mengji))] , 'I04A' , 'I049'), GetUnitX(mengji), GetUnitY(mengji))
	    call SaveInteger(YDHT, GetHandleId(Mengji___Liutao), 0xA75AD423, GetConvertedPlayerId(GetOwningPlayer(mengji)))
		call SetItemCharges(Mengji___Liutao, charges)
		if ( Mengji___Nihe != null ) then
			call SetItemVisible(Mengji___Liutao, false)
		else
			if ( IsUnitHasSlot(mengji) ) then
				//有空位则给英雄
				call UnitAddItem(mengji, Mengji___Liutao)
			endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Mengji___NitaiTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
		if ( Mengji___Nihe != null ) then
			call RemoveItem(Mengji___Nihe)
		endif
		set Mengji___Nihe=null
		call SetItemVisible(Mengji___Liutao, true)
		if ( IsUnitHasSlot(mengji) and IsUnitAliveBJ(mengji) ) then
			//有空位则给英雄
			call UnitAddItem(mengji, Mengji___Liutao)
	    	call PrintSpellContent(GetOwningPlayer(mengji) , GetAbilityName('A0GX') , "，拟态结束，圣弓回归至英雄身上.")
		else
			//没有位置则移到英雄脚下
			call SetItemPosition(Mengji___Liutao, GetUnitX(mengji), GetUnitY(mengji))
			call PingMinimapForForce(YDWEGetForceOfPlayerNull(GetOwningPlayer(mengji)), GetUnitX(mengji), GetUnitY(mengji), 2.00)
	    	call PrintSpellContent(GetOwningPlayer(mengji) , GetAbilityName('A0GX') , "，拟态结束，由于背包已满，圣弓回归至英雄脚下.")
		endif
		call PauseTimer(t)
		call FlushChildHashtable(spellTable, id)
		call DestroyTimer(t)
		set t=null
	endfunction
 function Mengji___Nitai takes nothing returns nothing
  local timer t= CreateTimer()
  local item temp= GetSpellTargetItem()
  local integer spellID= GetSpellAbilityId()
		//call SetItemPosition(Liutao,0,0)
		call UnitRemoveItemSwapped(Mengji___Liutao, mengji)
		call SetItemVisible(Mengji___Liutao, false)
		call UnitAddItemByIdSwapped(GetItemTypeId(temp), mengji)
		set Mengji___Nihe=GetLastCreatedItem()
		call SetItemPawnable(Mengji___Nihe, false)
		call TimerStart(t, 30, false, function Mengji___NitaiTimer)
	    call PrintSpellContent(GetOwningPlayer(mengji) , GetAbilityName(spellID) , "拟合出" + GetItemName(temp))
		set t=null
		set temp=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function RuohuanmengChatBack1 takes nothing returns nothing
		if ( Mengji___Nihe != null ) then
			call RemoveItem(Mengji___Nihe)
			set Mengji___Nihe=null
		endif
		if ( IsUnitHasSlot(mengji) and IsUnitAliveBJ(mengji) ) then
			//有空位则给英雄
			call UnitAddItem(mengji, Mengji___Liutao)
	    	call PrintSpellContent(GetOwningPlayer(mengji) , GetAbilityName('A0GX') , "，圣弓回归至英雄身上.")
		else
			//没有位置则移到英雄脚下
			call SetItemPosition(Mengji___Liutao, GetUnitX(mengji), GetUnitY(mengji))
			call PingMinimapForForce(YDWEGetForceOfPlayerNull(GetOwningPlayer(mengji)), GetUnitX(mengji), GetUnitY(mengji), 2.00)
	    	call PrintSpellContent(GetOwningPlayer(mengji) , GetAbilityName('A0GX') , "由于背包已满，圣弓回归至英雄脚下.")
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function RuohuanmengChatBack takes nothing returns nothing
		if ( Mengji___ULinglong1 == null ) then
			call Mengji___ExchangeChao(false)
		endif
		if ( IsUnitInRange(mengji, Mengji___ULinglong1, 900) ) then
			call Mengji___ExchangeChao(true)
		else
			call Mengji___ExchangeChao(false)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Mengji___RuohuanmengAttackCon takes nothing returns boolean
		return GetAttacker() == mengji and Mengji___HasShenggong()
	endfunction
 function Mengji___RuohuanmengAttack takes nothing returns nothing
  local integer times= GetItemCharges(Mengji___Liutao)
		if ( GetItemTypeId(Mengji___Liutao) == 'I049' ) then
			if ( times < IJ2(mengji , 200 , 100) ) then
				call SetItemCharges(Mengji___Liutao, times + 1)
			endif
		else
			call SetItemCharges(Mengji___Liutao, IMinBJ(1000, times + 1))
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function RuohuanmengDeathCon takes nothing returns boolean
	    return ( ( GetEventDamage() >= GetUnitStateSwap(UNIT_STATE_LIFE, GetTriggerUnit()) ) and GetItemCharges(Mengji___Liutao) >= 100 and IsUnitAliveBJ(mengji) )
	endfunction
 function RuohuanmengDeathAct takes nothing returns nothing
		call SetItemCharges(Mengji___Liutao, IMaxBJ(0, GetItemCharges(Mengji___Liutao) - 100))
	    call UnitAddAbilityBJ('A0GV', GetTriggerUnit())
	    call YDWEPolledWaitNull(0.01)
	    call UnitRemoveAbilityBJ('A0GV', GetTriggerUnit())
	endfunction
//---------------------------------------------------------------------------------------------------
	
    function Mengji___RuohuanmengTimer takes nothing returns nothing
    	if ( Mengji___HuanmengX != GetUnitX(mengji) or Mengji___HuanmengY != GetUnitY(mengji) ) then
    		set Mengji___HuanmengX=GetUnitX(mengji)
    		set Mengji___HuanmengY=GetUnitY(mengji)
    		//移动
    		if ( GetUnitAbilityLevel(mengji, 'A0GX') >= 1 ) then
    			call UnitRemoveAbility(mengji, 'A0GX')
    			call UnitAddAbility(mengji, 'A0GY')
    			call SetUnitAbilityLevel(mengji, 'A0GY', 1 + IJ1(mengji , 1 , 0) + IJ2(mengji , 1 , 0) + IJ3(mengji , 1 , 0))
    		endif
    	else
    		//静止
    		if ( GetUnitAbilityLevel(mengji, 'A0GY') >= 1 ) then
    			call UnitRemoveAbility(mengji, 'A0GY')
    			call UnitAddAbility(mengji, 'A0GX')
    			call SetUnitAbilityLevel(mengji, 'A0GX', 1 + IJ1(mengji , 1 , 0) + IJ2(mengji , 1 , 0) + IJ3(mengji , 1 , 0))
    		endif
    	endif
    endfunction
//---------------------------------------------------------------------------------------------------
	
 function Mengji___Tanyoujian takes real damageRate,integer abilityID,real x2,real y2,integer count returns nothing
  local real damage= GetDamageAgi(mengji) * damageRate
     local real x1= GetUnitX(mengji)
     local real y1= GetUnitY(mengji)
     local real facing= Atan2BJ(y2 - y1, x2 - x1)
  local unit u= null
  local boolean next= true
  local integer i= - 1 * count / 2
		loop
			exitwhen i > count / 2
			set u=CreateUnit(GetOwningPlayer(mengji), 'hhm5', x1, y1, facing + i * 20)
	    	call UnitApplyTimedLifeBJ(2, 'BHwe', u)
		    call YDWETimerPatternRushSlide(u , facing + i * 20 , 2000 , 2 , 0.05 , damage , 300. , false , true , true , "origin" , "Abilities\\Spells\\Undead\\DeathCoil\\DeathCoilSpecialArt.mdl" , "Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl")
			set i=i + 1
		endloop
	    call PrintSpell(GetOwningPlayer(mengji) , GetAbilityName(abilityID) , damage)
	    set u=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Mengji___Zhenhunsuo takes nothing returns nothing
   local unit u= CreateUnit(GetOwningPlayer(mengji), 'h000', GetUnitX(mengji), GetUnitY(mengji), 0)
	    call UnitApplyTimedLifeBJ(12.00, 'BHwe', u)
        call UnitAddAbilityBJ('A0H0', u)
    	call IssueTargetOrder(u, "magicleash", GetSpellTargetUnit())
 		set u=CreateUnit(GetOwningPlayer(mengji), 'h000', GetUnitX(mengji), GetUnitY(mengji), 0)
	    call UnitApplyTimedLifeBJ(12.00, 'BHwe', u)
        call UnitAddAbilityBJ('A0H0', u)
    	call IssueTargetOrder(u, "magicleash", GetSpellTargetUnit())
	    set u=null
	    call PrintSpellName(GetOwningPlayer(mengji) , GetAbilityName(GetSpellAbilityId()))
	endfunction
//---------------------------------------------------------------------------------------------------
	
    function Mengji___TSpellMengji2Con takes nothing returns boolean
    	return GetAttacker() == mengji and IsSecondSpellOK(mengji) == true and GetUnitState(mengji, UNIT_STATE_MANA) >= 250 and Mengji___HasShenggong() and GetUnitAbilityLevel(mengji, 'AHM2') == 1
    endfunction
    function Mengji___TSpellMengji2Act takes nothing returns nothing
    	call DisableTrigger(GetTriggeringTrigger())
		call Mengji___Tanyoujian(0.4 , 'AHM2' , GetUnitX(GetAttackedUnitBJ()) , GetUnitY(GetAttackedUnitBJ()) , 1)
		call YDWEPolledWaitNull(5)
    	call EnableTrigger(GetTriggeringTrigger())
    endfunction
//---------------------------------------------------------------------------------------------------
	
 function Mengji___Sanchuanjian takes nothing returns nothing
  local real damage= GetDamageAgi(mengji) * 0.2
  local real x= YDWECoordinateX(GetSpellTargetX() + GetRandomInt(- 100, 100))
  local real y= YDWECoordinateY(GetSpellTargetY() + GetRandomInt(- 100, 100))
        local unit u= CreateUnit(GetOwningPlayer(mengji), 'hhm1', x, y, 0)
        call UnitApplyTimedLifeBJ(22.00, 'BHwe', u)
        call IssuePointOrder(u, "stampede", GetSpellTargetX(), GetSpellTargetY())
		set x=YDWECoordinateX(GetSpellTargetX() + GetRandomInt(- 100, 100))
		set y=YDWECoordinateY(GetSpellTargetY() + GetRandomInt(- 100, 100))
 		set u=CreateUnit(GetOwningPlayer(mengji), 'hhm2', x, y, 0)
        call UnitApplyTimedLifeBJ(22.00, 'BHwe', u)
        call IssuePointOrder(u, "stampede", GetSpellTargetX(), GetSpellTargetY())
		set x=YDWECoordinateX(GetSpellTargetX() + GetRandomInt(- 100, 100))
		set y=YDWECoordinateY(GetSpellTargetY() + GetRandomInt(- 100, 100))
 		set u=CreateUnit(Player(10), 'hhm3', x, y, 0)
        call UnitApplyTimedLifeBJ(22.00, 'BHwe', u)
        call IssuePointOrder(u, "stampede", GetSpellTargetX(), GetSpellTargetY())
	    call PrintSpell(GetOwningPlayer(mengji) , GetAbilityName(GetSpellAbilityId()) , damage)
        set u=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Mengji___Shunfaxin takes nothing returns nothing
  local real damage= GetDamageAgi(mengji) * 0.1
	    call EnableTrigger(Mengji___TSpellMengji41)
	    call EnableTrigger(Mengji___TSpellMengji42)
        call PlaySoundBJ(gg_snd_mengji_4)
	    call PrintSpell(GetOwningPlayer(mengji) , GetAbilityName('AHM4') , damage)
	    call YDWEPolledWaitNull(30)
	    call DisableTrigger(Mengji___TSpellMengji41)
	    call DisableTrigger(Mengji___TSpellMengji42)
	    call PrintSpellContent(GetOwningPlayer(mengji) , GetAbilityName('AHM4') , ",施法结束.")
	endfunction
	
 function Mengji___ShunfaxinArrow takes real x2,real y2 returns nothing
  local real x1= GetUnitX(mengji)
     local real y1= GetUnitY(mengji)
     local real facing= Atan2BJ(y2 - y1, x2 - x1)
     local real x= x2 - CosBJ(facing) * 100
     local real y= y2 - SinBJ(facing) * 100
   local unit u= CreateUnit(GetOwningPlayer(mengji), 'h01B', x, y, 0)
        call UnitApplyTimedLifeBJ(5.00, 'BHwe', u)
        call UnitAddAbility(u, 'A0H4')
        call IssuePointOrder(u, "carrionswarm", x2, y2)
        set u=null
        //call PolledWait(0.01)
        call IssuePointOrder(mengji, "move", GetUnitX(mengji), GetUnitY(mengji))
        // if (RAbsBJ(GetUnitX(mengji)-x1) < 600) then
	    //     call SetUnitX(mengji,x1)
	    //     call SetUnitY(mengji,y1)
        // 	endif
        // call IssueImmediateOrder(mengji,"stop")
	endfunction
 function Mengji___TSpellMengji4Con takes nothing returns boolean
	    return ( ( GetIssuedOrderIdBJ() == String2OrderIdBJ("smart") ) )
	endfunction
 function Mengji___TSpellMengji41Act takes nothing returns nothing
	    call Mengji___ShunfaxinArrow(GetUnitX(GetOrderTargetUnit()) , GetUnitY(GetOrderTargetUnit()))
	endfunction
 function Mengji___TSpellMengji42Act takes nothing returns nothing
	    call Mengji___ShunfaxinArrow(GetOrderPointX() , GetOrderPointY())
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Mengji___LinglongwuTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local unit u= null
  local integer id= GetHandleId(t)
  local integer count= LoadInteger(spellTable, id, 1)
  local real angel= GetRandomReal(0, 360)
		if ( IsUnitInRange(mengji, Mengji___ULinglong1, 900) ) then
			if ( IsUnitAliveBJ(mengji) ) then
				set u=CreateUnit(GetOwningPlayer(mengji), 'hhm4', GetUnitX(mengji), GetUnitY(mengji), angel)
	       		call UnitApplyTimedLifeBJ(5.00, 'BHwe', u)
	        	call IssuePointOrder(u, "carrionswarm", YDWECoordinateX(GetUnitX(mengji) + 100 * CosBJ(angel)), YDWECoordinateY(GetUnitY(mengji) + 100 * SinBJ(angel)))
			endif
	        call MoveLightningEx(Mengji___LLinglong[1], true, YDWECoordinateX(GetUnitX(Mengji___ULinglong1) + 900 * CosBJ(count)), YDWECoordinateY(GetUnitY(Mengji___ULinglong1) + 900 * SinBJ(count)), 0, YDWECoordinateX(GetUnitX(Mengji___ULinglong1) + 900 * CosBJ(count)), YDWECoordinateY(GetUnitY(Mengji___ULinglong1) + 900 * SinBJ(count)), 750)
	        call MoveLightningEx(Mengji___LLinglong[2], true, YDWECoordinateX(GetUnitX(Mengji___ULinglong1) + 900 * CosBJ(count + 120)), YDWECoordinateY(GetUnitY(Mengji___ULinglong1) + 900 * SinBJ(count + 120)), 0, YDWECoordinateX(GetUnitX(Mengji___ULinglong1) + 900 * CosBJ(count + 120)), YDWECoordinateY(GetUnitY(Mengji___ULinglong1) + 900 * SinBJ(count + 120)), 750)
	        call MoveLightningEx(Mengji___LLinglong[3], true, YDWECoordinateX(GetUnitX(Mengji___ULinglong1) + 900 * CosBJ(count + 240)), YDWECoordinateY(GetUnitY(Mengji___ULinglong1) + 900 * SinBJ(count + 240)), 0, YDWECoordinateX(GetUnitX(Mengji___ULinglong1) + 900 * CosBJ(count + 240)), YDWECoordinateY(GetUnitY(Mengji___ULinglong1) + 900 * SinBJ(count + 240)), 750)
			call SaveInteger(spellTable, GetHandleId(t), 1, ModuloInteger(count + 6, 360))
			set u=null
		else
			call RemoveUnit(Mengji___ULinglong1)
			call RemoveUnit(Mengji___ULinglong2)
			call DestroyLightningBJ(Mengji___LLinglong[1])
			call DestroyLightningBJ(Mengji___LLinglong[2])
			call DestroyLightningBJ(Mengji___LLinglong[3])
			set Mengji___ULinglong1=null
			set Mengji___ULinglong2=null
			set Mengji___LLinglong[1]=null
			set Mengji___LLinglong[2]=null
			set Mengji___LLinglong[3]=null
			call Mengji___ExchangeChao(false)
			call PauseTimer(t)
			call FlushChildHashtable(spellTable, id)
			call DestroyTimer(t)
		endif
		set t=null
	endfunction
 function Mengji___Linglongwu takes nothing returns nothing
  local timer t= null
		if ( Mengji___ULinglong1 != null ) then
			return
		endif
		set t=CreateTimer()
        call PlaySoundBJ(gg_snd_mengji_5)
		set Mengji___ULinglong1=CreateUnit(GetOwningPlayer(mengji), 'h00S', GetUnitX(mengji), GetUnitY(mengji), 0)
		set Mengji___ULinglong2=CreateUnit(GetOwningPlayer(mengji), 'h00T', GetUnitX(mengji), GetUnitY(mengji), 0)
		set Mengji___LLinglong[1]=AddLightningEx("DRAM", true, YDWECoordinateX(GetUnitX(Mengji___ULinglong1) + 900), YDWECoordinateY(GetUnitY(Mengji___ULinglong1)), 0, YDWECoordinateX(GetUnitX(Mengji___ULinglong1) + 900), YDWECoordinateY(GetUnitY(Mengji___ULinglong1)), 750)
		set Mengji___LLinglong[2]=AddLightningEx("DRAM", true, YDWECoordinateX(GetUnitX(Mengji___ULinglong1) - 450), YDWECoordinateY(GetUnitY(Mengji___ULinglong1)), 0, YDWECoordinateX(GetUnitX(Mengji___ULinglong1) + 779), YDWECoordinateY(GetUnitY(Mengji___ULinglong1)), 750)
		set Mengji___LLinglong[3]=AddLightningEx("DRAM", true, YDWECoordinateX(GetUnitX(Mengji___ULinglong1) - 450), YDWECoordinateY(GetUnitY(Mengji___ULinglong1)), 0, YDWECoordinateX(GetUnitX(Mengji___ULinglong1) - 779), YDWECoordinateY(GetUnitY(Mengji___ULinglong1)), 750)
		call Mengji___ExchangeChao(true)
		call SaveInteger(spellTable, GetHandleId(t), 1, 0)
		call TimerStart(t, 0.1, true, function Mengji___LinglongwuTimer)
	    call PrintSpell(GetOwningPlayer(mengji) , GetAbilityName('AHM5') , GetDamageAgi(mengji) * 0.2)
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Mengji___TSpellMengjiAct takes nothing returns nothing
		if ( GetSpellAbilityId() == 'AHM1' ) then
			call Mengji___Tanyoujian(0.75 , GetSpellAbilityId() , GetSpellTargetX() , GetSpellTargetY() , 5)
		elseif ( GetSpellAbilityId() == 'AHM2' ) then
			call Mengji___Zhenhunsuo()
		elseif ( GetSpellAbilityId() == 'A0GW' ) then
			call Mengji___Sanchuanjian()
		elseif ( GetSpellAbilityId() == 'AHM4' ) then
			call Mengji___Shunfaxin()
		elseif ( GetSpellAbilityId() == 'AHM5' ) then
			call Mengji___Linglongwu()
		//拟态
		elseif ( GetSpellAbilityId() == 'A0JG' and IsCanCopy(GetSpellTargetItem()) ) then
			if ( IsInRect(GetUnitX(mengji) , GetUnitY(mengji) , gg_rct_______a3) and IsInRect(GetUnitX(mengji) , GetUnitY(mengji) , gg_rct_______a3) ) then
				call DisplayTextToPlayer(GetOwningPlayer(mengji), 0., 0., "|cFFFF66CC【消息】|r此处禁止拟态.")
			else
				call Mengji___Nitai()
			endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
	//按照12345来判断
 function LearnSkillMengjiI takes unit learner,integer whichSpell returns nothing
  local integer i
		if ( learner == mengji ) then
			if ( whichSpell == 1 ) then
			elseif ( whichSpell == 2 and IsSecondSpellOK(mengji) == true and GetUnitAbilityLevel(mengji, 'AHM2') == 1 ) then
				//技能2初始化
			elseif ( whichSpell == 3 and IsThirdSpellOK(mengji) == true and GetUnitAbilityLevel(mengji, 'A0GW') == 1 ) then
				//技能3初始化
				call AddSpecialEffectTargetUnitBJ("origin", mengji, "war3mapImported\\BlightwalkerAura.mdx")
				call InitMengjiAura()
			elseif ( whichSpell == 4 and IsFourthSpellOK(mengji) == true and GetUnitAbilityLevel(mengji, 'AHM4') == 1 ) then
				//技能4初始化
			elseif ( whichSpell == 5 and IsFifthSpellOK(mengji) == true and GetUnitAbilityLevel(mengji, 'AHM5') == 1 ) then
				//技能5初始化
			endif
		endif
	endfunction
 function LearnSkillMengji takes unit learner,integer learnSpellID returns nothing
		if ( learner == mengji ) then
			if ( learnSpellID == 'AHM1' ) then
				call LearnSkillMengjiI(learner , 1)
			elseif ( learnSpellID == 'AHM2' ) then
				call LearnSkillMengjiI(learner , 2)
			elseif ( learnSpellID == 'A0GW' ) then
				call LearnSkillMengjiI(learner , 3)
			elseif ( learnSpellID == 'AHM4' ) then
				call LearnSkillMengjiI(learner , 4)
			elseif ( learnSpellID == 'AHM5' ) then
				call LearnSkillMengjiI(learner , 5)
			endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
 function InitMengji takes unit u returns nothing
     local timer t= CreateTimer()
		set mengji=u
		set Mengji___Liutao=YDWEGetItemOfTypeFromUnitBJNull(mengji , 'I049')
	    call SaveInteger(YDHT, GetHandleId(Mengji___Liutao), 0xA75AD423, GetConvertedPlayerId(GetOwningPlayer(mengji)))
	    
	    call AddStrPercent(GetConvertedPlayerId(GetOwningPlayer(mengji)) , 0.2 * I3(CT2() , 6 , 1))
	    call AddAgiPercent(GetConvertedPlayerId(GetOwningPlayer(mengji)) , 0.2 * I3(CT2() , 6 , 1))
	    call AddIntPercent(GetConvertedPlayerId(GetOwningPlayer(mengji)) , 0.2 * I3(CT2() , 6 , 1))
	    call AddAttackPercent(GetConvertedPlayerId(GetOwningPlayer(mengji)) , 0.5 * I3(CT2() , 6 , 1))
	    call AddSpellPercent(GetConvertedPlayerId(GetOwningPlayer(mengji)) , 0.4 * I3(CT2() , 6 , 1))
	    call AddDamagePercent(GetConvertedPlayerId(GetOwningPlayer(mengji)) , 0.2 * I3(CT2() , 6 , 1))
		call SetPlayerAbilityAvailable(GetOwningPlayer(mengji), 'A0GV', false)
		//若幻梦
	    set Mengji___TSpellMengji01=CreateTrigger()
	    call TriggerRegisterPlayerChatEvent(Mengji___TSpellMengji01, GetOwningPlayer(mengji), "-th", true)
	    call TriggerAddAction(Mengji___TSpellMengji01, function RuohuanmengChatBack1)
	    set Mengji___TSpellMengji02=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(Mengji___TSpellMengji02, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(Mengji___TSpellMengji02, Condition(function Mengji___RuohuanmengAttackCon))
	    call TriggerAddAction(Mengji___TSpellMengji02, function Mengji___RuohuanmengAttack)
	    set Mengji___TSpellMengji03=CreateTrigger()
	    call TriggerRegisterUnitEvent(Mengji___TSpellMengji03, mengji, EVENT_UNIT_DAMAGED)
	    call TriggerAddCondition(Mengji___TSpellMengji03, Condition(function RuohuanmengDeathCon))
	    call TriggerAddAction(Mengji___TSpellMengji03, function RuohuanmengDeathAct)
		//主英雄技能
		set Mengji___TSpellMengji=CreateTrigger()
	    call TriggerRegisterUnitEvent(Mengji___TSpellMengji, u, EVENT_UNIT_SPELL_EFFECT)
	    call TriggerAddAction(Mengji___TSpellMengji, function Mengji___TSpellMengjiAct)
	    //若幻梦静止与动
	    call TimerStart(t, 0.5, true, function Mengji___RuohuanmengTimer)
	    //英雄第二个技能攻击事件
	    set Mengji___TSpellMengji2=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(Mengji___TSpellMengji2, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(Mengji___TSpellMengji2, Condition(function Mengji___TSpellMengji2Con))
	    call TriggerAddAction(Mengji___TSpellMengji2, function Mengji___TSpellMengji2Act)
	    //瞬伐心
	    set Mengji___TSpellMengji41=CreateTrigger()
	    call TriggerRegisterUnitEvent(Mengji___TSpellMengji41, mengji, EVENT_UNIT_ISSUED_TARGET_ORDER)
	    call TriggerAddCondition(Mengji___TSpellMengji41, Condition(function Mengji___TSpellMengji4Con))
	    call TriggerAddAction(Mengji___TSpellMengji41, function Mengji___TSpellMengji41Act)
	    call DisableTrigger(Mengji___TSpellMengji41)
	    set Mengji___TSpellMengji42=CreateTrigger()
	    call TriggerRegisterUnitEvent(Mengji___TSpellMengji42, mengji, EVENT_UNIT_ISSUED_POINT_ORDER)
	    call TriggerAddCondition(Mengji___TSpellMengji42, Condition(function Mengji___TSpellMengji4Con))
	    call TriggerAddAction(Mengji___TSpellMengji42, function Mengji___TSpellMengji42Act)
	    call DisableTrigger(Mengji___TSpellMengji42)
	    set t=null
	endfunction

//library Mengji ends
//library Qixi:
//---------------------------------------------------------------------------------------------------
	
 function Buchang takes player p returns nothing
		// local integer i = GetConvertedPlayerId(p)
		// if (playerName[i] == "Cyandrizzle") then
		// 	call GetAchievementAndSave(p,325)
		// 	call GetAchievementAndSave(p,35)
		// 	call GetAchievementAndSave(p,321)
		// 	call GetAchievementAndSave(p,412)
		// 	call GetAchievementAndSave(p,413)
		// 	call GetAchievementAndSave(p,414)
		// endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
	
//---------------------------------------------------------------------------------------------------
	
	
//---------------------------------------------------------------------------------------------------
	
	
//---------------------------------------------------------------------------------------------------
	
	
//---------------------------------------------------------------------------------------------------
	
 function Qixi___QixiHuodongFafang takes player p returns nothing
		//倾雪
		//call Fafang1(p)
		//救死
		//call Fafang2(p)
		//皮肤
		//call Fafang3(p)
		//幻逸
		//call Fafang4(p)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Qixi___QixiHuodongJudgeTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local player p= LoadPlayerHandle(LHTable, id, 1)
		call Qixi___QixiHuodongFafang(p)
		call PauseTimer(t)
		call FlushChildHashtable(LHTable, id)
		call DestroyTimer(t)
		set p=null
		set t=null
	endfunction
 function QixiHuodong takes player p returns nothing
  local timer t= CreateTimer()
		call SavePlayerHandle(LHTable, GetHandleId(t), 1, p)
		call TimerStart(t, 1, false, function Qixi___QixiHuodongJudgeTimer)
		set t=null
	endfunction

//library Qixi ends
//library ChallangerMode:
//---------------------------------------------------------------------------------------------------
    
    function ShowChallangerDialog takes player p returns nothing
    	if ( CType != 0 ) then
        	call ShowGameHint(p , GetChallangerContent(CType))
    	endif
    endfunction
//---------------------------------------------------------------------------------------------------
	
 function StartTiaozhan1 takes nothing returns nothing
  local integer i= 1
     local unit u= CreateUnit(Player(10), 'h025', 0, 0, 0)
		loop
			exitwhen i > 6
			if ( udg_H[i] != null ) then
				call UnitRemoveAbility(udg_H[i], 'A0B9')
			endif
			set i=i + 1
		endloop
    	call ShowUnitHide(u)
		call BJDebugMsg("|cFFFF66CC【消息】|r你们开启了成就挑战1,所有英雄失去攻击速度与100000%的移动速度.")
		set u=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitKuanghuan takes nothing returns nothing
		set CType=- 1
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ChallangerMode___Tiaozhan2Timer takes nothing returns nothing
  local integer i= 1
		if ( udg_Bo >= 13 ) then
			loop
				exitwhen i > 6
				if ( udg_H[i] != null ) then
    				call RecoverUnitHP(udg_H[i] , - 0.3)
				endif
				set i=i + 1
			endloop
		else
			loop
				exitwhen i > 6
				if ( udg_H[i] != null ) then
    				call RecoverUnitHP(udg_H[i] , - 0.1)
				endif
				set i=i + 1
			endloop
		endif
	endfunction
 function StartTiaozhan2 takes nothing returns nothing
		call TimerStart(CreateTimer(), 1, true, function ChallangerMode___Tiaozhan2Timer)
		call BJDebugMsg("|cFFFF66CC【消息】|r你们开启了成就挑战2,所有英雄获得金钱为1%,英雄每秒减少10%的生命.(13波开始每秒减少30%的生命)")
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitChallanger takes nothing returns nothing
		if ( CT2() ) then
			set EquipLoopingTime=6
		elseif ( CT3() ) then
			call StartTiaozhan1()
		elseif ( CT4() ) then
			call StartTiaozhan2()
		elseif ( CT5() ) then
			set GJingxiang=CreateGroup()
		elseif ( CT7() ) then
	    	call SetPlayerTechResearchedSwap('R01L', 1, Player(10))
	    	call SetPlayerTechResearchedSwap('R01L', 1, Player(11))
			set udg_I_Er_diansi[1]=udg_I_Er_diansi[1] + 5
		endif
		if ( CType != 0 ) then
			set SgameMode=S3(CDiff == 1 , "简单" , S3(CDiff == 2 , "中等" , "困难")) + GetChallangerTitle(CType)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitChallanger2Hero takes unit u returns nothing
  local integer i= 2
  local item it= null
		if not ( CT2() ) then
			return
		endif
		loop
			exitwhen i > 6
			if ( UnitItemInSlotBJ(u, i) != null ) then
    			call UnitRemoveItemSwapped(UnitItemInSlotBJ(u, i), u)
			endif
			call UnitAddItemByIdSwapped('I079', u)
			set i=i + 1
		endloop
		if ( u == cangling ) then
			set i=8
			loop
				exitwhen i > 12
				set IBibo[i]=CreateItem('I079', 0, 0)
				call SetItemVisible(IBibo[i], false)
				set i=i + 1
			endloop
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitChallanger1Hero takes unit u returns nothing
  local integer int= 0
  local integer agi= 0
  local integer str= 0
		if not ( CT1() ) then
			return
		endif
		set int=GetHeroInt(u, true)
		set agi=GetHeroAgi(u, true)
		set str=GetHeroStr(u, true)
	    call SetHeroLevelBJ(u, 450, false)
	    call SetHeroInt(u, int, true)
	    call SetHeroAgi(u, agi, true)
	    call SetHeroStr(u, str, true)
	    call AddAgiPercentImme(GetConvertedPlayerId(GetOwningPlayer(u)) , - 0.95)
	    call AddStrPercentImme(GetConvertedPlayerId(GetOwningPlayer(u)) , - 0.95)
	    call AddIntPercentImme(GetConvertedPlayerId(GetOwningPlayer(u)) , - 0.95)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ChooseDifficulty takes integer i returns nothing
		call DialogSetMessage(udg_X_Nandu, "选择难度")
	    if ( i < 2 ) then
		    call DialogAddButtonBJ(udg_X_Nandu, "天国（24波）")
		    set udg_X_Nandu_Chuangkou[1]=GetLastCreatedButtonBJ()
	    endif
	    if ( i < 3 ) then
		    call DialogAddButtonBJ(udg_X_Nandu, "太平（24波）")
		    set udg_X_Nandu_Chuangkou[2]=GetLastCreatedButtonBJ()
	    endif
	    if ( i < 4 ) then
		    call DialogAddButtonBJ(udg_X_Nandu, "和谐（24+5波）")
		    set udg_X_Nandu_Chuangkou[3]=GetLastCreatedButtonBJ()
	    endif
	    if ( i < 5 ) then
		    call DialogAddButtonBJ(udg_X_Nandu, "战争（24+5波）")
		    set udg_X_Nandu_Chuangkou[4]=GetLastCreatedButtonBJ()
		endif
	    if ( i < 6 ) then
		    call DialogAddButtonBJ(udg_X_Nandu, "炼狱（24+5+2波）")
		    set udg_X_Nandu_Chuangkou[5]=GetLastCreatedButtonBJ()
		endif
	    if ( i < 7 ) then
		    call DialogAddButtonBJ(udg_X_Nandu, "地狱（24+5+2波）")
		    set udg_X_Nandu_Chuangkou[6]=GetLastCreatedButtonBJ()
		endif
	    if ( i < 8 ) then
		    call DialogAddButtonBJ(udg_X_Nandu, "|cFFFF0000末日|r（24+5+2波）")
		    set udg_X_Nandu_Chuangkou[7]=GetLastCreatedButtonBJ()
		endif
	    if ( i < 9 ) then
		    call DialogAddButtonBJ(udg_X_Nandu, "|cffff00ff轮回|r（24+5+2波）")
		    set udg_X_Nandu_Chuangkou[8]=GetLastCreatedButtonBJ()
		endif
	    if ( i < 10 ) then
		    call DialogAddButtonBJ(udg_X_Nandu, "|cff008000万劫|r（24+5+2波）")
		    set udg_X_Nandu_Chuangkou[9]=GetLastCreatedButtonBJ()
		endif
	    if ( IsTianyanOK() ) then
		    call DialogAddButtonBJ(udg_X_Nandu, "|cff993366天魇|r（24+5+2波）")
		    set udg_X_Nandu_Chuangkou[10]=GetLastCreatedButtonBJ()
	    endif
	    call DialogDisplay(GetFirstPlayer(), udg_X_Nandu, true)
	    if ( CType != 0 and CType != - 1 ) then
	    	call InitChallanger()
	    endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ChallangerMode___ChooseSpeedClick takes nothing returns nothing
     local dialog d= GetClickedDialogBJ()
        if ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), 1) ) then
        	call BJDebugMsg("|cFFFF66CC【消息】|r当前游戏速度为经典(常速).")
			set mode=1
			set SgameMode=SgameMode + "C"
    	endif
        if ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), 2) ) then
        	call BJDebugMsg("|cFFFF66CC【消息】|r当前游戏速度为加速(进阶).")
			set mode=2
			set SgameMode=SgameMode + "S"
    	endif
    	call ChooseDifficulty(GetChallangerDifficulty())
        call FlushChildHashtable(LHTable, GetHandleId(d))
    	call DialogDisplay(Player(0), d, false)
        call DialogClear(d)
        call DialogDestroy(d)
        set d=null
        call DestroyTrigger(GetTriggeringTrigger())
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ChallangerMode___CreateCDialog4 takes nothing returns nothing
     local trigger t= CreateTrigger()
     local dialog d= DialogCreate()
    	call DialogSetMessage(d, "经典(常速)还是加速?")
	    call SaveButtonHandle(LHTable, GetHandleId(d), 1, DialogAddButtonBJ(d, "经典(推荐)"))
    	call SaveButtonHandle(LHTable, GetHandleId(d), 2, DialogAddButton(d, "加速(进阶)", 512))
	    call DialogDisplay(GetFirstPlayer(), d, true)
	    call TriggerRegisterDialogEvent(t, d)
	    call TriggerAddAction(t, function ChallangerMode___ChooseSpeedClick)
	    set d=null
	    set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ChallangerMode___ChooseComfirmClick takes nothing returns nothing
     local dialog d= GetClickedDialogBJ()
        if ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), 1) ) then
        	call ChallangerMode___CreateCDialog4()
        	call BJDebugMsg("|cFFFF66CC【消息】|r已确认挑战内容,正在选择加速与难度.")
    	endif
        if ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), 2) ) then
    		call sc___prototype51_execute(1)
        	call BJDebugMsg("|cFFFF66CC【消息】|r正在切换挑战类型.")
    	endif
        call FlushChildHashtable(LHTable, GetHandleId(d))
    	call DialogDisplay(Player(0), d, false)
        call DialogClear(d)
        call DialogDestroy(d)
        set d=null
        call DestroyTrigger(GetTriggeringTrigger())
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ChallangerMode___CreateCDialog3 takes integer i returns nothing
     local trigger t= CreateTrigger()
     local dialog d= DialogCreate()
    	call DialogSetMessage(d, GetChallangerContent(i))
    	//设置类型
    	set CType=i
	    call SaveButtonHandle(LHTable, GetHandleId(d), 1, DialogAddButtonBJ(d, "确认选择"))
    	call SaveButtonHandle(LHTable, GetHandleId(d), 2, DialogAddButton(d, "返回|cffff6800(Esc)|r", 512))
	    call DialogDisplay(GetFirstPlayer(), d, true)
	    call TriggerRegisterDialogEvent(t, d)
	    call TriggerAddAction(t, function ChallangerMode___ChooseComfirmClick)
	    set d=null
	    set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ChallangerMode___ChooseChallangerClick takes nothing returns nothing
     local dialog d= GetClickedDialogBJ()
     local integer i= 1
	    loop
	    	exitwhen i > 9
	        if ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), i) ) then
        		call ChallangerMode___CreateCDialog3(i)
        		call BJDebugMsg("|cFFFF66CC【消息】|r当前挑战为" + GetChallangerTitle(i) + ".")
	    	endif
	    	set i=i + 1
	    endloop
        if ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), 10) ) then
    		call sc___prototype51_execute(2)
    		call BJDebugMsg("|cFFFF66CC【消息】|r正在切换挑战难度.")
    	endif
        call FlushChildHashtable(LHTable, GetHandleId(d))
    	call DialogDisplay(Player(0), d, false)
        call DialogClear(d)
        call DialogDestroy(d)
        set d=null
        call DestroyTrigger(GetTriggeringTrigger())
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CreateCDialog2 takes nothing returns nothing
     local trigger t= CreateTrigger()
     local dialog d= DialogCreate()
     local integer i= 1
	    if ( CDiff == 1 ) then
	    	call DialogSetMessage(d, "选择挑战类别(简单)")
	    elseif ( CDiff == 2 ) then
	    	call DialogSetMessage(d, "选择挑战类别(中等)")
	    elseif ( CDiff == 3 ) then
	    	call DialogSetMessage(d, "选择挑战类别(困难)")
	    endif
	    call SaveButtonHandle(LHTable, GetHandleId(d), 7, DialogAddButtonBJ(d, GetChallangerTitle(7) + S3(IsChallangerComplete(GetFirstPlayer() , 7) , "|cffff9900(已完成)|r" , "|cff33cccc(未完成)|r")))
	    loop
	    	exitwhen i > 6
		    call SaveButtonHandle(LHTable, GetHandleId(d), i, DialogAddButtonBJ(d, GetChallangerTitle(i) + S3(IsChallangerComplete(GetFirstPlayer() , i) , "|cffff9900(已完成)|r" , "|cff33cccc(未完成)|r")))
	    	set i=i + 1
	    endloop
    	call SaveButtonHandle(LHTable, GetHandleId(d), 10, DialogAddButton(d, "返回|cffff6800(Esc)|r", 512))
	    call DialogDisplay(GetFirstPlayer(), d, true)
	    call TriggerRegisterDialogEvent(t, d)
	    call TriggerAddAction(t, function ChallangerMode___ChooseChallangerClick)
	    set d=null
	    set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ChallangerMode___ChooseDifficultyClick takes nothing returns nothing
     local dialog d= GetClickedDialogBJ()
        if ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), 1) ) then
        	set CDiff=1
        	call CreateCDialog2()
        	call BJDebugMsg("|cFFFF66CC【消息】|r当前的挑战模式难度为简单.")
		elseif ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), 2) ) then
        	set CDiff=2
        	call CreateCDialog2()
        	call BJDebugMsg("|cFFFF66CC【消息】|r当前的挑战模式难度为中等.")
		elseif ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), 3) ) then
        	set CDiff=3
        	call CreateCDialog2()
        	call BJDebugMsg("|cFFFF66CC【消息】|r当前的挑战模式难度为困难.")
		endif
        call FlushChildHashtable(LHTable, GetHandleId(d))
    	call DialogDisplay(Player(0), d, false)
        call DialogClear(d)
        call DialogDestroy(d)
        set d=null
        call DestroyTrigger(GetTriggeringTrigger())
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CreateCDialog1 takes nothing returns nothing
     local trigger t= CreateTrigger()
     local dialog d= DialogCreate()
	    call DialogSetMessage(d, "选择挑战难度")
	    if ( true ) then
		    call SaveButtonHandle(LHTable, GetHandleId(d), 1, DialogAddButtonBJ(d, "简单(" + I2S(GetEasyComplete(GetFirstPlayer())) + "/" + I2S(COUNT_CHALLANGER) + ")"))
		    call SaveButtonHandle(LHTable, GetHandleId(d), 2, DialogAddButtonBJ(d, "中等(" + I2S(GetMiddleComplete(GetFirstPlayer())) + "/" + I2S(COUNT_CHALLANGER) + ")"))
		    call SaveButtonHandle(LHTable, GetHandleId(d), 3, DialogAddButtonBJ(d, "困难(" + I2S(GetHardComplete(GetFirstPlayer())) + "/" + I2S(COUNT_CHALLANGER) + ")"))
		else
			call SaveButtonHandle(LHTable, GetHandleId(d), 1, DialogAddButtonBJ(d, "简单"))
		    call SaveButtonHandle(LHTable, GetHandleId(d), 2, DialogAddButtonBJ(d, "中等"))
		    call SaveButtonHandle(LHTable, GetHandleId(d), 3, DialogAddButtonBJ(d, "困难"))
	    endif
	    call DialogDisplay(GetFirstPlayer(), d, true)
	    call TriggerRegisterDialogEvent(t, d)
	    call TriggerAddAction(t, function ChallangerMode___ChooseDifficultyClick)
	    set d=null
	    set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ShowTiaozhanDialog takes nothing returns nothing
		call CreateCDialog1()
	endfunction

//library ChallangerMode ends
//library Diffculty:
//---------------------------------------------------------------------------------------------------
	
 function GetDiffculty takes nothing returns integer
		if ( udg_Nandu_JJJ > 7 ) then
			return 9
		elseif ( udg_Nandu > 20 ) then
			return 8
		elseif ( udg_Nandu > 10 ) then
			return 7
		elseif ( udg_Nandu > 8 ) then
			return 6
		elseif ( udg_Nandu > 6 ) then
			return 5
		elseif ( udg_Nandu > 4 ) then
			return 4
		elseif ( udg_Nandu > 2 ) then
			return 3
		elseif ( udg_Nandu > 1 ) then
			return 2
		else
			return 1
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CreateJingongguai takes integer unitType,real facing returns nothing
  local integer id
		if ( CT5() ) then
			set id=GetNextPlayerID()
	    	call CreateNUnitsAtLoc(1, GetUnitTypeId(udg_H[id]), Player(11), udg_Point, facing)
	    	call SetUnitMirror(GetLastCreatedUnit() , udg_H[id] , I3(udg_Bo == 1 , 1 , udg_Bo * GetDiffculty()))
	    	call GroupAddUnit(GJingxiang, GetLastCreatedUnit())
		else
	    	call CreateNUnitsAtLoc(1, unitType, Player(11), udg_Point, facing)
		endif
	endfunction
	
 function IsWanjie takes nothing returns boolean
		return GetDiffculty() == 9
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function EnhanceDiffAttack takes unit u returns nothing
		if ( NanDiff <= 0 ) then
			return
		endif
		if ( IsTianyan ) then
			call UnitAddAbility(u, 'A0G5')
		endif
		//100倍攻击加强
		if ( GetUnitAbilityLevel(u, 'A09V') >= 1 ) then
			call SetUnitAbilityLevel(u, 'A09V', NanDiff + 1)
			return
		endif
		call UnitAddAbility(u, 'A0EY')
		call SetUnitAbilityLevel(u, 'A0EY', NanDiff)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function AddTianyanmokang takes unit u returns nothing
		if ( IsTianyan ) then
			 call UnitAddAbility(u, 'A09G')
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function RemoveDiffAttack takes unit u returns nothing
		if ( GetUnitAbilityLevel(u, 'A09V') >= 1 ) then
			call SetUnitAbilityLevel(u, 'A09V', 1)
		endif
		call UnitRemoveAbility(u, 'A0EY')
		call UnitRemoveAbility(u, 'A05O')
		call UnitRemoveAbility(u, 'A0G5')
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function EnhanceWanjieAttack takes unit u returns nothing
		if ( IsWanjie() ) then
			call EnhanceDiffAttack(u)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function AttackBase takes unit u returns nothing
		if ( IsTianyan and GetUnitTypeId(u) == 'hrif' ) then
			call IssueTargetOrder(u, "attack", gg_unit_haro_0030)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetJunengTech takes nothing returns integer
		if ( NanDiff == 1 ) then
			return 'R00T'
		elseif ( NanDiff == 2 ) then
			return 'R00U'
		elseif ( NanDiff == 3 ) then
			return 'R00V'
		else
			return 'R00R'
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetHundunTech takes nothing returns integer
		if ( NanDiff == 1 ) then
			return 'R01H'
		elseif ( NanDiff == 2 ) then
			return 'R01I'
		elseif ( NanDiff == 3 ) then
			return 'R01J'
		else
			return 'R01G'
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetHundun2Tech takes nothing returns integer
		if ( NanDiff == 1 ) then
			return 'R01M'
		elseif ( NanDiff == 2 ) then
			return 'R01N'
		elseif ( NanDiff == 3 ) then
			return 'R01O'
		else
			return 'R01P'
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetForbidTianfuTime takes nothing returns real
		if ( GetDiffculty() >= 9 ) then
			return 9.5
		elseif ( GetDiffculty() >= 8 ) then
			return 7.5
		else
			return 5.
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetArenaUpdateSpeed takes nothing returns real
		if ( NanDiff == 1 ) then
			return 4.
		elseif ( NanDiff == 2 ) then
			return 3.
		elseif ( NanDiff == 3 ) then
			return 2.
		else
			return 5.
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetWanjieInt takes integer value,real rate returns integer
		if ( IsWanjie() ) then
			return IMinBJ(2100000000, R2I(I2R(value) * rate))
		endif
		return value
	endfunction
	
 function GetWanjieReal takes real value,real rate returns real
		if ( IsWanjie() ) then
			return value * rate
		endif
		return value
	endfunction
	
 function GetWanjieAddInt takes integer value,integer add returns integer
		if ( IsWanjie() ) then
			return value + add
		endif
		return value
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function AddWanjieSpell takes unit u returns nothing
		if ( IsWanjie() ) then
			if ( udg_Bo > 10 ) then
				//60倍技能
				call UnitAddAbility(u, 'A0GL')
			endif
			//闪烁技能
			call UnitAddAbility(u, 'ANbl')
			call UnitAddAbility(u, 'A0HE')
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function PrintDifficulty takes nothing returns nothing
  local integer d= GetDiffculty()
		if ( d == 6 ) then
			call BJDebugMsg("|cFFFF66CC【消息】|r地狱难度下，会额外提高以下怪物的难度：")
			call BJDebugMsg("|cFFFF66CC【消息】|r炼狱30+层、宝石区怪物和翅膀区伤害提高100%,生命提高66%.")
		elseif ( d == 7 ) then
			call BJDebugMsg("|cFFFF66CC【消息】|r|cffff0000末日|r难度下，会额外提高以下怪物的难度：")
			call BJDebugMsg("|cFFFF66CC【消息】|r炼狱30+层、宝石区怪物和翅膀区伤害提高200%,生命提高133%.")
		elseif ( d == 8 ) then
			call BJDebugMsg("|cFFFF66CC【消息】|r|cffff00ff轮回|r难度下，会额外提高以下怪物的难度：")
			call BJDebugMsg("|cFFFF66CC【消息】|r炼狱30+层、宝石区怪物和翅膀区伤害提高300%,有几率无视闪避,生命提高200%.")
		elseif ( d == 9 ) then
			call BJDebugMsg("|cFFFF66CC【消息】|r|cff008000万劫|r难度下，会额外提高以下怪物的难度：")
			call BJDebugMsg("|cFFFF66CC【消息】|r炼狱30+层、宝石区怪物和翅膀区伤害提高300%,有几率无视闪避,生命提高200%.")
			call BJDebugMsg("|cFFFF66CC【消息】|r炼狱前30层与天庭均会增强同上属性.")
			call BJDebugMsg("|cFFFF66CC【消息】|r所有单位增加50%基础防御,所有非英雄单位增加2%生命回复速度.")
			call BJDebugMsg("|cFFFF66CC【消息】|r野怪每次升级会升3级.")
			call BJDebugMsg("|cFFFF66CC【消息】|r进攻怪获得技能\"闪烁\",10波以后怪物提高20倍生命与20倍攻击.")
			call BJDebugMsg("|cFFFF66CC【消息】|r熊猫与大法BOSS提高50倍生命与20倍生命.")
			call BJDebugMsg("|cFFFF66CC【消息】|r英雄获得经验减少25%.")
			call BJDebugMsg("|cFFFF66CC【消息】|r通关该难度可以加轮回之狱主群把你名字永久保存在|cff99cc00封帝万劫录|r中哦!")
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitWanjie takes nothing returns nothing
		//光环（加防和回血）
    	set UWanjieGuanghuan=CreateUnit(Player(10), 'h00U', 0, 0, 0)
    	if ( IsTianyan ) then
    		call SetUnitAbilityLevel(UWanjieGuanghuan, 'A0HD', 2)
    		call UnitAddAbility(UWanjieGuanghuan, 'A0JJ')
    	endif
    	call ShowUnitHide(UWanjieGuanghuan)
		//前三野与前30层科技 3倍生命
    	call SetPlayerTechResearchedSwap('R00X', 1, Player(10))
    	call SetPlayerTechResearchedSwap('R00X', 1, Player(11))
    	//11-24波怪物，10倍生命
    	call SetPlayerTechResearchedSwap('R00Y', 1, Player(10))
    	call SetPlayerTechResearchedSwap('R00Y', 1, Player(11))
    	//加宝石射程
    	call SetPlayerTechResearchedSwap('R010', 1, Player(10))
    	call SetPlayerTechResearchedSwap('R010', 1, Player(11))
    	call SetPlayerTechResearchedSwap('R011', 1, Player(10))
    	call SetPlayerTechResearchedSwap('R011', 1, Player(11))
    	//冥刹30000E
    	call SetPlayerTechResearchedSwap('R013', 1, Player(10))
    	call SetPlayerTechResearchedSwap('R013', 1, Player(11))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Diffculty___UnlimitSlienceTianyanTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local unit u= LoadUnitHandle(spellTable, id, 1)
		if ( IsUnitAliveBJ(u) ) then
 			call SimulateSpell(u , u , 'A0JK' , 1 , 5 , "silence" , true , false , false)
		else
			call PauseTimer(t)
			call FlushChildHashtable(spellTable, id)
			call DestroyTimer(t)
		endif
		set u=null
		set t=null
	endfunction
 function UnlimitSlienceTianyan takes unit u returns nothing
  local timer t= CreateTimer()
		call SaveUnitHandle(spellTable, GetHandleId(t), 1, u)
		call TimerStart(t, 3, true, function Diffculty___UnlimitSlienceTianyanTimer)
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitTianyan takes nothing returns nothing
  local unit l_unit= null
  local group g= YDWEGetUnitsOfTypeIdAllNull('uzg2')
		loop
		    set l_unit=FirstOfGroup(g)
		    exitwhen l_unit == null
		    call GroupRemoveUnit(g, l_unit)
		    call AddTianyanmokang(l_unit)
		endloop
    	call SetPlayerTechResearchedSwap('R00Z', 1, Player(10))
    	call SetPlayerTechResearchedSwap('R00Z', 1, Player(11))
    	call SetPlayerTechResearchedSwap('R01F', 1, Player(10))
    	call SetPlayerTechResearchedSwap('R01F', 1, Player(11))
    	call DestroyGroup(g)
    	set g=null
    	set l_unit=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Show245Dialog takes nothing returns nothing
		call ShowGameHintAll("\n		感谢对本地图的支持！\n    	你选择的难度在这波就结束了.\n    	后续的关卡请选择\"和谐\"难度(难度3)或以上进行体验\n    	(前5个难度其实提升不大)")
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Show2451Dialog takes nothing returns nothing
		call ShowGameHintAll("\n			感谢对本地图的支持！\n	    	你选择的难度在这波就结束了.\n	    	后续的关卡请选择\"炼狱\"难度(难度35)或以上进行体验\n	    	(前5个难度其实提升不大)")
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ShowMingjieDialog takes nothing returns nothing
		call ShowGameHintAll("\n			|cffff6800新任务:|r\n			击败来自冥界的5波攻击并击败|cffff0000冥刹|r.")
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ShowKuileiDialog takes nothing returns nothing
		call ShowGameHintAll("\n			|cffff6800新任务:|r\n			击败六界傀儡|cffffff00穆晴|r与白浅.")
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Diffculty___GameModeClick takes nothing returns nothing
     local dialog d= GetClickedDialogBJ()
        if ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), 1) ) then
			//经典模式
			set mode=1
			call BJDebugMsg("|cFFFF66CC【消息】|r当前的游戏模式为\"经典模式\".")
			set SgameMode="经典"
			call ChooseDifficulty(1)
		elseif ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), 3) ) then
			//加速模式
			call BJDebugMsg("|cFFFF66CC【消息】|r当前的游戏模式为\"挑战模式\".")
			set SgameMode="挑战"
			set mode=1
			call ShowTiaozhanDialog()
		elseif ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), 2) ) then
			//挑战模式
			set mode=2
			call BJDebugMsg("|cFFFF66CC【消息】|r当前的游戏模式为\"加速模式\".")
			set SgameMode="加速"
			call ChooseDifficulty(1)
		elseif ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), 5) ) then
			//挑战模式
			set mode=2
			call BJDebugMsg("|cFFFF66CC【消息】|r当前的游戏模式为\"狂欢模式\".")
			set SgameMode="狂欢"
			call InitKuanghuan()
			call ChooseDifficulty(4)
		endif
        call FlushChildHashtable(LHTable, GetHandleId(d))
    	call DialogDisplay(Player(0), d, false)
        call DialogClear(d)
        call DialogDestroy(d)
        set d=null
        call DestroyTrigger(GetTriggeringTrigger())
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ChooseGameMode takes nothing returns nothing
     local trigger t= CreateTrigger()
     local dialog d= DialogCreate()
	    call DialogSetMessage(d, "请选择游戏模式")
	    if ( IsKuanghuanTime() ) then
	    	call SaveButtonHandle(LHTable, GetHandleId(d), 5, DialogAddButtonBJ(d, "狂欢模式(活动)"))
	    endif
	    call SaveButtonHandle(LHTable, GetHandleId(d), 1, DialogAddButtonBJ(d, "经典模式"))
	    call SaveButtonHandle(LHTable, GetHandleId(d), 3, DialogAddButtonBJ(d, "挑战模式"))
	    call SaveButtonHandle(LHTable, GetHandleId(d), 2, DialogAddButtonBJ(d, "加速模式(速通)"))
	    call DialogDisplay(GetFirstPlayer(), d, true)
	    call TriggerRegisterDialogEvent(t, d)
	    call TriggerAddAction(t, function Diffculty___GameModeClick)
	    set d=null
	    set t=null
	endfunction

//library Diffculty ends
//library Battle:
//---------------------------------------------------------------------------------------------------
	
 function TStartFastMonsterAct takes nothing returns nothing
  local integer i= 1
		if ( GetItemTypeId(GetSoldItem()) == 'I04P' ) then
			set BSkip[GetConvertedPlayerId(GetOwningPlayer(GetBuyingUnit()))]=true
	        call PingMinimap(8189.00, 1461, 8.00)
			loop
				exitwhen i > 6
				if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) ) then
					if ( BSkip[i] ) then
	    				call BJDebugMsg("|cFFFF66CC【消息】|r" + GetUnitName(udg_H[i]) + "打开了急速出怪的开关,需要全员打开才能急速出怪！")
	    			else
	    				call BJDebugMsg("|cFFFF66CC【消息】|r" + GetUnitName(udg_H[i]) + "还未打开急速出怪的开关,需要全员打开才能急速出怪！")
					endif
				endif
				set i=i + 1
			endloop
		endif
	    if ( ( GetItemTypeId(GetSoldItem()) == 'ssan' ) ) then
	        call SetUnitUserData(gg_unit_ndrz_0019, 1)
	        call DisplayTextToForce(GetPlayersAll(), "|cFFFF66CC【消息】|r出怪间隔被调整成了1s。|cffffff00（此时很危险！）|r")
	    endif
	    if ( ( GetItemTypeId(GetSoldItem()) == 'sreg' ) ) then
	        call SetUnitUserData(gg_unit_ndrz_0019, 2)
	        call DisplayTextToForce(GetPlayersAll(), "|cFFFF66CC【消息】|r出怪间隔被调整成了2s。|cffffff00（此时较危险！）|r")
	    endif
	    if ( ( GetItemTypeId(GetSoldItem()) == 'stwp' ) ) then
	        call SetUnitUserData(gg_unit_ndrz_0019, 3)
	        call DisplayTextToForce(GetPlayersAll(), "|cFFFF66CC【消息】|r出怪间隔被调整成了3s。")
	    endif
	    if ( ( GetItemTypeId(GetSoldItem()) == 'mcri' ) ) then
	        call SetUnitUserData(gg_unit_ndrz_0019, 4)
	        call DisplayTextToForce(GetPlayersAll(), "|cFFFF66CC【消息】|r出怪间隔被调整成了4s。")
	    endif
	    if ( ( GetItemTypeId(GetSoldItem()) == 'pnvl' ) ) then
	        call SetUnitUserData(gg_unit_ndrz_0019, 5)
	        call DisplayTextToForce(GetPlayersAll(), "|cFFFF66CC【消息】|r出怪间隔被调整成了5s。|cffffff00（此时较安全。）|r")
	    endif
	    if ( ( GetItemTypeId(GetSoldItem()) == 'pclr' ) ) then
	        call SetUnitUserData(gg_unit_ndrz_0019, 6)
	        call DisplayTextToForce(GetPlayersAll(), "|cFFFF66CC【消息】|r出怪间隔被调整成了6s。|cffffff00（此时很安全。）|r")
	    endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Battle___IsFastly takes nothing returns boolean
  local integer i= 1
  local integer count= 0
		loop
			exitwhen i > 6
			if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) and BSkip[i] ) then
				set count=count + 1
			endif
			set i=i + 1
		endloop
		return count >= udg_RENSHU
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetMonsterSpeed takes nothing returns real
		if ( Battle___IsFastly() ) then
			return 3.
		endif
		return I2R(GetUnitUserData(gg_unit_ndrz_0019))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetFastMonsterCount takes integer i returns integer
		if ( Battle___IsFastly() or CT5() ) then
			return i / 3
		endif
		return CModeH(i , i / 2)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetBoSpeed takes nothing returns real
		if ( Battle___IsFastly() or ( IsKuanghuan() and IsTianyan and udg_Bo >= 8 ) ) then
			return 51.
		else
			return RCModeH(300. , 150.)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetWangSpeed takes nothing returns real
		//return 60.
		if ( Battle___IsFastly() ) then
			return 60.
		else
			return 420.
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Battle___InitBattle takes nothing returns nothing
  local integer i= 1
     local trigger t= CreateTrigger()
		loop
			exitwhen i > 6
			set BSkip[i]=false
			if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) then
				set BSkip[i]=false
			endif
			set i=i + 1
		endloop
	    call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_SELL_ITEM)
	    call TriggerAddAction(t, function TStartFastMonsterAct)
	    set t=null
	endfunction

//library Battle ends
//library ItemBase:
//---------------------------------------------------------------------------------------------------
	
 function IsChaoshen takes item i returns boolean
  local integer id= GetItemTypeId(i)
		return id == 'I07F' or id == 'I07E' or id == 'ICS1' or id == 'I04W' or id == 'tlum'
	endfunction
	//判断是否大于3级的神器
 function IsShen3 takes item i returns boolean
  local integer id= GetItemTypeId(i)
		return IsChaoshen(i) or id == 'sksh' or id == 'oslo' or id == 'grsl' or id == 'flag' or id == 'ocor' or id == 'blba' or id == 'cosl' or id == 'shhn' or id == 'rat3' or id == 'pams' or id == 'jdrn' or id == 'shcw' or id == 'stre' or id == 'shrs' or id == 'kgal' or id == 'shtm' or id == 'lure' or id == 'thdm' or id == 'arsh' or id == 'srtl' or id == 'rots' or id == 'tmmt' or id == 'brag' or id == 'olig' or id == 'tbar' or id == 'ccmd' or id == 'iwbr'
	endfunction
	
 function IsShenAll takes item i returns boolean
  local integer id= GetItemTypeId(i)
		return IsShen3(i) or id == 'I04Z' or id == 'I056' or id == 'I057' or id == 'I050' or id == 'I055' or id == 'I03Y' or id == 'nflg' or id == 'spre' or id == 'fwss' or id == 'uflg' or id == 'tgxp' or id == 'dust' or id == 'esaz' or id == 'asbl' or id == 'ram4' or id == 'ram3' or id == 'ram2' or id == 'ram1'
	endfunction
	//判断身上神器的数量
 function Shen3Count takes unit u returns integer
  local integer i= 1
  local integer count= 0
		loop
			exitwhen i > 6
			if ( IsShen3(UnitItemInSlotBJ(u, i)) ) then
				set count=count + 1
			endif
			set i=i + 1
		endloop
		return count
	endfunction
	//神器破防技能
 function GetShenPofangSpell takes unit u returns integer
		if ( YDWEUnitHasItemOfTypeBJNull(u , 'I07F') ) then
			return 'A0DA'
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'I07E') ) then
			return 'A0CI'
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'ICS1') ) then
			return 'A0CH'
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'I04W') ) then
			return 'A0K5'
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'tlum') ) then
			return 'A0D9'
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'tbar') or YDWEUnitHasItemOfTypeBJNull(u , 'ccmd') ) then
			return 'A0CQ'
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'shtm') or YDWEUnitHasItemOfTypeBJNull(u , 'srtl') or YDWEUnitHasItemOfTypeBJNull(u , 'olig') ) then
			return 'A0BK'
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'kgal') or YDWEUnitHasItemOfTypeBJNull(u , 'arsh') or YDWEUnitHasItemOfTypeBJNull(u , 'brag') ) then
			return 'A0BC'
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'shrs') or YDWEUnitHasItemOfTypeBJNull(u , 'thdm') or YDWEUnitHasItemOfTypeBJNull(u , 'tmmt') ) then
			return 'A0AX'
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'stre') or YDWEUnitHasItemOfTypeBJNull(u , 'lure') or YDWEUnitHasItemOfTypeBJNull(u , 'rots') ) then
			return 'A0A9'
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'ram3') or YDWEUnitHasItemOfTypeBJNull(u , 'ram2') or YDWEUnitHasItemOfTypeBJNull(u , 'ram1') ) then
			return 'A088'
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'uflg') or YDWEUnitHasItemOfTypeBJNull(u , 'tgxp') or YDWEUnitHasItemOfTypeBJNull(u , 'dust') ) then
			return 'A087'
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'I050') or YDWEUnitHasItemOfTypeBJNull(u , 'I055') or YDWEUnitHasItemOfTypeBJNull(u , 'I03Y') ) then
			return 'A041'
		endif
		return 0
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsChaomo takes item i returns boolean
  local integer id= GetItemTypeId(i)
		return id == 'IB09' or id == 'IB0A' or id == 'I04X' or id == 'I07O' or id == 'I07N'
	endfunction
 function IsMo3 takes item i returns boolean
  local integer id= GetItemTypeId(i)
		return IsChaomo(i) or id == 'IB04' or id == 'IB05' or id == 'IB06' or id == 'IB07' or id == 'IB08'
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsGui3 takes item i returns boolean
  local integer id= GetItemTypeId(i)
		return IsMaxRing(i) or id == 'lgdh' or id == 'clfm' or id == 'bgst' or id == 'belv' or id == 'hcun' or id == 'rag1' or id == 'penr' or id == 'brac'
	endfunction
 function IsGui takes item i returns boolean
  local integer id= GetItemTypeId(i)
		return IsGui3(i) or id == 'rat9' or id == 'rlif'
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsChaoyao takes item i returns boolean
  local integer id= GetItemTypeId(i)
		return id == 'ICY1' or id == 'I05X' or id == 'I05F' or id == 'I07P' or id == 'I07Q'
	endfunction
 function IsYao3 takes item i returns boolean
  local integer id= GetItemTypeId(i)
		return IsChaoyao(i) or id == 'I041' or id == 'I04R' or id == 'I05C' or id == 'I05B'
	endfunction
 function Yao3Count takes unit u returns integer
  local integer i= 1
  local integer count= 0
		loop
			exitwhen i > 6
			if ( IsYao3(UnitItemInSlotBJ(u, i)) ) then
				set count=count + 1
			endif
			set i=i + 1
		endloop
		return count
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsXianglian takes item i returns boolean
  local integer id= GetItemTypeId(i)
		return id == 'rde3' or id == 'ssil' or id == 'I04Y' or id == 'I05T' or id == 'I07H' or id == 'I07G'
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsChaoren takes item i returns boolean
  local integer id= GetItemTypeId(i)
		return id == 'tbsm' or id == 'tfar' or id == 'tbak' or id == 'I05Y' or id == 'I05Z' or id == 'I060' or id == 'I07K' or id == 'I07J' or id == 'I07I'
	endfunction
 function IsRen3 takes item i returns boolean
  local integer id= GetItemTypeId(i)
		return IsChaoren(i) or id == 'frhg' or id == 'mlst' or id == 'nspi' or id == 'oli2' or id == 'rump' or id == 'shen' or id == 'stpg' or id == 'ofir' or id == 'soul' or id == 'sbok' or id == 'arsc' or id == 'rde0' or id == 'oflg' or id == 'frgd' or id == 'gldo' or id == 'gsou' or id == 'envl' or id == 'rugt' or id == 'shdt' or id == 'crdt' or id == 'pspd'
	endfunction
 function IsRen takes item i returns boolean
  local integer id= GetItemTypeId(i)
		return IsRen3(i) or id == 'rugt' or id == 'drph' or id == 'oven' or id == 'rej4' or id == 'dtsb' or id == 'gobm' or id == 'gvsm' or id == 'pgin' or id == 'rej6' or id == 'tels'
	endfunction
 function GetRenTime takes unit u returns real
		if ( YDWEUnitHasItemOfTypeBJNull(u , 'tbak') or YDWEUnitHasItemOfTypeBJNull(u , 'I060') or YDWEUnitHasItemOfTypeBJNull(u , 'I07I') ) then
			return 9.0
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'pspd') ) then
			return 8.5
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'crdt') or YDWEUnitHasItemOfTypeBJNull(u , 'tfar') or YDWEUnitHasItemOfTypeBJNull(u , 'tbsm') or YDWEUnitHasItemOfTypeBJNull(u , 'I05Y') or YDWEUnitHasItemOfTypeBJNull(u , 'I05Z') or YDWEUnitHasItemOfTypeBJNull(u , 'I07K') or YDWEUnitHasItemOfTypeBJNull(u , 'I07J') ) then
			return 8.0
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'shdt') or YDWEUnitHasItemOfTypeBJNull(u , 'frgd') or YDWEUnitHasItemOfTypeBJNull(u , 'stpg') ) then
			return 7.5
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'rugt') or YDWEUnitHasItemOfTypeBJNull(u , 'oflg') or YDWEUnitHasItemOfTypeBJNull(u , 'shen') ) then
			return 7.0
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'envl') or YDWEUnitHasItemOfTypeBJNull(u , 'rde0') or YDWEUnitHasItemOfTypeBJNull(u , 'rump') ) then
			return 6.5
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'gsou') or YDWEUnitHasItemOfTypeBJNull(u , 'arsc') or YDWEUnitHasItemOfTypeBJNull(u , 'oli2') ) then
			return 6.0
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'gldo') or YDWEUnitHasItemOfTypeBJNull(u , 'sbok') or YDWEUnitHasItemOfTypeBJNull(u , 'nspi') ) then
			return 5.5
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'gvsm') or YDWEUnitHasItemOfTypeBJNull(u , 'soul') or YDWEUnitHasItemOfTypeBJNull(u , 'mlst') ) then
			return 5.0
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'gobm') or YDWEUnitHasItemOfTypeBJNull(u , 'ofir') or YDWEUnitHasItemOfTypeBJNull(u , 'frhg') ) then
			return 4.5
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'pgin') or YDWEUnitHasItemOfTypeBJNull(u , 'tels') or YDWEUnitHasItemOfTypeBJNull(u , 'oven') ) then
			return 4.0
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'dtsb') or YDWEUnitHasItemOfTypeBJNull(u , 'drph') ) then
			return 3.5
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'rej4') or YDWEUnitHasItemOfTypeBJNull(u , 'rej6') ) then
			return 3.0
		endif
		return 0.
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsBox takes item i returns boolean
  local integer id= GetItemTypeId(i)
		return id == 'wild' or id == 'hlst' or id == 'totw' or id == 'sror' or id == 'fgrg' or id == 'wshs' or id == 'I06N' or id == 'I07T' or id == 'I02U'
	endfunction
//---------------------------------------------------------------------------------------------------
	
	//判断身上双魂的数量
 function Xian3Count takes unit u returns integer
  local integer i= 1
  local integer count= 0
		loop
			exitwhen i > 6
			if ( IsZhanfa3(UnitItemInSlotBJ(u, i)) ) then
				set count=count + 1
			endif
			set i=i + 1
		endloop
		return count
	endfunction
 function Zhan0Count takes unit u returns integer
  local integer i= 1
  local integer count= 0
		loop
			exitwhen i > 6
			if ( IsZhan0(UnitItemInSlotBJ(u, i)) ) then
				set count=count + 1
			endif
			set i=i + 1
		endloop
		return count
	endfunction
 function ChaoxianCount takes unit u returns integer
  local integer i= 1
  local integer count= 0
		loop
			exitwhen i > 6
			if ( IsZhanfaChao(UnitItemInSlotBJ(u, i)) ) then
				set count=count + 1
			endif
			set i=i + 1
		endloop
		return count
	endfunction
	//复活时长
 function GetZhanfaReviveTime takes unit u returns real
  local real time= 0
		if ( ChaoxianCount(u) >= 1 or playerName[GetConvertedPlayerId(GetOwningPlayer(u))] == "信哲大人" or B3SecondRevive[GetConvertedPlayerId(GetOwningPlayer(u))] ) then
			set time=3.0 / CModeH(1 , 2)
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'tgrh') ) then
			set time=4.0 / CModeH(1 , 2)
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'I078') or YDWEUnitHasItemOfTypeBJNull(u , 'plcl') ) then
			set time=8.0 / CModeH(1 , 2)
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'tcas') ) then
			set time=10.0 / CModeH(1 , 2)
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'tsct') ) then
			set time=12.0 / CModeH(1 , 2)
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'skul') ) then
			set time=14.0 / CModeH(1 , 2)
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'vamp') ) then
			set time=16.0 / CModeH(1 , 2)
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'I01U') or YDWEUnitHasItemOfTypeBJNull(u , 'rde2') ) then
			set time=18.0 / CModeH(1 , 2)
		else
			set time=20.0 / CModeH(1 , 2)
		endif
		if ( GetUnitTypeId(UDepot[GetConvertedPlayerId(GetOwningPlayer(u))]) == 'n02D' ) then
			set time=RMaxBJ(1.5, time - 1.0)
		endif
		return time
	endfunction
	//复活回复魔法
 function GetZhanfaReviveMana takes unit u returns real
		if ( ChaoxianCount(u) >= 1 ) then
			return 1000.
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'shas') ) then
			return 600.
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'spro') ) then
			return 500.
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'phea') ) then
			return 400.
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'rin1') ) then
			return 300.
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'ward') ) then
			return 200.
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'rde1') or YDWEUnitHasItemOfTypeBJNull(u , 'I027') ) then
			return 100.
		else
			return 0.
		endif
	endfunction
	//战魂加的属性
 function GetZhanhunShuxing takes unit u returns integer
		if ( YDWEUnitHasItemOfTypeBJNull(u , 'I05U') ) then
			return 10
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'ICX1') ) then
			return 9
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'rst1') ) then
			return 8
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'tgrh') ) then
			return 7
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'plcl') ) then
			return 6
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'tcas') ) then
			return 5
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'tsct') ) then
			return 4
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'skul') ) then
			return 3
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'vamp') ) then
			return 2
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'I01E') or YDWEUnitHasItemOfTypeBJNull(u , 'rde2') ) then
			return 1
		else
			return 0
		endif
	endfunction
	//减少的伤害
 function GetZhanhunJianshang takes item i returns integer
  local integer id= GetItemTypeId(i)
		if ( IsZhanfaChao(i) ) then
			return 50000
		elseif ( id == 'tgrh' ) then
			return 25000
		elseif ( id == 'plcl' ) then
			return 10000
		elseif ( id == 'tcas' ) then
			return 6000
		elseif ( id == 'tsct' ) then
			return 3000
		elseif ( id == 'skul' ) then
			return 1000
		elseif ( id == 'I02A' or id == 'rde2' ) then
			return 75
		else
			return 0
		endif
	endfunction
	//复活时长
 function GetZhanfaReviveCool takes unit u returns real
		if ( ChaoxianCount(u) >= 1 ) then
			return 29.
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'tgrh') ) then
			return 59.
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'I078') or YDWEUnitHasItemOfTypeBJNull(u , 'plcl') ) then
			return 99.
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'tcas') ) then
			return 149.
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'tsct') ) then
			return 174.
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'skul') ) then
			return 199.
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'vamp') ) then
			return 219.
		elseif ( YDWEUnitHasItemOfTypeBJNull(u , 'I01U') or YDWEUnitHasItemOfTypeBJNull(u , 'rde2') ) then
			return 249.
		else
			return - 1.
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetRandomPotion takes nothing returns integer
  local integer i= GetRandomInt(1, 6)
		if ( i == 1 ) then
			return 'sres'
		elseif ( i == 2 ) then
			return 'I06A'
		elseif ( i == 3 ) then
			return 'I06B'
		elseif ( i == 4 ) then
			return 'I06C'
		elseif ( i == 5 ) then
			return 'I06J'
		elseif ( i == 6 ) then
			return 'I06O'
		endif
		return 0
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemBase___TGetWingSpellCon takes nothing returns boolean
		return ( GetManipulatingUnit() == udg_H[GetConvertedPlayerId(GetOwningPlayer(GetManipulatingUnit()))] or GetManipulatingUnit() == udg_U_Zhuansheng_Dantiao[2] )
	endfunction
 function ItemBase___TGetWingSpellPickAct takes nothing returns nothing
		if ( GetItemTypeId(GetManipulatedItem()) == 'I043' ) then
			call UnitAddAbility(GetManipulatingUnit(), 'Apxf')
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'I045' ) then
			call UnitAddAbility(GetManipulatingUnit(), 'A06O')
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'I041' ) then
			call UnitAddAbility(GetManipulatingUnit(), 'A09J')
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'I04R' ) then
			call UnitAddAbility(GetManipulatingUnit(), 'A0AO')
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'I05B' ) then
			call UnitAddAbility(GetManipulatingUnit(), 'A0CL')
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'I05C' ) then
			call UnitAddAbility(GetManipulatingUnit(), 'A0CU')
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'I05F' ) then
			call UnitAddAbility(GetManipulatingUnit(), 'A0D0')
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'I05X' ) then
			call UnitAddAbility(GetManipulatingUnit(), 'A0KE')
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'ICY1' ) then
			call UnitAddAbility(GetManipulatingUnit(), 'A0KF')
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'I07P' ) then
			call UnitAddAbility(GetManipulatingUnit(), 'A0KE')
			call SetUnitAbilityLevel(GetManipulatingUnit(), 'A0KE', 2)
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'I07Q' ) then
			call UnitAddAbility(GetManipulatingUnit(), 'A0KF')
			call SetUnitAbilityLevel(GetManipulatingUnit(), 'A0KF', 2)
		endif
	endfunction
 function ItemBase___TGetWingSpellDropAct takes nothing returns nothing
		if ( GetItemTypeId(GetManipulatedItem()) == 'I043' ) then
			call UnitRemoveAbility(GetManipulatingUnit(), 'Apxf')
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'I045' ) then
			call UnitRemoveAbility(GetManipulatingUnit(), 'A06O')
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'I041' ) then
			call UnitRemoveAbility(GetManipulatingUnit(), 'A09J')
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'I04R' ) then
			call UnitRemoveAbility(GetManipulatingUnit(), 'A0AO')
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'I05B' ) then
			call UnitRemoveAbility(GetManipulatingUnit(), 'A0CL')
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'I05C' ) then
			call UnitRemoveAbility(GetManipulatingUnit(), 'A0CU')
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'I05F' ) then
			call UnitRemoveAbility(GetManipulatingUnit(), 'A0D0')
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'I05X' ) then
			call UnitRemoveAbility(GetManipulatingUnit(), 'A0KE')
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'ICY1' ) then
			call UnitRemoveAbility(GetManipulatingUnit(), 'A0KF')
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'I07P' ) then
			call UnitRemoveAbility(GetManipulatingUnit(), 'A0KE')
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'I07Q' ) then
			call UnitRemoveAbility(GetManipulatingUnit(), 'A0KF')
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemBase___TBookBUGCon takes nothing returns boolean
		return GetItemType(GetManipulatedItem()) == ITEM_TYPE_POWERUP
	endfunction
 function ItemBase___TBookBUGAct takes nothing returns nothing
		call YDWEPolledWaitNull(1.0)
		call RemoveItem(GetManipulatedItem())
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ReflashCrainaxAttr takes nothing returns nothing
		call ModifyHeroStat(bj_HEROSTAT_STR, UCrainax, bj_MODIFYMETHOD_SET, IMinBJ(2100000000, R2I(( I2R(udg_Laser[udg_Bo]) * ( 1.00 + ( 0.30 * I2R(udg_Nandu_JJJ) ) ) ))))
	    call ModifyHeroStat(bj_HEROSTAT_AGI, UCrainax, bj_MODIFYMETHOD_SET, IMinBJ(2100000000, R2I(( I2R(udg_Laser[( udg_Bo + 29 )]) * ( 1.00 + ( 0.30 * I2R(udg_Nandu_JJJ) ) ) ))))
	    call ModifyHeroStat(bj_HEROSTAT_INT, UCrainax, bj_MODIFYMETHOD_SET, IMinBJ(2100000000, R2I(( I2R(udg_Laser[( udg_Bo + 58 )]) * ( 1.00 + ( 0.30 * I2R(udg_Nandu_JJJ) ) ) ))))
	    call SetUnitAbilityLevelSwapped('A0EM', UCrainax, udg_Bo)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemBase___ReviveNecklace takes nothing returns nothing
	        call PingMinimap(- 1658.00, - 14973.00, 2.00)
	        call RemoveUnit(UCrainax)
	        set UCrainax=CreateUnit(Player(10), 'Ekgg', - 1658.00, - 14973.00, 180)
	        call AddTianyanmokang(UCrainax)
	        call ReflashCrainaxAttr()
	        call DisplayTextToForce(GetPlayersAll(), "|cFFFF66CC【消息】|r|cffff9900圣主Crainax的分身|r复活.")
	        call TimerDialogDisplay(TiDiaNecklace, false)
	        call DestroyTimerDialog(TiDiaNecklace)
	        call PauseTimer(GetExpiredTimer())
	        call DestroyTimer(GetExpiredTimer())
	        set TiDiaNecklace=null
	endfunction
 function ItemBase___ReviveRing takes nothing returns nothing
   local unit u= null
	        call PingMinimap(- 10630.00, - 8642.00, 2.00)
	        set u=CreateUnit(Player(10), 'Naka', - 10425.00, - 10429.00, 180)
	        call SetHeroLevel(u, ( GetHeroLevel(u) + 1 ), true)
	        call DisplayTextToForce(GetPlayersAll(), ( "|cFFFF66CC【消息】|r|cFFFF6699千年孤魂|r|cffffcc00弑魂|r复活了。" ))
	        set u=null
	        call PauseTimer(GetExpiredTimer())
	        call DestroyTimer(GetExpiredTimer())
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function BossDeathDropItem takes nothing returns nothing
  local timer t
	    if ( ( GetUnitTypeId(GetDyingUnit()) == 'Naka' ) ) then
	        call CreateItem('rat9', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()))
	        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Demon\\DarkPortal\\DarkPortalTarget.mdl", GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit())))
	        call TimerStart(CreateTimer(), 30, false, function ItemBase___ReviveRing)
	        call YDWEPolledWaitNull(0.5)
	        call RemoveUnit(GetDyingUnit())
	    endif
	    if ( GetDyingUnit() == UCrainax ) then
	        call CreateItem('rde3', GetUnitX(UCrainax), GetUnitY(UCrainax))
	        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Demon\\DarkPortal\\DarkPortalTarget.mdl", GetUnitX(UCrainax), GetUnitY(UCrainax)))
	        set t=CreateTimer()
	        set TiDiaNecklace=CreateTimerDialogBJ(t, "圣主分身复活")
	        call TimerStart(t, 900, false, function ItemBase___ReviveNecklace)
	        call TimerDialogDisplay(TiDiaNecklace, true)
	        set t=null
	    endif
	endfunction
//---------------------------------------------------------------------------------------------------
 function ItemBase___InitItemBase takes nothing returns nothing
		//删除书本的小点BUG
  local trigger t= CreateTrigger()
		call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_PICKUP_ITEM)
		call TriggerAddCondition(t, Condition(function ItemBase___TBookBUGCon))
		call TriggerAddAction(t, function ItemBase___TBookBUGAct)
		//获得翅膀的技能
		set t=CreateTrigger()
		call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_PICKUP_ITEM)
		call TriggerAddCondition(t, Condition(function ItemBase___TGetWingSpellCon))
		call TriggerAddAction(t, function ItemBase___TGetWingSpellPickAct)
		//删掉翅膀的技能
		set t=CreateTrigger()
		call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_DROP_ITEM)
		call TriggerAddCondition(t, Condition(function ItemBase___TGetWingSpellCon))
		call TriggerAddAction(t, function ItemBase___TGetWingSpellDropAct)
		//死亡掉落戒指和项链
	    set t=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_DEATH)
	    call TriggerAddAction(t, function BossDeathDropItem)
		set UCrainax=CreateUnit(Player(10), 'Ekgg', - 1661.7, - 14985.1, 180.000)
		set t=null
	endfunction

//library ItemBase ends
//library Jungle:
//---------------------------------------------------------------------------------------------------
	
 function Jungle__Jungle4DropCon takes nothing returns boolean
		return GetDyingUnit() == UYeYang or GetDyingUnit() == UYeYin
	endfunction
 function Jungle__Jungle4DropAct takes nothing returns nothing
  local integer i= 1
    	call BJDebugMsg("|cFFFF66CC【消息】|r" + GetUnitName(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetKillingUnitBJ()))]) + "成功地击杀了" + GetUnitName(GetDyingUnit()) + ",所有玩家奖励1000木材！")
    	loop
    		exitwhen i > 6
			call AdjustPlayerStateBJ(1000, ConvertedPlayer(i), PLAYER_STATE_RESOURCE_LUMBER)
    		set i=i + 1
    	endloop
    	call AddPlayerTechResearched(Player(10), 'R00W', udg_RENSHU)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Jungle__SetJudgeJungle4InvuFilter takes nothing returns boolean
		return IsEnemyMP(GetFilterUnit() , Player(10)) == true
	endfunction
 function Jungle__SetJudgeJungle4Invu takes unit u returns nothing
  local group l_group= CreateGroup()
		call GroupEnumUnitsInRange(l_group, GetUnitX(u), GetUnitY(u), 900, Condition(function Jungle__SetJudgeJungle4InvuFilter))
		if ( GetUnitAbilityLevel(u, 'Avul') < 1 and CountUnitsInGroup(l_group) == 0 ) then
			call UnitAddAbility(u, 'Avul')
			call PauseUnit(u, true)
			call SetUnitLifePercentBJ(u, 100)
		elseif ( GetUnitAbilityLevel(u, 'Avul') >= 1 and CountUnitsInGroup(l_group) != 0 ) then
			call UnitRemoveAbility(u, 'Avul')
			call PauseUnit(u, false)
		endif
		set l_group=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Jungle__JungleFlash takes nothing returns nothing
		//阳
		if ( IsUnitAliveBJ(UYeYang) ) then
			call Jungle__SetJudgeJungle4Invu(UYeYang)
		else
			call RemoveUnit(UYeYang)
			if ( GetPlayerTechCountSimple('R00W', Player(10)) < 100 ) then
		    	set UYeYang=CreateUnit(Player(10), 'Orkn', 14707.6, - 290.4, 180.000)
	 		    call EnhanceDiffAttack(UYeYang)
		    	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\ReviveHuman\\ReviveHuman.mdl", GetUnitX(UYeYang), GetUnitY(UYeYang)))
		    	call AddTianyanmokang(UYeYang)
			endif
		endif
		//阴
		if ( IsUnitAliveBJ(UYeYin) ) then
			call Jungle__SetJudgeJungle4Invu(UYeYin)
		else
			call RemoveUnit(UYeYin)
			if ( GetPlayerTechCountSimple('R00W', Player(10)) < 100 ) then
		    	set UYeYin=CreateUnit(Player(10), 'Osam', 1923.9, - 420.4, 0.000)
			    call EnhanceDiffAttack(UYeYin)
		    	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\ReviveHuman\\ReviveHuman.mdl", GetUnitX(UYeYin), GetUnitY(UYeYin)))
		    	call AddTianyanmokang(UYeYin)
			endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitJungle takes nothing returns nothing
     local trigger t= CreateTrigger()
	    set UYeYang=CreateUnit(Player(10), 'Orkn', 14707.6, - 290.4, 180.000)
	    set UYeYin=CreateUnit(Player(10), 'Osam', 1923.9, - 420.4, 0.000)
	    call EnhanceDiffAttack(UYeYang)
	    call EnhanceDiffAttack(UYeYin)
		//死亡奖励木头
	    call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_DEATH)
	    call TriggerAddCondition(t, Condition(function Jungle__Jungle4DropCon))
	    call TriggerAddAction(t, function Jungle__Jungle4DropAct)
	    call TimerStart(CreateTimer(), 5, true, function Jungle__JungleFlash)
	    set t=null
	endfunction

//library Jungle ends
//library LHOther:
//---------------------------------------------------------------------------------------------------
	
 function PingfenMoney takes player p returns nothing
  local integer i= 1
  local integer count= 0
  local integer lumber= 0
  local integer gold= 0
		loop
			exitwhen i > 6
			if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) and ( ConvertedPlayer(i) != p ) ) then
				set count=count + 1
			endif
			set i=i + 1
		endloop
		if ( count != 0 ) then
			set lumber=GetPlayerState(p, PLAYER_STATE_RESOURCE_LUMBER) / count
			set gold=GetPlayerState(p, PLAYER_STATE_RESOURCE_GOLD) / count
			call AdjustPlayerStateBJ(- 1000000, p, PLAYER_STATE_RESOURCE_LUMBER)
			call AdjustPlayerStateBJ(- 1000000, p, PLAYER_STATE_RESOURCE_GOLD)
			set i=1
			loop
				exitwhen i > 6
				if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) and ( ConvertedPlayer(i) != p ) ) then
					call AdjustPlayerStateBJ(lumber, ConvertedPlayer(i), PLAYER_STATE_RESOURCE_LUMBER)
					call AdjustPlayerStateBJ(gold, ConvertedPlayer(i), PLAYER_STATE_RESOURCE_GOLD)
				endif
				set i=i + 1
			endloop
		endif
	endfunction
 function DropAllItem takes unit u returns nothing
  local integer i= 1
		loop
			exitwhen i > 6
			if ( not ( IsMinganItem(UnitItemInSlotBJ(u, i)) ) ) then
				call SetItemPosition(UnitItemInSlotBJ(u, i), GetRectRandomX(gg_rct______________100), GetRectRandomY(gg_rct______________100))
			endif
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function TOverlayItemAct takes nothing returns boolean
	    return ( ( GetItemType(GetManipulatedItem()) == ITEM_TYPE_CHARGED ) )
	endfunction
 function TOverlayItemCon takes nothing returns nothing
     local integer i= 1
	    loop
	        exitwhen i > 6
	        if ( ( GetManipulatedItem() != UnitItemInSlotBJ(GetTriggerUnit(), i) ) and ( GetItemTypeId(GetManipulatedItem()) == GetItemTypeId(UnitItemInSlotBJ(GetTriggerUnit(), i)) ) ) then
	            call SetItemCharges(UnitItemInSlotBJ(GetTriggerUnit(), i), ( GetItemCharges(UnitItemInSlotBJ(GetTriggerUnit(), i)) + GetItemCharges(GetManipulatedItem()) ))
	            call RemoveItem(GetManipulatedItem())
	        else
	        endif
	        set i=i + 1
	    endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function LHOther___TAttackAllyCon takes nothing returns boolean
		return ( ( GetPlayerController(GetOwningPlayer(GetAttacker())) == MAP_CONTROL_USER ) and ( GetAttackedUnitBJ() == udg_H[GetConvertedPlayerId(GetOwningPlayer(GetAttackedUnitBJ()))] ) and IsUnitAlly(GetAttacker(), GetOwningPlayer(GetAttackedUnitBJ())) )
	endfunction
 function LHOther___TAttackAllyAct takes nothing returns nothing
			call IssueImmediateOrder(GetAttacker(), "stop")
			if ( GetUnitTypeId(GetAttacker()) != 'h028' ) then
				call DisplayTimedTextToForce(GetPlayersAll(), 20, "|cFFFF66CC【提示】|r有人企图攻击自己的英雄队友，被伟大的Crainax制止了。")
			endif
	endfunction
//---------------------------------------------------------------------------------------------------
    
    function TGetExCon takes nothing returns boolean
        return ( ( IsPlayerEnemy(GetOwningPlayer(GetDyingUnit()), Player(0)) == true ) and ( GetOwningPlayer(GetKillingUnitBJ()) != Player(11) ) and ( GetOwningPlayer(GetKillingUnitBJ()) != Player(10) ) and ( IsUnitIllusionBJ(GetDyingUnit()) != true ) and ( GetOwningPlayer(GetKillingUnitBJ()) != Player(PLAYER_NEUTRAL_AGGRESSIVE) ) and ( GetUnitPointValue(GetDyingUnit()) != 0 ) and ( GetUnitPointValue(GetDyingUnit()) != 123 ) and ( GetPlayerController(GetOwningPlayer(GetDyingUnit())) != MAP_CONTROL_USER ) )
    endfunction
    function TGetExAct takes nothing returns nothing
       local integer i= 1
       local integer basicEx= 0
       loop
            exitwhen i > 6
            if ( udg_H[i] != null and ( udg_H[i] != xinglong or BJuexing1[i] or GetOwningPlayer(GetKillingUnitBJ()) == GetOwningPlayer(xinglong) ) ) then
	            set basicEx=GetWanjieInt(R2I(I2R(GetUnitPointValue(GetDyingUnit())) * udg_I_Jingyan[i]) , 0.75)
	            call AddHeroXPSwapped(CModeH(basicEx , basicEx * 2), udg_H[i], true)
            endif
            set i=i + 1
       endloop
    endfunction
//---------------------------------------------------------------------------------------------------
 function LHOther___InitLHOther takes nothing returns nothing
		//物品叠加
     local trigger t= CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_PICKUP_ITEM)
	    call TriggerAddCondition(t, Condition(function TOverlayItemAct))
	    call TriggerAddAction(t, function TOverlayItemCon)
	    //队友将不能互相攻击
		set t=CreateTrigger()
		call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
		call TriggerAddCondition(t, Condition(function LHOther___TAttackAllyCon))
		call TriggerAddAction(t, function LHOther___TAttackAllyAct)
        //获取经验
		set t=CreateTrigger()
        call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_DEATH)
        call TriggerAddCondition(t, Condition(function TGetExCon))
        call TriggerAddAction(t, function TGetExAct)
	    set t=null
	endfunction

//library LHOther ends
//library Beast:
//---------------------------------------------------------------------------------------------------
	
 function Beast__isOutOfRange takes integer i returns boolean
		return ( ( i > 255 ) or ( i < 0 ) )
	endfunction
 function Beast__GetModifiedColor takes integer i returns integer
		return IMinBJ(IAbsBJ(i), 255)
	endfunction
 function Beast__DiscolorTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local unit u= LoadUnitHandle(itemTable, id, Beast__kU)
  local integer r= LoadInteger(itemTable, id, Beast__kr)
  local integer g= LoadInteger(itemTable, id, Beast__kg)
  local integer b= LoadInteger(itemTable, id, Beast__kb)
  local integer sr= LoadInteger(itemTable, id, Beast__ksr)
  local integer sg= LoadInteger(itemTable, id, Beast__ksg)
  local integer sb= LoadInteger(itemTable, id, Beast__ksb)
		if ( ( IsUnitAliveBJ(u) == true ) or ( IsUnitType(u, UNIT_TYPE_HERO) ) ) then
//textmacro instance: ChangeColor("r")
			if ( sr > 0 ) then
				set r=r + GetRandomInt(0, sr)
			else
				set r=r + GetRandomInt(sr, 0)
			endif
			if ( Beast__isOutOfRange(r) ) then
				set r=Beast__GetModifiedColor(r)
				if ( sr > 0 ) then
					call SaveInteger(itemTable, GetHandleId(t), Beast__ksr, GetRandomInt(- 60, - 20))
				else
					call SaveInteger(itemTable, GetHandleId(t), Beast__ksr, GetRandomInt(20, 60))
				endif
			endif
			call SaveInteger(itemTable, GetHandleId(t), Beast__kr, r)
//end of: ChangeColor("r")
//textmacro instance: ChangeColor("g")
			if ( sg > 0 ) then
				set g=g + GetRandomInt(0, sg)
			else
				set g=g + GetRandomInt(sg, 0)
			endif
			if ( Beast__isOutOfRange(g) ) then
				set g=Beast__GetModifiedColor(g)
				if ( sg > 0 ) then
					call SaveInteger(itemTable, GetHandleId(t), Beast__ksg, GetRandomInt(- 60, - 20))
				else
					call SaveInteger(itemTable, GetHandleId(t), Beast__ksg, GetRandomInt(20, 60))
				endif
			endif
			call SaveInteger(itemTable, GetHandleId(t), Beast__kg, g)
//end of: ChangeColor("g")
//textmacro instance: ChangeColor("b")
			if ( sb > 0 ) then
				set b=b + GetRandomInt(0, sb)
			else
				set b=b + GetRandomInt(sb, 0)
			endif
			if ( Beast__isOutOfRange(b) ) then
				set b=Beast__GetModifiedColor(b)
				if ( sb > 0 ) then
					call SaveInteger(itemTable, GetHandleId(t), Beast__ksb, GetRandomInt(- 60, - 20))
				else
					call SaveInteger(itemTable, GetHandleId(t), Beast__ksb, GetRandomInt(20, 60))
				endif
			endif
			call SaveInteger(itemTable, GetHandleId(t), Beast__kb, b)
//end of: ChangeColor("b")
    		call SetUnitVertexColor(u, r, g, b, 255)
		else
			call SetUnitVertexColor(u, 255, 255, 255, 255)
			call PauseTimer(t)
			call DestroyTimer(t)
			call FlushChildHashtable(itemTable, id)
		endif
		set t=null
		set u=null
	endfunction
 function Discolor takes unit u returns nothing
  local timer t= CreateTimer()
		call SaveUnitHandle(itemTable, GetHandleId(t), Beast__kU, u)
		call SaveInteger(itemTable, GetHandleId(t), Beast__kr, GetRandomInt(0, 254))
		call SaveInteger(itemTable, GetHandleId(t), Beast__kg, GetRandomInt(0, 254))
		call SaveInteger(itemTable, GetHandleId(t), Beast__kb, GetRandomInt(0, 254))
		call SaveInteger(itemTable, GetHandleId(t), Beast__ksr, GetRandomInt(20, 60))
		call SaveInteger(itemTable, GetHandleId(t), Beast__ksg, GetRandomInt(20, 60))
		call SaveInteger(itemTable, GetHandleId(t), Beast__ksb, GetRandomInt(20, 60))
		call TimerStart(t, 0.1, true, function Beast__DiscolorTimer)
		if ( IsUnitType(u, UNIT_TYPE_HERO) ) then
			set TBianse[GetConvertedPlayerId(GetOwningPlayer(u))]=t
		endif
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Beast__CreateBeast takes unit captain,integer itemId returns nothing
  local integer unitID= LoadInteger(itemTable, Beast__kBeastItem, itemId)
  local unit u= CreateUnit(GetOwningPlayer(captain), unitID, GetUnitX(captain), GetUnitY(captain), 0)
		//变色
		if ( ( unitID == 'ub08' ) or ( unitID == 'ub09' ) or ( unitID == 'ub10' ) or ( unitID == 'ub11' ) or ( unitID == 'ub12' ) or ( unitID == 'ub13' ) ) then
			call Discolor(u)
		endif
		if ( Unit_Beast[GetConvertedPlayerId(GetOwningPlayer(captain))] != null ) then
			call RemoveUnit(Unit_Beast[GetConvertedPlayerId(GetOwningPlayer(captain))])
		endif
		set Unit_Beast[GetConvertedPlayerId(GetOwningPlayer(captain))]=u
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTarget.mdl", GetUnitX(captain), GetUnitY(captain)))
		if ( BMoshou[GetConvertedPlayerId(GetOwningPlayer(captain))] ) then
			call UnitAddAbility(u, 'Aloc')
		endif
		call YDWESetGuard(u , captain , 1 , 600 , 600 , 600 , 100)
		set u=null
	endfunction
//---------------------------------------------------------------------------------------------------
 function Beast__IsBeast takes item i returns boolean
		return GetItemTypeId(i) == 'IB00' or GetItemTypeId(i) == 'IB01' or GetItemTypeId(i) == 'IB02' or GetItemTypeId(i) == 'IB03' or GetItemTypeId(i) == 'IB04' or GetItemTypeId(i) == 'IB05' or GetItemTypeId(i) == 'IB06' or GetItemTypeId(i) == 'IB07' or GetItemTypeId(i) == 'IB08' or GetItemTypeId(i) == 'IB09' or GetItemTypeId(i) == 'I04X' or GetItemTypeId(i) == 'IB0A' or GetItemTypeId(i) == 'I07O' or GetItemTypeId(i) == 'I07N'
	endfunction
	
 function Beast__UnitHasBeastInSlot takes unit u,integer slot returns boolean
		return Beast__IsBeast(UnitItemInSlotBJ(u, slot))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Beast__GetBeastInUnit takes unit u returns item
  local integer i= 1
		loop
			exitwhen i > 6
			if ( Beast__UnitHasBeastInSlot(u , i) ) then
				return UnitItemInSlotBJ(u, i)
			endif
			set i=i + 1
		endloop
		return null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Beast__TBeastEquitAct takes nothing returns nothing
  local integer i= 1
  local integer beastCount= 0
		loop
			exitwhen i > 6
			if ( Beast__UnitHasBeastInSlot(GetTriggerUnit() , i) ) then
				set beastCount=beastCount + 1
			endif
			set i=i + 1
		endloop
		//如果计数君大于1则丢掉
		if ( beastCount > 1 ) then
			call YDWEPolledWaitNull(0.1)
			call UnitRemoveItemSwapped(GetManipulatedItem(), GetTriggerUnit())
			call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【消息】|r你只能同时装备上一个魔兽！")
			return
		elseif ( beastCount == 1 ) then
		//产生相对应的魔兽操作
			call Beast__CreateBeast(GetTriggerUnit() , GetItemTypeId(GetManipulatedItem()))
			if ( IsMo(GetTriggerUnit()) ) then
				if ( IsMo3(GetManipulatedItem()) ) then
					call UnitAddAbility(GetTriggerUnit(), 'A0MT')
				endif
				if ( IsChaomo(GetManipulatedItem()) ) then
					call SetUnitAbilityLevel(GetTriggerUnit(), 'A0MT', 2)
				endif
			endif
		endif
	endfunction
 function Beast__TBeastEquitCon takes nothing returns boolean
		return ( GetManipulatingUnit() == udg_H[GetConvertedPlayerId(GetOwningPlayer(GetManipulatingUnit()))] ) and ( IsUnitIllusionBJ(GetManipulatingUnit()) != true ) and ( Beast__IsBeast(GetManipulatedItem()) == true )
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function RemoveBeast takes unit u returns nothing
		call RemoveUnit(Unit_Beast[GetConvertedPlayerId(GetOwningPlayer(u))])
		set Unit_Beast[GetConvertedPlayerId(GetOwningPlayer(u))]=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ReviveBeast takes unit u returns nothing
		if ( Beast__GetBeastInUnit(u) != null ) then
			call Beast__CreateBeast(u , GetItemTypeId(Beast__GetBeastInUnit(u)))
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Beast__TBeastDropAct takes nothing returns nothing
  local integer i= 1
  local integer beastCount= 0
		loop
			exitwhen i > 6
			if ( Beast__UnitHasBeastInSlot(GetTriggerUnit() , i) ) then
				set beastCount=beastCount + 1
			endif
			set i=i + 1
		endloop
		if ( beastCount != 2 ) then
			call RemoveBeast(GetManipulatingUnit())
			if ( IsMo(GetTriggerUnit()) ) then
				if ( IsMo3(GetManipulatedItem()) ) then
					call UnitRemoveAbility(GetTriggerUnit(), 'A0MT')
				endif
			endif
		endif
	endfunction
 function Beast__TBeastDropCon takes nothing returns boolean
		return ( GetManipulatingUnit() == udg_H[GetConvertedPlayerId(GetOwningPlayer(GetManipulatingUnit()))] ) and ( IsUnitIllusionBJ(GetManipulatingUnit()) != true ) and ( Beast__IsBeast(GetManipulatedItem()) == true )
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Beast__TBeastDamageAct takes nothing returns nothing
  local integer unitID= GetUnitTypeId(GetEventDamageSource())
  local integer playerID= GetConvertedPlayerId(GetOwningPlayer(GetEventDamageSource()))
  local item beast= Beast__GetBeastInUnit(udg_H[playerID])
		//魔兽怒吼
		if ( GetUnitAbilityLevel(Unit_Beast[playerID], 'ABe9') >= 1 ) then
			call SetItemCharges(beast, GetItemCharges(beast) + 1)
			if ( GetItemCharges(beast) > CHARGES_BEAST ) then
					call CreateSpellTextTag("魔兽怒吼!" , Unit_Beast[playerID] , 0 , 100 , 0 , 2)
 					call SimulateSpell(Unit_Beast[playerID] , Unit_Beast[playerID] , 'A0CR' , 1 , 5 , "stomp" , false , true , false)
					call SetItemCharges(beast, 0)
			endif
		endif
		//余数为4则施放
		if ( ModuloInteger(GetItemCharges(beast), 4) == 0 and ( GetUnitTypeId(GetEventDamageSource()) == 'ub11' or GetUnitTypeId(GetEventDamageSource()) == 'ub13' ) ) then
			call UnitApplyTimedLifeBJ(2.00, 'BHwe', CreateUnit(ConvertedPlayer(playerID), I3(GetUnitTypeId(GetEventDamageSource()) == 'ub11' , 'h01P' , 'h02J'), YDWECoordinateX(GetUnitX(GetEventDamageSource()) + GetRandomReal(- 100, 100)), YDWECoordinateY(GetUnitY(GetEventDamageSource()) + GetRandomReal(- 100, 100)), GetRandomReal(0, 360)))
		endif
		
		if ( GetUnitAbilityLevel(Unit_Beast[playerID], 'ABea') >= 1 and BMoshou[playerID] and GetUnitState(Unit_Beast[playerID], UNIT_STATE_MANA) > 999 ) then
			call IssueImmediateOrder(Unit_Beast[playerID], "berserk")
		endif
		
//textmacro instance: DamageBeast1("00")
		if ( unitID == 'ub00' ) then
			call DisableTrigger(GetTriggeringTrigger())
			call UnitDamageTarget(udg_H[playerID], GetTriggerUnit(), DAMAGE_BEAST_00, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_POISON, WEAPON_TYPE_WHOKNOWS)
			call EnableTrigger(GetTriggeringTrigger())
			set beast=null
			return
		endif
//end of: DamageBeast1("00")
//textmacro instance: DamageBeast1("01")
		if ( unitID == 'ub01' ) then
			call DisableTrigger(GetTriggeringTrigger())
			call UnitDamageTarget(udg_H[playerID], GetTriggerUnit(), DAMAGE_BEAST_01, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_POISON, WEAPON_TYPE_WHOKNOWS)
			call EnableTrigger(GetTriggeringTrigger())
			set beast=null
			return
		endif
//end of: DamageBeast1("01")
//textmacro instance: DamageBeast1("02")
		if ( unitID == 'ub02' ) then
			call DisableTrigger(GetTriggeringTrigger())
			call UnitDamageTarget(udg_H[playerID], GetTriggerUnit(), DAMAGE_BEAST_02, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_POISON, WEAPON_TYPE_WHOKNOWS)
			call EnableTrigger(GetTriggeringTrigger())
			set beast=null
			return
		endif
//end of: DamageBeast1("02")
//textmacro instance: DamageBeast1("03")
		if ( unitID == 'ub03' ) then
			call DisableTrigger(GetTriggeringTrigger())
			call UnitDamageTarget(udg_H[playerID], GetTriggerUnit(), DAMAGE_BEAST_03, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_POISON, WEAPON_TYPE_WHOKNOWS)
			call EnableTrigger(GetTriggeringTrigger())
			set beast=null
			return
		endif
//end of: DamageBeast1("03")
//textmacro instance: DamageBeast1("04")
		if ( unitID == 'ub04' ) then
			call DisableTrigger(GetTriggeringTrigger())
			call UnitDamageTarget(udg_H[playerID], GetTriggerUnit(), DAMAGE_BEAST_04, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_POISON, WEAPON_TYPE_WHOKNOWS)
			call EnableTrigger(GetTriggeringTrigger())
			set beast=null
			return
		endif
//end of: DamageBeast1("04")
//textmacro instance: DamageBeast1("05")
		if ( unitID == 'ub05' ) then
			call DisableTrigger(GetTriggeringTrigger())
			call UnitDamageTarget(udg_H[playerID], GetTriggerUnit(), DAMAGE_BEAST_05, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_POISON, WEAPON_TYPE_WHOKNOWS)
			call EnableTrigger(GetTriggeringTrigger())
			set beast=null
			return
		endif
//end of: DamageBeast1("05")
//textmacro instance: DamageBeast1("06")
		if ( unitID == 'ub06' ) then
			call DisableTrigger(GetTriggeringTrigger())
			call UnitDamageTarget(udg_H[playerID], GetTriggerUnit(), DAMAGE_BEAST_06, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_POISON, WEAPON_TYPE_WHOKNOWS)
			call EnableTrigger(GetTriggeringTrigger())
			set beast=null
			return
		endif
//end of: DamageBeast1("06")
//textmacro instance: DamageBeast1("07")
		if ( unitID == 'ub07' ) then
			call DisableTrigger(GetTriggeringTrigger())
			call UnitDamageTarget(udg_H[playerID], GetTriggerUnit(), DAMAGE_BEAST_07, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_POISON, WEAPON_TYPE_WHOKNOWS)
			call EnableTrigger(GetTriggeringTrigger())
			set beast=null
			return
		endif
//end of: DamageBeast1("07")
//textmacro instance: DamageBeast1("08")
		if ( unitID == 'ub08' ) then
			call DisableTrigger(GetTriggeringTrigger())
			call UnitDamageTarget(udg_H[playerID], GetTriggerUnit(), DAMAGE_BEAST_08, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_POISON, WEAPON_TYPE_WHOKNOWS)
			call EnableTrigger(GetTriggeringTrigger())
			set beast=null
			return
		endif
//end of: DamageBeast1("08")
//textmacro instance: DamageBeast1("09")
		if ( unitID == 'ub09' ) then
			call DisableTrigger(GetTriggeringTrigger())
			call UnitDamageTarget(udg_H[playerID], GetTriggerUnit(), DAMAGE_BEAST_09, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_POISON, WEAPON_TYPE_WHOKNOWS)
			call EnableTrigger(GetTriggeringTrigger())
			set beast=null
			return
		endif
//end of: DamageBeast1("09")
//textmacro instance: DamageBeast1("10")
		if ( unitID == 'ub10' ) then
			call DisableTrigger(GetTriggeringTrigger())
			call UnitDamageTarget(udg_H[playerID], GetTriggerUnit(), DAMAGE_BEAST_10, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_POISON, WEAPON_TYPE_WHOKNOWS)
			call EnableTrigger(GetTriggeringTrigger())
			set beast=null
			return
		endif
//end of: DamageBeast1("10")
//textmacro instance: DamageBeast1("11")
		if ( unitID == 'ub11' ) then
			call DisableTrigger(GetTriggeringTrigger())
			call UnitDamageTarget(udg_H[playerID], GetTriggerUnit(), DAMAGE_BEAST_11, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_POISON, WEAPON_TYPE_WHOKNOWS)
			call EnableTrigger(GetTriggeringTrigger())
			set beast=null
			return
		endif
//end of: DamageBeast1("11")
//textmacro instance: DamageBeast1("12")
		if ( unitID == 'ub12' ) then
			call DisableTrigger(GetTriggeringTrigger())
			call UnitDamageTarget(udg_H[playerID], GetTriggerUnit(), DAMAGE_BEAST_12, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_POISON, WEAPON_TYPE_WHOKNOWS)
			call EnableTrigger(GetTriggeringTrigger())
			set beast=null
			return
		endif
//end of: DamageBeast1("12")
//textmacro instance: DamageBeast1("13")
		if ( unitID == 'ub13' ) then
			call DisableTrigger(GetTriggeringTrigger())
			call UnitDamageTarget(udg_H[playerID], GetTriggerUnit(), DAMAGE_BEAST_13, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_POISON, WEAPON_TYPE_WHOKNOWS)
			call EnableTrigger(GetTriggeringTrigger())
			set beast=null
			return
		endif
//end of: DamageBeast1("13")
	endfunction
 function Beast__TBeastDamageCon takes nothing returns boolean
		return ( ( GetEventDamage() > 0 ) and ( IsUnitIllusion(GetEventDamageSource()) == false ) and ( GetEventDamageSource() == Unit_Beast[GetConvertedPlayerId(GetOwningPlayer(GetEventDamageSource()))] ) )
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CombineBeast takes unit u returns nothing
//textmacro instance: SummonBeast("IB00","IMJ1","IB01")
		if ( ( GetItemTypeId(YDWEGetItemOfTypeFromUnitBJNull(u , 'IB00')) == 'IB00' ) and ( GetItemTypeId(YDWEGetItemOfTypeFromUnitBJNull(u , 'IMJ1')) == 'IMJ1' ) and ( IsItemPawnable(YDWEGetItemOfTypeFromUnitBJNull(u , 'IB00')) == true ) and ( IsItemPawnable(YDWEGetItemOfTypeFromUnitBJNull(u , 'IMJ1')) == true ) ) then
            call YDWEPolledWaitNull(0.01)
            call RemoveItem(YDWEGetItemOfTypeFromUnitBJNull(u , 'IMJ1'))
            call RemoveItem(YDWEGetItemOfTypeFromUnitBJNull(u , 'IB00'))
            call UnitAddItemById(u, 'IB01')
			call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你成功召唤新的魔兽,如果想让魔兽进入不可点击状态,请输入\"-ms\"!")
			call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你成功召唤新的魔兽,如果想让魔兽进入不可点击状态,请输入\"-ms\"!")
			call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你成功召唤新的魔兽,如果想让魔兽进入不可点击状态,请输入\"-ms\"!")
			return
		endif
//end of: SummonBeast("IB00","IMJ1","IB01")
//textmacro instance: SummonBeast("IB01","IMJ2","IB02")
		if ( ( GetItemTypeId(YDWEGetItemOfTypeFromUnitBJNull(u , 'IB01')) == 'IB01' ) and ( GetItemTypeId(YDWEGetItemOfTypeFromUnitBJNull(u , 'IMJ2')) == 'IMJ2' ) and ( IsItemPawnable(YDWEGetItemOfTypeFromUnitBJNull(u , 'IB01')) == true ) and ( IsItemPawnable(YDWEGetItemOfTypeFromUnitBJNull(u , 'IMJ2')) == true ) ) then
            call YDWEPolledWaitNull(0.01)
            call RemoveItem(YDWEGetItemOfTypeFromUnitBJNull(u , 'IMJ2'))
            call RemoveItem(YDWEGetItemOfTypeFromUnitBJNull(u , 'IB01'))
            call UnitAddItemById(u, 'IB02')
			call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你成功召唤新的魔兽,如果想让魔兽进入不可点击状态,请输入\"-ms\"!")
			call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你成功召唤新的魔兽,如果想让魔兽进入不可点击状态,请输入\"-ms\"!")
			call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你成功召唤新的魔兽,如果想让魔兽进入不可点击状态,请输入\"-ms\"!")
			return
		endif
//end of: SummonBeast("IB01","IMJ2","IB02")
//textmacro instance: SummonBeast("IB02","IMJ3","IB03")
		if ( ( GetItemTypeId(YDWEGetItemOfTypeFromUnitBJNull(u , 'IB02')) == 'IB02' ) and ( GetItemTypeId(YDWEGetItemOfTypeFromUnitBJNull(u , 'IMJ3')) == 'IMJ3' ) and ( IsItemPawnable(YDWEGetItemOfTypeFromUnitBJNull(u , 'IB02')) == true ) and ( IsItemPawnable(YDWEGetItemOfTypeFromUnitBJNull(u , 'IMJ3')) == true ) ) then
            call YDWEPolledWaitNull(0.01)
            call RemoveItem(YDWEGetItemOfTypeFromUnitBJNull(u , 'IMJ3'))
            call RemoveItem(YDWEGetItemOfTypeFromUnitBJNull(u , 'IB02'))
            call UnitAddItemById(u, 'IB03')
			call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你成功召唤新的魔兽,如果想让魔兽进入不可点击状态,请输入\"-ms\"!")
			call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你成功召唤新的魔兽,如果想让魔兽进入不可点击状态,请输入\"-ms\"!")
			call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你成功召唤新的魔兽,如果想让魔兽进入不可点击状态,请输入\"-ms\"!")
			return
		endif
//end of: SummonBeast("IB02","IMJ3","IB03")
//textmacro instance: SummonBeast("IB03","IMJ4","IB04")
		if ( ( GetItemTypeId(YDWEGetItemOfTypeFromUnitBJNull(u , 'IB03')) == 'IB03' ) and ( GetItemTypeId(YDWEGetItemOfTypeFromUnitBJNull(u , 'IMJ4')) == 'IMJ4' ) and ( IsItemPawnable(YDWEGetItemOfTypeFromUnitBJNull(u , 'IB03')) == true ) and ( IsItemPawnable(YDWEGetItemOfTypeFromUnitBJNull(u , 'IMJ4')) == true ) ) then
            call YDWEPolledWaitNull(0.01)
            call RemoveItem(YDWEGetItemOfTypeFromUnitBJNull(u , 'IMJ4'))
            call RemoveItem(YDWEGetItemOfTypeFromUnitBJNull(u , 'IB03'))
            call UnitAddItemById(u, 'IB04')
			call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你成功召唤新的魔兽,如果想让魔兽进入不可点击状态,请输入\"-ms\"!")
			call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你成功召唤新的魔兽,如果想让魔兽进入不可点击状态,请输入\"-ms\"!")
			call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你成功召唤新的魔兽,如果想让魔兽进入不可点击状态,请输入\"-ms\"!")
			return
		endif
//end of: SummonBeast("IB03","IMJ4","IB04")
//textmacro instance: SummonBeast("IB04","IMJ5","IB05")
		if ( ( GetItemTypeId(YDWEGetItemOfTypeFromUnitBJNull(u , 'IB04')) == 'IB04' ) and ( GetItemTypeId(YDWEGetItemOfTypeFromUnitBJNull(u , 'IMJ5')) == 'IMJ5' ) and ( IsItemPawnable(YDWEGetItemOfTypeFromUnitBJNull(u , 'IB04')) == true ) and ( IsItemPawnable(YDWEGetItemOfTypeFromUnitBJNull(u , 'IMJ5')) == true ) ) then
            call YDWEPolledWaitNull(0.01)
            call RemoveItem(YDWEGetItemOfTypeFromUnitBJNull(u , 'IMJ5'))
            call RemoveItem(YDWEGetItemOfTypeFromUnitBJNull(u , 'IB04'))
            call UnitAddItemById(u, 'IB05')
			call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你成功召唤新的魔兽,如果想让魔兽进入不可点击状态,请输入\"-ms\"!")
			call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你成功召唤新的魔兽,如果想让魔兽进入不可点击状态,请输入\"-ms\"!")
			call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你成功召唤新的魔兽,如果想让魔兽进入不可点击状态,请输入\"-ms\"!")
			return
		endif
//end of: SummonBeast("IB04","IMJ5","IB05")
//textmacro instance: SummonBeast("IB05","IMJ6","IB06")
		if ( ( GetItemTypeId(YDWEGetItemOfTypeFromUnitBJNull(u , 'IB05')) == 'IB05' ) and ( GetItemTypeId(YDWEGetItemOfTypeFromUnitBJNull(u , 'IMJ6')) == 'IMJ6' ) and ( IsItemPawnable(YDWEGetItemOfTypeFromUnitBJNull(u , 'IB05')) == true ) and ( IsItemPawnable(YDWEGetItemOfTypeFromUnitBJNull(u , 'IMJ6')) == true ) ) then
            call YDWEPolledWaitNull(0.01)
            call RemoveItem(YDWEGetItemOfTypeFromUnitBJNull(u , 'IMJ6'))
            call RemoveItem(YDWEGetItemOfTypeFromUnitBJNull(u , 'IB05'))
            call UnitAddItemById(u, 'IB06')
			call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你成功召唤新的魔兽,如果想让魔兽进入不可点击状态,请输入\"-ms\"!")
			call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你成功召唤新的魔兽,如果想让魔兽进入不可点击状态,请输入\"-ms\"!")
			call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你成功召唤新的魔兽,如果想让魔兽进入不可点击状态,请输入\"-ms\"!")
			return
		endif
//end of: SummonBeast("IB05","IMJ6","IB06")
//textmacro instance: SummonBeast("IB06","IMJ7","IB07")
		if ( ( GetItemTypeId(YDWEGetItemOfTypeFromUnitBJNull(u , 'IB06')) == 'IB06' ) and ( GetItemTypeId(YDWEGetItemOfTypeFromUnitBJNull(u , 'IMJ7')) == 'IMJ7' ) and ( IsItemPawnable(YDWEGetItemOfTypeFromUnitBJNull(u , 'IB06')) == true ) and ( IsItemPawnable(YDWEGetItemOfTypeFromUnitBJNull(u , 'IMJ7')) == true ) ) then
            call YDWEPolledWaitNull(0.01)
            call RemoveItem(YDWEGetItemOfTypeFromUnitBJNull(u , 'IMJ7'))
            call RemoveItem(YDWEGetItemOfTypeFromUnitBJNull(u , 'IB06'))
            call UnitAddItemById(u, 'IB07')
			call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你成功召唤新的魔兽,如果想让魔兽进入不可点击状态,请输入\"-ms\"!")
			call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你成功召唤新的魔兽,如果想让魔兽进入不可点击状态,请输入\"-ms\"!")
			call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你成功召唤新的魔兽,如果想让魔兽进入不可点击状态,请输入\"-ms\"!")
			return
		endif
//end of: SummonBeast("IB06","IMJ7","IB07")
//textmacro instance: SummonBeast("IB07","IMJ8","IB08")
		if ( ( GetItemTypeId(YDWEGetItemOfTypeFromUnitBJNull(u , 'IB07')) == 'IB07' ) and ( GetItemTypeId(YDWEGetItemOfTypeFromUnitBJNull(u , 'IMJ8')) == 'IMJ8' ) and ( IsItemPawnable(YDWEGetItemOfTypeFromUnitBJNull(u , 'IB07')) == true ) and ( IsItemPawnable(YDWEGetItemOfTypeFromUnitBJNull(u , 'IMJ8')) == true ) ) then
            call YDWEPolledWaitNull(0.01)
            call RemoveItem(YDWEGetItemOfTypeFromUnitBJNull(u , 'IMJ8'))
            call RemoveItem(YDWEGetItemOfTypeFromUnitBJNull(u , 'IB07'))
            call UnitAddItemById(u, 'IB08')
			call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你成功召唤新的魔兽,如果想让魔兽进入不可点击状态,请输入\"-ms\"!")
			call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你成功召唤新的魔兽,如果想让魔兽进入不可点击状态,请输入\"-ms\"!")
			call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你成功召唤新的魔兽,如果想让魔兽进入不可点击状态,请输入\"-ms\"!")
			return
		endif
//end of: SummonBeast("IB07","IMJ8","IB08")
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Beast__initBeastItem takes nothing returns nothing
		call SaveInteger(itemTable, Beast__kBeastItem, 'IB00', 'ub00')
		call SaveInteger(itemTable, Beast__kBeastItem, 'IB01', 'ub01')
		call SaveInteger(itemTable, Beast__kBeastItem, 'IB02', 'ub02')
		call SaveInteger(itemTable, Beast__kBeastItem, 'IB03', 'ub03')
		call SaveInteger(itemTable, Beast__kBeastItem, 'IB04', 'ub04')
		call SaveInteger(itemTable, Beast__kBeastItem, 'IB05', 'ub05')
		call SaveInteger(itemTable, Beast__kBeastItem, 'IB06', 'ub06')
		call SaveInteger(itemTable, Beast__kBeastItem, 'IB07', 'ub07')
		call SaveInteger(itemTable, Beast__kBeastItem, 'IB08', 'ub08')
		call SaveInteger(itemTable, Beast__kBeastItem, 'IB09', 'ub09')
		call SaveInteger(itemTable, Beast__kBeastItem, 'IB0A', 'ub10')
		call SaveInteger(itemTable, Beast__kBeastItem, 'I04X', 'ub11')
		call SaveInteger(itemTable, Beast__kBeastItem, 'I07N', 'ub12')
		call SaveInteger(itemTable, Beast__kBeastItem, 'I07O', 'ub13')
	endfunction
//---------------------------------------------------------------------------------------------------
 function Beast__InitBeast takes nothing returns nothing
		//初始化
  local trigger t= CreateTrigger()
		call Beast__initBeastItem()
		//只能同时装备一个魔兽
		call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_PICKUP_ITEM)
		call TriggerAddCondition(t, Condition(function Beast__TBeastEquitCon))
		call TriggerAddAction(t, function Beast__TBeastEquitAct)
		//魔兽伤害事件
		set t=CreateTrigger()
		call YDWESyStemAnyUnitDamagedRegistTrigger(t)
		call TriggerAddCondition(t, Condition(function Beast__TBeastDamageCon))
		call TriggerAddAction(t, function Beast__TBeastDamageAct)
		//丢弃魔兽事件
		set t=CreateTrigger()
		call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_DROP_ITEM)
		call TriggerAddCondition(t, Condition(function Beast__TBeastDropCon))
		call TriggerAddAction(t, function Beast__TBeastDropAct)
		set t=null
	endfunction

//library Beast ends
//library Continous:
//---------------------------------------------------------------------------------------------------
	
 function Continous___GetGoldReward takes integer day returns integer
		return I3(day == 1 , 500 , R2I(( SquareRoot(day) + 2. ) * 300.))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GiveJianianhuaGift takes player p returns nothing
  local integer i= IConDays[GetConvertedPlayerId(p)]
  local unit u= udg_H[GetConvertedPlayerId(p)]
		call AdjustPlayerStateBJ(Continous___GetGoldReward(i), GetOwningPlayer(u), PLAYER_STATE_RESOURCE_GOLD)
		if ( i >= 2 ) then
			call UnitAddItemByIdSwapped('ankh', u)
		endif
		if ( i >= 4 ) then
			call UnitAddItemByIdSwapped('k3m1', u)
		endif
		if ( i >= 7 ) then
			call UnitAddItemByIdSwapped('I07A', u)
			set BWuxing[GetConvertedPlayerId(p)]=true
		endif
		if ( i >= 12 ) then
			call UnitAddItemByIdSwapped('I05O', u)
			call SetItemPawnable(GetLastCreatedItem(), false)
		endif
		if ( i >= 14 ) then
			call SetLingxueSpinOK(p)
		endif
		if ( i >= 20 ) then
			call UnitAddItemByIdSwapped('hlst', u)
		endif
		if ( i >= 40 ) then
			call GetAchievementAndSave(p , 47)
		endif
		set u=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetDailyReward takes integer days returns string
		if ( days == 2 ) then
			return "天地庇佑 * 2"
		elseif ( days == 4 ) then
			return "血精石 * 1"
		elseif ( days == 7 ) then
			return "|cffffff00【妖】五行之杖|r * 1"
		elseif ( days == 12 ) then
			return "聚宝·Lv0 * 1"
		elseif ( days == 14 ) then
			return "|cFF339933沐雪无瑕|r皮肤"
		elseif ( days == 20 ) then
			return "|cff808080【E】幸运宝箱|r"
		elseif ( days == 40 ) then
			return GetAchievementName(47) + "成就"
		endif
		return null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetContinousDay takes player p returns integer
		if ( DzAPI_Map_GetGameStartTime() < TIMESTAMP_START ) then
			return 0
		endif
		return ( DzAPI_Map_GetGameStartTime() - ILastTime[GetConvertedPlayerId(p)] ) / 86400
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CreateLoginDialog takes player p returns nothing
        local dialog d= DialogCreate()
        local string s= "\n        	连续登录奖励\n        	你获得了第" + I2S(IConDays[GetConvertedPlayerId(p)]) + "天对应的" + I2S(Continous___GetGoldReward(IConDays[GetConvertedPlayerId(p)])) + "金币!\n        	明天继续签到可以获得" + I2S(Continous___GetGoldReward(IConDays[GetConvertedPlayerId(p)] + 1)) + "的金币!\n        	"
        local integer i= 1
        loop
        	exitwhen i > 41
        	if ( GetDailyReward(i) != null ) then
        		set s=s + "第" + I2S(i) + "天:" + GetDailyReward(i) + S3(IConDays[GetConvertedPlayerId(p)] >= i , "|cffff9900(已完成)|r" , "|cff33cccc(未完成)|r") + "\n        		"
        	endif
        	set i=i + 1
        endloop
                		set s=s + "\n        你已经连续签到了" + I2S(IConDays[GetConvertedPlayerId(p)]) + "天,注意断签了会重新计算哦."
        call DialogSetMessage(d, s)
        call DialogAddButton(d, "10分钟之后当天才签到成功|cffff6800(Esc)|r", 512)
        call DialogDisplay(p, d, true)
        //call DialogDestroy(d)
        set d=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Continous___GetCurrentStartTime takes nothing returns integer
		return TIMESTAMP_START + ( ( DzAPI_Map_GetGameStartTime() - TIMESTAMP_START ) / 86400 ) * 86400
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Continous___GetOldStartTime takes integer day returns integer
		return Continous___GetCurrentStartTime() - ( ( day - 1 ) * 86400 )
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitContinousData takes player p returns nothing
		set IConDays[GetConvertedPlayerId(p)]=DzAPI_Map_GetStoredInteger(p , "IConDays")
		set ILastTime[GetConvertedPlayerId(p)]=DzAPI_Map_GetStoredInteger(p , "ILastTime")
	endfunction
//---------------------------------------------------------------------------------------------------
	
	
//---------------------------------------------------------------------------------------------------
	
 function SaveLoginState takes player p returns nothing
		if ( Bdudang[GetConvertedPlayerId(p)] ) then
			call DzAPI_Map_StoreInteger(p , "IConDays" , IConDays[GetConvertedPlayerId(p)])
			call DzAPI_Map_StoreInteger(p , "ILastTime" , ILastTime[GetConvertedPlayerId(p)])
			//call DzAPI_Map_StoreInteger( p,  "IQiandao2", IQiandao2[GetConvertedPlayerId(p)] )
			call DisplayTextToPlayer(p, 0., 0., "|cffff0000【消息】连续登录数据保存成功!|r")
			call DisplayTextToPlayer(p, 0., 0., "|cffff0000【消息】连续登录数据保存成功!|r")
			call DisplayTextToPlayer(p, 0., 0., "|cffff0000【消息】连续登录数据保存成功!|r")
			call DisplayTextToPlayer(p, 0., 0., "|cffff0000【消息】连续登录数据保存成功!|r")
			call DisplayTextToPlayer(p, 0., 0., "|cffff0000【消息】连续登录数据保存成功!|r")
			//call CreateYuebingPlayer(GetUnitX(udg_H[GetConvertedPlayerId(p)]),GetUnitY(udg_H[GetConvertedPlayerId(p)]),p)
		else
			call DisplayTextToPlayer(p, 0., 0., "|cffff0000【消息】连续登录数据保存失败,请重启游戏!|r")
			call DisplayTextToPlayer(p, 0., 0., "|cffff0000【消息】连续登录数据保存失败,请重启游戏!|r")
			call DisplayTextToPlayer(p, 0., 0., "|cffff0000【消息】连续登录数据保存失败,请重启游戏!|r")
			call DisplayTextToPlayer(p, 0., 0., "|cffff0000【消息】连续登录数据保存失败,请重启游戏!|r")
			call DisplayTextToPlayer(p, 0., 0., "|cffff0000【消息】连续登录数据保存失败,请重启游戏!|r")
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Continous___UploadToNetEaseTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local player p= LoadPlayerHandle(LHTable, id, 1)
		call SaveLoginState(p)
		call PauseTimer(t)
		call FlushChildHashtable(LHTable, id)
		call DestroyTimer(t)
		set p=null
		set t=null
	endfunction
 function UploadToNetEase takes player p returns nothing
  local timer t= CreateTimer()
		call SavePlayerHandle(LHTable, GetHandleId(t), 1, p)
		call TimerStart(t, 600, false, function Continous___UploadToNetEaseTimer)
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetDenglu takes player p returns nothing
		//活动还没开始，或者说是首次
		if ( DzAPI_Map_GetGameStartTime() < TIMESTAMP_START ) then
			call BJDebugMsg("|cFFFF66CC【消息】|r ")
			call DisplayTextToPlayer(Player(0), 0., 0., "|cFFFF66CC【消息】|r嘉年华时间未开始.")
			return
		endif
		if ( ILastTime[GetConvertedPlayerId(p)] < TIMESTAMP_START ) then
			set ILastTime[GetConvertedPlayerId(p)]=TIMESTAMP_START
			set IConDays[GetConvertedPlayerId(p)]=0
		endif
		//断签啦重新存储
		if ( GetContinousDay(p) == IConDays[GetConvertedPlayerId(p)] ) then
			//首次连续登录的提示与奖励
			set IConDays[GetConvertedPlayerId(p)]=GetContinousDay(p) + 1
			//set IQiandao2[GetConvertedPlayerId(p)] = IQiandao2[GetConvertedPlayerId(p)] + DzAPI_Map_GetGameStartTime() - GetCurrentStartTime(p)
			call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r你已经成功连续登录" + I2S(IConDays[GetConvertedPlayerId(p)]) + "天(注意今天的签到需要等10分钟才能保存).")
		elseif ( GetContinousDay(p) == IConDays[GetConvertedPlayerId(p)] - 1 ) then
			//保持当天的奖励
			call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r你已经成功连续登录" + I2S(IConDays[GetConvertedPlayerId(p)]) + "天(今天的签到数据已经在前面游戏中保存了哦).")
		else
			set ILastTime[GetConvertedPlayerId(p)]=Continous___GetCurrentStartTime()
			set IConDays[GetConvertedPlayerId(p)]=1
			//set IQiandao2[GetConvertedPlayerId(p)] = IQiandao2[GetConvertedPlayerId(p)] + DzAPI_Map_GetGameStartTime() - GetCurrentStartTime(p)
			call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r你已经成功连续登录" + I2S(IConDays[GetConvertedPlayerId(p)]) + "天(注意今天的签到需要等10分钟才能保存).")
		endif
		call UploadToNetEase(p)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Buqian1 takes player p returns nothing
		if not ( BBuqian1 ) then
			set BBuqian1=true
			call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r补签1阶段.")
		endif
	endfunction
 function Buqian2 takes player p,string s returns nothing
		if ( s == I2S(GetCycleHash(playerName[GetConvertedPlayerId(p)] , 25)) ) then
			set BBuqian2=true
			call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r补签2阶段.")
		endif
		set BBuqian1=false
	endfunction
 function Buqian3 takes player p,string s returns nothing
  local integer i= 1
  local integer result= 0
		loop
			exitwhen i > 100
			if ( s == I2S(GetCycleHash(I2S(i) , 1)) ) then
				set IConDays[GetConvertedPlayerId(p)]=i
				set ILastTime[GetConvertedPlayerId(p)]=Continous___GetOldStartTime(i)
				call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r补签为" + I2S(i) + "天.")
				call SaveLoginState(p)
				exitwhen true
			endif
			set i=i + 1
		endloop
		set BBuqian2=false
	endfunction
//---------------------------------------------------------------------------------------------------
 function Continous___InitContinous takes nothing returns nothing
	endfunction

//library Continous ends
//library Purgatory:
//---------------------------------------------------------------------------------------------------
	
 function Purgatory___XuyuanClick takes nothing returns nothing
        local dialog d= GetClickedDialogBJ()
        local player p= LoadPlayerHandle(LHTable, GetHandleId(d), 4)
        local unit u= udg_H[GetConvertedPlayerId(p)]
        local integer int= 0
        local integer str= 0
        local integer agi= 0
        call RemoveItem(LoadItemHandle(LHTable, GetHandleId(d), 5))
        if ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), 1) ) then
        	//回归100级，然后爆炸
        	set int=GetHeroInt(u, false)
        	set str=GetHeroStr(u, false)
        	set agi=GetHeroAgi(u, false)
		    call SetHeroLevelBJ(u, 100, false)
        	call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r你等级到了100级.")
	    	call CreateUnitEffect(GetOwningPlayer(u) , 'h01M' , GetUnitX(u) , GetUnitY(u) , 0)
	    	call SetHeroInt(u, int, false)
	    	call SetHeroAgi(u, agi, false)
	    	call SetHeroStr(u, str, false)
        endif
        if ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), 2) ) then
        	//立即获取8%的属性
        	if ( u != chenji ) then
        		call SetHeroInt(u, IMinBJ(1000000000, R2I(I2R(GetHeroInt(u, false)) * 1.08)), false)
        		call SetHeroAgi(u, IMinBJ(1000000000, R2I(I2R(GetHeroAgi(u, false)) * 1.08)), false)
        		call SetHeroStr(u, IMinBJ(1000000000, R2I(I2R(GetHeroStr(u, false)) * 1.08)), false)
        	else
        		call SetHeroStr(u, IMinBJ(1000000000, R2I(I2R(GetHeroStr(u, false)) * 1.08)), false)
        		call SetHeroStr(u, IMinBJ(1000000000, R2I(I2R(GetHeroStr(u, false)) * 1.08)), false)
        		call SetHeroStr(u, IMinBJ(1000000000, R2I(I2R(GetHeroStr(u, false)) * 1.08)), false)
        	endif
	    	call CreateUnitEffect(GetOwningPlayer(u) , 'h01M' , GetUnitX(u) , GetUnitY(u) , 0)
        	call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r你成功的获得了8%的全属性(直接相乘).")
        endif
        if ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), 3) ) then
        	//立即提高20级
        	call SetHeroLevel(u, GetHeroLevel(u) + 50, true)
        	call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r你成功的提高了50级.")
	    	call CreateUnitEffect(GetOwningPlayer(u) , 'h01M' , GetUnitX(u) , GetUnitY(u) , 0)
        endif
        if ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), 5) ) then
        	//50个木头
        	call AdjustPlayerStateBJ(50, p, PLAYER_STATE_RESOURCE_LUMBER)
        	call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r你成功的获得了50个木头.")
	    	call CreateUnitEffect(GetOwningPlayer(u) , 'h01M' , GetUnitX(u) , GetUnitY(u) , 0)
        endif
        call FlushChildHashtable(LHTable, GetHandleId(d))
        call DialogDisplay(p, d, false)
        call DialogClear(d)
        call DialogDestroy(d)
        set d=null
        set u=null
        set p=null
        call DestroyTrigger(GetTriggeringTrigger())
	endfunction
 function Xuyuan takes player p returns nothing
        local trigger t= CreateTrigger()
        local dialog d= DialogCreate()
        call DialogSetMessage(d, "选择你想要的愿望")
        if ( ( udg_H[GetConvertedPlayerId(p)] != sichen and udg_H[GetConvertedPlayerId(p)] != xuanxue ) or not IsKuanghuan() ) then
        	call SaveButtonHandle(LHTable, GetHandleId(d), 3, DialogAddButtonBJ(d, "提高50级"))
        endif
    	call SaveButtonHandle(LHTable, GetHandleId(d), 1, DialogAddButtonBJ(d, "等级到100，属性不变"))
        call SaveButtonHandle(LHTable, GetHandleId(d), 2, DialogAddButtonBJ(d, "属性立马提高8%(直接相乘)"))
        call SaveButtonHandle(LHTable, GetHandleId(d), 5, DialogAddButtonBJ(d, "获得50点木头"))
        call SavePlayerHandle(LHTable, GetHandleId(d), 4, p)
        call DialogDisplay(p, d, true)
        call TriggerRegisterDialogEvent(t, d)
        call TriggerAddAction(t, function Purgatory___XuyuanClick)
        set d=null
        set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetPurgatory90UpUnit takes nothing returns nothing
  local integer i= GetConvertedPlayerId(GetOwningPlayer(udg_Unit))
		if ( ( udg_I_Lianyu[i] >= 92 ) and ( udg_I_Lianyu[i] != 106 ) and ( udg_I_Lianyu[i] < 110 ) ) then
			call UnitAddItemByIdSwapped(GetRandomPotion(), udg_Unit)
			call DisplayTextToPlayer(GetOwningPlayer(udg_Unit), 0., 0., "|cFFFF6699【炼狱】|r额外奖励" + GetPlayerName(GetOwningPlayer(udg_Unit)) + GetItemName(GetLastCreatedItem()) + ".")
		endif
	    if ( ( udg_I_Lianyu[i] == 91 ) ) then
	        set udg_Lianyu_Unit[i]='Nfir'
	        call DisplayTextToForce(GetPlayersAll(), ( "|cFFFF6699【炼狱】|r额外奖励" + ( GetPlayerName(GetOwningPlayer(udg_Unit)) + "|cffffcc001个人口，人口可以用来抓宠物。" ) ))
	        call SetPlayerStateBJ(GetOwningPlayer(udg_Unit), PLAYER_STATE_RESOURCE_FOOD_CAP, ( GetPlayerState(GetOwningPlayer(udg_Unit), PLAYER_STATE_RESOURCE_FOOD_CAP) + 1 ))
	    elseif ( ( udg_I_Lianyu[i] == 92 ) ) then
	        set udg_Lianyu_Unit[i]='N00D'
	    elseif ( ( udg_I_Lianyu[i] == 93 ) ) then
	        set udg_Lianyu_Unit[i]='N00E'
	    elseif ( ( udg_I_Lianyu[i] == 94 ) ) then
	        set udg_Lianyu_Unit[i]='N00F'
	    elseif ( ( udg_I_Lianyu[i] == 95 ) ) then
	        set udg_Lianyu_Unit[i]='N00G'
	    elseif ( ( udg_I_Lianyu[i] == 96 ) ) then
	        set udg_Lianyu_Unit[i]='N00J'
	    elseif ( ( udg_I_Lianyu[i] == 97 ) ) then
	        set udg_Lianyu_Unit[i]='N00K'
	    elseif ( ( udg_I_Lianyu[i] == 98 ) ) then
	        set udg_Lianyu_Unit[i]='N00N'
	    elseif ( ( udg_I_Lianyu[i] == 99 ) ) then
	        set udg_Lianyu_Unit[i]='N00O'
	    elseif ( ( udg_I_Lianyu[i] == 100 ) ) then
	        set udg_Lianyu_Unit[i]='N00R'
	    elseif ( ( udg_I_Lianyu[i] == 101 ) ) then
	        set udg_Lianyu_Unit[i]='N00S'
	    elseif ( ( udg_I_Lianyu[i] == 102 ) ) then
	        set udg_Lianyu_Unit[i]='N00V'
	    elseif ( ( udg_I_Lianyu[i] == 103 ) ) then
	        set udg_Lianyu_Unit[i]='N00X'
	    elseif ( ( udg_I_Lianyu[i] == 104 ) ) then
	        set udg_Lianyu_Unit[i]='N010'
	    elseif ( ( udg_I_Lianyu[i] == 105 ) ) then
	        set udg_Lianyu_Unit[i]='N00Z'
	        call DisplayTextToForce(GetPlayersAll(), ( "|cFFFF6699【炼狱】|r额外奖励" + ( GetPlayerName(GetOwningPlayer(udg_Unit)) + "|cffffcc001个人口，人口可以用来抓宠物。" ) ))
	        call SetPlayerStateBJ(GetOwningPlayer(udg_Unit), PLAYER_STATE_RESOURCE_FOOD_CAP, ( GetPlayerState(GetOwningPlayer(udg_Unit), PLAYER_STATE_RESOURCE_FOOD_CAP) + 1 ))
	    elseif ( ( udg_I_Lianyu[i] == 106 ) ) then
	        set udg_Lianyu_Unit[i]='N011'
	    elseif ( ( udg_I_Lianyu[i] == 107 ) ) then
	        set udg_Lianyu_Unit[i]='N012'
	    elseif ( ( udg_I_Lianyu[i] == 108 ) ) then
	        set udg_Lianyu_Unit[i]='N013'
	    elseif ( ( udg_I_Lianyu[i] == 109 ) ) then
	        set udg_Lianyu_Unit[i]='N014'
	    elseif ( ( udg_I_Lianyu[i] == 110 ) ) then
	        set udg_Lianyu_Unit[i]='N015'
			call UnitAddItemByIdSwapped('I02U', udg_Unit)
		    call SaveInteger(YDHT, GetHandleId(GetLastCreatedItem()), 0xA75AD423, i)
	        call DisplayTextToForce(GetPlayersAll(), ( "|cFFFF6699【炼狱】|r额外奖励" + ( GetPlayerName(GetOwningPlayer(udg_Unit)) + "|cffffcc001个|cffff00ff【地狱】兮月蚕芯|r,可以许一个愿望。" ) ))
	    elseif ( ( udg_I_Lianyu[i] == 111 ) ) then
	    	//下一个就是阎王啦
			call UnitAddItemByIdSwapped('I02U', udg_Unit)
		    call SaveInteger(YDHT, GetHandleId(GetLastCreatedItem()), 0xA75AD423, i)
	        call DisplayTextToForce(GetPlayersAll(), ( "|cFFFF6699【炼狱】|r额外奖励" + ( GetPlayerName(GetOwningPlayer(udg_Unit)) + "|cffffcc001个|cffff00ff【地狱】兮月蚕芯|r,可以许一个愿望。" ) ))
	    endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function TPurgatoryItemCon takes nothing returns boolean
	    return ( ( IsUnitIllusionBJ(GetDyingUnit()) != true ) and ( ( GetUnitTypeId(GetDyingUnit()) == 'nfra' ) or ( GetUnitTypeId(GetDyingUnit()) == 'nwld' ) or ( GetUnitTypeId(GetDyingUnit()) == 'nwzd' ) or ( GetUnitTypeId(GetDyingUnit()) == 'ndqp' ) or ( GetUnitTypeId(GetDyingUnit()) == 'nsc2' ) or ( GetUnitTypeId(GetDyingUnit()) == 'nwns' ) or ( GetUnitTypeId(GetDyingUnit()) == 'nsoc' ) or ( GetUnitTypeId(GetDyingUnit()) == 'npfl' ) or ( GetUnitTypeId(GetDyingUnit()) == 'ninm' ) ) )
	endfunction
 function TPurgatoryItemAct takes nothing returns nothing
  local integer dyingUnitId= GetUnitTypeId(GetDyingUnit())
//textmacro instance: CreatePurgatoryItem("nfra","IB00")
		if ( dyingUnitId == 'nfra' ) then
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl", GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit())))
			call CreateItem('IB00', GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit()))
			return
		endif
//end of: CreatePurgatoryItem("nfra","IB00")
//textmacro instance: CreatePurgatoryItem("nwld","IMJ1")
		if ( dyingUnitId == 'nwld' ) then
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl", GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit())))
			call CreateItem('IMJ1', GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit()))
			return
		endif
//end of: CreatePurgatoryItem("nwld","IMJ1")
//textmacro instance: CreatePurgatoryItem("nwzd","IMJ2")
		if ( dyingUnitId == 'nwzd' ) then
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl", GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit())))
			call CreateItem('IMJ2', GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit()))
			return
		endif
//end of: CreatePurgatoryItem("nwzd","IMJ2")
//textmacro instance: CreatePurgatoryItem("ndqp","IMJ3")
		if ( dyingUnitId == 'ndqp' ) then
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl", GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit())))
			call CreateItem('IMJ3', GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit()))
			return
		endif
//end of: CreatePurgatoryItem("ndqp","IMJ3")
//textmacro instance: CreatePurgatoryItem("nsc2","IMJ4")
		if ( dyingUnitId == 'nsc2' ) then
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl", GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit())))
			call CreateItem('IMJ4', GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit()))
			return
		endif
//end of: CreatePurgatoryItem("nsc2","IMJ4")
//textmacro instance: CreatePurgatoryItem("nwns","IMJ5")
		if ( dyingUnitId == 'nwns' ) then
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl", GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit())))
			call CreateItem('IMJ5', GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit()))
			return
		endif
//end of: CreatePurgatoryItem("nwns","IMJ5")
//textmacro instance: CreatePurgatoryItem("nsoc","IMJ6")
		if ( dyingUnitId == 'nsoc' ) then
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl", GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit())))
			call CreateItem('IMJ6', GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit()))
			return
		endif
//end of: CreatePurgatoryItem("nsoc","IMJ6")
//textmacro instance: CreatePurgatoryItem("npfl","IMJ7")
		if ( dyingUnitId == 'npfl' ) then
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl", GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit())))
			call CreateItem('IMJ7', GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit()))
			return
		endif
//end of: CreatePurgatoryItem("npfl","IMJ7")
//textmacro instance: CreatePurgatoryItem("ninm","IMJ8")
		if ( dyingUnitId == 'ninm' ) then
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl", GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit())))
			call CreateItem('IMJ8', GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit()))
			return
		endif
//end of: CreatePurgatoryItem("ninm","IMJ8")
	endfunction
//---------------------------------------------------------------------------------------------------
 function Purgatory___InitPurgatory takes nothing returns nothing
  local trigger t= CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_DEATH)
	    call TriggerAddCondition(t, Condition(function TPurgatoryItemCon))
	    call TriggerAddAction(t, function TPurgatoryItemAct)
	    set t=null
	endfunction

//library Purgatory ends
//library SameItem:
//---------------------------------------------------------------------------------------------------
	
 function IsSharedItem takes item i returns boolean
		return GetItemTypeId(i) == 'fgrg' or GetItemTypeId(i) == 'hlst' or GetItemTypeId(i) == 'wshs' or GetItemTypeId(i) == 'wild' or GetItemTypeId(i) == 'totw' or GetItemTypeId(i) == 'sror' or GetItemTypeId(i) == 'olig' or GetItemTypeId(i) == 'srtl' or GetItemTypeId(i) == 'shhn' or GetItemTypeId(i) == 'flag' or GetItemTypeId(i) == 'shcw' or GetItemTypeId(i) == 'shtm' or GetItemTypeId(i) == 'IXU1' or GetItemTypeId(i) == 'I049' or GetItemTypeId(i) == 'I04A' or GetItemTypeId(i) == 'I06N' or GetItemTypeId(i) == 'I07T' or GetItemTypeId(i) == 'I02U'
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SameItem__UnitHasJubaoInSlot takes unit u,integer slot returns boolean
		return GetItemTypeId(UnitItemInSlotBJ(u, slot)) == 'I05P' or GetItemTypeId(UnitItemInSlotBJ(u, slot)) == 'I05Q' or GetItemTypeId(UnitItemInSlotBJ(u, slot)) == 'I05R'
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SameItem__OnlyOneZhuangbei takes integer itemID returns nothing
  local integer i= 1
  local integer count= 0
		loop
			exitwhen i > 6
			if ( GetItemTypeId(UnitItemInSlotBJ(GetTriggerUnit(), i)) == itemID ) then
				set count=count + 1
			endif
			set i=i + 1
		endloop
		//如果计数君大于1则丢掉
		if ( count > 1 ) then
			call UnitRemoveItemSwapped(GetManipulatedItem(), GetTriggerUnit())
			call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【消息】|r你只能同时装备一个" + GetItemName(GetManipulatedItem()) + "！")
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SameItem__TOnlyOneItemAct takes nothing returns nothing
  local integer i= 1
  local integer count= 0
		//多个人器的判断
		loop
			exitwhen i > 6
			if ( IsRen(UnitItemInSlotBJ(GetTriggerUnit(), i)) ) then
				set count=count + 1
			endif
			set i=i + 1
		endloop
		//如果计数君大于1则丢掉
		if ( count > 1 ) then
			call YDWEPolledWaitNull(0.1)
			call UnitRemoveItemSwapped(GetManipulatedItem(), GetTriggerUnit())
			call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【消息】|r你只能同时装备一个人器！")
			return
		endif
		//多个聚宝的判断
		set i=1
		set count=0
		loop
			exitwhen i > 6
			if ( SameItem__UnitHasJubaoInSlot(GetTriggerUnit() , i) ) then
				set count=count + 1
			endif
			set i=i + 1
		endloop
		//如果计数君大于1则丢掉
		if ( count > 1 ) then
			call UnitRemoveItemSwapped(GetManipulatedItem(), GetTriggerUnit())
			call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【消息】|r你只能同时装备一个1级以上的聚宝！")
			return
		endif
		//多个项链的判断
		set i=1
		set count=0
		loop
			exitwhen i > 6
			if ( IsXianglian(UnitItemInSlotBJ(GetTriggerUnit(), i)) ) then
				set count=count + 1
			endif
			set i=i + 1
		endloop
		//如果计数君大于1则丢掉
		if ( count > 1 ) then
			call UnitRemoveItemSwapped(GetManipulatedItem(), GetTriggerUnit())
			call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【消息】|r你只能同时装备一个项链！")
			return
		endif
		//多个戒指的判断
		set i=1
		set count=0
		loop
			exitwhen i > 6
			if ( IsGui(UnitItemInSlotBJ(GetTriggerUnit(), i)) ) then
				set count=count + 1
			endif
			set i=i + 1
		endloop
		//如果计数君大于1则丢掉
		if ( count > 1 ) then
			call YDWEPolledWaitNull(0.1)
			call UnitRemoveItemSwapped(GetManipulatedItem(), GetTriggerUnit())
			call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【消息】|r你只能同时装备一个戒指！")
			return
		endif
		call SameItem__OnlyOneZhuangbei('ratc')
		call SameItem__OnlyOneZhuangbei('I04L')
		//call OnlyOneZhuangbei('rat6')
	endfunction
 function SameItem__TOnlyOneItemCon takes nothing returns boolean
		return ( GetManipulatingUnit() == udg_H[GetConvertedPlayerId(GetOwningPlayer(GetManipulatingUnit()))] ) and ( IsUnitIllusionBJ(GetManipulatingUnit()) != true )
	endfunction
//---------------------------------------------------------------------------------------------------
 function SameItem__InitSameItem takes nothing returns nothing
		//人器或者聚宝只能装备一个
  local trigger t= CreateTrigger()
		call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_PICKUP_ITEM)
		call TriggerAddCondition(t, Condition(function SameItem__TOnlyOneItemCon))
		call TriggerAddAction(t, function SameItem__TOnlyOneItemAct)
		set t=null
	endfunction

//library SameItem ends
//library Version:
//---------------------------------------------------------------------------------------------------
	
 function SaveAllPlayerAchievement takes integer id returns nothing
  local integer i= 1
		loop
			exitwhen i > 6
			if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) ) then
				call GetAchievementAndSave(ConvertedPlayer(i) , id)
			endif
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetPlatformLevelGold takes player p returns nothing
		if ( DzAPI_Map_GetMapLevel(p) >= 20 ) then
			call AdjustPlayerStateBJ(8000, p, PLAYER_STATE_RESOURCE_GOLD)
		elseif ( DzAPI_Map_GetMapLevel(p) >= 15 ) then
			call AdjustPlayerStateBJ(6000, p, PLAYER_STATE_RESOURCE_GOLD)
		elseif ( DzAPI_Map_GetMapLevel(p) >= 10 or true ) then
			call AdjustPlayerStateBJ(4000, p, PLAYER_STATE_RESOURCE_GOLD)
		elseif ( DzAPI_Map_GetMapLevel(p) >= 5 ) then
			call AdjustPlayerStateBJ(2000, p, PLAYER_STATE_RESOURCE_GOLD)
		endif
	endfunction
//-----------------------------------------------------------------1---------------------------------
	
 function Version___IsPass takes player p,integer nan returns boolean
  local integer i= 9
		loop
			exitwhen i < nan
			if ( GetBit(achieve[GetConvertedPlayerId(p)] , i) > 0 ) then
				return true
			endif
			set i=i - 1
		endloop
		return false
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ActivateAllSpin takes player p returns nothing
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetHuanyiHint takes nothing returns string
		return "|cff99ccff需要地图等级达到2级才能选取该英雄|r"
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetMengjiHint takes nothing returns string
		return "|cff99ccff需要地图等级达到6级才能选取该英雄|r"
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetCanglingHint takes nothing returns string
		return "|cff99ccff需要地图等级达到8级才能选取该英雄|r"
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetXinglongHint takes nothing returns string
		return "|cff99ccff需要地图等级达到11级才能选取该英雄|r"
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetXiaotingHint takes nothing returns string
		return "|cff99ccff考虑到操作对新手可能不友好,通关炼狱难度后证明自己的实力即可选取|r"
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function PrintCurrentPlatformLevel takes player p returns nothing
		call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r当前你的平台地图等级为：" + I2S(DzAPI_Map_GetMapLevel(p)) + "！")
		// call QixiHuodong(p)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsColorSpin takes player p returns boolean
		return ( GetBit(spin[GetConvertedPlayerId(p)] , 1) > 0 )
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetHuanyiSelectedCon takes player p returns boolean
		return ( DzAPI_Map_GetMapLevel(p) >= 2 )
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetMengjiSelectedCon takes player p returns boolean
		return ( DzAPI_Map_GetMapLevel(p) >= 6 )
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetCanglingSelectedCon takes player p returns boolean
		return ( DzAPI_Map_GetMapLevel(p) >= 8 )
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetXinglongSelectedCon takes player p returns boolean
		return ( DzAPI_Map_GetMapLevel(p) >= 11 ) // or GetPlayerWordCount(p) >= 8
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetXiaotingSelectedCon takes player p returns boolean
		return Version___IsPass(p , 5)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function PrintMengjiPassword takes nothing returns nothing
	endfunction
 function PrintCanglingPassword takes nothing returns nothing
	endfunction
 function PrintXinglongPassword takes nothing returns nothing
	endfunction
 function PrintXiaotingPassword takes nothing returns nothing
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitAllAchievement takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > 6
			if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) ) then
    			set achieve[i]=S2I(DzAPI_Map_GetStoredString(ConvertedPlayer(i) , "achieve"))
    			set achieve2[i]=DzAPI_Map_GetStoredInteger(ConvertedPlayer(i) , "achieve2")
    			set achieve3[i]=DzAPI_Map_GetStoredInteger(ConvertedPlayer(i) , "achieve3")
    			set achieve4[i]=DzAPI_Map_GetStoredInteger(ConvertedPlayer(i) , "achieve4")
    			set vipCode[i]=DzAPI_Map_GetStoredInteger(ConvertedPlayer(i) , "vip")
    			set achiPage[i]=DzAPI_Map_GetStoredInteger(ConvertedPlayer(i) , "page")
    			set heroCountString[i]=DzAPI_Map_GetStoredString(ConvertedPlayer(i) , "hero")
    			set spin[i]=DzAPI_Map_GetStoredInteger(ConvertedPlayer(i) , "spin")
    			set diyu[i]=DzAPI_Map_GetStoredInteger(ConvertedPlayer(i) , "defense")
    			set mingcha[i]=DzAPI_Map_GetStoredInteger(ConvertedPlayer(i) , "mingcha")
    			
    			set Idaixin[i]=DzAPI_Map_GetStoredInteger(ConvertedPlayer(i) , "daixin")
    			set Ileishi[i]=DzAPI_Map_GetStoredInteger(ConvertedPlayer(i) , "leishi")
    			set SDIY[i]=DzAPI_Map_GetStoredString(ConvertedPlayer(i) , "diy")
    			set Greward[i]=DzAPI_Map_GetStoredInteger(ConvertedPlayer(i) , "Greward")
    			set Greward2[i]=DzAPI_Map_GetStoredString(ConvertedPlayer(i) , "Greward2")
    			set SJizi[i]=DzAPI_Map_GetStoredString(ConvertedPlayer(i) , "SJizi")
    			set IConDays[i]=DzAPI_Map_GetStoredInteger(ConvertedPlayer(i) , "IConDays")
    			set ILastTime[i]=DzAPI_Map_GetStoredInteger(ConvertedPlayer(i) , "ILastTime")
    			//签到指数
    			//set IQiandao2[i] = DzAPI_Map_GetStoredInteger(ConvertedPlayer(i), "IQiandao2")
    			set spin2[i]=DzAPI_Map_GetStoredInteger(ConvertedPlayer(i) , "spin2")
    			set spin3[i]=DzAPI_Map_GetStoredInteger(ConvertedPlayer(i) , "spin3")
    			set easyCString[i]=DzAPI_Map_GetStoredString(ConvertedPlayer(i) , "easyCString")
    			set middleCString[i]=DzAPI_Map_GetStoredString(ConvertedPlayer(i) , "middleCString")
    			set hardCString[i]=DzAPI_Map_GetStoredString(ConvertedPlayer(i) , "hardCString")
    			set SBoxWord[i]=DzAPI_Map_GetStoredString(ConvertedPlayer(i) , "SBoxWord")
    			set SFanzhaun[i]=DzAPI_Map_GetStoredString(ConvertedPlayer(i) , "SFanzhaun")
    			//全局变量
    			set IKuanghuan=S2I(DzAPI_Map_GetMapConfig("kh"))
    			call DisplayTextToPlayer(ConvertedPlayer(i), 0., 0., "|cFFFF66CC【消息】|r读取数据中.....")
			endif
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function JudgeCundang takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > 6
			if ( GetPlayerServerValueSuccess(ConvertedPlayer(i)) ) then
				set Bdudang[i]=true
			else
				set Bdudang[i]=false
			endif
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function TSpeakPassword takes nothing returns nothing
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitOldAchievement takes integer id returns nothing
		if ( GetBit(achieve[id] , 9) > 0 ) then
			set achiPage[id]=19
		elseif ( GetBit(achieve[id] , 8) > 0 ) then
			set achiPage[id]=18
		elseif ( GetBit(achieve[id] , 7) > 0 ) then
			set achiPage[id]=17
		elseif ( GetBit(achieve[id] , 6) > 0 ) then
			set achiPage[id]=16
		elseif ( GetBit(achieve[id] , 5) > 0 ) then
			set achiPage[id]=15
		elseif ( GetBit(achieve[id] , 4) > 0 ) then
			set achiPage[id]=14
		elseif ( GetBit(achieve[id] , 3) > 0 ) then
			set achiPage[id]=13
		elseif ( GetBit(achieve[id] , 2) > 0 ) then
			set achiPage[id]=12
		elseif ( GetBit(achieve[id] , 1) > 0 ) then
			set achiPage[id]=11
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Version___GetTotalDeathCount takes nothing returns integer
  local integer i= 1
  local integer result= 0
		loop
			exitwhen i > 6
			set result=result + deathCount[i]
			set i=i + 1
		endloop
		return result
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SaveDaixin takes integer index returns nothing
  local integer i= 1
		loop
			exitwhen i > 6
			if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) and ( index != i ) and ( DzAPI_Map_GetMapLevel(ConvertedPlayer(i)) <= 5 ) ) then
				set Idaixin[index]=Idaixin[index] + 1
			endif
			set i=i + 1
		endloop
		if ( Idaixin[index] >= 100 ) then
			call GetAchievementAndSave(ConvertedPlayer(index) , 324)
		else
			call DisplayTextToPlayer(ConvertedPlayer(index), 0., 0., GetAchievementName(324) + "|r" + I2S(Idaixin[index]) + "/100.")
	    	call DzAPI_Map_StoreInteger(ConvertedPlayer(index) , "daixin" , Idaixin[index])
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IncreaseYanmieFanzhuan takes player p returns nothing
  local integer i= GetConvertedPlayerId(p)
		if ( diyu[i] / 100000 < 5 ) then
			set diyu[i]=diyu[i] + 100000
			call DzAPI_Map_StoreInteger(ConvertedPlayer(i) , "defense" , diyu[i])
			call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r湮灭技能第二形态进度:" + I2S(diyu[i] / 100000) + "/5")
		endif
		if ( diyu[i] / 100000 >= 5 ) then
			call SetFanzhuanOK(p , 2)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SaveAchievement takes nothing returns nothing
  local integer i= 1
  local integer level= GetDiffculty()
		call BJDebugMsg("|cFFFF66CC【消息】|r正在保存游戏数据中....请不要马上退出游戏,以免保存失败...")
		loop
			exitwhen i > 6
			if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) ) then
				//通关称号
				call GetAchievementAndSave(ConvertedPlayer(i) , I3(level == 9 , 325 , 10 + level))
				//单通称号
				if ( renshu == 1 and level != 9 ) then
					call GetAchievementAndSave(ConvertedPlayer(i) , I3(level < 8 , 217 - level , 29))
				endif
				//玄雪末日权杖
				if ( renshu == 1 and udg_H[i] == xuanxue and level >= 4 ) then
					call SetXuanxue1SpinOK(ConvertedPlayer(i))
				endif
				if ( level >= 4 ) then
					call IncreaseYanmieFanzhuan(ConvertedPlayer(i))
				endif
				//基地的血
				if ( udg_I_Er_diansi[1] == 0 ) then
					call GetAchievementAndSave(ConvertedPlayer(i) , 221)
					if ( GetUnitState(gg_unit_haro_0030, UNIT_STATE_LIFE) <= ( 0.25 * GetUnitState(gg_unit_haro_0030, UNIT_STATE_MAX_LIFE) ) ) then
						call GetAchievementAndSave(ConvertedPlayer(i) , 222)
					endif
				endif
				if not ( BBaseDamage ) then
					call GetAchievementAndSave(ConvertedPlayer(i) , 320)
				endif
				if ( Version___GetTotalDeathCount() < 1 ) then
					call GetAchievementAndSave(ConvertedPlayer(i) , 310)
				endif
				call SaveDaixin(i)
				if not ( BJiulun ) then
					call GetAchievementAndSave(ConvertedPlayer(i) , 323)
				endif
				if not ( BHaojie ) then
					call GetAchievementAndSave(ConvertedPlayer(i) , 327)
				endif
				if not ( BSlince ) then
					call GetAchievementAndSave(ConvertedPlayer(i) , 416)
				endif
				if not ( BZongshu ) then
					call GetAchievementAndSave(ConvertedPlayer(i) , 49)
				endif
				if ( CT3() ) then
					call GetAchievementAndSave(ConvertedPlayer(i) , 410)
				endif
				if ( CT4() ) then
					call GetAchievementAndSave(ConvertedPlayer(i) , 411)
				endif
				if ( CType != 0 and CType != - 1 ) then
					call ChallangerSuccess(ConvertedPlayer(i))
				endif
				if ( CType == - 1 and level == 9 and renshu == 1 ) then
					call GetAchievementAndSave(ConvertedPlayer(i) , 418)
				endif
				if ( CType == - 1 and IsTianyan ) then
					call GetAchievementAndSave(ConvertedPlayer(i) , 420)
				endif
			endif
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SaveAchievementKuilei1 takes nothing returns nothing
  local integer i= 1
  local integer level= GetDiffculty()
		call BJDebugMsg("|cFFFF66CC【消息】|r正在保存游戏数据中....请不要马上退出游戏,以免保存失败...")
		loop
			exitwhen i > 6
			if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) ) then
				if ( not ( BShengming ) and udg_RENSHU >= 4 ) then
					call GetAchievementAndSave(ConvertedPlayer(i) , 45)
				endif
			endif
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SaveAchievementKuilei2 takes nothing returns nothing
  local integer i= 1
  local integer level= GetDiffculty()
		call BJDebugMsg("|cFFFF66CC【消息】|r正在保存游戏数据中....请不要马上退出游戏,以免保存失败...")
		loop
			exitwhen i > 6
			if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) ) then
				call GetAndSaveCangku(ConvertedPlayer(i) , 9)
			endif
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SaveAchievement2 takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > 6
			if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) ) then
				//通关称号,时间
				if ( IsClassic() ) then
					if ( udg_Second[2] < 135 ) then
						call GetAchievementAndSave(ConvertedPlayer(i) , 223)
					endif
					if ( udg_Second[2] < 120 ) then
						call GetAchievementAndSave(ConvertedPlayer(i) , 224)
					endif
					if ( udg_Second[2] < 90 ) then
						call GetAchievementAndSave(ConvertedPlayer(i) , 225)
					endif
					if ( udg_Second[2] < 60 ) then
						call GetAchievementAndSave(ConvertedPlayer(i) , 226)
					endif
				endif
			endif
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SaveAchievement3 takes player p,integer zhuan returns nothing
		if ( zhuan >= 20 ) then
			call GetAchievementAndSave(p , 21)
		endif
		if ( zhuan >= 50 ) then
			call GetAchievementAndSave(p , 22)
		endif
		if ( zhuan >= 100 ) then
			call GetAchievementAndSave(p , 23)
		endif
		if ( zhuan == 125 and udg_H[GetConvertedPlayerId(p)] == yanmie ) then
			call SetYanmieSpinOK(p)
		endif
		if ( zhuan >= 150 ) then
			call GetAchievementAndSave(p , 24)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function TGetAchievementLumber takes nothing returns nothing
		call GetAchievementAndSave(GetTriggerPlayer() , 25)
		if ( GetPlayerState(GetTriggerPlayer(), PLAYER_STATE_RESOURCE_LUMBER) > 50000 ) then
			call GetAchievementAndSave(GetTriggerPlayer() , 26)
		endif
		if ( GetPlayerState(GetTriggerPlayer(), PLAYER_STATE_RESOURCE_LUMBER) > 100000 ) then
			call GetAchievementAndSave(GetTriggerPlayer() , 27)
		endif
		if ( GetPlayerState(GetTriggerPlayer(), PLAYER_STATE_RESOURCE_LUMBER) > 200000 ) then
			call GetAchievementAndSave(GetTriggerPlayer() , 28)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SavePIV takes player p,integer i returns nothing
    	call DzAPI_Map_StoreInteger(p , "vip" , i)
	endfunction
 function IsSavePIV takes player p,integer i returns boolean
		return vipCode[GetConvertedPlayerId(p)] == i
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IncreaseHeroCount takes player p,integer i returns nothing
  local integer index= GetConvertedPlayerId(p)
  local integer length
  local integer times
  local string temp
		if ( i < 1 or i > 31 ) then
			return
		endif
		if not ( Bdudang[index] ) then
			call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r本局游戏英雄次数数据读取失败,请重新开始游戏.")
			return
		endif
		if ( StringLength(heroCountString[index]) < 62 ) then
			set heroCountString[index]="00000000000000000000000000000000000000000000000000000000000000"
		endif
		set length=StringLength(heroCountString[index])
		set times=S2I(SubStringBJ(heroCountString[index], 2 * i - 1, 2 * i))
		set temp=heroCountString[index]
		set times=IMinBJ(99, times + 1)
		set heroCountString[index]=SubStringBJ(temp, 1, 2 * i - 2)
		if ( times < 10 ) then
			set heroCountString[index]=heroCountString[index] + "0" + I2S(times)
		else
			set heroCountString[index]=heroCountString[index] + I2S(times)
		endif
		set heroCountString[index]=heroCountString[index] + SubStringBJ(temp, 2 * i + 1, length)
		set temp=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetHeroTimes takes player p returns integer
  local unit u= udg_H[GetConvertedPlayerId(p)]
  local integer i= GetHeroIndex(GetUnitTypeId(u))
		set u=null
		return GetSpecifyHeroTimes(p , i)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetBestHero takes player p returns integer
  local integer max= 0
  local integer maxIndex= 0
  local integer i= HERO_COUNT
		loop
			exitwhen i < 1
			if ( ( GetSpecifyHeroTimes(p , i) > max ) or ( GetSpecifyHeroTimes(p , i) == max and GetHeroIndex(GetUnitTypeId(udg_H[GetConvertedPlayerId(p)])) == i ) ) then
				set max=GetSpecifyHeroTimes(p , i)
				set maxIndex=i
			endif
			set i=i - 1
		endloop
		return maxIndex
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function PrintAllHeroTimes takes player p returns nothing
  local string result= ""
  local integer i= 1
		if not ( Bdudang[GetConvertedPlayerId(p)] ) then
			call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r本局游戏英雄次数数据读取失败,请重新开始游戏.")
			return
		endif
		call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r你的所有英雄使用次数如下所示：")
		loop
			exitwhen i > HERO_COUNT
			set result=result + GetIndexHeroColorName(i) + "的使用次数:" + I2S(GetSpecifyHeroTimes(p , i)) + ","
			if ( ModuloInteger(i, 3) == 0 ) then
				call DisplayTextToPlayer(p, 0., 0., result)
				set result=""
			endif
			set i=i + 1
		endloop
		if ( result != "" ) then
			call DisplayTextToPlayer(p, 0., 0., result)
		endif
		set result=null
		call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r如果你想调节视角高度,请输入-+")
		call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r如果你想隐藏技能伤害,请输入-sh(不推荐新手输入)")
		//call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r如果你想取消彩色皮肤,请输入-qc")
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SaveDeathAchievement takes player p returns nothing
		set deathCount[GetConvertedPlayerId(p)]=deathCount[GetConvertedPlayerId(p)] + 1
		if ( deathCount[GetConvertedPlayerId(p)] >= 100 ) then
			call GetAchievementAndSave(p , 231)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SaveRingAchievement takes player p,integer count returns nothing
		if ( count == 120 ) then
			call GetAchievementAndSave(p , 321)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SaveMijingAchievement takes integer count returns nothing
  local integer i= 1
		if ( count < 13 ) then
			return
		endif
		loop
			exitwhen i > 6
			if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) ) then
				if ( count >= 13 ) then
					call GetAchievementAndSave(ConvertedPlayer(i) , 36)
				endif
				if ( count >= 15 ) then
					call GetAchievementAndSave(ConvertedPlayer(i) , 37)
				endif
				if ( count >= 17 ) then
					call GetAchievementAndSave(ConvertedPlayer(i) , 38)
				endif
				if ( count >= 20 ) then
					call GetAchievementAndSave(ConvertedPlayer(i) , 39)
				endif
			endif
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SaveJunengAchievement takes nothing returns nothing
		set JunengCount=JunengCount + 1
		if ( JunengCount >= 6 ) then
			call SaveAllPlayerAchievement(311)
		endif
		if ( JunengCount >= 20 ) then
			call SaveAllPlayerAchievement(312)
		endif
		if ( JunengCount >= 12 and GetDiffculty() >= 8 ) then
			call SaveAllPlayerAchievement(313)
		endif
		if ( JunengCount >= 40 and GetDiffculty() >= 8 ) then
			call SaveAllPlayerAchievement(314)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SaveDoorAchievement takes nothing returns nothing
  local integer i= 1
		if ( udg_Second[2] >= 8 ) then
			return
		endif
		loop
			exitwhen i > 6
			if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) ) then
				call GetAchievementAndSave(ConvertedPlayer(i) , 326)
			endif
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Version___SaveAttrAchievement takes nothing returns nothing
  local integer i= 1
  local integer attr= 0
		loop
			exitwhen i > 6
			if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) ) then
				if ( udg_H[i] != null ) then
					set attr=GetHeroStr(udg_H[i], true) + GetHeroInt(udg_H[i], true) + GetHeroAgi(udg_H[i], true)
					if ( attr > 3000000 ) then
						call GetAchievementAndSave(ConvertedPlayer(i) , 315)
					endif
					if ( attr > 8000000 ) then
						call GetAchievementAndSave(ConvertedPlayer(i) , 316)
					endif
					if ( attr > 20000000 ) then
						call GetAchievementAndSave(ConvertedPlayer(i) , 317)
					endif
					if ( attr > 35000000 and udg_H[i] == sichen ) then
						call SetSichenSpinOK(ConvertedPlayer(i))
					endif
					if ( attr > 50000000 ) then
						call GetAchievementAndSave(ConvertedPlayer(i) , 318)
					endif
				endif
			endif
			set i=i + 1
		endloop
		// if (udg_RENSHU > 0) then
		// 	if (ModuloInteger(udg_Second[2],60/udg_RENSHU) == 0 and (udg_Second[2] != 0 or udg_RENSHU > 1)) then
		// 		call CreateYuebing(GetRectRandomX(GetPlayableMapRect()),GetRectRandomY(GetPlayableMapRect()))
		// 	endif
		// endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SaveKillLeishi takes player p returns nothing
		set Ileishi[GetConvertedPlayerId(p)]=SetIntegerBit(Ileishi[GetConvertedPlayerId(p)] , GetHeroIndex(GetUnitTypeId(udg_H[GetConvertedPlayerId(p)])) + 1 , true)
		if ( GetIntegerHasOne(Ileishi[GetConvertedPlayerId(p)]) >= 12 ) then
			call GetAchievementAndSave(p , 322)
		else
			call DisplayTextToPlayer(p, 0., 0., GetAchievementName(322) + "|r" + I2S(GetIntegerHasOne(Ileishi[GetConvertedPlayerId(p)])) + "/12.")
		endif
    	call DzAPI_Map_StoreInteger(p , "leishi" , Ileishi[GetConvertedPlayerId(p)])
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SaveAchievement5 takes player p,integer count returns nothing
		set killCount[GetConvertedPlayerId(p)]=killCount[GetConvertedPlayerId(p)] + count
		if ( killCount[GetConvertedPlayerId(p)] >= 15000 ) then
			call GetAchievementAndSave(p , 227)
		endif
		if ( killCount[GetConvertedPlayerId(p)] >= 40000 ) then
			call GetAchievementAndSave(p , 228)
		endif
		if ( killCount[GetConvertedPlayerId(p)] >= 80000 ) then
			call GetAchievementAndSave(p , 229)
		endif
		if ( killCount[GetConvertedPlayerId(p)] >= 150000 ) then
			call GetAchievementAndSave(p , 230)
		endif
		if ( killCount[GetConvertedPlayerId(p)] >= 125000 and udg_H[GetConvertedPlayerId(p)] == sheyan ) then
			call SetSheyanSpinOK(p)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Jiance1 takes unit u returns nothing
        local real percentThousand= ( GetUnitState(u, UNIT_STATE_LIFE) * 1000. ) / GetUnitState(u, UNIT_STATE_MAX_LIFE)
        if ( UnitHasBuffBJ(u, 'Bapl') or UnitHasBuffBJ(u, 'Bpoi') or UnitHasBuffBJ(u, 'Bpsd') ) then
        	call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你拥有中毒BUFF.")
        	return
        endif
        if ( percentThousand < 10 and IsUnitAliveBJ(u) and not ( BHeroDeath[GetConvertedPlayerId(GetOwningPlayer(u))] ) ) then
			call GetAchievementAndSave(GetOwningPlayer(u) , 412)
        endif
        call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你当前的生命为千分之" + R2S(percentThousand) + ".")
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Jiance2 takes unit u returns nothing
        local real life= GetUnitState(u, UNIT_STATE_MAX_LIFE)
        if ( life > 500000000 ) then
			call GetAchievementAndSave(GetOwningPlayer(u) , 413)
        endif
        call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你当前的生命为" + R2S(life) + ".")
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Jiance3 takes unit u returns nothing
        local integer defense= GetHeroAgi(u, true) / 100 + GetDefense(u)
        if ( defense > 1000000 ) then
			call GetAchievementAndSave(GetOwningPlayer(u) , 414)
        endif
        call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你判定的防御为" + R2S(defense) + ".")
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SaveAchievement6 takes player p,integer damage2 returns nothing
		if ( damage2 >= 500 ) then
			call GetAchievementAndSave(p , 32)
		endif
		if ( damage2 >= 4000 ) then
			call GetAchievementAndSave(p , 33)
		endif
		if ( damage2 >= 30000 ) then
			call GetAchievementAndSave(p , 34)
		endif
		if ( damage2 >= 600000 ) then
			call GetAchievementAndSave(p , 35)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SavePetAchievement takes player p,integer level returns nothing
		if ( level >= 50 ) then
			call GetAchievementAndSave(p , 328)
		endif
		if ( level >= 70 ) then
			call GetAchievementAndSave(p , 329)
		endif
		if ( level >= 100 ) then
			call GetAchievementAndSave(p , 330)
		endif
		if ( level >= 150 ) then
			call GetAchievementAndSave(p , 331)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SaveAchievement4 takes player p returns nothing
		if ( GetLowerHeroCount(p , 1 , 12) ) then
			call GetAchievementAndSave(p , 217)
		endif
		if ( GetLowerHeroCount(p , 5 , 12) ) then
			call GetAchievementAndSave(p , 218)
		endif
		if ( GetLowerHeroCount(p , 10 , 12) ) then
			call GetAchievementAndSave(p , 219)
		endif
		if ( GetLowerHeroCount(p , 30 , 12) ) then
			call GetAchievementAndSave(p , 220)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Version___SaveAllHeroTimes takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local player p= ConvertedPlayer(LoadInteger(LHTable, id, kSaveHeroTimes))
  local integer i= GetHeroIndex(GetUnitTypeId(udg_H[GetConvertedPlayerId(p)]))
		call IncreaseHeroCount(p , i)
		if ( Bdudang[GetConvertedPlayerId(p)] ) then
			call DzAPI_Map_StoreString(p , "hero" , heroCountString[GetConvertedPlayerId(p)])
	    	call DzAPI_Map_Stat_SetStat(p , "hero" , GetIndexHeroName(GetBestHero(p)))
	    else
	    	call ShowGameHint(p , "\n	    		本局游戏数据读取失败,建议重新开始游戏.\n	    		(还是能正常游戏,但是不能获得成就与皮肤)")
		endif
		call PrintAllHeroTimes(p)
		call SaveAchievement4(p)
		call PauseTimer(t)
		call FlushChildHashtable(LHTable, id)
		call DestroyTimer(t)
		set t=null
		set p=null
	endfunction
	
 function CreateAllHeroTimesTimer takes player p returns nothing
  local timer t= CreateTimer()
		call SaveInteger(LHTable, GetHandleId(t), kSaveHeroTimes, GetConvertedPlayerId(p))
		call TimerStart(t, 10, false, function Version___SaveAllHeroTimes)
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GetSuperLiujiewang takes nothing returns player
  local integer i= 1
		loop
			exitwhen i > 6
			if ( IsAchieveOK(ConvertedPlayer(i) , 48) ) then
				return ConvertedPlayer(i)
			endif
			set i=i + 1
		endloop
		return null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetAndSaveDIYName takes player p returns nothing
  local integer id= GetConvertedPlayerId(p)
		set achiPage[id]=- 1
		call SaveAchievePointer(p)
		call SetPlayerName(p, GetRandomColor() + "【" + GetRandomColor() + SDIY[id] + GetRandomColor() + "】" + GetRandomColor() + playerName[id] + "|r")
		call DzAPI_Map_Stat_SetStat(p , "achi" , SDIY[id])
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitAchievementName takes unit u returns nothing
  local integer id= GetConvertedPlayerId(GetOwningPlayer(u))
		//计时英雄数
		call CreateAllHeroTimesTimer(GetOwningPlayer(u))
		if ( achiPage[id] == - 1 and ( IsQuanchengjiu(GetOwningPlayer(u)) or playerName[id] == "信哲大人" ) ) then
			call SetAndSaveDIYName(GetOwningPlayer(u))
		else
			if ( StringLength(I2S(achiPage[id])) < 2 or achiPage[id] < 0 ) then
				set achiPage[id]=10
				call InitOldAchievement(id)
				call SaveAchievePointer(GetOwningPlayer(u))
			endif
			call SetAchievement(GetOwningPlayer(u) , achiPage[id])
		endif
		if ( IsAchieveOK(GetOwningPlayer(u) , 47) ) then
			call BJDebugMsg(GetPlayerName(GetOwningPlayer(u)) + "|cff00ff00受到了来自圣界的欢迎!!!|r")
			call BJDebugMsg(GetPlayerName(GetOwningPlayer(u)) + "|cff00ff00受到了来自圣界的欢迎!!!|r")
			call BJDebugMsg(GetPlayerName(GetOwningPlayer(u)) + "|cff00ff00受到了来自圣界的欢迎!!!|r")
			call BJDebugMsg(GetPlayerName(GetOwningPlayer(u)) + "|cff00ff00受到了来自圣界的欢迎!!!|r")
			call BJDebugMsg(GetPlayerName(GetOwningPlayer(u)) + "|cff00ff00受到了来自圣界的欢迎!!!|r")
			call BJDebugMsg(GetPlayerName(GetOwningPlayer(u)) + "|cff00ff00受到了来自圣界的欢迎!!!|r")
			call BJDebugMsg(GetPlayerName(GetOwningPlayer(u)) + "|cff00ff00受到了来自圣界的欢迎!!!|r")
			call BJDebugMsg(GetPlayerName(GetOwningPlayer(u)) + "|cff00ff00受到了来自圣界的欢迎!!!|r")
			call BJDebugMsg(GetPlayerName(GetOwningPlayer(u)) + "|cff00ff00受到了来自圣界的欢迎!!!|r")
			call BJDebugMsg(GetPlayerName(GetOwningPlayer(u)) + "|cff00ff00受到了来自圣界的欢迎!!!|r")
		endif
		call InitChallangerData(GetOwningPlayer(u))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetDIYName takes player p,string s returns nothing
  local integer i= GetConvertedPlayerId(p)
		call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r你已经成就将成就自定义成:" + s + ".")
		set SDIY[i]=s
		call DzAPI_Map_StoreString(p , "diy" , SDIY[i])
		call SetAndSaveDIYName(p)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Huoquachi takes player p,string chat,integer page returns nothing
  local integer i= 1
  local integer result= 0
		loop
			exitwhen i > 40
			if ( chat == I2S(GetCycleHash(playerName[GetConvertedPlayerId(p)] + "ac" + I2S(page) + I2S(i) , 1)) ) then
				call GetAchievementAndSave(p , S2I(I2S(page) + I2S(i)))
				exitwhen true
			endif
			set i=i + 1
		endloop
		set BBuqian2=false
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitVersion takes nothing returns nothing
  local trigger t= CreateTrigger()
  local integer i= 1
    	call CreateUnit(Player(PLAYER_NEUTRAL_PASSIVE), 'n01L', - 9816.0, - 5968.0, 270.000)
    	set UChengjiu=CreateUnit(Player(6), 'n01K', - 14504.0, - 14040.0, 270.000)
		loop
			exitwhen i > 6
			if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) ) then
			    call TriggerRegisterPlayerStateEvent(t, ConvertedPlayer(i), PLAYER_STATE_RESOURCE_LUMBER, GREATER_THAN_OR_EQUAL, 20000.00)
			    set deathCount[i]=0
			    set killCount[i]=0
			endif
			set i=i + 1
		endloop
		call TriggerAddAction(t, function TGetAchievementLumber)
		call TimerStart(CreateTimer(), 60, true, function Version___SaveAttrAchievement)
		set t=null
	endfunction

//library Version ends
//library CenterBase:
//---------------------------------------------------------------------------------------------------
	
 function CenterBase__TAttackCenterBaseCon takes nothing returns boolean
		return ( ( IsUnitType(GetAttackedUnitBJ(), UNIT_TYPE_STRUCTURE) == true ) and ( GetOwningPlayer(GetAttackedUnitBJ()) == Player(6) ) and ( IsUnitAlly(GetAttacker(), Player(6)) == true ) )
	endfunction
 function CenterBase__TAttackCenterBaseAct takes nothing returns nothing
			call IssueImmediateOrder(GetAttacker(), "stop")
			call KillSelf(GetAttacker())
			call DisplayTimedTextToForce(GetPlayersAll(), 30, "|cFFFF66CC【提示】|r有人企图攻打自己的基地，被伟大的Crainax处死了。")
	endfunction
//---------------------------------------------------------------------------------------------------
	
	//开启防护罩
 function CenterBase__Kaiqifanghuzhao takes nothing returns nothing
  local real x= GetUnitX(gg_unit_haro_0030)
  local real y= GetUnitY(gg_unit_haro_0030)
   local player p= GetSuperLiujiewang()
	    set udg_I_Er_diansi[1]=( udg_I_Er_diansi[1] - 1 )
      if ( p == null ) then
		    call DisplayTextToForce(GetPlayersAll(), "|cFFFF66CC【提示】|r防护罩开启，还剩下" + I2S(udg_I_Er_diansi[1]) + "次的防护罩。")
		    call DisplayTextToForce(GetPlayersAll(), "|cFFFF66CC【提示】|r防护罩开启，还剩下" + I2S(udg_I_Er_diansi[1]) + "次的防护罩。")
		    call DisplayTextToForce(GetPlayersAll(), "|cFFFF66CC【提示】|r防护罩开启，还剩下" + I2S(udg_I_Er_diansi[1]) + "次的防护罩。")
		    call DisplayTextToForce(GetPlayersAll(), "|cFFFF66CC【提示】|r防护罩开启，还剩下" + I2S(udg_I_Er_diansi[1]) + "次的防护罩。")
		    call DisplayTextToForce(GetPlayersAll(), "|cFFFF66CC【提示】|r防护罩开启，还剩下" + I2S(udg_I_Er_diansi[1]) + "次的防护罩。")
   else
   call DisplayTextToForce(GetPlayersAll(), ( "|cFFFF66CC【提示】|r" + GetPlayerName(p) + "你作为一个超级六界王竟然让防护罩开启了!仅剩" + ( I2S(udg_I_Er_diansi[1]) + "次防护罩!!!" ) ))
   call DisplayTextToForce(GetPlayersAll(), ( "|cFFFF66CC【提示】|r" + GetPlayerName(p) + "你作为一个超级六界王竟然让防护罩开启了!仅剩" + ( I2S(udg_I_Er_diansi[1]) + "次防护罩!!!" ) ))
   call DisplayTextToForce(GetPlayersAll(), ( "|cFFFF66CC【提示】|r" + GetPlayerName(p) + "你作为一个超级六界王竟然让防护罩开启了!仅剩" + ( I2S(udg_I_Er_diansi[1]) + "次防护罩!!!" ) ))
   call DisplayTextToForce(GetPlayersAll(), ( "|cFFFF66CC【提示】|r" + GetPlayerName(p) + "你作为一个超级六界王竟然让防护罩开启了!仅剩" + ( I2S(udg_I_Er_diansi[1]) + "次防护罩!!!" ) ))
   call DisplayTextToForce(GetPlayersAll(), ( "|cFFFF66CC【提示】|r" + GetPlayerName(p) + "你作为一个超级六界王竟然让防护罩开启了!仅剩" + ( I2S(udg_I_Er_diansi[1]) + "次防护罩!!!" ) ))
      endif
	    call PlaySoundBJ(gg_snd_kill_boss)
	    call RemoveUnit(gg_unit_haro_0030)
	    set gg_unit_haro_0030=CreateUnit(Player(6), 'haro', x, y, 270)
	    call TriggerRegisterUnitEvent(TCenterBaseDeath, gg_unit_haro_0030, EVENT_UNIT_DEATH)
    	call TriggerRegisterUnitEvent(gg_trg____________________035, gg_unit_haro_0030, EVENT_UNIT_DAMAGED)
	    call UnitAddAbility(gg_unit_haro_0030, 'Avul')
	    call YDWEPolledWaitNull(30.00)
	    call UnitRemoveAbility(gg_unit_haro_0030, 'Avul')
	    call DisplayTextToForce(GetPlayersAll(), "|cFFFF66CC【提示】|r防护罩消失。")
	    call DisplayTextToForce(GetPlayersAll(), "|cFFFF66CC【提示】|r防护罩消失。")
	    call DisplayTextToForce(GetPlayersAll(), "|cFFFF66CC【提示】|r防护罩消失。")
	    call DisplayTextToForce(GetPlayersAll(), "|cFFFF66CC【提示】|r防护罩消失。")
	    call DisplayTextToForce(GetPlayersAll(), "|cFFFF66CC【提示】|r防护罩消失。")
	endfunction
 function TCenterBaseDeathAct takes nothing returns nothing
	    if ( udg_I_Er_diansi[1] > 0 ) then
	    	//开启防护罩
	    	call CenterBase__Kaiqifanghuzhao()
	    else
	    	//游戏失败
			call Jidibaozha("\n	    		圣光宝石破碎，五界坠入了深渊……\n				轮回之狱玩家交流群:413359254\n				(开黑、攻略，一应俱全)\n")
	    endif
	endfunction
//---------------------------------------------------------------------------------------------------
 function CenterBase__InitCenterBase takes nothing returns nothing
  local trigger t= CreateTrigger()
		call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
		call TriggerAddCondition(t, Condition(function CenterBase__TAttackCenterBaseCon))
		call TriggerAddAction(t, function CenterBase__TAttackCenterBaseAct)
	    set TCenterBaseDeath=CreateTrigger()
	    call TriggerRegisterUnitEvent(TCenterBaseDeath, gg_unit_haro_0030, EVENT_UNIT_DEATH)
	    call TriggerAddAction(TCenterBaseDeath, function TCenterBaseDeathAct)
		set t=null
	endfunction

//library CenterBase ends
//library Diamond:
//---------------------------------------------------------------------------------------------------
    
    function IsInDiamondRegion takes real x,real y returns boolean
        local location point= Location(x, y)
        local boolean b= RectContainsLoc(gg_rct_Diamond2, point) or RectContainsLoc(gg_rct_Diamond3, point) or RectContainsLoc(gg_rct________8, point)
        call RemoveLocation(point)
        return b
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___Diamond100 takes integer itemID,integer newItemID returns boolean
        local integer charges= 0
        if ( GetItemTypeId(GetSpellTargetItem()) == itemID ) then
            call DisplayTextToForce(GetPlayersAll(), ( "|cFFFF66CC【消息】|r" + ( GetUnitName(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]) + "以100%的成功率成功地升级了" + GetItemName(GetSpellTargetItem()) + "！" ) ))
            set charges=GetItemCharges(GetSpellTargetItem())
            call RemoveItem(GetSpellTargetItem())
            call UnitAddItemByIdSwapped(newItemID, GetTriggerUnit())
            call SetItemCharges(GetLastCreatedItem(), charges)
            call PlaySoundBJ(gg_snd_Chenggong)
            return true
        endif
        return false
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___DiamondA takes integer itemID,integer newItemID,integer poss returns boolean
        //琉璃璞玉
        if ( HasLiuli(GetTriggerUnit()) == true ) then
            return Diamond___Diamond100(itemID , newItemID)
        endif
        //非琉璃璞玉
        if ( GetItemTypeId(GetSpellTargetItem()) == itemID ) then
            if ( ( GetRandomInt(1, 100) <= poss ) ) then
                call DisplayTextToForce(GetPlayersAll(), ( "|cFFFF66CC【消息】|r" + ( GetUnitName(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]) + "以" + I2S(poss) + "%的成功率成功地升级了" + GetItemName(GetSpellTargetItem()) + "！" ) ))
                call RemoveItem(GetSpellTargetItem())
                call UnitAddItemByIdSwapped(newItemID, GetTriggerUnit())
                call PlaySoundBJ(gg_snd_Chenggong)
            else
                call DisplayTextToForce(GetPlayersAll(), ( "|cFFFF66CC【消息】|r" + ( GetUnitName(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]) + "以" + I2S(poss) + "%的成功率升级" + GetItemName(GetSpellTargetItem()) + "失败！" ) ))
                if ( GetRandomInt(1, 5) == 1 ) then
                    call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【小提示】|r装备到了+4以后推荐使用祝福/强化/诅咒石去升级.")
                else
                    if ( GetRandomInt(1, 4) == 1 ) then
                        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【小提示】|r|cffff00ff琉璃璞玉|r可以将宝石成功率提升至100%,可以通过42转或者永久赞助(详情按F9)获取.")
                    endif
                endif
                call PlaySoundBJ(gg_snd_f_baoshi)
            endif
            return true
        endif
        return false
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___DiamondB takes integer itemID,integer newItemID,integer oldItemID,integer poss returns boolean
        //琉璃璞玉
        if ( HasLiuli(GetTriggerUnit()) == true ) then
            return Diamond___Diamond100(itemID , newItemID)
        endif
        //非琉璃璞玉
        if ( GetItemTypeId(GetSpellTargetItem()) == itemID ) then
            if ( ( GetRandomInt(1, 100) <= poss ) ) then
                call DisplayTextToForce(GetPlayersAll(), ( "|cFFFF66CC【消息】|r" + ( GetUnitName(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]) + "以" + I2S(poss) + "%的成功率成功地升级了" + GetItemName(GetSpellTargetItem()) + "！" ) ))
                call RemoveItem(GetSpellTargetItem())
                call UnitAddItemByIdSwapped(newItemID, GetTriggerUnit())
                call PlaySoundBJ(gg_snd_Chenggong)
            else
                call DisplayTextToForce(GetPlayersAll(), ( "|cFFFF66CC【消息】|r" + ( GetUnitName(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]) + "以" + I2S(poss) + "%的成功率升级" + GetItemName(GetSpellTargetItem()) + "失败,等级降低！" ) ))
                if ( GetRandomInt(1, 5) == 1 ) then
                    call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【小提示】|r装备到了+4以后推荐使用祝福/强化/诅咒石去升级.")
                else
                    if ( GetRandomInt(1, 4) == 1 ) then
                        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【小提示】|r|cffff00ff琉璃璞玉|r可以将宝石成功率提升至100%,可以通过42转或者永久赞助(详情按F9)获取.")
                    endif
                endif
                call RemoveItem(GetSpellTargetItem())
                call UnitAddItemByIdSwapped(oldItemID, GetTriggerUnit())
                call PlaySoundBJ(gg_snd_f_baoshi)
            endif
            return true
        endif
        return false
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___DiamondC takes integer itemID,integer newItemID,integer oldItemID,integer poss returns boolean
        //琉璃璞玉
        if ( HasLiuli(GetTriggerUnit()) == true ) then
            return Diamond___Diamond100(itemID , newItemID)
        endif
        //非琉璃璞玉
        if ( GetItemTypeId(GetSpellTargetItem()) == itemID ) then
            if ( ( GetRandomInt(1, 100) <= poss ) ) then
                call RemoveItem(GetSpellTargetItem())
                call DisplayTextToForce(GetPlayersAll(), ( "|cFFFF66CC【消息】|r" + ( GetUnitName(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]) + "以" + I2S(poss) + "%的成功率成功地升级了" + GetItemName(GetSpellTargetItem()) + "！" ) ))
                call UnitAddItemByIdSwapped(newItemID, GetTriggerUnit())
                call PlaySoundBJ(gg_snd_Chenggong)
            else
                call RemoveItem(GetSpellTargetItem())
                call DisplayTextToForce(GetPlayersAll(), ( "|cFFFF66CC【消息】|r" + ( GetUnitName(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]) + "以" + I2S(poss) + "%的成功率升级" + GetItemName(GetSpellTargetItem()) + "失败,等级降低2级！" ) ))
                if ( GetRandomInt(1, 5) == 1 ) then
                    call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【小提示】|r装备到了+4以后推荐使用祝福/强化/诅咒石去升级.")
                else
                    if ( GetRandomInt(1, 4) == 1 ) then
                        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【小提示】|r|cffff00ff琉璃璞玉|r可以将宝石成功率提升至100%,可以通过42转或者永久赞助(详情按F9)获取.")
                    endif
                endif
                call UnitAddItemByIdSwapped(oldItemID, GetTriggerUnit())
                call PlaySoundBJ(gg_snd_f_baoshi)
            endif
            return true
        endif
        return false
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___AddOneDiamond takes nothing returns nothing
                //复制出来的不能升级
        if ( IsItemPawnable(GetSpellTargetItem()) == false ) then
            call UnitAddItemByIdSwapped('I02N', GetTriggerUnit())
            call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
            return
        endif
        if ( Diamond___Diamond100('I04Z' , 'nflg') == true ) then
            return
        endif
        if ( Diamond___Diamond100('I056' , 'spre') == true ) then
            return
        endif
        if ( Diamond___Diamond100('I057' , 'fwss') == true ) then
            return
        endif
        if ( Diamond___Diamond100('I050' , 'uflg') == true ) then
            return
        endif
        if ( Diamond___Diamond100('I055' , 'tgxp') == true ) then
            return
        endif
        if ( Diamond___Diamond100('I03Y' , 'dust') == true ) then
            return
        endif
        if ( Diamond___Diamond100('rej4' , 'drph') == true ) then
            return
        endif
        if ( Diamond___Diamond100('rej6' , 'dtsb') == true ) then
            return
        endif
        if ( Diamond___Diamond100('pgin' , 'gobm') == true ) then
            return
        endif
        call UnitAddItemByIdSwapped('I02N', GetTriggerUnit())
        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
        return
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___AddSecondDiamond takes nothing returns nothing
        if ( IsItemPawnable(GetSpellTargetItem()) == false ) then
            call UnitAddItemByIdSwapped('I04S', GetTriggerUnit())
            call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
            return
        endif
        if ( Diamond___DiamondA('nflg' , 'esaz' , 90) == true ) then
            return
        endif
        if ( Diamond___DiamondA('spre' , 'asbl' , 90) == true ) then
            return
        endif
        if ( Diamond___DiamondA('fwss' , 'ram4' , 90) == true ) then
            return
        endif
        if ( Diamond___DiamondA('uflg' , 'ram3' , 90) == true ) then
            return
        endif
        if ( Diamond___DiamondA('tgxp' , 'ram2' , 90) == true ) then
            return
        endif
        if ( Diamond___DiamondA('dust' , 'ram1' , 90) == true ) then
            return
        endif
        if ( Diamond___DiamondA('drph' , 'oven' , 90) == true ) then
            return
        endif
        if ( Diamond___DiamondA('dtsb' , 'tels' , 90) == true ) then
            return
        endif
        if ( Diamond___DiamondA('gobm' , 'gvsm' , 90) == true ) then
            return
        endif
        call UnitAddItemByIdSwapped('I04S', GetTriggerUnit())
        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
        return
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___AddThirdDiamond takes nothing returns nothing
        if ( IsItemPawnable(GetSpellTargetItem()) == false ) then
            call UnitAddItemByIdSwapped('azhr', GetTriggerUnit())
            call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
            return
        endif
        if ( Diamond___DiamondA('esaz' , 'sksh' , 80) == true ) then
            return
        endif
        if ( Diamond___DiamondA('asbl' , 'ocor' , 80) == true ) then
            return
        endif
        if ( Diamond___DiamondA('ram4' , 'rat3' , 80) == true ) then
            return
        endif
        if ( Diamond___DiamondA('ram3' , 'stre' , 80) == true ) then
            return
        endif
        if ( Diamond___DiamondA('ram2' , 'lure' , 80) == true ) then
            return
        endif
        if ( Diamond___DiamondA('ram1' , 'rots' , 80) == true ) then
            return
        endif
        if ( Diamond___DiamondA('oven' , 'frhg' , 80) == true ) then
            return
        endif
        if ( Diamond___DiamondA('tels' , 'ofir' , 80) == true ) then
            return
        endif
        if ( Diamond___DiamondA('gvsm' , 'gldo' , 80) == true ) then
            return
        endif
        call UnitAddItemByIdSwapped('azhr', GetTriggerUnit())
        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
        return
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___AddFourthDiamond takes nothing returns nothing
        if ( IsItemPawnable(GetSpellTargetItem()) == false ) then
            call UnitAddItemByIdSwapped('gmfr', GetTriggerUnit())
            call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
            return
        endif
        if not ( HasLiuli(GetTriggerUnit()) ) then
            if not ( Diamond___BLuoshang1[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] ) then
                set Diamond___BLuoshang1[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]=true
                call ShowGameHint(GetOwningPlayer(GetTriggerUnit()) , "\n                    小提示\n                    3级以上的装备不建议使用未经强化的宝石祼升.\n                    因为未经强化的宝石失败率较高,且失败会降级.\n                    |cff6699ff祝福石能令装备失败不会降级.\n                    强化石能有效提高升级成功率.\n                    诅咒石更能提高成功率.|r\n                    以上3种宝石能与普通的宝石融合在一起.\n                    以上3种宝石均在宝石专区刷怪获取.\n    ")
            endif
        endif
        if ( Diamond___DiamondB('sksh' , 'oslo' , 'esaz' , 70) == true ) then
            return
        endif
        if ( Diamond___DiamondB('ocor' , 'blba' , 'asbl' , 70) == true ) then
            return
        endif
        if ( Diamond___DiamondB('rat3' , 'pams' , 'ram4' , 70) == true ) then
            return
        endif
        if ( Diamond___DiamondB('stre' , 'shrs' , 'ram3' , 70) == true ) then
            return
        endif
        if ( Diamond___DiamondB('lure' , 'thdm' , 'ram2' , 70) == true ) then
            return
        endif
        if ( Diamond___DiamondB('rots' , 'tmmt' , 'ram1' , 70) == true ) then
            return
        endif
        if ( Diamond___DiamondB('frhg' , 'mlst' , 'oven' , 70) == true ) then
            return
        endif
        if ( Diamond___DiamondB('ofir' , 'soul' , 'tels' , 70) == true ) then
            return
        endif
        if ( Diamond___DiamondB('gldo' , 'gsou' , 'gvsm' , 70) == true ) then
            return
        endif
        call UnitAddItemByIdSwapped('gmfr', GetTriggerUnit())
        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
        return
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___AddFourthStrDiamond takes nothing returns nothing
        if ( IsItemPawnable(GetSpellTargetItem()) == false ) then
            call UnitAddItemByIdSwapped('wolg', GetTriggerUnit())
            call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
            return
        endif
        if ( Diamond___DiamondB('sksh' , 'oslo' , 'esaz' , 90) == true ) then
            return
        endif
        if ( Diamond___DiamondB('ocor' , 'blba' , 'asbl' , 90) == true ) then
            return
        endif
        if ( Diamond___DiamondB('rat3' , 'pams' , 'ram4' , 90) == true ) then
            return
        endif
        if ( Diamond___DiamondB('stre' , 'shrs' , 'ram3' , 90) == true ) then
            return
        endif
        if ( Diamond___DiamondB('lure' , 'thdm' , 'ram2' , 90) == true ) then
            return
        endif
        if ( Diamond___DiamondB('rots' , 'tmmt' , 'ram1' , 90) == true ) then
            return
        endif
        if ( Diamond___DiamondB('frhg' , 'mlst' , 'oven' , 90) == true ) then
            return
        endif
        if ( Diamond___DiamondB('ofir' , 'soul' , 'tels' , 90) == true ) then
            return
        endif
        if ( Diamond___DiamondB('gldo' , 'gsou' , 'gvsm' , 90) == true ) then
            return
        endif
        call UnitAddItemByIdSwapped('wolg', GetTriggerUnit())
        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
        return
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___AddFourthBlessDiamond takes nothing returns nothing
        if ( IsItemPawnable(GetSpellTargetItem()) == false ) then
            call UnitAddItemByIdSwapped('skrt', GetTriggerUnit())
            call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
            return
        endif
        if ( Diamond___DiamondA('sksh' , 'oslo' , 60) == true ) then
            return
        endif
        if ( Diamond___DiamondA('ocor' , 'blba' , 60) == true ) then
            return
        endif
        if ( Diamond___DiamondA('rat3' , 'pams' , 60) == true ) then
            return
        endif
        if ( Diamond___DiamondA('stre' , 'shrs' , 60) == true ) then
            return
        endif
        if ( Diamond___DiamondA('lure' , 'thdm' , 60) == true ) then
            return
        endif
        if ( Diamond___DiamondA('rots' , 'tmmt' , 60) == true ) then
            return
        endif
        if ( Diamond___DiamondA('frhg' , 'mlst' , 60) == true ) then
            return
        endif
        if ( Diamond___DiamondA('ofir' , 'soul' , 60) == true ) then
            return
        endif
        if ( Diamond___DiamondA('gldo' , 'gsou' , 60) == true ) then
            return
        endif
        call UnitAddItemByIdSwapped('skrt', GetTriggerUnit())
        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
        return
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___AddFifthDiamond takes nothing returns nothing
        if ( IsItemPawnable(GetSpellTargetItem()) == false ) then
            call UnitAddItemByIdSwapped('jpnt', GetTriggerUnit())
            call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
            return
        endif
        if not ( HasLiuli(GetTriggerUnit()) ) then
            if not ( Diamond___BLuoshang1[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] ) then
                set Diamond___BLuoshang1[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]=true
                call ShowGameHint(GetOwningPlayer(GetTriggerUnit()) , "\n                    小提示\n                    3级以上的装备不建议使用未经强化的宝石祼升.\n                    因为未经强化的宝石失败率较高,且失败会降级.\n                    |cff6699ff祝福石能令装备失败不会降级.\n                    强化石能有效提高升级成功率.\n                    诅咒石更能提高成功率.|r\n                    以上3种宝石能与普通的宝石融合在一起.\n                    以上3种宝石均在宝石专区刷怪获取.\n    ")
            endif
        endif
        if ( Diamond___DiamondB('oslo' , 'grsl' , 'sksh' , 60) == true ) then
            return
        endif
        if ( Diamond___DiamondB('blba' , 'cosl' , 'ocor' , 60) == true ) then
            return
        endif
        if ( Diamond___DiamondB('pams' , 'jdrn' , 'rat3' , 60) == true ) then
            return
        endif
        if ( Diamond___DiamondB('shrs' , 'kgal' , 'stre' , 60) == true ) then
            return
        endif
        if ( Diamond___DiamondB('thdm' , 'arsh' , 'lure' , 60) == true ) then
            return
        endif
        if ( Diamond___DiamondB('tmmt' , 'brag' , 'rots' , 60) == true ) then
            return
        endif
        if ( Diamond___DiamondB('mlst' , 'nspi' , 'frhg' , 60) == true ) then
            return
        endif
        if ( Diamond___DiamondB('soul' , 'sbok' , 'ofir' , 60) == true ) then
            return
        endif
        if ( Diamond___DiamondB('gsou' , 'envl' , 'gldo' , 60) == true ) then
            return
        endif
        call UnitAddItemByIdSwapped('jpnt', GetTriggerUnit())
        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
        return
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___AddFifthStrDiamond takes nothing returns nothing
        if ( IsItemPawnable(GetSpellTargetItem()) == false ) then
            call UnitAddItemByIdSwapped('ledg', GetTriggerUnit())
            call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
            return
        endif
        if ( Diamond___DiamondB('oslo' , 'grsl' , 'sksh' , 80) == true ) then
            return
        endif
        if ( Diamond___DiamondB('blba' , 'cosl' , 'ocor' , 80) == true ) then
            return
        endif
        if ( Diamond___DiamondB('pams' , 'jdrn' , 'rat3' , 80) == true ) then
            return
        endif
        if ( Diamond___DiamondB('shrs' , 'kgal' , 'stre' , 80) == true ) then
            return
        endif
        if ( Diamond___DiamondB('thdm' , 'arsh' , 'lure' , 80) == true ) then
            return
        endif
        if ( Diamond___DiamondB('tmmt' , 'brag' , 'rots' , 80) == true ) then
            return
        endif
        if ( Diamond___DiamondB('mlst' , 'nspi' , 'frhg' , 80) == true ) then
            return
        endif
        if ( Diamond___DiamondB('soul' , 'sbok' , 'ofir' , 80) == true ) then
            return
        endif
        if ( Diamond___DiamondB('gsou' , 'envl' , 'gldo' , 80) == true ) then
            return
        endif
        call UnitAddItemByIdSwapped('ledg', GetTriggerUnit())
        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
        return
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___AddFifthBlessDiamond takes nothing returns nothing
        if ( IsItemPawnable(GetSpellTargetItem()) == false ) then
            call UnitAddItemByIdSwapped('wtlg', GetTriggerUnit())
            call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
            return
        endif
        if ( Diamond___DiamondA('oslo' , 'grsl' , 50) == true ) then
            return
        endif
        if ( Diamond___DiamondA('blba' , 'cosl' , 50) == true ) then
            return
        endif
        if ( Diamond___DiamondA('pams' , 'jdrn' , 50) == true ) then
            return
        endif
        if ( Diamond___DiamondA('shrs' , 'kgal' , 50) == true ) then
            return
        endif
        if ( Diamond___DiamondA('thdm' , 'arsh' , 50) == true ) then
            return
        endif
        if ( Diamond___DiamondA('tmmt' , 'brag' , 50) == true ) then
            return
        endif
        if ( Diamond___DiamondA('mlst' , 'nspi' , 50) == true ) then
            return
        endif
        if ( Diamond___DiamondA('soul' , 'sbok' , 50) == true ) then
            return
        endif
        if ( Diamond___DiamondA('gsou' , 'envl' , 50) == true ) then
            return
        endif
        call UnitAddItemByIdSwapped('wtlg', GetTriggerUnit())
        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
        return
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___AddFifthCurseDiamond takes nothing returns nothing
        if ( IsItemPawnable(GetSpellTargetItem()) == false ) then
            call UnitAddItemByIdSwapped('gopr', GetTriggerUnit())
            call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
            return
        endif
        if ( Diamond___DiamondC('oslo' , 'grsl' , 'esaz' , 90) == true ) then
            return
        endif
        if ( Diamond___DiamondC('blba' , 'cosl' , 'asbl' , 90) == true ) then
            return
        endif
        if ( Diamond___DiamondC('pams' , 'jdrn' , 'ram4' , 90) == true ) then
            return
        endif
        if ( Diamond___DiamondC('shrs' , 'kgal' , 'ram3' , 90) == true ) then
            return
        endif
        if ( Diamond___DiamondC('thdm' , 'arsh' , 'ram2' , 90) == true ) then
            return
        endif
        if ( Diamond___DiamondC('tmmt' , 'brag' , 'ram1' , 90) == true ) then
            return
        endif
        if ( Diamond___DiamondC('mlst' , 'nspi' , 'oven' , 90) == true ) then
            return
        endif
        if ( Diamond___DiamondC('soul' , 'sbok' , 'tels' , 90) == true ) then
            return
        endif
        if ( Diamond___DiamondC('gsou' , 'envl' , 'gvsm' , 90) == true ) then
            return
        endif
        call UnitAddItemByIdSwapped('gopr', GetTriggerUnit())
        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
        return
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___AddSixthDiamond takes nothing returns nothing
        if ( IsItemPawnable(GetSpellTargetItem()) == false ) then
            call UnitAddItemByIdSwapped('glsk', GetTriggerUnit())
            call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
            return
        endif
        if not ( HasLiuli(GetTriggerUnit()) ) then
            if not ( Diamond___BLuoshang1[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] ) then
                set Diamond___BLuoshang1[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]=true
                call ShowGameHint(GetOwningPlayer(GetTriggerUnit()) , "\n                    小提示\n                    3级以上的装备不建议使用未经强化的宝石祼升.\n                    因为未经强化的宝石失败率较高,且失败会降级.\n                    |cff6699ff祝福石能令装备失败不会降级.\n                    强化石能有效提高升级成功率.\n                    诅咒石更能提高成功率.|r\n                    以上3种宝石能与普通的宝石融合在一起.\n                    以上3种宝石均在宝石专区刷怪获取.\n    ")
            endif
        endif
        if ( Diamond___DiamondB('grsl' , 'flag' , 'oslo' , 50) == true ) then
            return
        endif
        if ( Diamond___DiamondB('cosl' , 'shhn' , 'blba' , 50) == true ) then
            return
        endif
        if ( Diamond___DiamondB('jdrn' , 'shcw' , 'pams' , 50) == true ) then
            return
        endif
        if ( Diamond___DiamondB('kgal' , 'shtm' , 'shrs' , 50) == true ) then
            return
        endif
        if ( Diamond___DiamondB('arsh' , 'srtl' , 'thdm' , 50) == true ) then
            return
        endif
        if ( Diamond___DiamondB('brag' , 'olig' , 'tmmt' , 50) == true ) then
            return
        endif
        if ( Diamond___DiamondB('nspi' , 'oli2' , 'mlst' , 50) == true ) then
            return
        endif
        if ( Diamond___DiamondB('sbok' , 'arsc' , 'soul' , 50) == true ) then
            return
        endif
        if ( Diamond___DiamondB('envl' , 'rugt' , 'gsou' , 50) == true ) then
            return
        endif
        call UnitAddItemByIdSwapped('glsk', GetTriggerUnit())
        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
        return
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___AddSixthStrDiamond takes nothing returns nothing
        if ( IsItemPawnable(GetSpellTargetItem()) == false ) then
            call UnitAddItemByIdSwapped('dthb', GetTriggerUnit())
            call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
            return
        endif
        if ( Diamond___DiamondB('grsl' , 'flag' , 'oslo' , 70) == true ) then
            return
        endif
        if ( Diamond___DiamondB('cosl' , 'shhn' , 'blba' , 70) == true ) then
            return
        endif
        if ( Diamond___DiamondB('jdrn' , 'shcw' , 'pams' , 70) == true ) then
            return
        endif
        if ( Diamond___DiamondB('kgal' , 'shtm' , 'shrs' , 70) == true ) then
            return
        endif
        if ( Diamond___DiamondB('arsh' , 'srtl' , 'thdm' , 70) == true ) then
            return
        endif
        if ( Diamond___DiamondB('brag' , 'olig' , 'tmmt' , 70) == true ) then
            return
        endif
        if ( Diamond___DiamondB('nspi' , 'oli2' , 'mlst' , 70) == true ) then
            return
        endif
        if ( Diamond___DiamondB('sbok' , 'arsc' , 'soul' , 70) == true ) then
            return
        endif
        if ( Diamond___DiamondB('envl' , 'rugt' , 'gsou' , 70) == true ) then
            return
        endif
        call UnitAddItemByIdSwapped('dthb', GetTriggerUnit())
        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
        return
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___AddSixthBlessDiamond takes nothing returns nothing
        if ( IsItemPawnable(GetSpellTargetItem()) == false ) then
            call UnitAddItemByIdSwapped('bzbe', GetTriggerUnit())
            call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
            return
        endif
        if ( Diamond___DiamondA('grsl' , 'flag' , 40) == true ) then
            return
        endif
        if ( Diamond___DiamondA('cosl' , 'shhn' , 40) == true ) then
            return
        endif
        if ( Diamond___DiamondA('jdrn' , 'shcw' , 40) == true ) then
            return
        endif
        if ( Diamond___DiamondA('kgal' , 'shtm' , 40) == true ) then
            return
        endif
        if ( Diamond___DiamondA('arsh' , 'srtl' , 40) == true ) then
            return
        endif
        if ( Diamond___DiamondA('brag' , 'olig' , 40) == true ) then
            return
        endif
        if ( Diamond___DiamondA('nspi' , 'oli2' , 40) == true ) then
            return
        endif
        if ( Diamond___DiamondA('sbok' , 'arsc' , 40) == true ) then
            return
        endif
        if ( Diamond___DiamondA('envl' , 'rugt' , 40) == true ) then
            return
        endif
        call UnitAddItemByIdSwapped('bzbe', GetTriggerUnit())
        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
        return
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___AddSixthCurseDiamond takes nothing returns nothing
        if ( IsItemPawnable(GetSpellTargetItem()) == false ) then
            call UnitAddItemByIdSwapped('dphe', GetTriggerUnit())
            call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
            return
        endif
        if ( Diamond___DiamondC('grsl' , 'flag' , 'sksh' , 80) == true ) then
            return
        endif
        if ( Diamond___DiamondC('cosl' , 'shhn' , 'ocor' , 80) == true ) then
            return
        endif
        if ( Diamond___DiamondC('jdrn' , 'shcw' , 'rat3' , 80) == true ) then
            return
        endif
        if ( Diamond___DiamondC('kgal' , 'shtm' , 'stre' , 80) == true ) then
            return
        endif
        if ( Diamond___DiamondC('arsh' , 'srtl' , 'lure' , 80) == true ) then
            return
        endif
        if ( Diamond___DiamondC('brag' , 'olig' , 'rots' , 80) == true ) then
            return
        endif
        if ( Diamond___DiamondC('nspi' , 'oli2' , 'frhg' , 80) == true ) then
            return
        endif
        if ( Diamond___DiamondC('sbok' , 'arsc' , 'ofir' , 80) == true ) then
            return
        endif
        if ( Diamond___DiamondC('envl' , 'rugt' , 'gldo' , 80) == true ) then
            return
        endif
        call UnitAddItemByIdSwapped('dphe', GetTriggerUnit())
        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
        return
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___AddSeventhDiamond takes nothing returns nothing
        if ( IsItemPawnable(GetSpellTargetItem()) == false ) then
            call UnitAddItemByIdSwapped('kygh', GetTriggerUnit())
            call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
            return
        endif
        if not ( HasLiuli(GetTriggerUnit()) ) then
            if not ( Diamond___BLuoshang1[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] ) then
                set Diamond___BLuoshang1[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]=true
                call ShowGameHint(GetOwningPlayer(GetTriggerUnit()) , "\n                    小提示\n                    3级以上的装备不建议使用未经强化的宝石祼升.\n                    因为未经强化的宝石失败率较高,且失败会降级.\n                    |cff6699ff祝福石能令装备失败不会降级.\n                    强化石能有效提高升级成功率.\n                    诅咒石更能提高成功率.|r\n                    以上3种宝石能与普通的宝石融合在一起.\n                    以上3种宝石均在宝石专区刷怪获取.\n    ")
            endif
        endif
        if ( Diamond___DiamondB('oli2' , 'rump' , 'nspi' , 40) == true ) then
            return
        endif
        if ( Diamond___DiamondB('arsc' , 'rde0' , 'sbok' , 40) == true ) then
            return
        endif
        if ( Diamond___DiamondB('rugt' , 'shdt' , 'envl' , 40) == true ) then
            return
        endif
        call UnitAddItemByIdSwapped('kygh', GetTriggerUnit())
        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
        return
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___AddSeventhStrDiamond takes nothing returns nothing
        if ( IsItemPawnable(GetSpellTargetItem()) == false ) then
            call UnitAddItemByIdSwapped('mort', GetTriggerUnit())
            call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
            return
        endif
        if not ( HasLiuli(GetTriggerUnit()) ) then
            if not ( Diamond___BLuoshang2[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] ) then
                set Diamond___BLuoshang2[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]=true
                call ShowGameHint(GetOwningPlayer(GetTriggerUnit()) , "\n                小提示\n                7级以上的装备几率可能会较低.\n                你还可以通过下面2种方式提高成功率:\n                1.通过42次转生获取|cffff00ff【虚】琉璃璞玉|r\n                (100%的升级成功率,当局无限次使用)\n                2.使用杀敌数在基地左边购买|cffff0000血精石|r.\n                (100%的升级成功率,消耗品)\n    ")
            endif
        endif
        if ( Diamond___DiamondB('oli2' , 'rump' , 'nspi' , 60) == true ) then
            return
        endif
        if ( Diamond___DiamondB('arsc' , 'rde0' , 'sbok' , 60) == true ) then
            return
        endif
        if ( Diamond___DiamondB('rugt' , 'shdt' , 'envl' , 60) == true ) then
            return
        endif
        call UnitAddItemByIdSwapped('mort', GetTriggerUnit())
        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
        return
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___AddSeventhBlessDiamond takes nothing returns nothing
        if ( IsItemPawnable(GetSpellTargetItem()) == false ) then
            call UnitAddItemByIdSwapped('ches', GetTriggerUnit())
            call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
            return
        endif
        if not ( HasLiuli(GetTriggerUnit()) ) then
            if not ( Diamond___BLuoshang2[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] ) then
                set Diamond___BLuoshang2[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]=true
                call ShowGameHint(GetOwningPlayer(GetTriggerUnit()) , "\n                小提示\n                7级以上的装备几率可能会较低.\n                你还可以通过下面2种方式提高成功率:\n                1.通过42次转生获取|cffff00ff【虚】琉璃璞玉|r\n                (100%的升级成功率,当局无限次使用)\n                2.使用杀敌数在基地左边购买|cffff0000血精石|r.\n                (100%的升级成功率,消耗品)\n    ")
            endif
        endif
        if ( Diamond___DiamondA('oli2' , 'rump' , 30) == true ) then
            return
        endif
        if ( Diamond___DiamondA('arsc' , 'rde0' , 30) == true ) then
            return
        endif
        if ( Diamond___DiamondA('rugt' , 'shdt' , 30) == true ) then
            return
        endif
        call UnitAddItemByIdSwapped('ches', GetTriggerUnit())
        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
        return
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___AddSeventhCurseDiamond takes nothing returns nothing
        if ( IsItemPawnable(GetSpellTargetItem()) == false ) then
            call UnitAddItemByIdSwapped('cnhn', GetTriggerUnit())
            call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
            return
        endif
        if not ( HasLiuli(GetTriggerUnit()) ) then
            if not ( Diamond___BLuoshang2[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] ) then
                set Diamond___BLuoshang2[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]=true
                call ShowGameHint(GetOwningPlayer(GetTriggerUnit()) , "\n                小提示\n                7级以上的装备几率可能会较低.\n                你还可以通过下面2种方式提高成功率:\n                1.通过42次转生获取|cffff00ff【虚】琉璃璞玉|r\n                (100%的升级成功率,当局无限次使用)\n                2.使用杀敌数在基地左边购买|cffff0000血精石|r.\n                (100%的升级成功率,消耗品)\n    ")
            endif
        endif
        if ( Diamond___DiamondC('oli2' , 'rump' , 'mlst' , 70) == true ) then
            return
        endif
        if ( Diamond___DiamondC('arsc' , 'rde0' , 'soul' , 70) == true ) then
            return
        endif
        if ( Diamond___DiamondC('rugt' , 'shdt' , 'gsou' , 70) == true ) then
            return
        endif
        call UnitAddItemByIdSwapped('cnhn', GetTriggerUnit())
        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
        return
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___AddEighthDiamond takes nothing returns nothing
        if ( IsItemPawnable(GetSpellTargetItem()) == false ) then
            call UnitAddItemByIdSwapped('sehr', GetTriggerUnit())
            call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
            return
        endif
        if not ( HasLiuli(GetTriggerUnit()) ) then
            if not ( Diamond___BLuoshang1[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] ) then
                set Diamond___BLuoshang1[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]=true
                call ShowGameHint(GetOwningPlayer(GetTriggerUnit()) , "\n                    小提示\n                    3级以上的装备不建议使用未经强化的宝石祼升.\n                    因为未经强化的宝石失败率较高,且失败会降级.\n                    |cff6699ff祝福石能令装备失败不会降级.\n                    强化石能有效提高升级成功率.\n                    诅咒石更能提高成功率.|r\n                    以上3种宝石能与普通的宝石融合在一起.\n                    以上3种宝石均在宝石专区刷怪获取.\n    ")
            endif
        endif
        if ( Diamond___DiamondB('rump' , 'shen' , 'oli2' , 40) == true ) then
            return
        endif
        if ( Diamond___DiamondB('rde0' , 'oflg' , 'arsc' , 40) == true ) then
            return
        endif
        if ( Diamond___DiamondB('shdt' , 'crdt' , 'rugt' , 40) == true ) then
            return
        endif
        call UnitAddItemByIdSwapped('sehr', GetTriggerUnit())
        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
        return
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___AddEighthStrDiamond takes nothing returns nothing
        if ( IsItemPawnable(GetSpellTargetItem()) == false ) then
            call UnitAddItemByIdSwapped('k3m3', GetTriggerUnit())
            call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
            return
        endif
        if not ( HasLiuli(GetTriggerUnit()) ) then
            if not ( Diamond___BLuoshang2[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] ) then
                set Diamond___BLuoshang2[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]=true
                call ShowGameHint(GetOwningPlayer(GetTriggerUnit()) , "\n                小提示\n                7级以上的装备几率可能会较低.\n                你还可以通过下面2种方式提高成功率:\n                1.通过42次转生获取|cffff00ff【虚】琉璃璞玉|r\n                (100%的升级成功率,当局无限次使用)\n                2.使用杀敌数在基地左边购买|cffff0000血精石|r.\n                (100%的升级成功率,消耗品)\n    ")
            endif
        endif
        if ( Diamond___DiamondB('rump' , 'shen' , 'oli2' , 60) == true ) then
            return
        endif
        if ( Diamond___DiamondB('rde0' , 'oflg' , 'arsc' , 60) == true ) then
            return
        endif
        if ( Diamond___DiamondB('shdt' , 'crdt' , 'rugt' , 60) == true ) then
            return
        endif
        call UnitAddItemByIdSwapped('k3m3', GetTriggerUnit())
        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
        return
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___AddEighthBlessDiamond takes nothing returns nothing
        if ( IsItemPawnable(GetSpellTargetItem()) == false ) then
            call UnitAddItemByIdSwapped('k3m2', GetTriggerUnit())
            call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
            return
        endif
        if not ( HasLiuli(GetTriggerUnit()) ) then
            if not ( Diamond___BLuoshang2[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] ) then
                set Diamond___BLuoshang2[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]=true
                call ShowGameHint(GetOwningPlayer(GetTriggerUnit()) , "\n                小提示\n                7级以上的装备几率可能会较低.\n                你还可以通过下面2种方式提高成功率:\n                1.通过42次转生获取|cffff00ff【虚】琉璃璞玉|r\n                (100%的升级成功率,当局无限次使用)\n                2.使用杀敌数在基地左边购买|cffff0000血精石|r.\n                (100%的升级成功率,消耗品)\n    ")
            endif
        endif
        if ( Diamond___DiamondA('rump' , 'shen' , 30) == true ) then
            return
        endif
        if ( Diamond___DiamondA('rde0' , 'oflg' , 30) == true ) then
            return
        endif
        if ( Diamond___DiamondA('shdt' , 'crdt' , 30) == true ) then
            return
        endif
        call UnitAddItemByIdSwapped('k3m2', GetTriggerUnit())
        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
        return
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___AddEighthCurseDiamond takes nothing returns nothing
        if ( IsItemPawnable(GetSpellTargetItem()) == false ) then
            call UnitAddItemByIdSwapped('kybl', GetTriggerUnit())
            call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
            return
        endif
        if not ( HasLiuli(GetTriggerUnit()) ) then
            if not ( Diamond___BLuoshang2[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] ) then
                set Diamond___BLuoshang2[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]=true
                call ShowGameHint(GetOwningPlayer(GetTriggerUnit()) , "\n                小提示\n                7级以上的装备几率可能会较低.\n                你还可以通过下面2种方式提高成功率:\n                1.通过42次转生获取|cffff00ff【虚】琉璃璞玉|r\n                (100%的升级成功率,当局无限次使用)\n                2.使用杀敌数在基地左边购买|cffff0000血精石|r.\n                (100%的升级成功率,消耗品)\n    ")
            endif
        endif
        if ( Diamond___DiamondC('rump' , 'shen' , 'nspi' , 70) == true ) then
            return
        endif
        if ( Diamond___DiamondC('rde0' , 'oflg' , 'sbok' , 70) == true ) then
            return
        endif
        if ( Diamond___DiamondC('shdt' , 'crdt' , 'envl' , 70) == true ) then
            return
        endif
        call UnitAddItemByIdSwapped('kybl', GetTriggerUnit())
        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
        return
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___AddNinthDiamond takes nothing returns nothing
        if ( IsItemPawnable(GetSpellTargetItem()) == false ) then
            call UnitAddItemByIdSwapped('bzbf', GetTriggerUnit())
            call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
            return
        endif
        if not ( HasLiuli(GetTriggerUnit()) ) then
            if not ( Diamond___BLuoshang1[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] ) then
                set Diamond___BLuoshang1[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]=true
                call ShowGameHint(GetOwningPlayer(GetTriggerUnit()) , "\n                    小提示\n                    3级以上的装备不建议使用未经强化的宝石祼升.\n                    因为未经强化的宝石失败率较高,且失败会降级.\n                    |cff6699ff祝福石能令装备失败不会降级.\n                    强化石能有效提高升级成功率.\n                    诅咒石更能提高成功率.|r\n                    以上3种宝石能与普通的宝石融合在一起.\n                    以上3种宝石均在宝石专区刷怪获取.\n    ")
            endif
        endif
        if ( Diamond___DiamondB('shen' , 'stpg' , 'rump' , 40) == true ) then
            return
        endif
        if ( Diamond___DiamondB('oflg' , 'frgd' , 'rde0' , 40) == true ) then
            return
        endif
        if ( Diamond___DiamondB('crdt' , 'pspd' , 'shdt' , 40) == true ) then
            return
        endif
        call UnitAddItemByIdSwapped('bzbf', GetTriggerUnit())
        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
        return
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___AddNinthStrDiamond takes nothing returns nothing
        if ( IsItemPawnable(GetSpellTargetItem()) == false ) then
            call UnitAddItemByIdSwapped('kysn', GetTriggerUnit())
            call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
            return
        endif
        if not ( HasLiuli(GetTriggerUnit()) ) then
            if not ( Diamond___BLuoshang2[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] ) then
                set Diamond___BLuoshang2[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]=true
                call ShowGameHint(GetOwningPlayer(GetTriggerUnit()) , "\n                小提示\n                7级以上的装备几率可能会较低.\n                你还可以通过下面2种方式提高成功率:\n                1.通过42次转生获取|cffff00ff【虚】琉璃璞玉|r\n                (100%的升级成功率,当局无限次使用)\n                2.使用杀敌数在基地左边购买|cffff0000血精石|r.\n                (100%的升级成功率,消耗品)\n    ")
            endif
        endif
        if ( Diamond___DiamondB('shen' , 'stpg' , 'rump' , 60) == true ) then
            return
        endif
        if ( Diamond___DiamondB('oflg' , 'frgd' , 'rde0' , 60) == true ) then
            return
        endif
        if ( Diamond___DiamondB('crdt' , 'pspd' , 'shdt' , 60) == true ) then
            return
        endif
        call UnitAddItemByIdSwapped('kysn', GetTriggerUnit())
        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
        return
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___AddNinthBlessDiamond takes nothing returns nothing
        if ( IsItemPawnable(GetSpellTargetItem()) == false ) then
            call UnitAddItemByIdSwapped('ktrm', GetTriggerUnit())
            call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
            return
        endif
        if not ( HasLiuli(GetTriggerUnit()) ) then
            if not ( Diamond___BLuoshang2[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] ) then
                set Diamond___BLuoshang2[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]=true
                call ShowGameHint(GetOwningPlayer(GetTriggerUnit()) , "\n                小提示\n                7级以上的装备几率可能会较低.\n                你还可以通过下面2种方式提高成功率:\n                1.通过42次转生获取|cffff00ff【虚】琉璃璞玉|r\n                (100%的升级成功率,当局无限次使用)\n                2.使用杀敌数在基地左边购买|cffff0000血精石|r.\n                (100%的升级成功率,消耗品)\n    ")
            endif
        endif
        if ( Diamond___DiamondA('shen' , 'stpg' , 30) == true ) then
            return
        endif
        if ( Diamond___DiamondA('oflg' , 'frgd' , 30) == true ) then
            return
        endif
        if ( Diamond___DiamondA('crdt' , 'pspd' , 30) == true ) then
            return
        endif
        call UnitAddItemByIdSwapped('ktrm', GetTriggerUnit())
        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
        return
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___AddNinthCurseDiamond takes nothing returns nothing
        if ( IsItemPawnable(GetSpellTargetItem()) == false ) then
            call UnitAddItemByIdSwapped('shwd', GetTriggerUnit())
            call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
            return
        endif
        if not ( HasLiuli(GetTriggerUnit()) ) then
            if not ( Diamond___BLuoshang2[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] ) then
                set Diamond___BLuoshang2[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]=true
                call ShowGameHint(GetOwningPlayer(GetTriggerUnit()) , "\n                小提示\n                7级以上的装备几率可能会较低.\n                你还可以通过下面2种方式提高成功率:\n                1.通过42次转生获取|cffff00ff【虚】琉璃璞玉|r\n                (100%的升级成功率,当局无限次使用)\n                2.使用杀敌数在基地左边购买|cffff0000血精石|r.\n                (100%的升级成功率,消耗品)\n    ")
            endif
        endif
        if ( Diamond___DiamondC('shen' , 'stpg' , 'oli2' , 70) == true ) then
            return
        endif
        if ( Diamond___DiamondC('oflg' , 'frgd' , 'arsc' , 70) == true ) then
            return
        endif
        if ( Diamond___DiamondC('crdt' , 'pspd' , 'rugt' , 70) == true ) then
            return
        endif
        call UnitAddItemByIdSwapped('shwd', GetTriggerUnit())
        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
        return
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___XueJingDiamond takes nothing returns nothing
        if ( IsItemPawnable(GetSpellTargetItem()) == false ) then
            call UnitAddItemByIdSwapped('k3m1', GetTriggerUnit())
            call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
            return
        endif
        if ( Diamond___Diamond100('oli2' , 'rump') == true ) then
            return
        endif
        if ( Diamond___Diamond100('arsc' , 'rde0') == true ) then
            return
        endif
        if ( Diamond___Diamond100('rugt' , 'shdt') == true ) then
            return
        endif
        if ( Diamond___Diamond100('shen' , 'stpg') == true ) then
            return
        endif
        if ( Diamond___Diamond100('oflg' , 'frgd') == true ) then
            return
        endif
        if ( Diamond___Diamond100('crdt' , 'pspd') == true ) then
            return
        endif
        if ( Diamond___Diamond100('rump' , 'shen') == true ) then
            return
        endif
        if ( Diamond___Diamond100('rde0' , 'oflg') == true ) then
            return
        endif
        if ( Diamond___Diamond100('shdt' , 'crdt') == true ) then
            return
        endif
        call UnitAddItemByIdSwapped('k3m1', GetTriggerUnit())
        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
        return
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___Hundun2Diamond takes nothing returns nothing
        if ( IsItemPawnable(GetSpellTargetItem()) == false ) then
            call UnitAddItemByIdSwapped('I07R', GetTriggerUnit())
            call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
            return
        endif
        if ( Diamond___Diamond100('I04W' , 'I07E') == true ) then
            return
        endif
        if ( Diamond___Diamond100('ICS1' , 'I07F') == true ) then
            return
        endif
        if ( Diamond___Diamond100('I04Y' , 'I07G') == true ) then
            return
        endif
        if ( Diamond___Diamond100('I05T' , 'I07H') == true ) then
            return
        endif
        if ( Diamond___Diamond100('I060' , 'I07I') == true ) then
            return
        endif
        if ( Diamond___Diamond100('I05Z' , 'I07J') == true ) then
            return
        endif
        if ( Diamond___Diamond100('I05Y' , 'I07K') == true ) then
            return
        endif
        if ( Diamond___Diamond100('I04X' , 'I07O') == true ) then
            return
        endif
        if ( Diamond___Diamond100('IB0A' , 'I07N') == true ) then
            return
        endif
        if ( Diamond___Diamond100('I05X' , 'I07P') == true ) then
            return
        endif
        if ( Diamond___Diamond100('ICY1' , 'I07Q') == true ) then
            return
        endif
        if ( Diamond___Diamond100('I05W' , 'I07M') == true ) then
            return
        endif
        if ( Diamond___Diamond100('I05V' , 'I07L') == true ) then
            return
        endif
        if ( Diamond___Diamond100('ICX1' , 'I05U') == true ) then
            return
        endif
        call UnitAddItemByIdSwapped('I07R', GetTriggerUnit())
        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, DIAMOND_CANT_UPDATE)
        return
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___TSpellDiamondAct takes nothing returns nothing
        if ( GetSpellAbilityId() == 'A02Z' ) then
            call Diamond___AddOneDiamond()
        elseif ( GetSpellAbilityId() == 'Amnb' ) then
            call Diamond___AddSecondDiamond()
        elseif ( GetSpellAbilityId() == 'Ambb' ) then
            call Diamond___AddThirdDiamond()
        elseif ( ( GetSpellAbilityId() == 'ACfl' ) ) then
            call Diamond___AddFourthDiamond()
        elseif ( ( GetSpellAbilityId() == 'Aenw' ) ) then
            call Diamond___AddFourthStrDiamond()
        elseif ( ( GetSpellAbilityId() == 'Aenr' ) ) then
            call Diamond___AddFourthBlessDiamond()
        elseif ( ( GetSpellAbilityId() == 'ACcy' ) ) then
            call Diamond___AddFifthDiamond()
        elseif ( ( GetSpellAbilityId() == 'ACbn' ) ) then
            call Diamond___AddFifthStrDiamond()
        elseif ( ( GetSpellAbilityId() == 'SCc1' ) ) then
            call Diamond___AddFifthBlessDiamond()
        elseif ( ( GetSpellAbilityId() == 'ACfb' ) ) then
            call Diamond___AddFifthCurseDiamond()
        elseif ( ( GetSpellAbilityId() == 'ACls' ) ) then
            call Diamond___AddSixthDiamond()
        elseif ( ( GetSpellAbilityId() == 'ACbf' ) ) then
            call Diamond___AddSixthStrDiamond()
        elseif ( ( GetSpellAbilityId() == 'Afod' ) ) then
            call Diamond___AddSixthBlessDiamond()
        elseif ( ( GetSpellAbilityId() == 'ACdc' ) ) then
            call Diamond___AddSixthCurseDiamond()
        elseif ( ( GetSpellAbilityId() == 'A0DG' ) ) then
            call Diamond___AddSeventhDiamond()
        elseif ( ( GetSpellAbilityId() == 'A0DI' ) ) then
            call Diamond___AddSeventhStrDiamond()
        elseif ( ( GetSpellAbilityId() == 'A0DH' ) ) then
            call Diamond___AddSeventhBlessDiamond()
        elseif ( ( GetSpellAbilityId() == 'A0DN' ) ) then
            call Diamond___AddSeventhCurseDiamond()
        elseif ( ( GetSpellAbilityId() == 'A0DJ' ) ) then
            call Diamond___AddEighthDiamond()
        elseif ( ( GetSpellAbilityId() == 'A0DK' ) ) then
            call Diamond___AddEighthStrDiamond()
        elseif ( ( GetSpellAbilityId() == 'A0DL' ) ) then
            call Diamond___AddEighthBlessDiamond()
        elseif ( ( GetSpellAbilityId() == 'A0DM' ) ) then
            call Diamond___AddEighthCurseDiamond()
        elseif ( ( GetSpellAbilityId() == 'A0DO' ) ) then
            call Diamond___AddNinthDiamond()
        elseif ( ( GetSpellAbilityId() == 'A0DR' ) ) then
            call Diamond___AddNinthStrDiamond()
        elseif ( ( GetSpellAbilityId() == 'A0DQ' ) ) then
            call Diamond___AddNinthBlessDiamond()
        elseif ( ( GetSpellAbilityId() == 'A0DP' ) ) then
            call Diamond___AddNinthCurseDiamond()
        elseif ( ( GetSpellAbilityId() == 'A0EK' ) ) then
            call Diamond___XueJingDiamond()
        elseif ( ( GetSpellAbilityId() == 'A0N6' ) ) then
            call Diamond___Hundun2Diamond()
        endif
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function DiamondMonsterFilter takes nothing returns boolean
        return ( ( ( IsUnitAliveBJ(GetFilterUnit()) == true ) and ( GetOwningPlayer(GetFilterUnit()) == Player(10) ) ) )
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function DiamondPlayerFilter takes nothing returns boolean
        return ( ( IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) == true ) and ( GetPlayerController(GetOwningPlayer(GetFilterUnit())) == MAP_CONTROL_USER ) and ( IsUnitAliveBJ(GetFilterUnit()) or ( GetFilterUnit() == udg_H[GetConvertedPlayerId(GetOwningPlayer(GetFilterUnit()))] and not ( IsWanjie() ) ) ) )
    endfunction
    function DiamondPlayerFilterOther takes nothing returns boolean
        return ( ( IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) == true ) and ( GetPlayerController(GetOwningPlayer(GetFilterUnit())) == MAP_CONTROL_USER ) and ( IsUnitAliveBJ(GetFilterUnit()) or ( GetFilterUnit() == udg_H[GetConvertedPlayerId(GetOwningPlayer(GetFilterUnit()))] ) ) )
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___CreateDiamonMonster takes integer whichType,integer aLevel returns nothing
        local real x= 0
        local real y= 0
        local unit u
        if ( RectContainsUnit(gg_rct________8, GetSellingUnit()) ) then
            set x=GetRandomReal(GetRectMinX(gg_rct________8), GetRectMaxX(gg_rct________8))
            set y=GetRandomReal(GetRectMinY(gg_rct________8), GetRectMaxY(gg_rct________8))
        elseif ( RectContainsUnit(gg_rct_Diamond2, GetSellingUnit()) ) then
            set x=GetRandomReal(GetRectMinX(gg_rct_Diamond2), GetRectMaxX(gg_rct_Diamond2))
            set y=GetRandomReal(GetRectMinY(gg_rct_Diamond2), GetRectMaxY(gg_rct_Diamond2))
        else
            set x=GetRandomReal(GetRectMinX(gg_rct_Diamond3), GetRectMaxX(gg_rct_Diamond3))
            set y=GetRandomReal(GetRectMinY(gg_rct_Diamond3), GetRectMaxY(gg_rct_Diamond3))
        endif
        set u=CreateUnit(Player(10), whichType, x, y, GetRandomDirectionDeg())
        call EnhanceDiffAttack(u)
        call SetUnitAbilityLevel(u, 'AB01', GetWanjieAddInt(aLevel , 9))
        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\Blink\\BlinkTarget.mdl", x, y))
        set u=null
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function TBuyDiamondStartCon takes nothing returns boolean
        return ( BuyerFilter(GetBuyingUnit()) and ( GetUnitTypeId(GetSellingUnit()) == 'nmr5' or GetUnitTypeId(GetSellingUnit()) == 'nmre' or GetUnitTypeId(GetSellingUnit()) == 'n01D' or GetUnitTypeId(GetSellingUnit()) == 'n01C' ) )
    endfunction
    function TBuyDiamondStartAct takes nothing returns nothing
        local group group1
        local group group2
        local integer i= 1
        if ( RectContainsUnit(gg_rct________8, GetSellingUnit()) ) then
            set group1=YDWEGetUnitsInRectMatchingNull(gg_rct________8 , Condition(function DiamondMonsterFilter))
            set group2=YDWEGetUnitsInRectMatchingNull(gg_rct________8 , Condition(function DiamondPlayerFilter))
        elseif ( RectContainsUnit(gg_rct_Diamond2, GetSellingUnit()) ) then
            set group1=YDWEGetUnitsInRectMatchingNull(gg_rct_Diamond2 , Condition(function DiamondMonsterFilter))
            set group2=YDWEGetUnitsInRectMatchingNull(gg_rct_Diamond2 , Condition(function DiamondPlayerFilter))
        elseif ( RectContainsUnit(gg_rct_Diamond3, GetSellingUnit()) ) then
            set group1=YDWEGetUnitsInRectMatchingNull(gg_rct_Diamond3 , Condition(function DiamondMonsterFilter))
            set group2=YDWEGetUnitsInRectMatchingNull(gg_rct_Diamond3 , Condition(function DiamondPlayerFilter))
        endif
//textmacro instance: StartDiamondMonster("rre1","nnmg","1")
        if ( ( GetItemTypeId(GetSoldItem()) == 'rre1' ) ) then
            if ( ( CountUnitsInGroup(group1) == 0 ) ) then
                if ( ( CountUnitsInGroup(group2) != 0 ) ) then
                    if ( RectContainsUnit(gg_rct________8, GetSellingUnit()) ) then
                        set IAtleast1=21
                    elseif ( RectContainsUnit(gg_rct_Diamond2, GetSellingUnit()) ) then
                        set IAtleast2=21
                    elseif ( RectContainsUnit(gg_rct_Diamond3, GetSellingUnit()) ) then
                        set IAtleast3=21
                    endif
                     set BJiulun=true
                    call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r祝你好运!")
                    set i=1
                    loop
                        exitwhen i > 20
                        call Diamond___CreateDiamonMonster('nnmg' , 1)
                        set i=i + 1
                    endloop
                else
                    call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r没英雄不开刷!")
                endif
            else
                call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r清完这波东西再来买!")
            endif
        endif
//end of: StartDiamondMonster("rre1","nnmg","1")
//textmacro instance: StartDiamondMonster("rhe1","nmyr","2")
        if ( ( GetItemTypeId(GetSoldItem()) == 'rhe1' ) ) then
            if ( ( CountUnitsInGroup(group1) == 0 ) ) then
                if ( ( CountUnitsInGroup(group2) != 0 ) ) then
                    if ( RectContainsUnit(gg_rct________8, GetSellingUnit()) ) then
                        set IAtleast1=21
                    elseif ( RectContainsUnit(gg_rct_Diamond2, GetSellingUnit()) ) then
                        set IAtleast2=21
                    elseif ( RectContainsUnit(gg_rct_Diamond3, GetSellingUnit()) ) then
                        set IAtleast3=21
                    endif
                     set BJiulun=true
                    call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r祝你好运!")
                    set i=1
                    loop
                        exitwhen i > 20
                        call Diamond___CreateDiamonMonster('nmyr' , 2)
                        set i=i + 1
                    endloop
                else
                    call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r没英雄不开刷!")
                endif
            else
                call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r清完这波东西再来买!")
            endif
        endif
//end of: StartDiamondMonster("rhe1","nmyr","2")
//textmacro instance: StartDiamondMonster("guvi","nnsw","3")
        if ( ( GetItemTypeId(GetSoldItem()) == 'guvi' ) ) then
            if ( ( CountUnitsInGroup(group1) == 0 ) ) then
                if ( ( CountUnitsInGroup(group2) != 0 ) ) then
                    if ( RectContainsUnit(gg_rct________8, GetSellingUnit()) ) then
                        set IAtleast1=21
                    elseif ( RectContainsUnit(gg_rct_Diamond2, GetSellingUnit()) ) then
                        set IAtleast2=21
                    elseif ( RectContainsUnit(gg_rct_Diamond3, GetSellingUnit()) ) then
                        set IAtleast3=21
                    endif
                     set BJiulun=true
                    call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r祝你好运!")
                    set i=1
                    loop
                        exitwhen i > 20
                        call Diamond___CreateDiamonMonster('nnsw' , 3)
                        set i=i + 1
                    endloop
                else
                    call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r没英雄不开刷!")
                endif
            else
                call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r清完这波东西再来买!")
            endif
        endif
//end of: StartDiamondMonster("guvi","nnsw","3")
//textmacro instance: StartDiamondMonster("tpow","nsnp","4")
        if ( ( GetItemTypeId(GetSoldItem()) == 'tpow' ) ) then
            if ( ( CountUnitsInGroup(group1) == 0 ) ) then
                if ( ( CountUnitsInGroup(group2) != 0 ) ) then
                    if ( RectContainsUnit(gg_rct________8, GetSellingUnit()) ) then
                        set IAtleast1=21
                    elseif ( RectContainsUnit(gg_rct_Diamond2, GetSellingUnit()) ) then
                        set IAtleast2=21
                    elseif ( RectContainsUnit(gg_rct_Diamond3, GetSellingUnit()) ) then
                        set IAtleast3=21
                    endif
                     set BJiulun=true
                    call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r祝你好运!")
                    set i=1
                    loop
                        exitwhen i > 20
                        call Diamond___CreateDiamonMonster('nsnp' , 4)
                        set i=i + 1
                    endloop
                else
                    call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r没英雄不开刷!")
                endif
            else
                call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r清完这波东西再来买!")
            endif
        endif
//end of: StartDiamondMonster("tpow","nsnp","4")
//textmacro instance: StartDiamondMonster("rhe2","nhyc","5")
        if ( ( GetItemTypeId(GetSoldItem()) == 'rhe2' ) ) then
            if ( ( CountUnitsInGroup(group1) == 0 ) ) then
                if ( ( CountUnitsInGroup(group2) != 0 ) ) then
                    if ( RectContainsUnit(gg_rct________8, GetSellingUnit()) ) then
                        set IAtleast1=21
                    elseif ( RectContainsUnit(gg_rct_Diamond2, GetSellingUnit()) ) then
                        set IAtleast2=21
                    elseif ( RectContainsUnit(gg_rct_Diamond3, GetSellingUnit()) ) then
                        set IAtleast3=21
                    endif
                     set BJiulun=true
                    call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r祝你好运!")
                    set i=1
                    loop
                        exitwhen i > 20
                        call Diamond___CreateDiamonMonster('nhyc' , 5)
                        set i=i + 1
                    endloop
                else
                    call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r没英雄不开刷!")
                endif
            else
                call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r清完这波东西再来买!")
            endif
        endif
//end of: StartDiamondMonster("rhe2","nhyc","5")
//textmacro instance: StartDiamondMonster("tint","nnrg","6")
        if ( ( GetItemTypeId(GetSoldItem()) == 'tint' ) ) then
            if ( ( CountUnitsInGroup(group1) == 0 ) ) then
                if ( ( CountUnitsInGroup(group2) != 0 ) ) then
                    if ( RectContainsUnit(gg_rct________8, GetSellingUnit()) ) then
                        set IAtleast1=21
                    elseif ( RectContainsUnit(gg_rct_Diamond2, GetSellingUnit()) ) then
                        set IAtleast2=21
                    elseif ( RectContainsUnit(gg_rct_Diamond3, GetSellingUnit()) ) then
                        set IAtleast3=21
                    endif
                     set BJiulun=true
                    call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r祝你好运!")
                    set i=1
                    loop
                        exitwhen i > 20
                        call Diamond___CreateDiamonMonster('nnrg' , 6)
                        set i=i + 1
                    endloop
                else
                    call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r没英雄不开刷!")
                endif
            else
                call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r清完这波东西再来买!")
            endif
        endif
//end of: StartDiamondMonster("tint","nnrg","6")
//textmacro instance: StartDiamondMonster("modt","nplb","7")
        if ( ( GetItemTypeId(GetSoldItem()) == 'modt' ) ) then
            if ( ( CountUnitsInGroup(group1) == 0 ) ) then
                if ( ( CountUnitsInGroup(group2) != 0 ) ) then
                    if ( RectContainsUnit(gg_rct________8, GetSellingUnit()) ) then
                        set IAtleast1=21
                    elseif ( RectContainsUnit(gg_rct_Diamond2, GetSellingUnit()) ) then
                        set IAtleast2=21
                    elseif ( RectContainsUnit(gg_rct_Diamond3, GetSellingUnit()) ) then
                        set IAtleast3=21
                    endif
                     set BJiulun=true
                    call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r祝你好运!")
                    set i=1
                    loop
                        exitwhen i > 20
                        call Diamond___CreateDiamonMonster('nplb' , 7)
                        set i=i + 1
                    endloop
                else
                    call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r没英雄不开刷!")
                endif
            else
                call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r清完这波东西再来买!")
            endif
        endif
//end of: StartDiamondMonster("modt","nplb","7")
//textmacro instance: StartDiamondMonster("sman","ntrv","8")
        if ( ( GetItemTypeId(GetSoldItem()) == 'sman' ) ) then
            if ( ( CountUnitsInGroup(group1) == 0 ) ) then
                if ( ( CountUnitsInGroup(group2) != 0 ) ) then
                    if ( RectContainsUnit(gg_rct________8, GetSellingUnit()) ) then
                        set IAtleast1=21
                    elseif ( RectContainsUnit(gg_rct_Diamond2, GetSellingUnit()) ) then
                        set IAtleast2=21
                    elseif ( RectContainsUnit(gg_rct_Diamond3, GetSellingUnit()) ) then
                        set IAtleast3=21
                    endif
                     set BJiulun=true
                    call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r祝你好运!")
                    set i=1
                    loop
                        exitwhen i > 20
                        call Diamond___CreateDiamonMonster('ntrv' , 8)
                        set i=i + 1
                    endloop
                else
                    call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r没英雄不开刷!")
                endif
            else
                call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r清完这波东西再来买!")
            endif
        endif
//end of: StartDiamondMonster("sman","ntrv","8")
//textmacro instance: StartDiamondMonster("sorf","nmmu","9")
        if ( ( GetItemTypeId(GetSoldItem()) == 'sorf' ) ) then
            if ( ( CountUnitsInGroup(group1) == 0 ) ) then
                if ( ( CountUnitsInGroup(group2) != 0 ) ) then
                    if ( RectContainsUnit(gg_rct________8, GetSellingUnit()) ) then
                        set IAtleast1=21
                    elseif ( RectContainsUnit(gg_rct_Diamond2, GetSellingUnit()) ) then
                        set IAtleast2=21
                    elseif ( RectContainsUnit(gg_rct_Diamond3, GetSellingUnit()) ) then
                        set IAtleast3=21
                    endif
                     set BJiulun=true
                    call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r祝你好运!")
                    set i=1
                    loop
                        exitwhen i > 20
                        call Diamond___CreateDiamonMonster('nmmu' , 9)
                        set i=i + 1
                    endloop
                else
                    call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r没英雄不开刷!")
                endif
            else
                call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r清完这波东西再来买!")
            endif
        endif
//end of: StartDiamondMonster("sorf","nmmu","9")
//textmacro instance: StartDiamondMonster("ratf","nanb","5")
        if ( ( GetItemTypeId(GetSoldItem()) == 'ratf' ) ) then
            if ( ( CountUnitsInGroup(group1) == 0 ) ) then
                if ( ( CountUnitsInGroup(group2) != 0 ) ) then
                    if ( RectContainsUnit(gg_rct________8, GetSellingUnit()) ) then
                        set IAtleast1=21
                    elseif ( RectContainsUnit(gg_rct_Diamond2, GetSellingUnit()) ) then
                        set IAtleast2=21
                    elseif ( RectContainsUnit(gg_rct_Diamond3, GetSellingUnit()) ) then
                        set IAtleast3=21
                    endif
                     set BJiulun=true
                    call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r祝你好运!")
                    set i=1
                    loop
                        exitwhen i > 20
                        call Diamond___CreateDiamonMonster('nanb' , 5)
                        set i=i + 1
                    endloop
                else
                    call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r没英雄不开刷!")
                endif
            else
                call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r清完这波东西再来买!")
            endif
        endif
//end of: StartDiamondMonster("ratf","nanb","5")
//textmacro instance: StartDiamondMonster("rreb","nanm","5")
        if ( ( GetItemTypeId(GetSoldItem()) == 'rreb' ) ) then
            if ( ( CountUnitsInGroup(group1) == 0 ) ) then
                if ( ( CountUnitsInGroup(group2) != 0 ) ) then
                    if ( RectContainsUnit(gg_rct________8, GetSellingUnit()) ) then
                        set IAtleast1=21
                    elseif ( RectContainsUnit(gg_rct_Diamond2, GetSellingUnit()) ) then
                        set IAtleast2=21
                    elseif ( RectContainsUnit(gg_rct_Diamond3, GetSellingUnit()) ) then
                        set IAtleast3=21
                    endif
                     set BJiulun=true
                    call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r祝你好运!")
                    set i=1
                    loop
                        exitwhen i > 20
                        call Diamond___CreateDiamonMonster('nanm' , 5)
                        set i=i + 1
                    endloop
                else
                    call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r没英雄不开刷!")
                endif
            else
                call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r清完这波东西再来买!")
            endif
        endif
//end of: StartDiamondMonster("rreb","nanm","5")
//textmacro instance: StartDiamondMonster("ckng","nane","5")
        if ( ( GetItemTypeId(GetSoldItem()) == 'ckng' ) ) then
            if ( ( CountUnitsInGroup(group1) == 0 ) ) then
                if ( ( CountUnitsInGroup(group2) != 0 ) ) then
                    if ( RectContainsUnit(gg_rct________8, GetSellingUnit()) ) then
                        set IAtleast1=21
                    elseif ( RectContainsUnit(gg_rct_Diamond2, GetSellingUnit()) ) then
                        set IAtleast2=21
                    elseif ( RectContainsUnit(gg_rct_Diamond3, GetSellingUnit()) ) then
                        set IAtleast3=21
                    endif
                     set BJiulun=true
                    call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r祝你好运!")
                    set i=1
                    loop
                        exitwhen i > 20
                        call Diamond___CreateDiamonMonster('nane' , 5)
                        set i=i + 1
                    endloop
                else
                    call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r没英雄不开刷!")
                endif
            else
                call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r清完这波东西再来买!")
            endif
        endif
//end of: StartDiamondMonster("ckng","nane","5")
        call DestroyGroup(group1)
        call DestroyGroup(group2)
        set group1=null
        set group2=null
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___MonsterDropDiamond takes nothing returns boolean
        local integer i= 1
            if ( ( GetUnitTypeId(GetDyingUnit()) == 'nnmg' ) ) then
                loop
                    exitwhen i > CModeH(1 , 2) * I3(JJ2 , 3 , 1)
                        call CreateItem('I02N', GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit()))
                        set i=i + 1
                endloop
                return true
            elseif ( ( GetUnitTypeId(GetDyingUnit()) == 'nmyr' ) ) then
                loop
                    exitwhen i > CModeH(1 , 2) * I3(JJ2 , 3 , 1)
                    call CreateItem('I04S', GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit()))
                    set i=i + 1
                endloop
                return true
            elseif ( ( GetUnitTypeId(GetDyingUnit()) == 'nnsw' ) ) then
                loop
                    exitwhen i > CModeH(1 , 2) * I3(JJ2 , 3 , 1)
                    call CreateItem('azhr', GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit()))
                    set i=i + 1
                endloop
                return true
            elseif ( ( GetUnitTypeId(GetDyingUnit()) == 'nsnp' ) ) then
                loop
                    exitwhen i > CModeH(1 , 2) * I3(JJ2 , 3 , 1)
                    call CreateItem('gmfr', GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit()))
                    set i=i + 1
                endloop
                return true
            elseif ( ( GetUnitTypeId(GetDyingUnit()) == 'nhyc' ) ) then
                loop
                    exitwhen i > CModeH(1 , 2) * I3(JJ2 , 3 , 1)
                    call CreateItem('jpnt', GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit()))
                    set i=i + 1
                endloop
                return true
            elseif ( ( GetUnitTypeId(GetDyingUnit()) == 'nnrg' ) ) then
                loop
                    exitwhen i > CModeH(1 , 2) * I3(JJ2 , 3 , 1)
                    call CreateItem('glsk', GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit()))
                    set i=i + 1
                endloop
                return true
            elseif ( ( GetUnitTypeId(GetDyingUnit()) == 'nplb' ) ) then
                loop
                    exitwhen i > CModeH(1 , 2)
                    call CreateItem('kygh', GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit()))
                    set i=i + 1
                endloop
                return true
            elseif ( ( GetUnitTypeId(GetDyingUnit()) == 'ntrv' ) ) then
                loop
                    exitwhen i > CModeH(1 , 2)
                    call CreateItem('sehr', GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit()))
                    set i=i + 1
                endloop
                return true
            elseif ( ( GetUnitTypeId(GetDyingUnit()) == 'nmmu' ) ) then
                loop
                    exitwhen i > CModeH(1 , 2)
                    call CreateItem('bzbf', GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit()))
                    set i=i + 1
                endloop
                return true
            elseif ( ( GetUnitTypeId(GetDyingUnit()) == 'nanb' ) ) then
                loop
                    exitwhen i > CModeH(1 , 2)
                    call CreateItem('thle', GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit()))
                    set i=i + 1
                endloop
                return true
            elseif ( ( GetUnitTypeId(GetDyingUnit()) == 'nanm' ) ) then
                loop
                    exitwhen i > CModeH(1 , 2)
                    call CreateItem('dkfw', GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit()))
                    set i=i + 1
                endloop
                return true
            elseif ( ( GetUnitTypeId(GetDyingUnit()) == 'nane' ) ) then
                loop
                    exitwhen i > CModeH(1 , 2)
                    call CreateItem('phlt', GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit()))
                    set i=i + 1
                endloop
                return true
            endif
            set i=i + 1
        return false
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function TDropDiamondCon takes nothing returns boolean
        return ( GetOwningPlayer(GetDyingUnit()) == Player(10) or GetOwningPlayer(GetDyingUnit()) == Player(11) ) and not ( IsUnitIllusion(GetDyingUnit()) )
    endfunction
    
    function TDropDiamondAct takes nothing returns nothing
        if ( ( ( GetUnitTypeId(GetDyingUnit()) == 'nnmg' ) or ( GetUnitTypeId(GetDyingUnit()) == 'nmyr' ) or ( GetUnitTypeId(GetDyingUnit()) == 'nnsw' ) or ( GetUnitTypeId(GetDyingUnit()) == 'nsnp' ) or ( GetUnitTypeId(GetDyingUnit()) == 'nhyc' ) or ( GetUnitTypeId(GetDyingUnit()) == 'nnrg' ) or ( GetUnitTypeId(GetDyingUnit()) == 'nplb' ) or ( GetUnitTypeId(GetDyingUnit()) == 'ntrv' ) or ( GetUnitTypeId(GetDyingUnit()) == 'nmmu' ) or ( GetUnitTypeId(GetDyingUnit()) == 'nanb' ) or ( GetUnitTypeId(GetDyingUnit()) == 'nanm' ) or ( GetUnitTypeId(GetDyingUnit()) == 'nane' ) ) and ( GetPlayerController(GetOwningPlayer(GetDyingUnit())) == MAP_CONTROL_COMPUTER ) ) then
            if ( RectContainsUnit(gg_rct________8, GetDyingUnit()) ) then
                set IAtleast1=( IAtleast1 - 1 )
                if ( ( IAtleast1 == 1 ) ) then
                    set IAtleast1=100
                    call Diamond___MonsterDropDiamond()
                    return
                endif
            elseif ( RectContainsUnit(gg_rct_Diamond2, GetDyingUnit()) ) then
                set IAtleast2=( IAtleast2 - 1 )
                if ( ( IAtleast2 == 1 ) ) then
                    set IAtleast2=100
                    call Diamond___MonsterDropDiamond()
                    return
                endif
            elseif ( RectContainsUnit(gg_rct_Diamond3, GetDyingUnit()) ) then
                set IAtleast3=( IAtleast3 - 1 )
                if ( ( IAtleast3 == 1 ) ) then
                    set IAtleast3=100
                    call Diamond___MonsterDropDiamond()
                    return
                endif
            endif
            if ( ( GetRandomInt(1, 25) == 1 ) and not ( IsTianyan ) and IsInDiamondRegion(GetUnitX(GetDyingUnit()) , GetUnitY(GetDyingUnit())) ) then
                if ( Diamond___MonsterDropDiamond() ) then
                    if ( RectContainsUnit(gg_rct________8, GetDyingUnit()) ) then
                        set IAtleast1=100
                    elseif ( RectContainsUnit(gg_rct_Diamond2, GetDyingUnit()) ) then
                        set IAtleast2=100
                    elseif ( RectContainsUnit(gg_rct_Diamond3, GetDyingUnit()) ) then
                        set IAtleast3=100
                    endif
                endif
            endif
        endif
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function ClearDiamondRegion takes rect r returns nothing
        local unit l_unit= null
        local group group2= YDWEGetUnitsInRectMatchingNull(r , Condition(function DiamondMonsterFilter))
        set group2=YDWEGetUnitsInRectMatchingNull(r , Condition(function DiamondMonsterFilter))
        loop
            set l_unit=FirstOfGroup(group2)
            exitwhen l_unit == null
            call GroupRemoveUnit(group2, l_unit)
            call FlushChildHashtable(YDHT, GetHandleId(l_unit))
            call RemoveUnit(l_unit)
        endloop
        call DestroyGroup(group2)
        set group2=null
        set l_unit=null
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function TLeaveDiamondRegionCon takes nothing returns boolean
        return ( ( GetPlayerController(GetOwningPlayer(GetLeavingUnit())) == MAP_CONTROL_USER ) )
    endfunction
    function TLeaveDiamondRegion1Act takes nothing returns nothing
        local group group1= YDWEGetUnitsInRectMatchingNull(gg_rct________8 , Condition(function DiamondPlayerFilter))
        if ( ( CountUnitsInGroup(group1) == 0 ) ) then
            call ClearDiamondRegion(gg_rct________8)
        endif
        call DestroyGroup(group1)
        set group1=null
    endfunction
    function TLeaveDiamondRegion2Act takes nothing returns nothing
        local group group1= YDWEGetUnitsInRectMatchingNull(gg_rct_Diamond2 , Condition(function DiamondPlayerFilterOther))
        local group group2= null
        local unit l_unit= null
        if ( ( CountUnitsInGroup(group1) == 0 ) ) then
            set group2=YDWEGetUnitsInRectMatchingNull(gg_rct_Diamond2 , Condition(function DiamondMonsterFilter))
            loop
                set l_unit=FirstOfGroup(group2)
                exitwhen l_unit == null
                call GroupRemoveUnit(group2, l_unit)
                call FlushChildHashtable(YDHT, GetHandleId(l_unit))
                call RemoveUnit(l_unit)
            endloop
            call DestroyGroup(group2)
        endif
        call DestroyGroup(group1)
        set group1=null
        set group2=null
        set l_unit=null
    endfunction
    function TLeaveDiamondRegion3Act takes nothing returns nothing
        local group group1= YDWEGetUnitsInRectMatchingNull(gg_rct_Diamond3 , Condition(function DiamondPlayerFilterOther))
        local group group2= null
        local unit l_unit= null
        if ( ( CountUnitsInGroup(group1) == 0 ) ) then
            set group2=YDWEGetUnitsInRectMatchingNull(gg_rct_Diamond3 , Condition(function DiamondMonsterFilter))
            loop
                set l_unit=FirstOfGroup(group2)
                exitwhen l_unit == null
                call GroupRemoveUnit(group2, l_unit)
                call FlushChildHashtable(YDHT, GetHandleId(l_unit))
                call RemoveUnit(l_unit)
            endloop
            call DestroyGroup(group2)
        endif
        call DestroyGroup(group1)
        set group1=null
        set group2=null
        set l_unit=null
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Diamond___DiamondDialogClick takes nothing returns nothing
        local dialog d= GetClickedDialogBJ()
        local unit u= LoadUnitHandle(LHTable, GetHandleId(d), 3)
        if ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), 1) ) then
            call SetUnitX(u, GetRectCenterX(gg_rct_Diamond2))
            call SetUnitY(u, GetRectCenterY(gg_rct_Diamond2))
            call PanCameraToTimedForPlayer(GetOwningPlayer(GetBuyingUnit()), GetRectCenterX(gg_rct_Diamond2), GetRectCenterY(gg_rct_Diamond2), 0.2)
            call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", GetRectCenterX(gg_rct_Diamond2), GetRectCenterY(gg_rct_Diamond2)))
            call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r回去输入“HG”。")
        endif
        if ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), 4) ) then
            call SetUnitX(u, GetRectCenterX(gg_rct_Diamond3))
            call SetUnitY(u, GetRectCenterY(gg_rct_Diamond3))
            call PanCameraToTimedForPlayer(GetOwningPlayer(GetBuyingUnit()), GetRectCenterX(gg_rct_Diamond3), GetRectCenterY(gg_rct_Diamond3), 0.2)
            call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", GetRectCenterX(gg_rct_Diamond3), GetRectCenterY(gg_rct_Diamond3)))
            call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r回去输入“HG”。")
        endif
        if ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), 2) ) then
            call SetUnitX(u, GetRectCenterX(gg_rct________8))
            call SetUnitY(u, GetRectCenterY(gg_rct________8))
            call PanCameraToTimedForPlayer(GetOwningPlayer(GetBuyingUnit()), GetRectCenterX(gg_rct________8), GetRectCenterY(gg_rct________8), 0.2)
            call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", GetRectCenterX(gg_rct________8), GetRectCenterY(gg_rct________8)))
            call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r回去输入“HG”。")
        endif
        call FlushChildHashtable(LHTable, GetHandleId(d))
        call DialogDisplay(GetOwningPlayer(u), d, false)
        call DialogClear(d)
        call DialogDestroy(d)
        set d=null
        set u=null
        call DestroyTrigger(GetTriggeringTrigger())
    endfunction
    function CreateDiamondDialog takes unit u returns nothing
        local trigger t= CreateTrigger()
        local dialog d= DialogCreate()
        call DialogSetMessage(d, "请选择进入的宝石区")
        call SaveButtonHandle(LHTable, GetHandleId(d), 1, DialogAddButtonBJ(d, "低级宝石区1（次）"))
        call SaveButtonHandle(LHTable, GetHandleId(d), 4, DialogAddButtonBJ(d, "低级宝石区2（次）"))
        call SaveButtonHandle(LHTable, GetHandleId(d), 2, DialogAddButtonBJ(d, "高级宝石区（主）"))
        call SaveUnitHandle(LHTable, GetHandleId(d), 3, u)
        call DialogDisplay(GetOwningPlayer(u), d, true)
        call TriggerRegisterDialogEvent(t, d)
        call TriggerAddAction(t, function Diamond___DiamondDialogClick)
        set d=null
        set t=null
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function EnterDiamond takes nothing returns nothing
        if ( ( GetItemTypeId(GetSoldItem()) == 'rspd' ) ) then
            call CreateDiamondDialog(GetBuyingUnit())
        endif
    endfunction
//---------------------------------------------------------------------------------------------------
	
 function Diamond___InitDiamond takes nothing returns nothing
        local trigger t= CreateTrigger()
        call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
        call TriggerAddAction(t, function Diamond___TSpellDiamondAct)
        //开始刷宝石
        set t=CreateTrigger()
        call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_SELL_ITEM)
        call TriggerAddCondition(t, Condition(function TBuyDiamondStartCon))
        call TriggerAddAction(t, function TBuyDiamondStartAct)
        //宝石怪物掉落
        set t=CreateTrigger()
        call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_DEATH)
        call TriggerAddCondition(t, Condition(function TDropDiamondCon))
        call TriggerAddAction(t, function TDropDiamondAct)
        //宝石区离开事件
        set t=CreateTrigger()
        call YDWETriggerRegisterLeaveRectSimpleNull(t , gg_rct________8)
        call TriggerAddCondition(t, Condition(function TLeaveDiamondRegionCon))
        call TriggerAddAction(t, function TLeaveDiamondRegion1Act)
        set t=CreateTrigger()
        call YDWETriggerRegisterLeaveRectSimpleNull(t , gg_rct_Diamond2)
        call TriggerAddCondition(t, Condition(function TLeaveDiamondRegionCon))
        call TriggerAddAction(t, function TLeaveDiamondRegion2Act)
        set t=CreateTrigger()
        call YDWETriggerRegisterLeaveRectSimpleNull(t , gg_rct_Diamond3)
        call TriggerAddCondition(t, Condition(function TLeaveDiamondRegionCon))
        call TriggerAddAction(t, function TLeaveDiamondRegion3Act)
        set t=null
	endfunction

//library Diamond ends
//library GoldSystem:
//---------------------------------------------------------------------------------------------------
	
 function TGoldDeathCon takes nothing returns boolean
	    return ( ( ( HaveSavedInteger(YDHT, GetUnitTypeId(GetDyingUnit()), 0x9DA51395) == true ) or IsUnitInGroup(GetDyingUnit(), GJingxiang) ) and ( IsUnitIllusionBJ(GetDyingUnit()) != true ) and ( GetPlayerController(GetOwningPlayer(GetKillingUnitBJ())) == MAP_CONTROL_USER ) and ( GetPlayerSlotState(GetOwningPlayer(GetKillingUnitBJ())) == PLAYER_SLOT_STATE_PLAYING ) )
	endfunction
 function TGoldDeathAct takes nothing returns nothing
  local integer index= GetConvertedPlayerId(GetOwningPlayer(GetKillingUnitBJ()))
  local integer rate= 1
  local integer i= 1
		if ( IsHighSpeed() ) then
			if not ( IsUnitType(GetDyingUnit(), UNIT_TYPE_HERO) ) then
				set rate=2
			endif
		endif
		loop
			exitwhen i > 6
			if ( i == index or BGoldGongxiang[i] ) then
	    		set udg_gold[i]=( R2I(I2R(I3(IsUnitInGroup(GetDyingUnit(), GJingxiang) , udg_Bo * 75 + 225 , LoadInteger(YDHT, GetUnitTypeId(GetDyingUnit()), 0x9DA51395))) * udg_I_Jinqianhuodelv[i]) ) * rate + udg_gold[i] + udg_gold[i + 6]
			endif
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function AddGoldForPlayerTimer takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > 6
			if ( ( udg_gold[i] != 0 ) ) then
				if ( CT4() ) then
		        	call AdjustPlayerStateBJ(R2I(I2R(udg_gold[i]) * 0.01), ConvertedPlayer(i), PLAYER_STATE_RESOURCE_GOLD)
	    			call CreateSpellTextTag("黄金+" + I2S(R2I(I2R(udg_gold[i]) * 0.01)) , udg_H[i] , 255 , 255 , 0 , 2)
				else
		        	call AdjustPlayerStateBJ(udg_gold[i], ConvertedPlayer(i), PLAYER_STATE_RESOURCE_GOLD)
	    			call CreateSpellTextTag("黄金+" + I2S(udg_gold[i]) , udg_H[i] , 255 , 255 , 0 , 2)
				endif
		        set udg_gold[i]=0
		    endif
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GoldSystem___InitAllMonsterGoldSystem takes nothing returns nothing
		call SaveInteger(YDHT, 'nitr', 0x9DA51395, 100)
	    call SaveInteger(YDHT, 'nitw', 0x9DA51395, 100)
	    call SaveInteger(YDHT, 'nith', 0x9DA51395, 125)
	    call SaveInteger(YDHT, 'nits', 0x9DA51395, 125)
	    call SaveInteger(YDHT, 'nmrl', 0x9DA51395, 150)
	    call SaveInteger(YDHT, 'nmrm', 0x9DA51395, 150)
	    call SaveInteger(YDHT, 'hfoo', 0x9DA51395, 175)
	    call SaveInteger(YDHT, 'hmpr', 0x9DA51395, 175)
	    call SaveInteger(YDHT, 'hsor', 0x9DA51395, 200)
	    call SaveInteger(YDHT, 'hspt', 0x9DA51395, 200)
	    call SaveInteger(YDHT, 'uban', 0x9DA51395, 225)
	    call SaveInteger(YDHT, 'unec', 0x9DA51395, 225)
	    call SaveInteger(YDHT, 'ugho', 0x9DA51395, 250)
	    call SaveInteger(YDHT, 'ucry', 0x9DA51395, 250)
	    call SaveInteger(YDHT, 'earc', 0x9DA51395, 275)
	    call SaveInteger(YDHT, 'esen', 0x9DA51395, 275)
	    call SaveInteger(YDHT, 'ogru', 0x9DA51395, 300)
	    call SaveInteger(YDHT, 'orai', 0x9DA51395, 300)
	    call SaveInteger(YDHT, 'hkni', 0x9DA51395, 325)
	    call SaveInteger(YDHT, 'hrif', 0x9DA51395, 325)
	    call SaveInteger(YDHT, 'ohun', 0x9DA51395, 350)
	    call SaveInteger(YDHT, 'odoc', 0x9DA51395, 350)
	    call SaveInteger(YDHT, 'njks', 0x9DA51395, 375)
	    call SaveInteger(YDHT, 'hhes', 0x9DA51395, 375)
	    call SaveInteger(YDHT, 'nchr', 0x9DA51395, 400)
	    call SaveInteger(YDHT, 'nchw', 0x9DA51395, 400)
	    call SaveInteger(YDHT, 'okod', 0x9DA51395, 425)
	    call SaveInteger(YDHT, 'oshm', 0x9DA51395, 425)
	    call SaveInteger(YDHT, 'nzom', 0x9DA51395, 450)
	    call SaveInteger(YDHT, 'uswb', 0x9DA51395, 450)
	    call SaveInteger(YDHT, 'hgry', 0x9DA51395, 475)
	    call SaveInteger(YDHT, 'hdhw', 0x9DA51395, 475)
	    call SaveInteger(YDHT, 'otau', 0x9DA51395, 500)
	    call SaveInteger(YDHT, 'ospw', 0x9DA51395, 500)
	    call SaveInteger(YDHT, 'edry', 0x9DA51395, 525)
	    call SaveInteger(YDHT, 'edot', 0x9DA51395, 525)
	    call SaveInteger(YDHT, 'hgyr', 0x9DA51395, 550)
	    call SaveInteger(YDHT, 'hmtm', 0x9DA51395, 550)
	    call SaveInteger(YDHT, 'efdr', 0x9DA51395, 575)
	    call SaveInteger(YDHT, 'edoc', 0x9DA51395, 575)
	    call SaveInteger(YDHT, 'uobs', 0x9DA51395, 600)
	    call SaveInteger(YDHT, 'umtw', 0x9DA51395, 600)
	    call SaveInteger(YDHT, 'otbr', 0x9DA51395, 625)
	    call SaveInteger(YDHT, 'owyv', 0x9DA51395, 625)
	    call SaveInteger(YDHT, 'owar', 0x9DA51395, 650)
	    call SaveInteger(YDHT, 'oswy', 0x9DA51395, 650)
	    call SaveInteger(YDHT, 'emtg', 0x9DA51395, 700)
	    call SaveInteger(YDHT, 'ebal', 0x9DA51395, 700)
	    call SaveInteger(YDHT, 'nfgb', 0x9DA51395, 5000)
	    call SaveInteger(YDHT, 'nsgb', 0x9DA51395, 5000)
	    call SaveInteger(YDHT, 'nwrg', 0x9DA51395, 6000)
	    call SaveInteger(YDHT, 'nlkl', 0x9DA51395, 6000)
	    call SaveInteger(YDHT, 'nltc', 0x9DA51395, 7000)
	    call SaveInteger(YDHT, 'nltc', 0x9DA51395, 7000)
	    call SaveInteger(YDHT, 'nmsc', 0x9DA51395, 8000)
	    call SaveInteger(YDHT, 'nplg', 0x9DA51395, 8000)
	    call SaveInteger(YDHT, 'nlrv', 0x9DA51395, 9000)
	    call SaveInteger(YDHT, 'nvdg', 0x9DA51395, 9000)
	    call SaveInteger(YDHT, 'nano', 0x9DA51395, 200)
	    call SaveInteger(YDHT, 'nanw', 0x9DA51395, 400)
	    call SaveInteger(YDHT, 'nenf', 0x9DA51395, 500)
	    call SaveInteger(YDHT, 'nbld', 0x9DA51395, 1000)
	    call SaveInteger(YDHT, 'nbda', 0x9DA51395, 1000)
	    call SaveInteger(YDHT, 'nbdo', 0x9DA51395, 2000)
	    call SaveInteger(YDHT, 'ncim', 0x9DA51395, 2500)
	    call SaveInteger(YDHT, 'ncnk', 0x9DA51395, 5000)
	    call SaveInteger(YDHT, 'ngnw', 0x9DA51395, 10000)
	    call SaveInteger(YDHT, 'ngns', 0x9DA51395, 5000)
	    call SaveInteger(YDHT, 'ngna', 0x9DA51395, 500)
	    call SaveInteger(YDHT, 'nhhr', 0x9DA51395, 1000)
	    call SaveInteger(YDHT, 'nhfp', 0x9DA51395, 10000)
	    call SaveInteger(YDHT, 'nenc', 0x9DA51395, 20000)
	    call SaveInteger(YDHT, 'Nbst', 0x9DA51395, 20000)
	    call SaveInteger(YDHT, 'Hblm', 0x9DA51395, 50000)
	    call SaveInteger(YDHT, 'Obla', 0x9DA51395, 150000)
	    call SaveInteger(YDHT, 'Npbm', 0x9DA51395, 250000)
	    call SaveInteger(YDHT, 'Hamg', 0x9DA51395, 400000)
	    call SaveInteger(YDHT, 'nltl', 0x9DA51395, 100)
	    call SaveInteger(YDHT, 'nthl', 0x9DA51395, 500)
	    call SaveInteger(YDHT, 'nstw', 0x9DA51395, 1500)
	    call SaveInteger(YDHT, 'nslm', 0x9DA51395, 100)
	    call SaveInteger(YDHT, 'nslf', 0x9DA51395, 500)
	    call SaveInteger(YDHT, 'nsln', 0x9DA51395, 1500)
	    call SaveInteger(YDHT, 'nspd', 0x9DA51395, 100)
	    call SaveInteger(YDHT, 'nnwa', 0x9DA51395, 500)
	    call SaveInteger(YDHT, 'nnwl', 0x9DA51395, 1500)
	    call SaveInteger(YDHT, 'nubk', 0x9DA51395, 100)
	    call SaveInteger(YDHT, 'nubr', 0x9DA51395, 500)
	    call SaveInteger(YDHT, 'nubw', 0x9DA51395, 1500)
	endfunction
//---------------------------------------------------------------------------------------------------
 function GoldSystem___InitGoldSystem takes nothing returns nothing
		//怪物死亡事件
     local trigger t= CreateTrigger()
     local timer ti= CreateTimer()
	    call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_DEATH)
	    call TriggerAddCondition(t, Condition(function TGoldDeathCon))
	    call TriggerAddAction(t, function TGoldDeathAct)
	    call GoldSystem___InitAllMonsterGoldSystem()
	    //每秒增加黄金
	    call TimerStart(ti, 1, true, function AddGoldForPlayerTimer)
	    set t=null
	    set ti=null
	endfunction

//library GoldSystem ends
//library MiJing:
//---------------------------------------------------------------------------------------------------
    
    function SimulateDeathMijing takes unit u returns nothing
        if ( GetUnitTypeId(u) == 'n029' ) then
            call KillAreaPlayerEnemy(u , GetUnitX(u) , GetUnitY(u) , 400 , Player(10))
            call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Other\\NeutralBuildingExplosion\\NeutralBuildingExplosion.mdl", GetUnitX(u), GetUnitY(u)))
        endif
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function TDengDamageCon takes nothing returns boolean
        return GetUnitTypeId(GetTriggerUnit()) == 'n01H' and GetEventDamage() > 0
    endfunction
    function TDengDamageAct takes nothing returns nothing
        call SetUnitLifeBJ(GetTriggerUnit(), GetUnitState(GetTriggerUnit(), UNIT_STATE_LIFE) - RCModeH(1 , 2))
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function MiJing__GetDengJiangli takes nothing returns integer
        if ( IDeng == 1 ) then
            return 'ILI1'
        elseif ( IDeng == 2 ) then
            return 'ILI2'
        elseif ( IDeng == 3 ) then
            return 'ILI3'
        elseif ( IDeng == 4 ) then
            return 'ILI4'
        elseif ( IDeng == 5 ) then
            return 'ILI5'
        elseif ( IDeng == 6 ) then
            return 'ILI6'
        elseif ( IDeng == 7 ) then
            return 'ILI7'
        elseif ( IDeng == 8 ) then
            return 'ILI8'
        elseif ( IDeng == 9 ) then
            return 'ILI9'
        elseif ( IDeng == 10 ) then
            return 'ILIA'
        elseif ( IDeng == 11 ) then
            return 'ILIB'
        elseif ( IDeng == 12 ) then
            return 'ILIC'
        elseif ( IDeng == 13 ) then
            return 'ILID'
        elseif ( IDeng == 14 ) then
            return 'ILIE'
        elseif ( IDeng == 15 ) then
            return 'ILIF'
        elseif ( IDeng == 16 ) then
            return 'ILIG'
        elseif ( IDeng == 17 ) then
            return 'ILIH'
        elseif ( IDeng == 18 ) then
            return 'ILII'
        elseif ( IDeng == 19 ) then
            return 'ILIJ'
        elseif ( IDeng == 20 ) then
            return 'ILIK'
        elseif ( IDeng == 21 ) then
            return 'I07D'
        endif
        return 0
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function MiJing__GetMijingMonster takes nothing returns integer
        if ( IDeng == 1 ) then
            return 'nogr'
        elseif ( IDeng == 2 ) then
            return 'nmbg'
        elseif ( IDeng == 3 ) then
            return 'nkog'
        elseif ( IDeng == 4 ) then
            return 'nfrp'
        elseif ( IDeng == 5 ) then
            return 'nfot'
        elseif ( IDeng == 6 ) then
            return 'ners'
        elseif ( IDeng == 7 ) then
            return 'nsel'
        elseif ( IDeng == 8 ) then
            return 'ndrs'
        elseif ( IDeng == 9 ) then
            return 'ehip'
        elseif ( IDeng == 10 ) then
            return 'uabo'
        elseif ( IDeng >= 11 and IDeng < 16 ) then
            return 'nmgd'
        elseif ( IDeng >= 16 and IDeng < 21 ) then
            return 'nrwm'
        elseif ( IDeng >= 21 ) then
            return 'N028'
        endif
        return 0
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function MiJing__GetMijingMonsterCount takes nothing returns integer
        local group l_group= CreateGroup()
        local unit l_unit
        local integer count= 0
        call GroupAddGroup(MiJing__GMijing, l_group)
        loop
            set l_unit=FirstOfGroup(l_group)
            exitwhen l_unit == null
            call GroupRemoveUnit(l_group, l_unit)
            if ( IsUnitAliveBJ(l_unit) and GetOwningPlayer(l_unit) == Player(11) ) then
                set count=count + 1
                call UnitRemoveBuffsBJ(bj_REMOVEBUFFS_ALL, l_unit)
            endif
        endloop
        call DestroyGroup(l_group)
        set l_group=null
        set l_unit=null
        return count
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function MiJing__TDeathYexiCon takes nothing returns boolean
        return RectContainsUnit(gg_rct_M6, GetDyingUnit()) and ( GetUnitPointValue(GetDyingUnit()) != 0 ) and ( GetUnitPointValue(GetDyingUnit()) != 123 ) and ( GetPlayerController(GetOwningPlayer(GetDyingUnit())) == MAP_CONTROL_USER )
    endfunction
    function MiJing__TDeathYexiAct takes nothing returns nothing
        call CreateSpellTextTag("减少灯进度" , GetDyingUnit() , 0 , 0 , 0 , 2)
        set MiJing__IProcess=IMaxBJ(MiJing__IProcess - 1, 0)
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function MiJing__YexiAttackTarget takes nothing returns boolean
        return IsEnemyP(GetFilterUnit() , Player(10)) and GetUnitAbilityLevel(GetFilterUnit(), 'Avul') < 1
    endfunction
    
    function MiJing__GetFocusTarget takes group g returns unit
        local integer i= 1
        loop
            exitwhen i > 6
            if ( udg_H[i] != null and IsUnitInGroup(udg_H[i], g) ) then
                return udg_H[i]
            endif
            set i=i + 1
        endloop
        return FirstOfGroup(g)
    endfunction
    //创建假灯
    function MiJing__CreateJiadeng takes nothing returns nothing
        local timer t= GetExpiredTimer()
        local integer i= 1
        if ( MiJing__yexi != null ) then
            loop
                exitwhen i > 7
                call UnitApplyTimedLifeBJ(3.00, 'BHwe', CreateUnit(Player(6), 'n029', GetRandomReal(GetRectMinX(gg_rct_M6), GetRectMaxX(gg_rct_M6)), GetRandomReal(GetRectMinY(gg_rct_M6), GetRectMaxY(gg_rct_M6)), GetRandomReal(0, 360)))
                set i=i + 1
            endloop
            call CreateSpellTextTag("制造假灯" , MiJing__yexi , 0 , 100 , 0 , 2)
        else
            call PauseTimer(t)
            call DestroyTimer(t)
        endif
        set t=null
    endfunction
    //创建大爆炸
    function MiJing__CreateBigBoom takes nothing returns nothing
        local timer t= GetExpiredTimer()
        if ( MiJing__yexi != null ) then
            call s__Missile_createXY(MiJing__yexi , 'h02H' , "Units\\Demon\\Infernal\\InfernalBirth.mdl" , 1800 , GetUnitX(MiJing__yexi) , GetUnitY(MiJing__yexi) , 2 , 1 , 1000000000)
        else
            call PauseTimer(t)
            call DestroyTimer(t)
        endif
        set t=null
    endfunction
    //位移打人
    function MiJing__FlashLocation takes nothing returns nothing
        local timer t= GetExpiredTimer()
        local unit target= null
        local group g= null
        if ( MiJing__yexi != null ) then
            set g=YDWEGetUnitsInRectMatchingNull(gg_rct_M6 , Condition(function MiJing__YexiAttackTarget))
            set target=U3(MiJing__GetFocusTarget(g) != null , MiJing__GetFocusTarget(g) , MiJing__UDeng)
            call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\Blink\\BlinkTarget.mdl", GetUnitX(MiJing__yexi), GetUnitY(MiJing__yexi)))
            call SetUnitX(MiJing__yexi, GetUnitX(target))
            call SetUnitY(MiJing__yexi, GetUnitY(target))
            call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\Blink\\BlinkTarget.mdl", GetUnitX(MiJing__yexi), GetUnitY(MiJing__yexi)))
            call IssueTargetOrder(MiJing__yexi, "attack", target)
        else
            call PauseTimer(t)
            call DestroyTimer(t)
        endif
        set t=null
    endfunction
    //创建假灯
    function MiJing__SummonBingfeng takes nothing returns nothing
        local timer t= GetExpiredTimer()
        local integer i= 1
        if ( MiJing__yexi != null ) then
            loop
                exitwhen i > 7
                call UnitApplyTimedLifeBJ(5.00, 'BHwe', CreateUnit(Player(10), 'h02G', GetRandomReal(GetRectMinX(gg_rct_M6), GetRectMaxX(gg_rct_M6)), GetRandomReal(GetRectMinY(gg_rct_M6), GetRectMaxY(gg_rct_M6)), GetRandomReal(0, 360)))
                set i=i + 1
            endloop
            call CreateSpellTextTag("冰川夜幕" , MiJing__yexi , 0 , 100 , 0 , 2)
        else
            call PauseTimer(t)
            call DestroyTimer(t)
        endif
        set t=null
    endfunction
    function MiJing__CreateYexi takes nothing returns nothing
        local unit u= CreateUnit(Player(11), MiJing__GetMijingMonster(), GetRandomReal(GetRectMinX(gg_rct_M6), GetRectMaxX(gg_rct_M6)), GetRandomReal(GetRectMinY(gg_rct_M6), GetRectMaxY(gg_rct_M6)), GetRandomReal(0, 360))
        local timer t= CreateTimer()
        set MiJing__yexi=u
        call s__SuperShield_create(u , 20)
        call GroupAddUnit(MiJing__GMijing, u)
        call EnhanceDiffAttack(u)
        set MiJing__TDeathKou=CreateTrigger()
        call TriggerRegisterAnyUnitEventBJ(MiJing__TDeathKou, EVENT_PLAYER_UNIT_DEATH)
        call TriggerAddCondition(MiJing__TDeathKou, Condition(function MiJing__TDeathYexiCon))
        call TriggerAddAction(MiJing__TDeathKou, function MiJing__TDeathYexiAct)
        //制造假灯
        call TimerStart(t, ( 27 - IDeng ) * 0.5 + 2, true, function MiJing__CreateJiadeng)
        //大爆炸
        if ( IDeng >= 22 ) then
            set t=CreateTimer()
            call TimerStart(t, 33 - IDeng, true, function MiJing__CreateBigBoom)
        endif
        //瞬移打人
        set t=CreateTimer()
        call TimerStart(t, 1, true, function MiJing__FlashLocation)
        //召唤眩晕
        if ( IDeng >= 23 ) then
            set t=CreateTimer()
            call TimerStart(t, 5, true, function MiJing__SummonBingfeng)
        endif
        set t=null
        set u=null
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function MiJing__CreateMijingMonster takes nothing returns nothing
        local integer i= 1
        local unit u= null
        local rect r= gg_rct_M6
        local unit temp= MiJing__UDeng
        loop
            exitwhen i > udg_RENSHU
            set u=CreateUnit(Player(11), MiJing__GetMijingMonster(), GetRandomReal(GetRectMinX(r), GetRectMaxX(r)), GetRandomReal(GetRectMinY(r), GetRectMaxY(r)), GetRandomReal(0, 360))
            call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTo.mdl", GetUnitX(u), GetUnitY(u)))
            call GroupAddUnit(MiJing__GMijing, u)
            call IssuePointOrderById(u, 851983, GetUnitX(temp) + GetRandomReal(- 100, 100), GetUnitY(temp) + GetRandomReal(- 100, 100))
            if ( IsWanjie() ) then
                call UnitAddAbility(u, 'ANbl')
                call UnitAddAbility(u, 'A0IO')
            endif
            call UnitAddAbility(u, 'A0IH')
            if ( IDeng <= 10 ) then
                call EnhanceDiffAttack(u)
            elseif ( IDeng == 11 ) then
                call UnitAddAbility(u, 'A09V')
                call SetUnitAbilityLevel(u, 'A09V', NanDiff + 1)
            elseif ( IDeng == 12 ) then
                call UnitAddAbility(u, 'A0I6')
                call SetUnitAbilityLevel(u, 'A0I6', NanDiff + 1)
            elseif ( IDeng == 13 ) then
                call UnitAddAbility(u, 'A0I7')
                call SetUnitAbilityLevel(u, 'A0I7', NanDiff + 1)
            elseif ( IDeng == 14 ) then
                call UnitAddAbility(u, 'A0I8')
                call SetUnitAbilityLevel(u, 'A0I8', NanDiff + 1)
            elseif ( IDeng == 15 ) then
                call UnitAddAbility(u, 'A0I9')
                call SetUnitAbilityLevel(u, 'A0I9', NanDiff + 1)
            elseif ( IDeng == 16 ) then
                call UnitAddAbility(u, 'A09V')
                call SetUnitAbilityLevel(u, 'A09V', NanDiff + 1)
            elseif ( IDeng == 17 ) then
                call UnitAddAbility(u, 'A0IC')
                call SetUnitAbilityLevel(u, 'A0IC', NanDiff + 1)
            elseif ( IDeng == 18 ) then
                call UnitAddAbility(u, 'A0ID')
                call SetUnitAbilityLevel(u, 'A0ID', NanDiff + 1)
            elseif ( IDeng == 19 ) then
                call UnitAddAbility(u, 'A0IE')
                call SetUnitAbilityLevel(u, 'A0IE', NanDiff + 1)
            elseif ( IDeng == 20 ) then
                call UnitAddAbility(u, 'A0IF')
                call SetUnitAbilityLevel(u, 'A0IF', NanDiff + 1)
            endif
            if ( IDeng > 10 and IDeng < 16 ) then
                call SetUnitAbilityLevel(u, 'A0I3', IDeng - 10)
            elseif ( IDeng > 15 ) then
                call SetUnitAbilityLevel(u, 'A0IA', IDeng - 10)
            endif
            set i=i + 1
        endloop
        set u=null
        set r=null
        set temp=null
    endfunction
//---------------------------------------------------------------------------------------------------
    
    
//---------------------------------------------------------------------------------------------------
    
    function Fafangmijing takes integer index returns nothing
        if ( IDeng >= 22 ) then
            call AddHero3W(udg_H[index] , 40000)
            call DisplayTextToPlayer(ConvertedPlayer(index), 0., 0., "|cFFFF66CC【消息】|r秘境挑战第" + I2S(IDeng) + "层挑战成功！奖励40000点全属性与1点能量值发放到了你的身上.")
            if ( IsStrHero(udg_H[index]) ) then
                call SetHeroStr(udg_H[index], GetHeroStr(udg_H[index], true) + 40000, true)
                call DisplayTextToPlayer(ConvertedPlayer(index), 0., 0., "|cFFFF66CC【消息】|r额外奖励40000点力量.")
            elseif ( IsAgiHero(udg_H[index]) ) then
                call SetHeroAgi(udg_H[index], GetHeroAgi(udg_H[index], true) + 40000, true)
                call DisplayTextToPlayer(ConvertedPlayer(index), 0., 0., "|cFFFF66CC【消息】|r额外奖励40000点敏捷.")
            elseif ( IsIntHero(udg_H[index]) ) then
                call SetHeroInt(udg_H[index], GetHeroInt(udg_H[index], true) + 40000, true)
                call DisplayTextToPlayer(ConvertedPlayer(index), 0., 0., "|cFFFF66CC【消息】|r额外奖励40000点智力.")
            endif
            if ( MiJing__IMijing[index] != null ) then
                call SetItemCharges(MiJing__IMijing[index], GetItemCharges(MiJing__IMijing[index]) + 1)
            endif
            return
        endif
        if ( udg_H[index] != cangling ) then
            if ( MiJing__IMijing[index] != null ) then
                call RemoveItem(MiJing__IMijing[index])
            endif
        endif
        //call PolledWait(0.1)
        if ( udg_H[index] == mengji ) then
            set MiJing__IMijing[GetConvertedPlayerId(GetOwningPlayer(mengji))]=UnitAddItemByIdSwapped(MiJing__GetDengJiangli(), UDepot[GetConvertedPlayerId(GetOwningPlayer(mengji))])
            call DisplayTextToPlayer(GetOwningPlayer(mengji), 0., 0., "|cFFFF66CC【消息】|r秘境挑战第" + I2S(IDeng) + "层挑战成功！奖励" + GetItemName(GetLastCreatedItem()) + "发放到了你的仓库里面.")
            call PingMinimapForForce(YDWEGetForceOfPlayerNull(GetOwningPlayer(mengji)), GetUnitX(UDepot[GetConvertedPlayerId(GetOwningPlayer(mengji))]), GetUnitY(UDepot[GetConvertedPlayerId(GetOwningPlayer(mengji))]), 5.00)
            //call TimerStart(CreateTimer(),0.1,false,function GiveMengjiMijing)
            return
        endif
        set MiJing__IMijing[index]=UnitAddItemByIdSwapped(MiJing__GetDengJiangli(), udg_H[index])
        call DisplayTextToPlayer(ConvertedPlayer(index), 0., 0., "|cFFFF66CC【消息】|r秘境挑战第" + I2S(IDeng) + "层挑战成功！奖励" + GetItemName(GetLastCreatedItem()) + "发放到了你的身上.")
        call PingMinimapForForce(YDWEGetForceOfPlayerNull(ConvertedPlayer(index)), GetUnitX(udg_H[index]), GetUnitY(udg_H[index]), 5.00)
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function MiJing__MijingSucceed takes nothing returns nothing
        local integer i= 1
        loop
            exitwhen i > 6
            if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) and udg_H[i] != null ) then
                call Fafangmijing(i)
            endif
            set i=i + 1
        endloop
        call SetTextTagTextBJ(MiJing__TDeng, "第" + I2S(IDeng) + "层", 25)
         call SaveMijingAchievement(IDeng)
        call PlaySoundBJ(gg_snd_v_mijing)
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function MiJing__MijingFail takes nothing returns nothing
        call BJDebugMsg("|cFFFF66CC【消息】|r秘境挑战第" + I2S(IDeng) + "层挑战失败!")
        set IDeng=IDeng - 1
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function MiJing__RemoveAllMijingUnit takes nothing returns nothing
        if ( IsUnitAliveBJ(GetEnumUnit()) and GetOwningPlayer(GetEnumUnit()) == Player(11) ) then
            call RemoveUnit(GetEnumUnit())
        endif
    endfunction
    function MiJing__DestroyAllMijing takes nothing returns nothing
        if ( MiJing__TDeathKou != null ) then
            call DestroyTrigger(MiJing__TDeathKou)
            set MiJing__TDeathKou=null
        endif
        if ( MiJing__yexi != null ) then
            if ( IsUnitDeadBJ(MiJing__yexi) ) then
                 call SaveAllPlayerAchievement(417)
            endif
        endif
        set MiJing__yexi=null
        if ( MiJing__UDeng != null ) then
            call RemoveUnit(MiJing__UDeng)
        endif
        call DestroyTextTag(MiJing__TDengProcess)
        set MiJing__UDeng=null
        set MiJing__TDengProcess=null
        call ForGroupBJ(MiJing__GMijing, function MiJing__RemoveAllMijingUnit)
        call DisableTrigger(MiJing__TDengUnderAttacked)
        set MiJing__BMijingStart=false
        set MiJing__IProcess=0
        set MiJing__ITotalMonster=0
        call PauseTimer(MiJing__TMijingJudge)
        call DestroyTimer(MiJing__TMijingJudge)
        set MiJing__TMijingJudge=null
        call PauseTimer(MiJing__TMijingBound)
        call DestroyTimer(MiJing__TMijingBound)
        set MiJing__TMijingBound=null
        if ( MiJing__TMijingFlash != null ) then
            call PauseTimer(MiJing__TMijingFlash)
            call DestroyTimer(MiJing__TMijingFlash)
            set MiJing__TMijingFlash=null
        endif
        call DestroyGroup(MiJing__GMijing)
        set MiJing__GMijing=null
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function MiJing__JudgeDengTimer takes nothing returns nothing
        set MiJing__IProcess=MiJing__IProcess + 1
        //失败条件:任一灯爆了
        if not ( IsUnitAliveBJ(MiJing__UDeng) ) then
            call MiJing__DestroyAllMijing()
            call MiJing__MijingFail()
            return
        endif
        //胜利条件:100%或者没有怪了
        if ( MiJing__IProcess >= 100 or ( MiJing__GetMijingMonsterCount() == 0 ) and MiJing__ITotalMonster >= I3(IDeng >= 21 , 0 , 15) ) then
            call MiJing__MijingSucceed()
            call MiJing__DestroyAllMijing()
            return
        endif
        call SetTextTagTextBJ(MiJing__TDengProcess, I2S(MiJing__IProcess) + "%", 20)
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function MiJing__FlashMonsterTimer takes nothing returns nothing
        set MiJing__ITotalMonster=MiJing__ITotalMonster + udg_RENSHU
        if ( MiJing__ITotalMonster < 15 ) then
            //创建怪物
            call MiJing__CreateMijingMonster()
        else
            call PauseTimer(MiJing__TMijingFlash)
            call DestroyTimer(MiJing__TMijingFlash)
            set MiJing__TMijingFlash=null
        endif
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function MiJing__JudgeBoundTimer takes nothing returns nothing
        local group l_group= CreateGroup()
        local unit l_unit
        local integer count= 0
        local unit temp= null
        local rect r= gg_rct_M6
        call GroupAddGroup(MiJing__GMijing, l_group)
        loop
            set l_unit=FirstOfGroup(l_group)
            exitwhen l_unit == null
            call GroupRemoveUnit(l_group, l_unit)
            if ( IsUnitAliveBJ(l_unit) and GetOwningPlayer(l_unit) == Player(11) ) then
                set temp=MiJing__UDeng
                if not ( RectContainsUnit(r, l_unit) ) then
                    call SetUnitPosition(l_unit, GetRandomReal(GetRectMinX(r), GetRectMaxX(r)), GetRandomReal(GetRectMinY(r), GetRectMaxY(r)))
                endif
                call IssuePointOrderById(l_unit, 851983, GetUnitX(temp) + GetRandomReal(- 100, 100), GetUnitY(temp) + GetRandomReal(- 100, 100))
            endif
        endloop
        call DestroyGroup(l_group)
        set l_group=null
        set l_unit=null
        set temp=null
        set r=null
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function MiJing__StartMijing takes nothing returns nothing
        local rect r= null
         set BJiulun=true
        if ( IDeng >= 25 ) then
            call BJDebugMsg("|cFFFF66CC【消息】|r秘境挑战已经达到最高的25层，25层之后敬请期待.")
            return
        endif
        if ( MiJing__BMijingStart ) then
            call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0., 0., "|cFFFF66CC【消息】|r请完成当前挑战再挑战新的秘境.")
            return
        endif
        if ( IDeng >= 10 ) then
            if ( ( GetPlayerState(GetOwningPlayer(GetBuyingUnit()), PLAYER_STATE_RESOURCE_LUMBER) < 1000 ) ) then
                call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0., 0., "|cFFFF66CC【消息】|r从11层秘境开始,需要消耗1000木头.")
                return
            endif
            call AdjustPlayerStateBJ(- 1000, GetOwningPlayer(GetBuyingUnit()), PLAYER_STATE_RESOURCE_LUMBER)
        endif
        set IDeng=IDeng + 1
        //强化怪物
        if ( IDeng == 12 ) then
            call SetPlayerTechResearchedSwap('R012', NanDiff + 1, Player(10))
            call SetPlayerTechResearchedSwap('R012', NanDiff + 1, Player(11))
        elseif ( IDeng == 13 ) then
            call SetPlayerTechResearchedSwap('R014', NanDiff + 1, Player(10))
            call SetPlayerTechResearchedSwap('R014', NanDiff + 1, Player(11))
        elseif ( IDeng == 14 ) then
            call SetPlayerTechResearchedSwap('R015', NanDiff + 1, Player(10))
            call SetPlayerTechResearchedSwap('R015', NanDiff + 1, Player(11))
        elseif ( IDeng == 15 ) then
            call SetPlayerTechResearchedSwap('R016', NanDiff + 1, Player(10))
            call SetPlayerTechResearchedSwap('R016', NanDiff + 1, Player(11))
        elseif ( IDeng == 17 ) then
            call SetPlayerTechResearchedSwap('R017', NanDiff + 1, Player(10))
            call SetPlayerTechResearchedSwap('R017', NanDiff + 1, Player(11))
        elseif ( IDeng == 18 ) then
            call SetPlayerTechResearchedSwap('R018', NanDiff + 1, Player(10))
            call SetPlayerTechResearchedSwap('R018', NanDiff + 1, Player(11))
        elseif ( IDeng == 19 ) then
            call SetPlayerTechResearchedSwap('R019', NanDiff + 1, Player(10))
            call SetPlayerTechResearchedSwap('R019', NanDiff + 1, Player(11))
        elseif ( IDeng == 20 ) then
            call SetPlayerTechResearchedSwap('R01A', NanDiff + 1, Player(10))
            call SetPlayerTechResearchedSwap('R01A', NanDiff + 1, Player(11))
        endif
        //获取对应的区域
        set r=gg_rct_M6
        //创建对应的灯与对应的文字
        set MiJing__UDeng=CreateUnit(Player(6), 'n01H', GetRandomReal(GetRectMinX(r), GetRectMaxX(r)), GetRandomReal(GetRectMinY(r), GetRectMaxY(r)), 0)
        set MiJing__TDengProcess=CreateTextTagUnitBJ("0%", MiJing__UDeng, 0, 20, 100, 100, 0, 0)
        call PingMinimap(GetUnitX(MiJing__UDeng), GetUnitY(MiJing__UDeng), 5)
        set MiJing__IProcess=0
        set MiJing__BMijingStart=true
        call BJDebugMsg("|cFFFF66CC【消息】|r第" + I2S(IDeng) + "层秘境挑战将在5秒后开始！请尽量保持全员参战！")
        call YDWEPolledWaitNull(5)
        call BJDebugMsg("|cFFFF66CC【消息】|r挑战开始！")
        call EnableTrigger(MiJing__TDengUnderAttacked)
        set MiJing__TMijingJudge=CreateTimer()
        set MiJing__GMijing=CreateGroup()
        //检测计时器
        call TimerStart(MiJing__TMijingJudge, RCModeH(0.6 , 0.3), true, function MiJing__JudgeDengTimer)
        if ( IDeng >= 21 ) then
            call MiJing__CreateYexi()
        else
            //刷怪计时器
            set MiJing__TMijingFlash=CreateTimer()
            call TimerStart(MiJing__TMijingFlash, RCModeH(1 , 0.5), true, function MiJing__FlashMonsterTimer)
            //进攻与检测吸怪计时器
            set MiJing__TMijingBound=CreateTimer()
            call TimerStart(MiJing__TMijingBound, RCModeH(4 , 2), true, function MiJing__JudgeBoundTimer)
        endif
        set r=null
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function EnterMijing takes nothing returns nothing
        local real x
        local real y
        if ( ( GetItemTypeId(GetSoldItem()) == 'I02T' ) ) then
            set x=GetRectCenterX(gg_rct_M6)
            set y=GetRectCenterY(gg_rct_M6)
            call SetUnitX(GetBuyingUnit(), x)
            call SetUnitY(GetBuyingUnit(), y)
            call PanCameraToTimedForPlayer(GetOwningPlayer(GetBuyingUnit()), x, y, 0.2)
            call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", x, y))
            call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r回去输入“HG”。")
        elseif ( ( GetItemTypeId(GetSoldItem()) == 'I048' ) ) then
            call MiJing__StartMijing()
        endif
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function MiJing__DamageMijingCon takes nothing returns boolean
        return ( IsUnitInGroup(GetTriggerUnit(), MiJing__GMijing) or IsUnitInGroup(GetEventDamageSource(), MiJing__GMijing) ) and ( GetEventDamage() >= 10.00 )
    endfunction
    function MiJing__DamageMijingAct takes nothing returns nothing
        if ( IsUnitInGroup(GetTriggerUnit(), MiJing__GMijing) and udg_RENSHU > 1 ) then
            //减伤
            call SetUnitLifeBJ(GetTriggerUnit(), GetUnitState(GetTriggerUnit(), UNIT_STATE_LIFE) + GetEventDamage() * ( 1.0 - 1.0 / I2R(udg_RENSHU) ))
        elseif ( IsUnitInGroup(GetEventDamageSource(), MiJing__GMijing) ) then
            //增伤
            call DisableTrigger(GetTriggeringTrigger())
            if ( GetEventDamageSource() == MiJing__yexi ) then
                call UnitDamageTarget(GetEventDamageSource(), GetTriggerUnit(), 0.01 * udg_Nandu_JJJ * GetUnitState(GetTriggerUnit(), UNIT_STATE_MAX_LIFE), false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_SLOW_POISON, WEAPON_TYPE_WHOKNOWS)
            else
                if ( udg_RENSHU > 1 ) then
                    call UnitDamageTarget(GetEventDamageSource(), GetTriggerUnit(), GetEventDamage() * ( udg_RENSHU - 1 ), false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_SLOW_POISON, WEAPON_TYPE_WHOKNOWS)
                endif
                if ( IsWanjie() ) then
                    call UnitDamageTarget(GetEventDamageSource(), GetTriggerUnit(), 0.01 * udg_RENSHU * GetUnitState(GetTriggerUnit(), UNIT_STATE_MAX_LIFE), false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_SLOW_POISON, WEAPON_TYPE_WHOKNOWS)
                endif
            endif
            if ( IsTianyan and GetTriggerUnit() != udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] and ( GetPlayerController(GetOwningPlayer(GetEventDamageSource())) == MAP_CONTROL_COMPUTER ) ) then
                call UnitDamageTarget(GetEventDamageSource(), GetTriggerUnit(), GetUnitState(GetTriggerUnit(), UNIT_STATE_MAX_LIFE), false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_SLOW_POISON, WEAPON_TYPE_WHOKNOWS)
            endif
            call EnableTrigger(GetTriggeringTrigger())
        endif
    endfunction
//---------------------------------------------------------------------------------------------------
    
 function InitMiJing takes nothing returns nothing
        local trigger t= CreateTrigger()
        set MiJing__TDengUnderAttacked=CreateTrigger()
        call YDWESyStemAnyUnitDamagedRegistTrigger(MiJing__TDengUnderAttacked)
        call DisableTrigger(MiJing__TDengUnderAttacked)
        call TriggerAddCondition(MiJing__TDengUnderAttacked, Condition(function TDengDamageCon))
        call TriggerAddAction(MiJing__TDengUnderAttacked, function TDengDamageAct)
        set UMijingShangdian=CreateUnit(Player(PLAYER_NEUTRAL_PASSIVE), 'n01G', - 6144.0, - 10176.0, 270.000)
        set MiJing__TDeng=CreateTextTagUnitBJ("第0层", UMijingShangdian, 0, 25, 100, 0, 100, 0)
        //秘境人数伤害的提高与伤害的减少
        call YDWESyStemAnyUnitDamagedRegistTrigger(t)
        call TriggerAddCondition(t, Condition(function MiJing__DamageMijingCon))
        call TriggerAddAction(t, function MiJing__DamageMijingAct)
        set t=null
	endfunction

//library MiJing ends
//library MiniGame:
//---------------------------------------------------------------------------------------------------
	
 function MiniGame__XiaojunengTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local unit u= LoadUnitHandle(LHTable, id, 1)
		if ( IsUnitAliveBJ(u) ) then
     		call IssuePointOrder(u, "stampede", GetRectCenterX(gg_rct_Game1), GetRectCenterY(gg_rct_Game1))
		else
			call PauseTimer(t)
			call FlushChildHashtable(LHTable, id)
			call DestroyTimer(t)
		endif
		set u=null
		set t=null
	endfunction
 function MiniGame__StartTimerXiaojuneng takes unit u returns nothing
  local timer t= CreateTimer()
		call SaveUnitHandle(LHTable, GetHandleId(t), 1, u)
		call TimerStart(t, 5, true, function MiniGame__XiaojunengTimer)
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CreateGame1Majia takes real angle returns nothing
  local real x= GetRectCenterX(gg_rct_Game1) + 200. * CosBJ(angle)
  local real y= GetRectCenterY(gg_rct_Game1) + 200. * SinBJ(angle)
  local unit u= CreateUnit(Player(10), 'h01U', x, y, angle + 180)
	    call UnitAddAbility(u, 'A0DY')
	    call SetUnitAbilityLevel(u, 'A0DY', I3(IsWanjie() , 7 , 3))
     	call IssuePointOrder(u, "stampede", GetRectCenterX(gg_rct_Game1), GetRectCenterY(gg_rct_Game1))
     	call GroupAddUnit(MiniGame__GGame1, u)
     	call MiniGame__StartTimerXiaojuneng(u)
     	set u=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function MiniGame__MiniMissileBoom takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local unit u= LoadUnitHandle(LHTable, id, 1)
		if ( IsUnitAliveBJ(u) ) then
			call s__Missile_create(u , 'hs01' , "Units\\Demon\\Infernal\\InfernalBirth.mdl" , 300 , 1800 , 3 , 1 , 1000000000)
		else
			call PauseTimer(t)
			call FlushChildHashtable(LHTable, id)
			call DestroyTimer(t)
		endif
		set u=null
		set t=null
	endfunction
 function MiniGame__RefreshMiniMingcha takes unit u returns nothing
  local timer t= CreateTimer()
		call SaveUnitHandle(LHTable, GetHandleId(t), 1, u)
		call TimerStart(t, 0.4, true, function MiniGame__MiniMissileBoom)
		set t=null
	endfunction
 function CreateGame2Majia takes nothing returns nothing
  local real x= GetRandomReal(GetRectMinX(gg_rct_Game2), GetRectMaxX(gg_rct_Game2))
  local real y= GetRandomReal(GetRectMinY(gg_rct_Game2), GetRectMaxY(gg_rct_Game2))
  local unit u= CreateUnit(Player(10), 'h02D', x, y, GetRandomReal(0, 360))
		call MiniGame__RefreshMiniMingcha(u)
     	call GroupAddUnit(MiniGame__GGame2, u)
     	set u=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
	//奖励值
 function MiniGame__GetSpecifyTimeGold takes integer time returns integer
		return R2I(( ( I2R(MiniGame__TTimeGame1) / 50. ) + 1. ) * ( 2.5 * ( I2R(udg_Bo) / 2. + 1 ) ))
	endfunction
 function MiniGame__FlashGame1Reward takes nothing returns nothing
  local integer i= 1
  local string s= ""
		set MiniGame__TTimeGame1=MiniGame__TTimeGame1 + 1
		loop
			exitwhen i > 6
			if ( MiniGame__IGoldGame1[i] != 0 ) then
				set MiniGame__IGoldGame1[i]=MiniGame__IGoldGame1[i] + MiniGame__GetSpecifyTimeGold(MiniGame__TTimeGame1) * CModeH(1 , 2)
				set s=s + GetUnitName(udg_H[i]) + ":" + I2S(MiniGame__IGoldGame1[i]) + "\n				"
			endif
			set i=i + 1
		endloop
		set s=s + "时间:" + I2S(MiniGame__TTimeGame1 / 10) + "s"
		call SetTextTagTextBJ(MiniGame__TTGame1, s, 10)
		set s=null
		if ( MiniGame__TTimeGame1 == 50 ) then
			call CreateGame1Majia(45.)
		elseif ( MiniGame__TTimeGame1 == 100 ) then
			call CreateGame1Majia(135.)
		elseif ( MiniGame__TTimeGame1 == 150 ) then
			call CreateGame1Majia(225.)
		elseif ( MiniGame__TTimeGame1 == 200 ) then
			call CreateGame1Majia(0.)
		elseif ( MiniGame__TTimeGame1 == 250 ) then
			call CreateGame1Majia(90.)
		elseif ( MiniGame__TTimeGame1 == 300 ) then
			call CreateGame1Majia(180.)
		elseif ( MiniGame__TTimeGame1 == 350 ) then
			call CreateGame1Majia(270.)
		elseif ( ModuloInteger(MiniGame__TTimeGame1, 50) == 0 ) then
			call CreateGame1Majia(GetRandomReal(0., 360.))
		endif
	endfunction
 function MiniGame__StartGame1 takes nothing returns nothing
		if ( MiniGame__TGame1 == null ) then
			set MiniGame__TGame1=CreateTimer()
			set MiniGame__GGame1=CreateGroup()
			call TimerStart(MiniGame__TGame1, 0.1, true, function MiniGame__FlashGame1Reward)
			set MiniGame__TTGame1=CreateTextTagUnitBJ("奖励", gg_unit_n01Q_0273, 0, 10, 0, 100, 0, 0)
			set MiniGame__TTimeGame1=0
			call CreateGame1Majia(315.)
		endif
	endfunction
 function MiniGame__RemoveAllMini takes nothing returns nothing
		call RemoveUnit(GetEnumUnit())
	endfunction
 function MiniGame__DestroyGame1 takes nothing returns nothing
		if ( MiniGame__TGame1 != null ) then
			call PauseTimer(MiniGame__TGame1)
			call DestroyTimer(MiniGame__TGame1)
			call DestroyTextTag(MiniGame__TTGame1)
			set MiniGame__TGame1=null
			call ForGroup(MiniGame__GGame1, function MiniGame__RemoveAllMini)
			call DestroyGroup(MiniGame__GGame1)
			set MiniGame__GGame1=null
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function MiniGame__FlashGame2Reward takes nothing returns nothing
  local integer i= 1
  local string s= ""
		set MiniGame__TTimeGame2=MiniGame__TTimeGame2 + 1
		loop
			exitwhen i > 6
			if ( MiniGame__IGoldGame2[i] != 0 ) then
				set MiniGame__IGoldGame2[i]=MiniGame__IGoldGame2[i] + MiniGame__GetSpecifyTimeGold(MiniGame__TTimeGame2) * CModeH(1 , 2) * 4
				set s=s + GetUnitName(udg_H[i]) + ":" + I2S(MiniGame__IGoldGame2[i]) + "\n				"
			endif
			set i=i + 1
		endloop
		set s=s + "时间:" + I2S(MiniGame__TTimeGame2 / 10) + "s"
		call SetTextTagTextBJ(MiniGame__TTGame2, s, 10)
		set s=null
		if ( ModuloInteger(MiniGame__TTimeGame2, 30) == 0 ) then
			call CreateGame2Majia()
		endif
	endfunction
 function MiniGame__DestroyGame2 takes nothing returns nothing
		if ( MiniGame__TGame2 != null ) then
			call PauseTimer(MiniGame__TGame2)
			call DestroyTimer(MiniGame__TGame2)
			call DestroyTextTag(MiniGame__TTGame2)
			set MiniGame__TGame2=null
			call ForGroup(MiniGame__GGame2, function MiniGame__RemoveAllMini)
			call DestroyGroup(MiniGame__GGame2)
			set MiniGame__GGame2=null
			set MiniGame__TTGame2=null
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function MiniGame__StartGame2 takes nothing returns nothing
		if ( MiniGame__TGame2 == null ) then
			set MiniGame__TGame2=CreateTimer()
			call TimerStart(MiniGame__TGame2, 0.1, true, function MiniGame__FlashGame2Reward)
			set MiniGame__GGame2=CreateGroup()
			set MiniGame__TTGame2=CreateTextTagUnitBJ("奖励", MiniGame__UGame2, 0, 10, 0, 100, 0, 0)
			set MiniGame__TTimeGame2=0
			call CreateGame2Majia()
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function EnterMiniGame takes nothing returns nothing
  local real x
  local real y
		if ( ( GetItemTypeId(GetSoldItem()) == 'I06K' ) ) then
			set x=GetRectCenterX(gg_rct_Game1)
			set y=GetRectCenterY(gg_rct_Game1)
	        call SetUnitX(GetBuyingUnit(), x)
	        call SetUnitY(GetBuyingUnit(), y)
	        call PanCameraToTimedForPlayer(GetOwningPlayer(GetBuyingUnit()), x, y, 0.2)
	        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", x, y))
	        call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r回去输入“HG”。")
	        return
	    elseif ( ( GetItemTypeId(GetSoldItem()) == 'I06M' ) and GetBuyingUnit() == udg_H[GetConvertedPlayerId(GetOwningPlayer(GetBuyingUnit()))] and RectContainsUnit(gg_rct_Game1, GetBuyingUnit()) ) then
	    	call MiniGame__StartGame1()
	    	call BJDebugMsg("|cFFFF66CC【消息】|r迷你挑战-骷髅海开始啦!")
            call PingMinimapForForce(GetPlayersAll(), GetRectCenterX(gg_rct_Game1), GetRectCenterY(gg_rct_Game1), 5.00)
		elseif ( ( GetItemTypeId(GetSoldItem()) == 'I07B' ) ) then
			set x=GetRectCenterX(gg_rct_Game2)
			set y=GetRectCenterY(gg_rct_Game2)
	        call SetUnitX(GetBuyingUnit(), x)
	        call SetUnitY(GetBuyingUnit(), y)
	        call PanCameraToTimedForPlayer(GetOwningPlayer(GetBuyingUnit()), x, y, 0.2)
	        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", x, y))
	        call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r回去输入“HG”。")
	        return
	    elseif ( ( GetItemTypeId(GetSoldItem()) == 'I07C' ) and GetBuyingUnit() == udg_H[GetConvertedPlayerId(GetOwningPlayer(GetBuyingUnit()))] and RectContainsUnit(gg_rct_Game2, GetBuyingUnit()) ) then
	    	call MiniGame__StartGame2()
	    	call BJDebugMsg("|cFFFF66CC【消息】|r迷你挑战-陨石雨开始啦!")
            call PingMinimapForForce(GetPlayersAll(), GetRectCenterX(gg_rct_Game2), GetRectCenterY(gg_rct_Game2), 5.00)
	    endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function MiniGame__MiniGamePlayerFilter takes nothing returns boolean
		return GetFilterUnit() == udg_H[GetConvertedPlayerId(GetOwningPlayer(GetFilterUnit()))]
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function MiniGame__TMiniGameCon takes nothing returns boolean
		return GetTriggerUnit() == udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]
	endfunction
	//离开1事件
 function MiniGame__TLeaveMiniGameAct takes nothing returns nothing
  local integer id= GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))
        local group group1= YDWEGetUnitsInRectMatchingNull(gg_rct_Game1 , Condition(function MiniGame__MiniGamePlayerFilter))
		if ( MiniGame__IGoldGame1[id] != 1 ) then
		 	call AddHeroXP(udg_H[id], R2I(MiniGame__IGoldGame1[id] * 0.4 * udg_I_Jingyan[id]), true)
		    call AdjustPlayerStateBJ(R2I(MiniGame__IGoldGame1[id] * udg_I_Jinqianhuodelv[id]), GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_GOLD)
		    call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【消息】|r你通过迷你挑战获得了" + I2S(R2I(MiniGame__IGoldGame1[id] * udg_I_Jinqianhuodelv[id])) + "的金钱奖励和" + I2S(R2I(MiniGame__IGoldGame1[id] * 0.4 * udg_I_Jingyan[id])) + "的经验奖励,成功坚持了" + I2S(MiniGame__TTimeGame1 / 10) + "秒.")
       if ( MiniGame__TTimeGame1 / 10 > 35 ) then
     call GetAchievementAndSave(ConvertedPlayer(id) , 43)
    endif
    if ( MiniGame__TTimeGame1 / 10 > 80 ) then
     call GetAchievementAndSave(ConvertedPlayer(id) , 44)
       endif
		endif
		set MiniGame__IGoldGame1[id]=0
        if ( CountUnitsInGroup(group1) == 0 ) then
        	call MiniGame__DestroyGame1()
        endif
        call DestroyGroup(group1)
        set group1=null
	endfunction
	//离开2事件
 function MiniGame__TLeaveMiniGame2Act takes nothing returns nothing
  local integer id= GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))
        local group group1= YDWEGetUnitsInRectMatchingNull(gg_rct_Game2 , Condition(function MiniGame__MiniGamePlayerFilter))
		if ( MiniGame__IGoldGame2[id] != 1 ) then
		 	call AddHeroXP(udg_H[id], R2I(MiniGame__IGoldGame2[id] * 0.4 * udg_I_Jingyan[id]), true)
		    call AdjustPlayerStateBJ(R2I(MiniGame__IGoldGame2[id] * udg_I_Jinqianhuodelv[id]), GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_GOLD)
		    call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【消息】|r你通过迷你挑战获得了" + I2S(R2I(MiniGame__IGoldGame2[id] * udg_I_Jinqianhuodelv[id])) + "的金钱奖励和" + I2S(R2I(MiniGame__IGoldGame2[id] * 0.4 * udg_I_Jingyan[id])) + "的经验奖励,成功坚持了" + I2S(MiniGame__TTimeGame2 / 10) + "秒.")
		endif
		set MiniGame__IGoldGame2[id]=0
        if ( CountUnitsInGroup(group1) == 0 ) then
        	call MiniGame__DestroyGame2()
        endif
        call DestroyGroup(group1)
        set group1=null
	endfunction
	//进入事件
 function MiniGame__TEnterMiniGameAct takes nothing returns nothing
		if ( RectContainsUnit(gg_rct_Game1, GetTriggerUnit()) ) then
			set MiniGame__IGoldGame1[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]=1
		elseif ( RectContainsUnit(gg_rct_Game2, GetTriggerUnit()) ) then
			set MiniGame__IGoldGame2[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]=1
			if not ( udg_Zhandouli[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] > 5000 ) then
		        call SetUnitX(GetTriggerUnit(), GetRectCenterX(gg_rct_Game1))
		        call SetUnitY(GetTriggerUnit(), GetRectCenterY(gg_rct_Game1))
		        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【消息】|r需要战斗力大于5000才能上去,你目前战斗力为" + I2S(udg_Zhandouli[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]) + ".")
			endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SimulateDamageMiniGame takes unit u returns boolean
		if ( ( GetUnitTypeId(u) == 'h01U' or GetUnitTypeId(u) == 'h02D' ) and GetTriggerUnit() == udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] ) then
				call HG(GetTriggerUnit())
			return true
		endif
		return false
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function MiniGame__InitMiniGame takes nothing returns nothing
		//离开1的事件
        local trigger t= CreateTrigger()
        call YDWETriggerRegisterLeaveRectSimpleNull(t , gg_rct_Game1)
        call TriggerAddCondition(t, Condition(function MiniGame__TMiniGameCon))
        call TriggerAddAction(t, function MiniGame__TLeaveMiniGameAct)
        //进入12的事件
        set t=CreateTrigger()
        call YDWETriggerRegisterEnterRectSimpleNull(t , gg_rct_Game1)
        call YDWETriggerRegisterEnterRectSimpleNull(t , gg_rct_Game2)
        call TriggerAddCondition(t, Condition(function MiniGame__TMiniGameCon))
        call TriggerAddAction(t, function MiniGame__TEnterMiniGameAct)
        //离开2的事件
        set t=CreateTrigger()
        call YDWETriggerRegisterLeaveRectSimpleNull(t , gg_rct_Game2)
        call TriggerAddCondition(t, Condition(function MiniGame__TMiniGameCon))
        call TriggerAddAction(t, function MiniGame__TLeaveMiniGame2Act)
        set MiniGame__UGame2=CreateUnit(Player(PLAYER_NEUTRAL_PASSIVE), 'n022', GetRectCenterX(gg_rct_Game2), GetRectCenterY(gg_rct_Game2), 270)
        set t=null
	endfunction

//library MiniGame ends
//library Multiboard:
//---------------------------------------------------------------------------------------------------
	
 function Multiboard___TAddAllDamageCon takes nothing returns boolean
		return GetEventDamage() > 100000 and GetPlayerSlotState(GetOwningPlayer(GetEventDamageSource())) == PLAYER_SLOT_STATE_PLAYING and GetPlayerController(GetOwningPlayer(GetEventDamageSource())) == MAP_CONTROL_USER
	endfunction
 function Multiboard___TAddAllDamageAct takes nothing returns nothing
  local integer index= GetConvertedPlayerId(GetOwningPlayer(GetEventDamageSource()))
  local integer divede1e= 0
		if ( GetEventDamage() > 100000000 ) then
			set divede1e=R2I(GetEventDamage() / 100000000)
			set Mdamage2[index]=Mdamage2[index] + divede1e
			if ( divede1e > 300 ) then
     call GetAchievementAndSave(ConvertedPlayer(index) , 46)
			endif
		endif
		set Mdamage1[index]=Mdamage1[index] + R2I(ModuloReal(GetEventDamage(), 100000000))
		if ( Mdamage1[index] > 100000000 ) then
			set Mdamage2[index]=Mdamage2[index] + 1
			set Mdamage1[index]=Mdamage1[index] - 100000000
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function AddCenterCredit takes unit u returns nothing
  local integer index
		if ( udg_RENSHU > 1 ) then
			set index=GetConvertedPlayerId(GetOwningPlayer(u))
			set centerCredit[index]=centerCredit[index] + ( udg_Bo ) * CModeH(1 , 2)
			call YDWEMultiboardSetItemValueBJNull(udg_D , 9 , index + 1 , I2S(centerCredit[index]))
		else
			set index=GetConvertedPlayerId(GetOwningPlayer(u))
			set centerCredit[index]=centerCredit[index] + ( udg_Bo / 2 ) * CModeH(1 , 2)
			call YDWEMultiboardSetItemValueBJNull(udg_D , 9 , index + 1 , I2S(centerCredit[index]))
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Multiboard___FlashDamage takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > 6
			if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) ) then
				//刷新多面板
			 	call LeaderboardSetPlayerItemValueBJ(Player(11), udg_Paihang[i], Mdamage1[i])
    			call LeaderboardSetPlayerItemLabelBJ(Player(11), udg_Paihang[i], "总伤害(" + I2S(Mdamage2[i]) + "亿)")
     call SaveAchievement6(ConvertedPlayer(i) , Mdamage2[i])
			endif
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Multiboard___InitMultiboard takes nothing returns nothing
  local trigger t= CreateTrigger()
		call TimerStart(CreateTimer(), 20, true, function Multiboard___FlashDamage)
    	call YDWESyStemAnyUnitDamagedRegistTrigger(t)
	    call TriggerAddCondition(t, Condition(function Multiboard___TAddAllDamageCon))
	    call TriggerAddAction(t, function Multiboard___TAddAllDamageAct)
    	set t=null
	endfunction

//library Multiboard ends
//library Pet:
//---------------------------------------------------------------------------------------------------
    
    function CreatePet takes player owner,unit pet returns nothing
        local unit u=null
        if ( CT1() and GetUnitLevel(pet) > 20 ) then
            call DisplayTextToPlayer(owner, 0., 0., "|cFFFF66CC【消息】|r目前挑战是力量透支挑战,该挑战下不能捕捉超过20级的怪物.")
            return
        endif
        set u=pet
        call PlaySoundBJ(gg_snd_GoodJob)
        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl", GetUnitX(pet), GetUnitY(pet)))
        //删除原有的宠物并清空缓存
        call SetUnitOwner(pet, owner, true)
        
        //添加技能
        if ( IsTianyan ) then
            call RemoveDiffAttack(u)
        endif
        call UnitAddAbilityBJ('AInv', u)
        call UnitAddAbilityBJ('A06E', u)
        call UnitAddAbilityBJ('A06F', u)
        call UnitAddAbilityBJ('A0P0', u)
        call UnitAddType(u, UNIT_TYPE_PEON)
        call SetUnitAcquireRange(u, 600.00)
        call UnitAddAbilityBJ('A08M', u)
        call GroupAddUnitSimple(u, GPet[GetConvertedPlayerId(owner)])
        call UnitAddAbilityBJ('Avul', u)
        call DisplayTextToPlayer(owner, 0, 0, "|cFFFF66CC【消息】|r捕捉成功！")
        call IssueTargetOrder(u, "attack", udg_H[GetConvertedPlayerId(owner)])
        call SetPlayerStateBJ(owner, PLAYER_STATE_RESOURCE_FOOD_USED, ( GetPlayerState(owner, PLAYER_STATE_RESOURCE_FOOD_USED) + 1 ))
        set u=null
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function TCatchPetAct takes nothing returns nothing
//textmacro instance: CatchPet("A06D","I073","10000")
            //忠诚单位
            if ( GetSpellAbilityId() == 'A06D' ) then
                //忠诚单位无效:
                if ( IsLoyalUnit(GetSpellTargetUnit()) ) then
                    call UnitAddItemByIdSwapped('I073', GetTriggerUnit())
                    call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, "|cFFFF66CC【消息】|r不能抓忠诚单位。")
                    return
                endif
                if ( GetUnitLevel(GetSpellTargetUnit()) > 19 and GetUnitLevel(GetSpellTargetUnit()) > GetHeroLevel(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]) ) then
                    call UnitAddItemByIdSwapped('I073', GetTriggerUnit())
                    call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, "|cFFFF66CC【消息】|r你的英雄需要" + I2S(GetUnitLevel(GetSpellTargetUnit())) + "级你才能捕捉该单位.")
                    return
                endif
                if ( ( GetPlayerState(GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_FOOD_USED) >= ( GetPlayerState(GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_FOOD_CAP) - 0 ) ) ) then
                    call UnitAddItemByIdSwapped('I073', GetTriggerUnit())
                    call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, "|cFFFF66CC【消息】|r你的人口已满,请通过炼狱提升你的人口数.")
                    return
                endif
                if ( ( GetUnitStateSwap(UNIT_STATE_LIFE, GetSpellTargetUnit()) >= 10000 ) ) then
                    call UnitAddItemByIdSwapped('I073', GetTriggerUnit())
                    call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, "|cFFFF66CC【消息】|r目标生物HP为" + I2S(R2I(GetUnitState(GetSpellTargetUnit(), UNIT_STATE_LIFE) / 10000)) + "万血,超过了网的" + I2S(10000) + "HP捕捉上限!")
                    return
                endif
                if ( GetSpellAbilityId() == 'A04Q' ) then
                     call SavePetAchievement(GetOwningPlayer(GetTriggerUnit()) , GetUnitLevel(GetSpellTargetUnit()))
                endif
                call CreatePet(GetOwningPlayer(GetTriggerUnit()) , GetSpellTargetUnit())
                return
            endif
//end of: CatchPet("A06D","I073","10000")
//textmacro instance: CatchPet("A04P","I074","100000")
            //忠诚单位
            if ( GetSpellAbilityId() == 'A04P' ) then
                //忠诚单位无效:
                if ( IsLoyalUnit(GetSpellTargetUnit()) ) then
                    call UnitAddItemByIdSwapped('I074', GetTriggerUnit())
                    call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, "|cFFFF66CC【消息】|r不能抓忠诚单位。")
                    return
                endif
                if ( GetUnitLevel(GetSpellTargetUnit()) > 19 and GetUnitLevel(GetSpellTargetUnit()) > GetHeroLevel(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]) ) then
                    call UnitAddItemByIdSwapped('I074', GetTriggerUnit())
                    call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, "|cFFFF66CC【消息】|r你的英雄需要" + I2S(GetUnitLevel(GetSpellTargetUnit())) + "级你才能捕捉该单位.")
                    return
                endif
                if ( ( GetPlayerState(GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_FOOD_USED) >= ( GetPlayerState(GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_FOOD_CAP) - 0 ) ) ) then
                    call UnitAddItemByIdSwapped('I074', GetTriggerUnit())
                    call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, "|cFFFF66CC【消息】|r你的人口已满,请通过炼狱提升你的人口数.")
                    return
                endif
                if ( ( GetUnitStateSwap(UNIT_STATE_LIFE, GetSpellTargetUnit()) >= 100000 ) ) then
                    call UnitAddItemByIdSwapped('I074', GetTriggerUnit())
                    call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, "|cFFFF66CC【消息】|r目标生物HP为" + I2S(R2I(GetUnitState(GetSpellTargetUnit(), UNIT_STATE_LIFE) / 10000)) + "万血,超过了网的" + I2S(100000) + "HP捕捉上限!")
                    return
                endif
                if ( GetSpellAbilityId() == 'A04Q' ) then
                     call SavePetAchievement(GetOwningPlayer(GetTriggerUnit()) , GetUnitLevel(GetSpellTargetUnit()))
                endif
                call CreatePet(GetOwningPlayer(GetTriggerUnit()) , GetSpellTargetUnit())
                return
            endif
//end of: CatchPet("A04P","I074","100000")
//textmacro instance: CatchPet("A04Q","I075","500000")
            //忠诚单位
            if ( GetSpellAbilityId() == 'A04Q' ) then
                //忠诚单位无效:
                if ( IsLoyalUnit(GetSpellTargetUnit()) ) then
                    call UnitAddItemByIdSwapped('I075', GetTriggerUnit())
                    call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, "|cFFFF66CC【消息】|r不能抓忠诚单位。")
                    return
                endif
                if ( GetUnitLevel(GetSpellTargetUnit()) > 19 and GetUnitLevel(GetSpellTargetUnit()) > GetHeroLevel(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]) ) then
                    call UnitAddItemByIdSwapped('I075', GetTriggerUnit())
                    call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, "|cFFFF66CC【消息】|r你的英雄需要" + I2S(GetUnitLevel(GetSpellTargetUnit())) + "级你才能捕捉该单位.")
                    return
                endif
                if ( ( GetPlayerState(GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_FOOD_USED) >= ( GetPlayerState(GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_FOOD_CAP) - 0 ) ) ) then
                    call UnitAddItemByIdSwapped('I075', GetTriggerUnit())
                    call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, "|cFFFF66CC【消息】|r你的人口已满,请通过炼狱提升你的人口数.")
                    return
                endif
                if ( ( GetUnitStateSwap(UNIT_STATE_LIFE, GetSpellTargetUnit()) >= 500000 ) ) then
                    call UnitAddItemByIdSwapped('I075', GetTriggerUnit())
                    call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, "|cFFFF66CC【消息】|r目标生物HP为" + I2S(R2I(GetUnitState(GetSpellTargetUnit(), UNIT_STATE_LIFE) / 10000)) + "万血,超过了网的" + I2S(500000) + "HP捕捉上限!")
                    return
                endif
                if ( GetSpellAbilityId() == 'A04Q' ) then
                     call SavePetAchievement(GetOwningPlayer(GetTriggerUnit()) , GetUnitLevel(GetSpellTargetUnit()))
                endif
                call CreatePet(GetOwningPlayer(GetTriggerUnit()) , GetSpellTargetUnit())
                return
            endif
//end of: CatchPet("A04Q","I075","500000")
//textmacro instance: CatchPet("A04R","I072","2000000")
            //忠诚单位
            if ( GetSpellAbilityId() == 'A04R' ) then
                //忠诚单位无效:
                if ( IsLoyalUnit(GetSpellTargetUnit()) ) then
                    call UnitAddItemByIdSwapped('I072', GetTriggerUnit())
                    call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, "|cFFFF66CC【消息】|r不能抓忠诚单位。")
                    return
                endif
                if ( GetUnitLevel(GetSpellTargetUnit()) > 19 and GetUnitLevel(GetSpellTargetUnit()) > GetHeroLevel(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]) ) then
                    call UnitAddItemByIdSwapped('I072', GetTriggerUnit())
                    call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, "|cFFFF66CC【消息】|r你的英雄需要" + I2S(GetUnitLevel(GetSpellTargetUnit())) + "级你才能捕捉该单位.")
                    return
                endif
                if ( ( GetPlayerState(GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_FOOD_USED) >= ( GetPlayerState(GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_FOOD_CAP) - 0 ) ) ) then
                    call UnitAddItemByIdSwapped('I072', GetTriggerUnit())
                    call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, "|cFFFF66CC【消息】|r你的人口已满,请通过炼狱提升你的人口数.")
                    return
                endif
                if ( ( GetUnitStateSwap(UNIT_STATE_LIFE, GetSpellTargetUnit()) >= 2000000 ) ) then
                    call UnitAddItemByIdSwapped('I072', GetTriggerUnit())
                    call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, "|cFFFF66CC【消息】|r目标生物HP为" + I2S(R2I(GetUnitState(GetSpellTargetUnit(), UNIT_STATE_LIFE) / 10000)) + "万血,超过了网的" + I2S(2000000) + "HP捕捉上限!")
                    return
                endif
                if ( GetSpellAbilityId() == 'A04Q' ) then
                     call SavePetAchievement(GetOwningPlayer(GetTriggerUnit()) , GetUnitLevel(GetSpellTargetUnit()))
                endif
                call CreatePet(GetOwningPlayer(GetTriggerUnit()) , GetSpellTargetUnit())
                return
            endif
//end of: CatchPet("A04R","I072","2000000")
//textmacro instance: CatchPet("A0E1","I071","20000000")
            //忠诚单位
            if ( GetSpellAbilityId() == 'A0E1' ) then
                //忠诚单位无效:
                if ( IsLoyalUnit(GetSpellTargetUnit()) ) then
                    call UnitAddItemByIdSwapped('I071', GetTriggerUnit())
                    call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, "|cFFFF66CC【消息】|r不能抓忠诚单位。")
                    return
                endif
                if ( GetUnitLevel(GetSpellTargetUnit()) > 19 and GetUnitLevel(GetSpellTargetUnit()) > GetHeroLevel(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]) ) then
                    call UnitAddItemByIdSwapped('I071', GetTriggerUnit())
                    call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, "|cFFFF66CC【消息】|r你的英雄需要" + I2S(GetUnitLevel(GetSpellTargetUnit())) + "级你才能捕捉该单位.")
                    return
                endif
                if ( ( GetPlayerState(GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_FOOD_USED) >= ( GetPlayerState(GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_FOOD_CAP) - 0 ) ) ) then
                    call UnitAddItemByIdSwapped('I071', GetTriggerUnit())
                    call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, "|cFFFF66CC【消息】|r你的人口已满,请通过炼狱提升你的人口数.")
                    return
                endif
                if ( ( GetUnitStateSwap(UNIT_STATE_LIFE, GetSpellTargetUnit()) >= 20000000 ) ) then
                    call UnitAddItemByIdSwapped('I071', GetTriggerUnit())
                    call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, "|cFFFF66CC【消息】|r目标生物HP为" + I2S(R2I(GetUnitState(GetSpellTargetUnit(), UNIT_STATE_LIFE) / 10000)) + "万血,超过了网的" + I2S(20000000) + "HP捕捉上限!")
                    return
                endif
                if ( GetSpellAbilityId() == 'A04Q' ) then
                     call SavePetAchievement(GetOwningPlayer(GetTriggerUnit()) , GetUnitLevel(GetSpellTargetUnit()))
                endif
                call CreatePet(GetOwningPlayer(GetTriggerUnit()) , GetSpellTargetUnit())
                return
            endif
//end of: CatchPet("A0E1","I071","20000000")
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function TAttackForbitCon takes nothing returns boolean
        return ( ( GetUnitAbilityLevelSwapped('A06F', GetAttacker()) == 1 ) and IsUnitInGroup(GetAttacker(), GPet[GetConvertedPlayerId(GetOwningPlayer(GetAttacker()))]) == true )
    endfunction
    function TAttackForbitAct takes nothing returns nothing
        call DisplayTextToPlayer(GetOwningPlayer(GetAttacker()), 0, 0, "|cFFFF66CC【消息】|r想攻击的话使用技能“切换形态”。")
        //停止命令
        call IssueImmediateOrderById(GetAttacker(), 851972)
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Pet___TPetChangeForm takes nothing returns nothing
        //切换形态1:
        if ( GetSpellAbilityId() == 'A06G' ) then
            call UnitAddType(GetTriggerUnit(), UNIT_TYPE_PEON)
            call UnitAddAbilityBJ('A06F', GetTriggerUnit())
            call UnitRemoveAbilityBJ('A06G', GetTriggerUnit())
            call UnitAddAbilityBJ('Avul', GetTriggerUnit())
        endif
        //切换形态2:
        if ( GetSpellAbilityId() == 'A06F' ) then
            call UnitRemoveType(GetTriggerUnit(), UNIT_TYPE_PEON)
            call UnitRemoveAbilityBJ('Avul', GetTriggerUnit())
            call UnitAddAbilityBJ('A06G', GetTriggerUnit())
            call UnitRemoveAbilityBJ('A06F', GetTriggerUnit())
        endif
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Pet___TPetDeathCon takes nothing returns boolean
        return ( IsUnitIllusionBJ(GetDyingUnit()) == false and ( ( IsUnitInGroup(GetDyingUnit(), GPet[1]) ) or ( IsUnitInGroup(GetDyingUnit(), GPet[2]) ) or ( IsUnitInGroup(GetDyingUnit(), GPet[3]) ) or ( IsUnitInGroup(GetDyingUnit(), GPet[4]) ) or ( IsUnitInGroup(GetDyingUnit(), GPet[5]) ) or ( IsUnitInGroup(GetDyingUnit(), GPet[6]) ) ) )
    endfunction
    function Pet___TPetDeathAct takes nothing returns nothing
        local integer index= - 1
        local integer i= 1
        local integer ii= 1
        loop
            exitwhen ii > 6
            if ( IsUnitInGroup(GetDyingUnit(), GPet[ii]) == true ) then
                set index=ii
            endif
            set ii=ii + 1
        endloop
        if ( index == - 1 ) then
            return
        endif
        call SetPlayerStateBJ(ConvertedPlayer(index), PLAYER_STATE_RESOURCE_FOOD_USED, ( GetPlayerState(ConvertedPlayer(index), PLAYER_STATE_RESOURCE_FOOD_USED) - 1 ))
        //物品给仓库
        loop
            exitwhen i > 6
            if ( IsUnitHasSlot(UDepot[index]) ) then
                call UnitAddItemSwapped(UnitItemInSlotBJ(GetDyingUnit(), i), UDepot[index])
            else
                call SetItemPosition(UnitItemInSlotBJ(GetDyingUnit(), i), GetUnitX(UDepot[index]), GetUnitY(UDepot[index]))
            endif
            set i=i + 1
        endloop
        call PingMinimapForForce(YDWEGetForceOfPlayerNull(ConvertedPlayer(index)), GetUnitX(UDepot[index]), GetUnitY(UDepot[index]), 10.00)
        call DisplayTextToPlayer(ConvertedPlayer(index), 0, 0, ( "|cFFFF66CC【消息】|r你的宠物“" + ( GetUnitName(GetDyingUnit()) + "”已阵亡，物品存放于你的仓库。" ) ))
        call FlushChildHashtable(YDHT, GetHandleId(GetDyingUnit()))
        call GroupRemoveUnit(GPet[index], GetDyingUnit())
        call RemoveUnit(GetDyingUnit())
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function TPetItemCon takes nothing returns boolean
        return ( ( not ( IsUnitIllusionBJ(GetTriggerUnit()) ) ) and ( IsUnitInGroup(GetTriggerUnit(), GPet[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]) ) )
    endfunction
    //得到物品
    function TPetItemPickAct takes nothing returns nothing
        if ( ( GetItemTypeId(GetManipulatedItem()) == 'sbch' ) and ( GetUnitAbilityLevelSwapped('A06R', GetTriggerUnit()) != 1 ) ) then
            call UnitAddAbilityBJ('A06R', GetTriggerUnit())
        endif
        if ( ( GetItemTypeId(GetManipulatedItem()) == 'gcel' ) and ( GetUnitAbilityLevelSwapped('A0B9', GetTriggerUnit()) != 1 ) ) then
            call UnitAddAbilityBJ('A0B9', GetTriggerUnit())
        endif
        if ( ( GetItemTypeId(GetManipulatedItem()) == 'crys' ) and ( GetUnitAbilityLevelSwapped('A0CG', GetTriggerUnit()) != 1 ) ) then
            call UnitAddAbilityBJ('A0CG', GetTriggerUnit())
        endif
    endfunction
    //丢弃物品
    function TPetItemDropAct takes nothing returns nothing
        if ( ( GetItemTypeId(GetManipulatedItem()) == 'sbch' ) and ( GetUnitAbilityLevelSwapped('A06R', GetTriggerUnit()) == 1 ) ) then
            call UnitRemoveAbility(GetTriggerUnit(), 'A06R')
        else
        endif
        if ( ( GetItemTypeId(GetManipulatedItem()) == 'gcel' ) and ( GetUnitAbilityLevelSwapped('A0B9', GetTriggerUnit()) == 1 ) ) then
            call UnitRemoveAbility(GetTriggerUnit(), 'A0B9')
        else
        endif
        if ( ( GetItemTypeId(GetManipulatedItem()) == 'crys' ) and ( GetUnitAbilityLevelSwapped('A0CG', GetTriggerUnit()) == 1 ) ) then
            call UnitRemoveAbility(GetTriggerUnit(), 'A0CG')
        else
        endif
    endfunction
//---------------------------------------------------------------------------------------------------
    function Pet___InitPet takes nothing returns nothing
        local trigger t= CreateTrigger()
        local integer i= 1
        loop
            exitwhen i > 6
            set GPet[i]=CreateGroup()
            set i=i + 1
        endloop
        //抓宠物与宠物切换形态
        call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
        call TriggerAddAction(t, function TCatchPetAct)
        call TriggerAddAction(t, function Pet___TPetChangeForm)
        //没切换攻击形态时
        set t=CreateTrigger()
        call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
        call TriggerAddCondition(t, Condition(function TAttackForbitCon))
        call TriggerAddAction(t, function TAttackForbitAct)
        //宠物死亡事件
        set t=CreateTrigger()
        call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_DEATH)
        call TriggerAddCondition(t, Condition(function Pet___TPetDeathCon))
        call TriggerAddAction(t, function Pet___TPetDeathAct)
        //宠物获得物品事件
        set t=CreateTrigger()
        call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_PICKUP_ITEM)
        call TriggerAddCondition(t, Condition(function TPetItemCon))
        call TriggerAddAction(t, function TPetItemPickAct)
        //宠物丢弃物品事件
        set t=CreateTrigger()
        call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_DROP_ITEM)
        call TriggerAddCondition(t, Condition(function TPetItemCon))
        call TriggerAddAction(t, function TPetItemDropAct)
        set t=null
    endfunction

//library Pet ends
//library Ring:
//---------------------------------------------------------------------------------------------------
	
 function Ring__RingSwitch takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local player p= LoadPlayerHandle(LHTable, id, 1)
		set BHintRing[GetConvertedPlayerId(p)]=false
		call PauseTimer(t)
		call FlushChildHashtable(LHTable, id)
		call DestroyTimer(t)
		set p=null
		set t=null
	endfunction
 function Ring__CreateRingTimer takes player p returns nothing
  local timer t= CreateTimer()
		call SavePlayerHandle(LHTable, GetHandleId(t), 1, p)
		call TimerStart(t, 5, false, function Ring__RingSwitch)
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function TRingUpdateCon takes nothing returns boolean
	    return ( ( IsUnitEnemy(GetDyingUnit(), GetOwningPlayer(GetKillingUnitBJ())) ) and ( IsUnitAliveBJ(GetKillingUnitBJ()) ) and ( GetBasicRing(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetKillingUnitBJ()))]) != null or GetBasicRing(UDepot[GetConvertedPlayerId(GetOwningPlayer(GetKillingUnitBJ()))]) != null ) )
	endfunction
 function TRingUpdateAct takes nothing returns nothing
     local integer count= GetKillCount(GetDyingUnit())
     local integer index= GetConvertedPlayerId(GetOwningPlayer(GetKillingUnitBJ()))
     local item ring= GetBasicRing(udg_H[index])
     local unit u= udg_H[index]
     local integer i= 1
	    if ( ring == null ) then
	    	set ring=GetBasicRing(UDepot[index])
	    	set u=UDepot[index]
	    endif
	    if ( ring == null ) then
	    	set u=null
	    	return
	    endif
	    call SetItemUserData(ring, GetItemUserData(ring) + count)
//textmacro instance: ShuaRing("rat9","rlif","600")
		    if ( GetItemTypeId(ring) == 'rat9' ) then
		    	if ( GetItemUserData(ring) > 600 ) then
		    		//满了
		    		call RemoveItem(ring)
		    		if ( not ( IsUnitAliveBJ(u) ) and ( u == udg_H[index] ) ) then
		    			//死亡不在身上
		    			call UnitAddItemByIdSwapped('rlif', UDepot[index])
		    			loop
		    				exitwhen i > 6
							call DisplayTextToPlayer(GetOwningPlayer(GetKillingUnitBJ()), 0, 0, "|cFFFF66CC【鬼器】|r由于你处于死亡状态，你成功升级的鬼器转移到了你的仓库里，输入\"-H\"来召唤仓库。")
		    				set i=i + 1
		    			endloop
					else
		    			call UnitAddItemByIdSwapped('rlif', u)
		    		endif
		    	else
		    		if not ( BHintRing[index] ) then
		    			set BHintRing[index]=true
		                call DisplayTextToPlayer(GetOwningPlayer(GetKillingUnitBJ()), 0, 0, ( "|cFFFF66CC【鬼器】|r" + ( I2S(GetItemUserData(ring)) + "/600。" ) ))
		                call Ring__CreateRingTimer(GetOwningPlayer(GetKillingUnitBJ()))
		            endif
		    	endif
		    endif
//end of: ShuaRing("rat9","rlif","600")
//textmacro instance: ShuaRing("rlif","lgdh","1200")
		    if ( GetItemTypeId(ring) == 'rlif' ) then
		    	if ( GetItemUserData(ring) > 1200 ) then
		    		//满了
		    		call RemoveItem(ring)
		    		if ( not ( IsUnitAliveBJ(u) ) and ( u == udg_H[index] ) ) then
		    			//死亡不在身上
		    			call UnitAddItemByIdSwapped('lgdh', UDepot[index])
		    			loop
		    				exitwhen i > 6
							call DisplayTextToPlayer(GetOwningPlayer(GetKillingUnitBJ()), 0, 0, "|cFFFF66CC【鬼器】|r由于你处于死亡状态，你成功升级的鬼器转移到了你的仓库里，输入\"-H\"来召唤仓库。")
		    				set i=i + 1
		    			endloop
					else
		    			call UnitAddItemByIdSwapped('lgdh', u)
		    		endif
		    	else
		    		if not ( BHintRing[index] ) then
		    			set BHintRing[index]=true
		                call DisplayTextToPlayer(GetOwningPlayer(GetKillingUnitBJ()), 0, 0, ( "|cFFFF66CC【鬼器】|r" + ( I2S(GetItemUserData(ring)) + "/1200。" ) ))
		                call Ring__CreateRingTimer(GetOwningPlayer(GetKillingUnitBJ()))
		            endif
		    	endif
		    endif
//end of: ShuaRing("rlif","lgdh","1200")
//textmacro instance: ShuaRing("lgdh","clfm","1800")
		    if ( GetItemTypeId(ring) == 'lgdh' ) then
		    	if ( GetItemUserData(ring) > 1800 ) then
		    		//满了
		    		call RemoveItem(ring)
		    		if ( not ( IsUnitAliveBJ(u) ) and ( u == udg_H[index] ) ) then
		    			//死亡不在身上
		    			call UnitAddItemByIdSwapped('clfm', UDepot[index])
		    			loop
		    				exitwhen i > 6
							call DisplayTextToPlayer(GetOwningPlayer(GetKillingUnitBJ()), 0, 0, "|cFFFF66CC【鬼器】|r由于你处于死亡状态，你成功升级的鬼器转移到了你的仓库里，输入\"-H\"来召唤仓库。")
		    				set i=i + 1
		    			endloop
					else
		    			call UnitAddItemByIdSwapped('clfm', u)
		    		endif
		    	else
		    		if not ( BHintRing[index] ) then
		    			set BHintRing[index]=true
		                call DisplayTextToPlayer(GetOwningPlayer(GetKillingUnitBJ()), 0, 0, ( "|cFFFF66CC【鬼器】|r" + ( I2S(GetItemUserData(ring)) + "/1800。" ) ))
		                call Ring__CreateRingTimer(GetOwningPlayer(GetKillingUnitBJ()))
		            endif
		    	endif
		    endif
//end of: ShuaRing("lgdh","clfm","1800")
//textmacro instance: ShuaRing("clfm","bgst","2400")
		    if ( GetItemTypeId(ring) == 'clfm' ) then
		    	if ( GetItemUserData(ring) > 2400 ) then
		    		//满了
		    		call RemoveItem(ring)
		    		if ( not ( IsUnitAliveBJ(u) ) and ( u == udg_H[index] ) ) then
		    			//死亡不在身上
		    			call UnitAddItemByIdSwapped('bgst', UDepot[index])
		    			loop
		    				exitwhen i > 6
							call DisplayTextToPlayer(GetOwningPlayer(GetKillingUnitBJ()), 0, 0, "|cFFFF66CC【鬼器】|r由于你处于死亡状态，你成功升级的鬼器转移到了你的仓库里，输入\"-H\"来召唤仓库。")
		    				set i=i + 1
		    			endloop
					else
		    			call UnitAddItemByIdSwapped('bgst', u)
		    		endif
		    	else
		    		if not ( BHintRing[index] ) then
		    			set BHintRing[index]=true
		                call DisplayTextToPlayer(GetOwningPlayer(GetKillingUnitBJ()), 0, 0, ( "|cFFFF66CC【鬼器】|r" + ( I2S(GetItemUserData(ring)) + "/2400。" ) ))
		                call Ring__CreateRingTimer(GetOwningPlayer(GetKillingUnitBJ()))
		            endif
		    	endif
		    endif
//end of: ShuaRing("clfm","bgst","2400")
//textmacro instance: ShuaRing("bgst","belv","3000")
		    if ( GetItemTypeId(ring) == 'bgst' ) then
		    	if ( GetItemUserData(ring) > 3000 ) then
		    		//满了
		    		call RemoveItem(ring)
		    		if ( not ( IsUnitAliveBJ(u) ) and ( u == udg_H[index] ) ) then
		    			//死亡不在身上
		    			call UnitAddItemByIdSwapped('belv', UDepot[index])
		    			loop
		    				exitwhen i > 6
							call DisplayTextToPlayer(GetOwningPlayer(GetKillingUnitBJ()), 0, 0, "|cFFFF66CC【鬼器】|r由于你处于死亡状态，你成功升级的鬼器转移到了你的仓库里，输入\"-H\"来召唤仓库。")
		    				set i=i + 1
		    			endloop
					else
		    			call UnitAddItemByIdSwapped('belv', u)
		    		endif
		    	else
		    		if not ( BHintRing[index] ) then
		    			set BHintRing[index]=true
		                call DisplayTextToPlayer(GetOwningPlayer(GetKillingUnitBJ()), 0, 0, ( "|cFFFF66CC【鬼器】|r" + ( I2S(GetItemUserData(ring)) + "/3000。" ) ))
		                call Ring__CreateRingTimer(GetOwningPlayer(GetKillingUnitBJ()))
		            endif
		    	endif
		    endif
//end of: ShuaRing("bgst","belv","3000")
//textmacro instance: ShuaRing("belv","hcun","3600")
		    if ( GetItemTypeId(ring) == 'belv' ) then
		    	if ( GetItemUserData(ring) > 3600 ) then
		    		//满了
		    		call RemoveItem(ring)
		    		if ( not ( IsUnitAliveBJ(u) ) and ( u == udg_H[index] ) ) then
		    			//死亡不在身上
		    			call UnitAddItemByIdSwapped('hcun', UDepot[index])
		    			loop
		    				exitwhen i > 6
							call DisplayTextToPlayer(GetOwningPlayer(GetKillingUnitBJ()), 0, 0, "|cFFFF66CC【鬼器】|r由于你处于死亡状态，你成功升级的鬼器转移到了你的仓库里，输入\"-H\"来召唤仓库。")
		    				set i=i + 1
		    			endloop
					else
		    			call UnitAddItemByIdSwapped('hcun', u)
		    		endif
		    	else
		    		if not ( BHintRing[index] ) then
		    			set BHintRing[index]=true
		                call DisplayTextToPlayer(GetOwningPlayer(GetKillingUnitBJ()), 0, 0, ( "|cFFFF66CC【鬼器】|r" + ( I2S(GetItemUserData(ring)) + "/3600。" ) ))
		                call Ring__CreateRingTimer(GetOwningPlayer(GetKillingUnitBJ()))
		            endif
		    	endif
		    endif
//end of: ShuaRing("belv","hcun","3600")
//textmacro instance: ShuaRing("hcun","rag1","4200")
		    if ( GetItemTypeId(ring) == 'hcun' ) then
		    	if ( GetItemUserData(ring) > 4200 ) then
		    		//满了
		    		call RemoveItem(ring)
		    		if ( not ( IsUnitAliveBJ(u) ) and ( u == udg_H[index] ) ) then
		    			//死亡不在身上
		    			call UnitAddItemByIdSwapped('rag1', UDepot[index])
		    			loop
		    				exitwhen i > 6
							call DisplayTextToPlayer(GetOwningPlayer(GetKillingUnitBJ()), 0, 0, "|cFFFF66CC【鬼器】|r由于你处于死亡状态，你成功升级的鬼器转移到了你的仓库里，输入\"-H\"来召唤仓库。")
		    				set i=i + 1
		    			endloop
					else
		    			call UnitAddItemByIdSwapped('rag1', u)
		    		endif
		    	else
		    		if not ( BHintRing[index] ) then
		    			set BHintRing[index]=true
		                call DisplayTextToPlayer(GetOwningPlayer(GetKillingUnitBJ()), 0, 0, ( "|cFFFF66CC【鬼器】|r" + ( I2S(GetItemUserData(ring)) + "/4200。" ) ))
		                call Ring__CreateRingTimer(GetOwningPlayer(GetKillingUnitBJ()))
		            endif
		    	endif
		    endif
//end of: ShuaRing("hcun","rag1","4200")
//textmacro instance: ShuaRing("rag1","penr","4800")
		    if ( GetItemTypeId(ring) == 'rag1' ) then
		    	if ( GetItemUserData(ring) > 4800 ) then
		    		//满了
		    		call RemoveItem(ring)
		    		if ( not ( IsUnitAliveBJ(u) ) and ( u == udg_H[index] ) ) then
		    			//死亡不在身上
		    			call UnitAddItemByIdSwapped('penr', UDepot[index])
		    			loop
		    				exitwhen i > 6
							call DisplayTextToPlayer(GetOwningPlayer(GetKillingUnitBJ()), 0, 0, "|cFFFF66CC【鬼器】|r由于你处于死亡状态，你成功升级的鬼器转移到了你的仓库里，输入\"-H\"来召唤仓库。")
		    				set i=i + 1
		    			endloop
					else
		    			call UnitAddItemByIdSwapped('penr', u)
		    		endif
		    	else
		    		if not ( BHintRing[index] ) then
		    			set BHintRing[index]=true
		                call DisplayTextToPlayer(GetOwningPlayer(GetKillingUnitBJ()), 0, 0, ( "|cFFFF66CC【鬼器】|r" + ( I2S(GetItemUserData(ring)) + "/4800。" ) ))
		                call Ring__CreateRingTimer(GetOwningPlayer(GetKillingUnitBJ()))
		            endif
		    	endif
		    endif
//end of: ShuaRing("rag1","penr","4800")
//textmacro instance: ShuaRing("penr","brac","5400")
		    if ( GetItemTypeId(ring) == 'penr' ) then
		    	if ( GetItemUserData(ring) > 5400 ) then
		    		//满了
		    		call RemoveItem(ring)
		    		if ( not ( IsUnitAliveBJ(u) ) and ( u == udg_H[index] ) ) then
		    			//死亡不在身上
		    			call UnitAddItemByIdSwapped('brac', UDepot[index])
		    			loop
		    				exitwhen i > 6
							call DisplayTextToPlayer(GetOwningPlayer(GetKillingUnitBJ()), 0, 0, "|cFFFF66CC【鬼器】|r由于你处于死亡状态，你成功升级的鬼器转移到了你的仓库里，输入\"-H\"来召唤仓库。")
		    				set i=i + 1
		    			endloop
					else
		    			call UnitAddItemByIdSwapped('brac', u)
		    		endif
		    	else
		    		if not ( BHintRing[index] ) then
		    			set BHintRing[index]=true
		                call DisplayTextToPlayer(GetOwningPlayer(GetKillingUnitBJ()), 0, 0, ( "|cFFFF66CC【鬼器】|r" + ( I2S(GetItemUserData(ring)) + "/5400。" ) ))
		                call Ring__CreateRingTimer(GetOwningPlayer(GetKillingUnitBJ()))
		            endif
		    	endif
		    endif
//end of: ShuaRing("penr","brac","5400")
	    set ring=null
	    set u=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function TRingMaxCon takes nothing returns boolean
	    return ( ( IsUnitEnemy(GetDyingUnit(), GetOwningPlayer(GetKillingUnitBJ())) == true ) and ( IsUnitAliveBJ(GetKillingUnitBJ()) == true ) and GetMaxRing(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetKillingUnitBJ()))]) != null )
	endfunction
 function TRingMaxAct takes nothing returns nothing
     local integer count= GetKillCount(GetDyingUnit())
     local integer index= GetConvertedPlayerId(GetOwningPlayer(GetKillingUnitBJ()))
     local item ring= GetMaxRing(udg_H[index])
	    call SetItemUserData(ring, GetItemUserData(ring) + count)
//textmacro instance: ShuaRingMax("brac","5000")
		    if ( GetItemTypeId(ring) == 'brac' ) then
		    	if ( GetItemUserData(ring) > 1000 ) then
		    		call SetItemCharges(ring, GetItemCharges(ring) + 1)
         call SaveRingAchievement(GetOwningPlayer(GetKillingUnitBJ()) , GetItemCharges(ring))
	   				call SetItemUserData(ring, 0)
					call AddHero3W(udg_H[index] , 5000)
    				call TriggerExecute(gg_trg_papa8____________u)
   					call TriggerExecute(gg_trg_papa10____________u)
    				call TriggerExecute(gg_trg_papa9____________u)
    				call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Avatar\\AvatarCaster.mdl", GetUnitX(udg_H[index]), GetUnitY(udg_H[index])))
		    	else
		    		if not ( BHintRing[index] ) then
		    			set BHintRing[index]=true
		                call DisplayTextToPlayer(GetOwningPlayer(GetKillingUnitBJ()), 0, 0, ( "|cFFFF66CC【鬼器】|r" + ( I2S(GetItemUserData(ring)) + "/1000。" ) ))
		                call Ring__CreateRingTimer(GetOwningPlayer(GetKillingUnitBJ()))
		            endif
		    	endif
		    endif
//end of: ShuaRingMax("brac","5000")
//textmacro instance: ShuaRingMax("I05W","13000")
		    if ( GetItemTypeId(ring) == 'I05W' ) then
		    	if ( GetItemUserData(ring) > 1000 ) then
		    		call SetItemCharges(ring, GetItemCharges(ring) + 1)
         call SaveRingAchievement(GetOwningPlayer(GetKillingUnitBJ()) , GetItemCharges(ring))
	   				call SetItemUserData(ring, 0)
					call AddHero3W(udg_H[index] , 13000)
    				call TriggerExecute(gg_trg_papa8____________u)
   					call TriggerExecute(gg_trg_papa10____________u)
    				call TriggerExecute(gg_trg_papa9____________u)
    				call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Avatar\\AvatarCaster.mdl", GetUnitX(udg_H[index]), GetUnitY(udg_H[index])))
		    	else
		    		if not ( BHintRing[index] ) then
		    			set BHintRing[index]=true
		                call DisplayTextToPlayer(GetOwningPlayer(GetKillingUnitBJ()), 0, 0, ( "|cFFFF66CC【鬼器】|r" + ( I2S(GetItemUserData(ring)) + "/1000。" ) ))
		                call Ring__CreateRingTimer(GetOwningPlayer(GetKillingUnitBJ()))
		            endif
		    	endif
		    endif
//end of: ShuaRingMax("I05W","13000")
//textmacro instance: ShuaRingMax("I05V","10000")
		    if ( GetItemTypeId(ring) == 'I05V' ) then
		    	if ( GetItemUserData(ring) > 1000 ) then
		    		call SetItemCharges(ring, GetItemCharges(ring) + 1)
         call SaveRingAchievement(GetOwningPlayer(GetKillingUnitBJ()) , GetItemCharges(ring))
	   				call SetItemUserData(ring, 0)
					call AddHero3W(udg_H[index] , 10000)
    				call TriggerExecute(gg_trg_papa8____________u)
   					call TriggerExecute(gg_trg_papa10____________u)
    				call TriggerExecute(gg_trg_papa9____________u)
    				call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Avatar\\AvatarCaster.mdl", GetUnitX(udg_H[index]), GetUnitY(udg_H[index])))
		    	else
		    		if not ( BHintRing[index] ) then
		    			set BHintRing[index]=true
		                call DisplayTextToPlayer(GetOwningPlayer(GetKillingUnitBJ()), 0, 0, ( "|cFFFF66CC【鬼器】|r" + ( I2S(GetItemUserData(ring)) + "/1000。" ) ))
		                call Ring__CreateRingTimer(GetOwningPlayer(GetKillingUnitBJ()))
		            endif
		    	endif
		    endif
//end of: ShuaRingMax("I05V","10000")
//textmacro instance: ShuaRingMax("I07M","16000")
		    if ( GetItemTypeId(ring) == 'I07M' ) then
		    	if ( GetItemUserData(ring) > 1000 ) then
		    		call SetItemCharges(ring, GetItemCharges(ring) + 1)
         call SaveRingAchievement(GetOwningPlayer(GetKillingUnitBJ()) , GetItemCharges(ring))
	   				call SetItemUserData(ring, 0)
					call AddHero3W(udg_H[index] , 16000)
    				call TriggerExecute(gg_trg_papa8____________u)
   					call TriggerExecute(gg_trg_papa10____________u)
    				call TriggerExecute(gg_trg_papa9____________u)
    				call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Avatar\\AvatarCaster.mdl", GetUnitX(udg_H[index]), GetUnitY(udg_H[index])))
		    	else
		    		if not ( BHintRing[index] ) then
		    			set BHintRing[index]=true
		                call DisplayTextToPlayer(GetOwningPlayer(GetKillingUnitBJ()), 0, 0, ( "|cFFFF66CC【鬼器】|r" + ( I2S(GetItemUserData(ring)) + "/1000。" ) ))
		                call Ring__CreateRingTimer(GetOwningPlayer(GetKillingUnitBJ()))
		            endif
		    	endif
		    endif
//end of: ShuaRingMax("I07M","16000")
//textmacro instance: ShuaRingMax("I07L","13000")
		    if ( GetItemTypeId(ring) == 'I07L' ) then
		    	if ( GetItemUserData(ring) > 1000 ) then
		    		call SetItemCharges(ring, GetItemCharges(ring) + 1)
         call SaveRingAchievement(GetOwningPlayer(GetKillingUnitBJ()) , GetItemCharges(ring))
	   				call SetItemUserData(ring, 0)
					call AddHero3W(udg_H[index] , 13000)
    				call TriggerExecute(gg_trg_papa8____________u)
   					call TriggerExecute(gg_trg_papa10____________u)
    				call TriggerExecute(gg_trg_papa9____________u)
    				call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Avatar\\AvatarCaster.mdl", GetUnitX(udg_H[index]), GetUnitY(udg_H[index])))
		    	else
		    		if not ( BHintRing[index] ) then
		    			set BHintRing[index]=true
		                call DisplayTextToPlayer(GetOwningPlayer(GetKillingUnitBJ()), 0, 0, ( "|cFFFF66CC【鬼器】|r" + ( I2S(GetItemUserData(ring)) + "/1000。" ) ))
		                call Ring__CreateRingTimer(GetOwningPlayer(GetKillingUnitBJ()))
		            endif
		    	endif
		    endif
//end of: ShuaRingMax("I07L","13000")
//textmacro instance: ShuaRingMax("lhst","10000")
		    if ( GetItemTypeId(ring) == 'lhst' ) then
		    	if ( GetItemUserData(ring) > 1000 ) then
		    		call SetItemCharges(ring, GetItemCharges(ring) + 1)
         call SaveRingAchievement(GetOwningPlayer(GetKillingUnitBJ()) , GetItemCharges(ring))
	   				call SetItemUserData(ring, 0)
					call AddHero3W(udg_H[index] , 10000)
    				call TriggerExecute(gg_trg_papa8____________u)
   					call TriggerExecute(gg_trg_papa10____________u)
    				call TriggerExecute(gg_trg_papa9____________u)
    				call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Avatar\\AvatarCaster.mdl", GetUnitX(udg_H[index]), GetUnitY(udg_H[index])))
		    	else
		    		if not ( BHintRing[index] ) then
		    			set BHintRing[index]=true
		                call DisplayTextToPlayer(GetOwningPlayer(GetKillingUnitBJ()), 0, 0, ( "|cFFFF66CC【鬼器】|r" + ( I2S(GetItemUserData(ring)) + "/1000。" ) ))
		                call Ring__CreateRingTimer(GetOwningPlayer(GetKillingUnitBJ()))
		            endif
		    	endif
		    endif
//end of: ShuaRingMax("lhst","10000")
	    set ring=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Ring__TRingUseCon takes nothing returns boolean
		return IsMaxRing(GetManipulatedItem())
	endfunction
 function Ring__TRingUseAct takes nothing returns nothing
		call SetItemCharges(GetManipulatedItem(), ( GetItemCharges(GetManipulatedItem()) + 1 ))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Ring__InitRing takes nothing returns nothing
  local integer i= 1
     local trigger t= CreateTrigger()
		loop
			exitwhen i > 6
			if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) ) then
				set BHintRing[i]=false
			endif
			set i=i + 1
		endloop
	    call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_DEATH)
	    call TriggerAddCondition(t, Condition(function TRingUpdateCon))
	    call TriggerAddAction(t, function TRingUpdateAct)
	    set t=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_DEATH)
	    call TriggerAddCondition(t, Condition(function TRingMaxCon))
	    call TriggerAddAction(t, function TRingMaxAct)
	    //使用戒指闪烁后
	    set t=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_USE_ITEM)
	    call TriggerAddCondition(t, Condition(function Ring__TRingUseCon))
	    call TriggerAddAction(t, function Ring__TRingUseAct)
	    set t=null
	endfunction

//library Ring ends
//library Spin:
//---------------------------------------------------------------------------------------------------
	
 function Spin___CreateFanzhuanItemTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local item it= LoadItemHandle(LHTable, id, 1)
		if ( it != null ) then
			call RemoveItem(it)
		endif
		call PauseTimer(t)
		call FlushChildHashtable(LHTable, id)
		call DestroyTimer(t)
		set it=null
		set t=null
	endfunction
 function CreateFanzhuanItem takes unit u returns nothing
     local timer t= CreateTimer()
    	call SaveItemHandle(LHTable, GetHandleId(t), 1, UnitAddItemByIdSwapped(GetFanzhuanItemType(u), u))
    	call TimerStart(t, 60, false, function Spin___CreateFanzhuanItemTimer)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsSeyuSpin1 takes player p returns boolean
		return ( not ( BCancelSpin[GetConvertedPlayerId(p)] ) ) and ( GetSeyu1Spin(p) )
		//return true
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsXiaoyueSpin1 takes player p returns boolean
		return ( not ( BCancelSpin[GetConvertedPlayerId(p)] ) ) and ( GetXiaoyue1Spin(p) )
		//return true
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsYanmieSpin1 takes player p returns boolean
		return ( not ( BCancelSpin[GetConvertedPlayerId(p)] ) ) and ( GetYanmie1Spin(p) )
		//return true
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsXuanxueSpin1 takes player p returns boolean
		return ( not ( BCancelSpin[GetConvertedPlayerId(p)] ) ) and ( GetXuanxue1Spin(p) )
		//return true
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsTaiyaSpin1 takes player p returns boolean
		return ( not ( BCancelSpin[GetConvertedPlayerId(p)] ) ) and ( GetTaiya1Spin(p) )
		//return true
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsHanshangSpin1 takes player p returns boolean
		return ( not ( BCancelSpin[GetConvertedPlayerId(p)] ) ) and ( GetHanshang1Spin(p) )
		//return true
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsChenjiSpin1 takes player p returns boolean
		return ( not ( BCancelSpin[GetConvertedPlayerId(p)] ) ) and ( GetChenji1Spin(p) )
		//return true
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsChenjiSpin2 takes player p returns boolean
		return ( not ( BCancelSpin[GetConvertedPlayerId(p)] ) ) and ( GetChenji2Spin(p) )
		//return true
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsLingxueSpin1 takes player p returns boolean
		return ( not ( BCancelSpin[GetConvertedPlayerId(p)] ) ) and ( GetLingxue1Spin(p) )
		//return true
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsMoqiSpin1 takes player p returns boolean
		return ( not ( BCancelSpin[GetConvertedPlayerId(p)] ) ) and ( GetMoqiSpin(p) )
		//return true
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsKaisaSpin1 takes player p returns boolean
		return ( not ( BCancelSpin[GetConvertedPlayerId(p)] ) ) and ( GetKaisaSpin(p) )
		//return true
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsXuanxueSpin2 takes player p returns boolean
		return ( not ( BCancelSpin[GetConvertedPlayerId(p)] ) ) and ( GetXuanxue2Spin(p) )
		//return true
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsBajueSpin1 takes player p returns boolean
		return ( not ( BCancelSpin[GetConvertedPlayerId(p)] ) ) and ( GetBajue1Spin(p) )
		//return true
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsSheyanSpin1 takes player p returns boolean
		return ( not ( BCancelSpin[GetConvertedPlayerId(p)] ) ) and ( GetSheyan1Spin(p) )
		//return true
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsHuanyiSpin1 takes player p returns boolean
		return ( not ( BCancelSpin[GetConvertedPlayerId(p)] ) ) and ( GetHuanyi1Spin(p) )
		//return true
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsSichenSpin1 takes player p returns boolean
		return ( not ( BCancelSpin[GetConvertedPlayerId(p)] ) ) and ( GetSichen1Spin(p) )
		//return true
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsCanglingSpin1 takes player p returns boolean
		return ( not ( BCancelSpin[GetConvertedPlayerId(p)] ) ) and ( GetCangling1Spin(p) )
		//return true
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsHeiyanSpin1 takes player p returns boolean
		return ( not ( BCancelSpin[GetConvertedPlayerId(p)] ) ) and ( GetHeiyan1Spin(p) )
		//return true
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsHanshangSpin2 takes player p returns boolean
		return ( not ( BCancelSpin[GetConvertedPlayerId(p)] ) ) and ( GetHanshang2Spin(p) )
		//return true
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsLichiSpin1 takes player p returns boolean
		return ( not ( BCancelSpin[GetConvertedPlayerId(p)] ) ) and ( GetLichi1Spin(p) )
		//return true
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsXinglongSpin1 takes player p returns boolean
		return ( not ( BCancelSpin[GetConvertedPlayerId(p)] ) ) and ( GetXinglong1Spin(p) )
		//return true
	endfunction

//library Spin ends
//library Bajue:
//---------------------------------------------------------------------------------------------------
	
 function InitFengshuang takes nothing returns nothing
		set Bajue__baseX=0.
		set Bajue__baseY=0.
		set Bajue__tempX=0.
		set Bajue__tempY=0.
		set Bajue__BFengshuang=true
	endfunction
	//开始
 function StartFengshuang takes nothing returns nothing
		if not ( Bajue__BFengshuang ) then
			return
		endif
		if ( GetBajue1Spin(GetOwningPlayer(bajue)) ) then
			return
		endif
		if ( GetTriggerUnit() == bajue ) then
			set Bajue__baseX=GetUnitX(bajue)
			set Bajue__baseY=GetUnitY(bajue)
			set Bajue__tempX=GetUnitX(bajue)
			set Bajue__tempY=GetUnitY(bajue)
			set Bajue__BFengshuangStart=true
		endif
	endfunction
	//结束判定
 function EndFengshuang takes nothing returns nothing
  local real distance= 0.
		if not ( Bajue__BFengshuang ) then
			return
		endif
		if not ( Bajue__BFengshuangStart ) then
			return
		endif
		set distance=GetDistance(Bajue__baseX , Bajue__baseY , Bajue__tempX , Bajue__tempY)
		call BJDebugMsg("|cFFFF66CC【消息】|r本次技能跳跃距离为" + R2S(distance) + ".")
		if ( distance > 8000. ) then
    call SetBajueSpinOK(GetOwningPlayer(bajue))
		endif
		set Bajue__baseX=0.
		set Bajue__baseY=0.
		set Bajue__tempX=0.
		set Bajue__tempY=0.
		set Bajue__BFengshuangStart=false
	endfunction
	//中途检测
 function JudgeFengshuang takes nothing returns nothing
		if not ( Bajue__BFengshuang ) then
			return
		endif
		if not ( Bajue__BFengshuangStart ) then
			return
		endif
		if ( GetDistance(GetUnitX(bajue) , GetUnitY(bajue) , Bajue__tempX , Bajue__tempY) < 1100 ) then
			set Bajue__tempX=GetUnitX(bajue)
			set Bajue__tempY=GetUnitY(bajue)
		else
			call EndFengshuang()
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsBajueSpin takes nothing returns boolean
		return GetUnitTypeId(bajue) == 'N01W'
	endfunction
 function GetBajueJiaType takes nothing returns integer
		return I3(IsBajueSpin() , 'N01X' , 'N018')
	endfunction
 function Bajue__InitBajueSpin takes unit u returns unit
		if ( IsBajueSpin1(GetOwningPlayer(u)) ) then
			set udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]=CreateUnit(GetOwningPlayer(u), 'N01W', GetUnitX(u), GetUnitY(u), 0)
			set gg_unit_Nbbc_0235=udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
			call UnitAddItemByIdSwapped('I006', udg_H[GetConvertedPlayerId(GetOwningPlayer(u))])
			call AddSpellPercent(GetConvertedPlayerId(GetOwningPlayer(u)) , 0.1)
			call SetUnitManaPercentBJ(udg_H[GetConvertedPlayerId(GetOwningPlayer(u))], 1000)
			call RemoveUnit(u)
			return udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
		else
			return u
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitBajue takes unit u returns nothing
		set bajue=Bajue__InitBajueSpin(u)
	endfunction

//library Bajue ends
//library Cangling:
//---------------------------------------------------------------------------------------------------
	
 function IsCanglingSpin takes nothing returns boolean
		return GetUnitTypeId(cangling) == 'N023'
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsSwitchItemCangling takes unit u,item it returns boolean
  local integer i= I3(Cangling__BiBo , 7 , 1)
		if ( u != cangling ) then
			return true
		endif
		if not ( IsItemPawnable(it) ) then
			return true
		endif
		loop
			exitwhen i > I3(Cangling__BiBo , 12 , 6)
			if ( it == IBibo[i] ) then
				return false
			endif
			set i=i + 1
		endloop
		return true
	endfunction
//---------------------------------------------------------------------------------------------------
	
	
//---------------------------------------------------------------------------------------------------
	
 function Cangling__BiBoBaoZhuo takes nothing returns nothing
  local integer i= 1
  local integer ii= 1
  local integer iii
  local integer iiii= 1
  local item temp= null
		//判断是否有不可丢弃的法魂
		loop
			exitwhen iiii > 6
			if ( IsZhanfahun(UnitItemInSlotBJ(cangling, iiii)) and not ( IsItemPawnable(UnitItemInSlotBJ(cangling, iiii)) ) ) then
				call DisplayTextToPlayer(GetOwningPlayer(cangling), 0., 0., "|cFFFF66CC【消息】|r战魂与法魂冷却期间不能切换装备栏,请等冷却结束.")
				return
			endif
			set iiii=iiii + 1
		endloop
		//保存装备
		loop
			exitwhen i > 6
			set IBibo[i + I3(Cangling__BiBo , 6 , 0)]=UnitItemInSlotBJ(cangling, i)
			set i=i + 1
		endloop
		//丢弃装备
		loop
			exitwhen ii > 6
			set temp=UnitItemInSlotBJ(cangling, ii)
			//call UnitRemoveItemSwapped(temp,mengji)
			call SetItemPosition(temp, 0, 0)
			call SetItemVisible(temp, false)
			set ii=ii + 1
		endloop
		set Cangling__BiBo=not ( Cangling__BiBo )
		//获得装备
		set iii=I3(Cangling__BiBo , 7 , 1)
		loop
			exitwhen iii > I3(Cangling__BiBo , 12 , 6)
			call UnitAddItem(cangling, IBibo[iii])
			set IBibo[iii]=null
			set iii=iii + 1
		endloop
		set temp=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Cangling__BiBoBaoZhuoTimer takes nothing returns nothing
		if ( IsUnitAliveBJ(cangling) ) then
			if ( GetUnitState(cangling, UNIT_STATE_LIFE) < ( 0.05 + RJ1(cangling , 0.05 , 0) + RJ2(cangling , 0.05 , 0) ) * GetUnitState(cangling, UNIT_STATE_MAX_LIFE) ) then
				call SetUnitLifePercentBJ(cangling, 10)
			endif
		endif
		if ( IsUnitAliveBJ(Cangling__UCangFeng) ) then
			if ( GetUnitState(Cangling__UCangFeng, UNIT_STATE_LIFE) < ( 0.05 + RJ1(cangling , 0.05 , 0) + RJ2(cangling , 0.05 , 0) ) * GetUnitState(Cangling__UCangFeng, UNIT_STATE_MAX_LIFE) ) then
				call SetUnitLifePercentBJ(Cangling__UCangFeng, 10)
			endif
		endif
		if ( IsUnitAliveBJ(Cangling__UCangHuo) ) then
			if ( GetUnitState(Cangling__UCangHuo, UNIT_STATE_LIFE) < ( 0.05 + RJ1(cangling , 0.05 , 0) + RJ2(cangling , 0.05 , 0) ) * GetUnitState(Cangling__UCangHuo, UNIT_STATE_MAX_LIFE) ) then
				call SetUnitLifePercentBJ(Cangling__UCangHuo, 10)
			endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SimulateDamageCangling takes unit u returns boolean
		if ( GetUnitTypeId(u) == 'h00V' ) then
			call UnitDamageTarget(cangling, GetTriggerUnit(), GetDamageAgi(cangling) * 0.33, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
			if ( IsUnitDeadBJ(GetTriggerUnit()) ) then
				call SetUnitUserData(GetEventDamageSource(), GetUnitUserData(GetEventDamageSource()) + 1)
				if ( GetUnitUserData(GetEventDamageSource()) >= 750 ) then
      call SetCanglingSpinOK(GetOwningPlayer(cangling))
				endif
			endif
			return true
		endif
		if ( GetUnitTypeId(u) == 'h00W' ) then
			call UnitDamageTarget(cangling, GetTriggerUnit(), GetDamageAgi(cangling) * 0.35, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
			return true
		endif
		if ( GetUnitTypeId(u) == 'h00Y' ) then
			call SimulateSpell(GetEventDamageSource() , GetTriggerUnit() , 'A0HU' , 1 , 5 , "hex" , false , false , true)
			return true
		endif
		return false
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Cangling__BuMieZhenYanTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local unit u= LoadUnitHandle(spellTable, id, 1)
  local texttag tt= LoadTextTagHandle(spellTable, id, 2)
  local integer value= GetUnitUserData(u) - 1
		if ( value > 0 ) then
			call SetTextTagTextBJ(tt, I2S(value) + "秒", 20)
			call SetUnitUserData(u, value)
		else
			call RemoveUnit(u)
			call DestroyTextTag(tt)
			call PauseTimer(t)
			call FlushChildHashtable(spellTable, id)
			call DestroyTimer(t)
		endif
		set u=null
		set t=null
		set tt=null
	endfunction
 function Cangling__BuMieZhenYan takes integer lifeTime,integer abilityID,real x,real y returns nothing
  local real damage= GetDamageAgi(cangling) * 0.4
  local timer t= CreateTimer()
  local unit u= CreateUnit(GetOwningPlayer(cangling), 'h00V', x, y, 270)
		call SetUnitUserData(u, lifeTime + I3(IsCanglingSpin() , 1 , 0))
		call SaveUnitHandle(spellTable, GetHandleId(t), 1, u)
		call SaveTextTagHandle(spellTable, GetHandleId(t), 2, CreateTextTagUnitBJ(I2S(lifeTime + I3(IsCanglingSpin() , 1 , 0)) + "秒", u, 0, 20, 100, 0, 100, 0))
		call TimerStart(t, 1, true, function Cangling__BuMieZhenYanTimer)
	    call PrintSpell(GetOwningPlayer(cangling) , GetAbilityName(abilityID) , damage)
	    set u=null
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Cangling__LianJieDiMeng takes nothing returns nothing
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\ReviveHuman\\ReviveHuman.mdl", GetUnitX(cangling), GetUnitY(cangling)))
	    call PrintSpellContent(GetOwningPlayer(cangling) , GetAbilityName('A0HJ') , "结盟成功！")
    	call SetPlayerAllianceStateBJ(Player(11), GetOwningPlayer(cangling), bj_ALLIANCE_ALLIED_VISION)
    	call SetPlayerAllianceStateBJ(Player(10), GetOwningPlayer(cangling), bj_ALLIANCE_ALLIED_VISION)
    	call ImmuteDamageInterval(cangling , 1)
    	call YDWEPolledWaitNull(10)
    	call SetPlayerAllianceStateBJ(Player(11), GetOwningPlayer(cangling), bj_ALLIANCE_UNALLIED)
    	call SetPlayerAllianceStateBJ(Player(10), GetOwningPlayer(cangling), bj_ALLIANCE_UNALLIED)
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\ReviveHuman\\ReviveHuman.mdl", GetUnitX(cangling), GetUnitY(cangling)))
	    call PrintSpellContent(GetOwningPlayer(cangling) , GetAbilityName('A0HJ') , "结盟结束！")
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Cangling__TSpellCangling2Con takes nothing returns boolean
		return ( GetAttacker() == cangling or ( GetAttacker() == Cangling__UCangFeng and Cangling__UCangFeng != null ) or ( GetAttacker() == Cangling__UCangHuo and Cangling__UCangHuo != null ) ) and IsSecondSpellOK(cangling) == true and GetUnitState(cangling, UNIT_STATE_MANA) >= 250 and GetUnitAbilityLevel(cangling, 'A0HJ') == 1 and GetRandomInt(1, 20) == 1
	endfunction
 function Cangling__TSpellCangling2Act takes nothing returns nothing
		call DisableTrigger(GetTriggeringTrigger())
		call Cangling__BuMieZhenYan(2 , 'A0HJ' , GetUnitX(GetAttackedUnitBJ()) , GetUnitY(GetAttackedUnitBJ()))
		call YDWEPolledWaitNull(5)
		call EnableTrigger(GetTriggeringTrigger())
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Cangling__DestroyGuangYin takes nothing returns nothing
		if ( Cangling__TGuang != null ) then
			call PauseTimer(Cangling__TGuang)
			call DestroyTimer(Cangling__TGuang)
			set Cangling__TGuang=null
		endif
		if ( Cangling__EGuang != null ) then
			call DestroyEffect(Cangling__EGuang)
			set Cangling__EGuang=null
		endif
		set Cangling__UGuang=null
		set Cangling__RGuang=0.
		set Cangling__IGuang=0
	endfunction
 function Cangling__GuangYinWuSuoTimer takes nothing returns nothing
		set Cangling__IGuang=Cangling__IGuang - 1
		if ( IsUnitAliveBJ(Cangling__UGuang) and Cangling__IGuang > 0 ) then
			call UnitDamageTarget(cangling, Cangling__UGuang, GetDamageAgi(cangling) * Cangling__RGuang, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
	    	call CreateSpellTextTag(I2S(R2I(Cangling__RGuang * 100)) + "%X!" , Cangling__UGuang , 0 , 100 , 0 , 4)
		else
			call Cangling__DestroyGuangYin()
		endif
	endfunction
 function Cangling__GuangYinWuSuo takes nothing returns nothing
		if ( Cangling__UGuang != GetSpellTargetUnit() ) then
			call Cangling__DestroyGuangYin()
			set Cangling__UGuang=GetSpellTargetUnit()
		endif
		set Cangling__RGuang=R3(Cangling__RGuang == 0. , 0.3 , Cangling__RGuang + 0.1)
		set Cangling__IGuang=10
		if ( Cangling__TGuang == null ) then
			set Cangling__TGuang=CreateTimer()
			call TimerStart(Cangling__TGuang, 1, true, function Cangling__GuangYinWuSuoTimer)
		endif
		if ( Cangling__EGuang == null ) then
			set Cangling__EGuang=AddSpecialEffectTargetUnitBJ("head", GetSpellTargetUnit(), "Abilities\\Spells\\NightElf\\shadowstrike\\shadowstrike.mdl")
		endif
	    call PrintSpellContent(GetOwningPlayer(cangling) , GetAbilityName('A0HK') , "百分比伤害" + I2S(R2I(Cangling__RGuang * 100)) + "%!")
	endfunction
//---------------------------------------------------------------------------------------------------
	
    function Cangling__GuangyinResetTimer takes nothing returns nothing
     local timer t= GetExpiredTimer()
     local integer id= GetHandleId(t)
     local integer pID= LoadInteger(spellTable, id, 1)
    	set Cangling__BWusuo[pID]=false
		call PauseTimer(t)
		call FlushChildHashtable(spellTable, id)
		call DestroyTimer(t)
    	set t=null
    endfunction
    function Cangling__StartTimerGuangyin takes unit u returns nothing
     local timer t= CreateTimer()
	    call SaveInteger(spellTable, GetHandleId(t), 1, GetConvertedPlayerId(GetOwningPlayer(u)))
	    call TimerStart(t, 42, false, function Cangling__GuangyinResetTimer)
	    set t=null
    endfunction
 function IsGuangyinRevive takes nothing returns boolean
		if ( GetUnitAbilityLevel(gg_unit_n01S_0258, 'A0HR') == 1 and not ( Cangling__BWusuo[GetConvertedPlayerId(GetOwningPlayer(GetDyingUnit()))] ) ) then
			set Cangling__BWusuo[GetConvertedPlayerId(GetOwningPlayer(GetDyingUnit()))]=true
			call BJDebugMsg("|cFFFF66CC【消息】|r" + GetPlayerName(GetOwningPlayer(GetDyingUnit())) + "被" + GetUnitName(GetKillingUnitBJ()) + "干掉了，被|cff808000光阴无梭|r救起,等待3秒原地复活.")
		    call YDWEPolledWaitNull(3.00)
		    call Cangling__StartTimerGuangyin(GetDyingUnit())
		    call ReviveHero(GetDyingUnit(), GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit()), true)
		    call SetUnitManaBJ(GetDyingUnit(), 0.5 * GetUnitState(GetDyingUnit(), UNIT_STATE_MAX_MANA))
			return true
		else
			return false
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Cangling__ZiLeiHuTi takes nothing returns nothing
		if ( Cangling__UCangFeng != null ) then
			if ( IsUnitAliveBJ(Cangling__UCangFeng) ) then
	    		call DamageArea(cangling , GetUnitX(Cangling__UCangFeng) , GetUnitY(Cangling__UCangFeng) , 450 , GetDamageAgi(cangling) * 0.2)
			endif
		else
		    call PauseTimer(GetExpiredTimer())
		    call DestroyTimer(GetExpiredTimer())
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Cangling__YangYanWuShuang takes nothing returns nothing
  local group l_group= YDWEGetUnitsOfTypeIdAllNull('h00V')
  local unit l_unit= null
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl", GetUnitX(GetSpellAbilityUnit()), GetUnitY(GetSpellAbilityUnit())))
		loop
		    set l_unit=FirstOfGroup(l_group)
		    exitwhen l_unit == null
		    call GroupRemoveUnit(l_group, l_unit)
	    	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl", GetUnitX(l_unit), GetUnitY(l_unit)))
			call SetUnitUserData(l_unit, GetUnitUserData(l_unit) + 6)
		endloop
		call DestroyGroup(l_group)
		set l_group=null
		set l_unit=null
	    call PrintSpellContent(GetOwningPlayer(cangling) , GetAbilityName('A0HS') , "成功续命6秒！")
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Cangling__YiQiSanHuaTimer takes nothing returns nothing
	    call PrintSpellContent(GetOwningPlayer(cangling) , GetAbilityName('A0HL') , "技能时间结束！")
	    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\FrostNova\\FrostNovaTarget.mdl", GetUnitX(Cangling__UCangFeng), GetUnitY(Cangling__UCangFeng)))
	    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl", GetUnitX(Cangling__UCangHuo), GetUnitY(Cangling__UCangHuo)))
	    call FlushChildHashtable(YDHT, GetHandleId(Cangling__UCangFeng))
	    call FlushChildHashtable(YDHT, GetHandleId(Cangling__UCangHuo))
	    call RemoveUnit(Cangling__UCangFeng)
	    call RemoveUnit(Cangling__UCangHuo)
	    set Cangling__UCangHuo=null
	    set Cangling__UCangFeng=null
	    call PauseTimer(GetExpiredTimer())
	    call DestroyTimer(GetExpiredTimer())
	endfunction
 function Cangling__YiQiSanHua takes nothing returns nothing
	    call PrintSpellName(GetOwningPlayer(cangling) , GetAbilityName('A0HL'))
	    set Cangling__UCangFeng=CreateUnit(GetOwningPlayer(cangling), 'Ogld', YDWECoordinateX(GetUnitX(cangling) + GetRandomReal(- 200, 200)), YDWECoordinateY(GetUnitY(cangling) + GetRandomReal(- 200, 200)), 0)
	    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\FrostNova\\FrostNovaTarget.mdl", GetUnitX(Cangling__UCangFeng), GetUnitY(Cangling__UCangFeng)))
	    call SetHeroInt(Cangling__UCangFeng, GetHeroInt(cangling, true), true)
	    call SetHeroAgi(Cangling__UCangFeng, GetHeroAgi(cangling, true), true)
	    call SetHeroStr(Cangling__UCangFeng, GetHeroStr(cangling, true), true)
	    call SetHeroLevel(Cangling__UCangFeng, GetHeroLevel(cangling), false)
	    call SelectHeroSkill(Cangling__UCangFeng, 'A0HI')
	    call SelectHeroSkill(Cangling__UCangFeng, 'A0HJ')
	    call SelectHeroSkill(Cangling__UCangFeng, 'A0HK')
	    call SetAttack(Cangling__UCangFeng , GetAttack(cangling))
	    call SetDefense(Cangling__UCangFeng , GetDefense(cangling))
	    call SetHP(Cangling__UCangFeng , GetHP(cangling))
	    set Cangling__UCangHuo=CreateUnit(GetOwningPlayer(cangling), 'Orex', YDWECoordinateX(GetUnitX(cangling) + GetRandomReal(- 200, 200)), YDWECoordinateY(GetUnitY(cangling) + GetRandomReal(- 200, 200)), 0)
	    call SetHeroInt(Cangling__UCangHuo, GetHeroInt(cangling, true), true)
	    call SetHeroAgi(Cangling__UCangHuo, GetHeroAgi(cangling, true), true)
	    call SetHeroStr(Cangling__UCangHuo, GetHeroStr(cangling, true), true)
	    call SetHeroLevel(Cangling__UCangHuo, GetHeroLevel(cangling), false)
	    call SelectHeroSkill(Cangling__UCangHuo, 'A0HI')
	    call SelectHeroSkill(Cangling__UCangHuo, 'A0HJ')
	    call SelectHeroSkill(Cangling__UCangHuo, 'A0HK')
	    call SetAttack(Cangling__UCangHuo , GetAttack(cangling))
	    call SetDefense(Cangling__UCangHuo , GetDefense(cangling))
	    call SetHP(Cangling__UCangHuo , GetHP(cangling))
	    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl", GetUnitX(Cangling__UCangHuo), GetUnitY(Cangling__UCangHuo)))
		call TimerStart(CreateTimer(), 120, false, function Cangling__YiQiSanHuaTimer)
		call TimerStart(CreateTimer(), 1, true, function Cangling__ZiLeiHuTi)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Cangling__CreateTanlang takes nothing returns nothing
  local integer i= GetRandomInt(1, 3)
  local integer ty= 0
  local real x= YDWECoordinateX(GetUnitX(Cangling__UTanlang) + GetRandomReal(- 400, 400))
  local real y= YDWECoordinateY(GetUnitY(Cangling__UTanlang) + GetRandomReal(- 400, 400))
  local unit u= null
		if ( i == 1 ) then
			set ty='h00W'
		elseif ( i == 2 ) then
			set ty='h00Y'
		else
			set ty='h00Z'
		endif
		set u=CreateUnit(GetOwningPlayer(cangling), ty, x, y, GetRandomReal(0, 360))
		call UnitApplyTimedLifeBJ(10, 'BHwe', u)
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportTarget.mdl", GetUnitX(u), GetUnitY(u)))
		set u=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Cangling__TanLangMangYaoTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local integer i= LoadInteger(spellTable, id, 1)
		if ( i > 0 ) then
			call SaveInteger(spellTable, id, 1, i - 1)
			call Cangling__CreateTanlang()
		else
			call PauseTimer(t)
			call FlushChildHashtable(spellTable, id)
			call DestroyTimer(t)
	    	call PrintSpellContent(GetOwningPlayer(cangling) , GetAbilityName('A0HM') , "技能时间结束！")
		endif
		set t=null
	endfunction
	
 function Cangling__TanLangMangYaoRotateTimer takes nothing returns nothing
		if ( IsUnitAliveBJ(Cangling__UTanlang) ) then
			call SetUnitFacing(Cangling__UTanlang, ModuloReal(GetUnitFacing(Cangling__UTanlang) + 7.2, 360))
		else
			call PauseTimer(GetExpiredTimer())
			call DestroyTimer(GetExpiredTimer())
			set Cangling__UTanlang=null
		endif
	endfunction
 function Cangling__TanLangMangYao takes nothing returns nothing
  local timer t= CreateTimer()
		set Cangling__UTanlang=CreateUnit(GetOwningPlayer(cangling), 'h013', GetUnitX(cangling), GetUnitY(cangling), 0)
		call UnitApplyTimedLifeBJ(25, 'BHwe', Cangling__UTanlang)
		call SaveInteger(spellTable, GetHandleId(t), 1, 15)
		call TimerStart(t, 1, true, function Cangling__TanLangMangYaoTimer)
		call TimerStart(CreateTimer(), 0.05, true, function Cangling__TanLangMangYaoRotateTimer)
    	call PlaySoundBJ(gg_snd_cangling_5)
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Cangling__TSpellCanglingCon takes nothing returns boolean
		return GetOwningPlayer(GetSpellAbilityUnit()) == GetOwningPlayer(cangling)
	endfunction
 function Cangling__TSpellCanglingAct takes nothing returns nothing
		if ( GetSpellAbilityId() == 'A0HI' ) then
			call Cangling__BuMieZhenYan(5 , GetSpellAbilityId() , GetSpellTargetX() , GetSpellTargetY())
		elseif ( GetSpellAbilityId() == 'A0HJ' and GetSpellAbilityUnit() == cangling ) then
			call Cangling__LianJieDiMeng()
		elseif ( GetSpellAbilityId() == 'A0HK' ) then
			call Cangling__GuangYinWuSuo()
		elseif ( GetSpellAbilityId() == 'A0HL' ) then
			call Cangling__YiQiSanHua()
		elseif ( GetSpellAbilityId() == 'A0HM' ) then
			call Cangling__TanLangMangYao()
		//切换背包
		elseif ( GetSpellAbilityId() == 'A0HH' ) then
			if ( IsInRect(GetUnitX(cangling) , GetUnitY(cangling) , gg_rct_______a3) and IsInRect(GetUnitX(cangling) , GetUnitY(cangling) , gg_rct_______a3) ) then
				call DisplayTextToPlayer(GetOwningPlayer(cangling), 0., 0., "|cFFFF66CC【消息】|r此处禁止切换背包.")
			else
				call Cangling__BiBoBaoZhuo()
			endif
		//阳炎无双
		elseif ( GetSpellAbilityId() == 'A0HS' ) then
			call Cangling__YangYanWuShuang()
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
	//按照12345来判断
 function LearnSkillCanglingI takes unit learner,integer whichSpell returns nothing
  local integer i
		if ( learner == cangling ) then
			if ( whichSpell == 3 and IsThirdSpellOK(cangling) == true and GetUnitAbilityLevel(cangling, 'A0HK') == 1 ) then
				//技能3初始化
				call AddSpecialEffectTargetUnitBJ("origin", cangling, "war3mapImported\\yanbao.mdl")
				call InitCanglingAura()
			endif
		endif
	endfunction
 function LearnSkillCangling takes unit learner,integer learnSpellID returns nothing
		if ( learner == cangling ) then
			if ( learnSpellID == 'A0HI' ) then
				call LearnSkillCanglingI(learner , 1)
			elseif ( learnSpellID == 'A0HJ' ) then
				call LearnSkillCanglingI(learner , 2)
			elseif ( learnSpellID == 'A0HK' ) then
				call LearnSkillCanglingI(learner , 3)
			elseif ( learnSpellID == 'A0HL' ) then
				call LearnSkillCanglingI(learner , 4)
			elseif ( learnSpellID == 'A0HM' ) then
				call LearnSkillCanglingI(learner , 5)
			endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Cangling__InitCanglingSpin takes unit u returns unit
		if ( IsCanglingSpin1(GetOwningPlayer(u)) ) then
			set udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]=CreateUnit(GetOwningPlayer(u), 'N023', GetUnitX(u), GetUnitY(u), 0)
			set gg_unit_Nsjs_0209=udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
			call UnitAddItemByIdSwapped('I006', udg_H[GetConvertedPlayerId(GetOwningPlayer(u))])
			call SetUnitManaPercentBJ(udg_H[GetConvertedPlayerId(GetOwningPlayer(u))], 1000)
			call RemoveUnit(u)
			return udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
		else
			return u
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitCangling takes unit u returns nothing
		set cangling=Cangling__InitCanglingSpin(u)
	    //英雄第二个技能攻击事件
	    set Cangling__TSpellCangling2=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(Cangling__TSpellCangling2, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(Cangling__TSpellCangling2, Condition(function Cangling__TSpellCangling2Con))
	    call TriggerAddAction(Cangling__TSpellCangling2, function Cangling__TSpellCangling2Act)
	    //苍凌的所有技能
		set Cangling__TSpellCangling=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(Cangling__TSpellCangling, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	    call TriggerAddCondition(Cangling__TSpellCangling, Condition(function Cangling__TSpellCanglingCon))
	    call TriggerAddAction(Cangling__TSpellCangling, function Cangling__TSpellCanglingAct)
	    call TimerStart(CreateTimer(), 0.05, true, function Cangling__BiBoBaoZhuoTimer)
	endfunction

//library Cangling ends
//library Chenji:
//---------------------------------------------------------------------------------------------------
    
    function Chenji__TuntianyaociEffect takes real radius,integer count returns nothing
        local integer i= 1
        loop
            exitwhen i > count
            call CreateUnitEffect(GetOwningPlayer(chenji) , 'hh00' , YDWECoordinateX(GetUnitX(chenji) + radius * CosBJ(i * ( 360 / count ))) , YDWECoordinateY(GetUnitY(chenji) + radius * SinBJ(i * ( 360 / count ))) , 0)
            set i=i + 1
        endloop
    endfunction
    function Tuntianyaoci takes nothing returns nothing
        local integer i= 1
        loop
            exitwhen i > 6
            call Chenji__TuntianyaociEffect(300 * i , i * 2 + 2)
            set i=i + 1
        endloop
        call PrintSpell(GetOwningPlayer(GetTriggerUnit()) , "|cFFCCFF66吞天妖刺|r" , GetDamageChenji(GetTriggerUnit()) * 3)
        call DamageArea(chenji , GetUnitX(chenji) , GetUnitY(chenji) , 1800 , GetDamageChenji(GetTriggerUnit()) * 3)
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function ChenjiJiance takes nothing returns nothing
        local real percentThousand= ( GetUnitState(chenji, UNIT_STATE_LIFE) * 1000. ) / GetUnitState(chenji, UNIT_STATE_MAX_LIFE)
        if ( UnitHasBuffBJ(chenji, 'Bapl') or UnitHasBuffBJ(chenji, 'Bpoi') or UnitHasBuffBJ(chenji, 'Bpsd') ) then
            call DisplayTextToPlayer(GetOwningPlayer(chenji), 0., 0., "|cFFFF66CC【消息】|r你拥有中毒BUFF.")
            return
        endif
        if ( percentThousand < 10 and IsUnitAliveBJ(chenji) and not ( BHeroDeath[GetConvertedPlayerId(GetOwningPlayer(chenji))] ) ) then
             call SetChenji2SpinOK(GetOwningPlayer(chenji))
        endif
        call DisplayTextToPlayer(GetOwningPlayer(chenji), 0., 0., "|cFFFF66CC【消息】|r你当前的生命为千分之" + R2S(percentThousand) + ".")
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function CountYindu takes nothing returns nothing
        if ( Chenji__IYinduTimes >= 7 ) then
             call SetChenji1SpinOK(GetOwningPlayer(chenji))
        else
            set Chenji__IYinduTimes=Chenji__IYinduTimes + 1
        endif
    endfunction
//---------------------------------------------------------------------------------------------------
    
    
//---------------------------------------------------------------------------------------------------
    
    function TSpellChenji4Con takes nothing returns boolean
        return ( ( GetUnitStateSwap(UNIT_STATE_MANA, chenji) > 800.00 ) and ( GetEventDamage() >= 1. ) and ( GetEventDamage() <= 100000000.00 ) )
    endfunction
    function TSpellChenji4Act takes nothing returns nothing
        local unit u
        call DisableTrigger(GetTriggeringTrigger())
        set Chenji__RDamage=Chenji__RDamage + GetEventDamage()
        if ( Chenji__RDamage >= GetUnitState(chenji, UNIT_STATE_MAX_LIFE) * 0.1 ) then
            set Chenji__RDamage=0
        else
            call EnableTrigger(GetTriggeringTrigger())
            return
        endif
        set u=CreateUnit(GetOwningPlayer(chenji), 'h00P', YDWECoordinateX(( GetUnitX(chenji) + GetRandomReal(- 300.00, 300.00) )), YDWECoordinateY(( GetUnitY(chenji) + GetRandomReal(- 300.00, 300.00) )), 0.00)
        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl", GetUnitX(u), GetUnitY(u)))
        call UnitApplyTimedLifeBJ(5.00, 'BTLF', u)
        set u=null
        call YDWEPolledWaitNull(0.50)
        call EnableTrigger(GetTriggeringTrigger())
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Chenji__MingheTimer takes nothing returns nothing
        local timer t= GetExpiredTimer()
        local integer id= GetHandleId(t)
        local integer times= LoadInteger(spellTable, id, 1)
        local real x= LoadReal(spellTable, id, 2)
        local real y= LoadReal(spellTable, id, 3)
        local integer i= 1
        local integer random= GetRandomInt(8, 18)
        local unit u= null
        if ( times <= 10 ) then
            call SaveInteger(spellTable, GetHandleId(t), 1, times + 1)
            call DamageArea(chenji , x , y , 600 , GetDamageChenji(chenji) * 8)
            call CreateUnitEffect(GetOwningPlayer(chenji) , 'h014' , x , y , 0)
            loop
                exitwhen i > random
                set u=CreateUnit(GetOwningPlayer(chenji), 'h00J', x, y, i * ( 360 / random ))
                call UnitApplyTimedLifeBJ(5, 'BHwe', u)
                set i=i + 1
            endloop
        else
            call PauseTimer(t)
            call FlushChildHashtable(spellTable, id)
            call DestroyTimer(t)
        endif
        set t=null
        set u=null
    endfunction
    function ChenjiMinghe takes nothing returns nothing
        local timer t= CreateTimer()
        call SaveInteger(spellTable, GetHandleId(t), 1, 0)
        call SaveReal(spellTable, GetHandleId(t), 2, GetSpellTargetX())
        call SaveReal(spellTable, GetHandleId(t), 3, GetSpellTargetY())
        call TimerStart(t, 1, true, function Chenji__MingheTimer)
        call PrintSpellContent(GetOwningPlayer(chenji) , GetAbilityName('A0G3') , I2S(R2I(GetDamageChenji(chenji) * 0.8 * RJ3(chenji , 2 , 1) / 100)) + "万总伤害.")
        set t=null
    endfunction
//---------------------------------------------------------------------------------------------------
    
    //按照12345来判断
    function LearnSkillChenjiI takes unit learner,integer whichSpell returns nothing
        local integer i
        if ( learner == chenji ) then
            if ( whichSpell == 4 and IsFourthSpellOK(chenji) == true and GetUnitAbilityLevel(chenji, 'A0F8') == 1 ) then
                set Chenji__TSpellChenji4=CreateTrigger()
                call TriggerRegisterUnitEvent(Chenji__TSpellChenji4, chenji, EVENT_UNIT_DAMAGED)
                call TriggerAddCondition(Chenji__TSpellChenji4, Condition(function TSpellChenji4Con))
                call TriggerAddAction(Chenji__TSpellChenji4, function TSpellChenji4Act)
            endif
        endif
    endfunction
    function LearnSkillChenji takes unit learner,integer learnSpellID returns nothing
        if ( learner == chenji ) then
            if ( learnSpellID == 'A0F8' ) then
                call LearnSkillChenjiI(learner , 4)
            endif
        endif
    endfunction
//---------------------------------------------------------------------------------------------------
    
    function Chenji__InitChenjiSpin takes unit u returns unit
        if ( IsChenjiSpin2(GetOwningPlayer(u)) ) then
            set udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]=CreateUnit(GetOwningPlayer(u), 'H01W', GetUnitX(u), GetUnitY(u), 0)
            set gg_unit_Harf_0262=udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
            call UnitAddItemByIdSwapped('stel', udg_H[GetConvertedPlayerId(GetOwningPlayer(u))])
            call UnitAddItemByIdSwapped('I006', udg_H[GetConvertedPlayerId(GetOwningPlayer(u))])
            call AddSpellPercent(GetConvertedPlayerId(GetOwningPlayer(u)) , 0.1)
            call SetUnitManaPercentBJ(udg_H[GetConvertedPlayerId(GetOwningPlayer(u))], 1000)
            call RemoveUnit(u)
            set u=udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
        endif
        if ( IsChenjiSpin1(GetOwningPlayer(u)) ) then
            call UnitAddAbility(u, 'A0JS')
            call AddStrPercent(GetConvertedPlayerId(GetOwningPlayer(u)) , 0.1)
        endif
        return u
    endfunction
//---------------------------------------------------------------------------------------------------
    function InitChenji takes unit u returns nothing
        set chenji=Chenji__InitChenjiSpin(u)
        call TriggerRegisterUnitEvent(gg_trg_____________132, chenji, EVENT_UNIT_DEATH)
        call TriggerRegisterUnitEvent(gg_trg_____________125, chenji, EVENT_UNIT_DAMAGED)
        call TriggerRegisterUnitEvent(gg_trg_____________130, chenji, EVENT_UNIT_DAMAGED)
    endfunction

//library Chenji ends
//library Hanshang:
//---------------------------------------------------------------------------------------------------
	
    function Hanshang__GuifushengongTimer takes nothing returns nothing
        local timer t= GetExpiredTimer()
        local integer id= GetHandleId(t)
        local item it= LoadItemHandle(spellTable, id, 1)
        call RemoveItem(it)
        call DisplayTextToPlayer(GetOwningPlayer(hanshang), 0., 0., "|cFFFF66CC【鬼斧神工】|r时间到，物品消失。")
        call PauseTimer(t)
        call FlushChildHashtable(spellTable, id)
        call DestroyTimer(t)
        set it=null
        set t=null
    endfunction
 function Hanshang__Guifushengong takes nothing returns nothing
        local item it= null
        local timer t= null
        if not ( IsCanCopy(GetSpellTargetItem()) ) then
            call DisplayTextToPlayer(GetOwningPlayer(hanshang), 0., 0., "|cFFFF66CC【鬼斧神工】|r该物品禁止复制。")
            return
        endif
        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, ( "|cFFFF66CC【|r|cffff00ff鬼斧神工|r|cFFFF66CC】|r成功复制出了" + ( GetItemName(GetSpellTargetItem()) + "。" ) ))
        set it=UnitAddItemByIdSwapped(GetItemTypeId(GetSpellTargetItem()), GetTriggerUnit())
        if ( ( GetItemType(GetSpellTargetItem()) != ITEM_TYPE_CHARGED ) ) then
        	if ( BJuexing3[GetConvertedPlayerId(GetOwningPlayer(hanshang))] ) then
        		set Hanshang__IJuexing=Hanshang__IJuexing + 1
        		if ( Hanshang__IJuexing >= 20 ) then
        			call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, ( "|cFFFF66CC【|r|cffff00ff鬼斧神工|r|cFFFF66CC】|r该物品为真品。" ))
					set Hanshang__IJuexing=0
			        set it=null
			        set t=null
					return
				else
        			call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, ( "|cFFFF66CC【|r|cffff00ff鬼斧神工|r|cFFFF66CC】|r还需要使用" + I2S(20 - Hanshang__IJuexing) + "次才为真品。" ))
        		endif
        	endif
            call SetItemPawnable(it, false)
            set t=CreateTimer()
            call SaveItemHandle(spellTable, GetHandleId(t), 1, it)
            call TimerStart(t, 30, false, function Hanshang__GuifushengongTimer)
        endif
        set it=null
        set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SiShenZhaDan takes real x,real y,real damageRate,integer abilityID returns nothing
  local real n
  local real damage= GetDamageAgi(hanshang) * damageRate
  local real x1= GetUnitX(hanshang)
     local real y1= GetUnitY(hanshang)
     local real facing= GetFacingBetweenXY(x1 , y1 , x , y)
     local real distance= SquareRoot(( y - y1 ) * ( y - y1 ) + ( x - x1 ) * ( x - x1 ))
	    if ( distance < 1000 ) then
	    	set n=1
	    elseif ( distance < 4000 ) then
	    	set n=1.5
	    else
	    	set n=( 1.5 + ( distance - 4000 ) / 5000 )
	    endif
	    set damage=damage * n
	    call s__Boom_create(CreateUnit(GetOwningPlayer(hanshang), 'h007', x1, y1, facing) , x , y , facing , damage , 60 * IJ2(hanshang , 2 , 1) , 450 , 0.05 , "Objects\\Spawnmodels\\Other\\NeutralBuildingExplosion\\NeutralBuildingExplosion.mdl")
	    if ( BJuexing2[GetConvertedPlayerId(GetOwningPlayer(hanshang))] ) then
	    	call SetUnitLifePercentBJ(hanshang, 100)
	    	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\AIma\\AImaTarget.mdl", GetUnitX(hanshang), GetUnitY(hanshang)))
	    endif
	    if ( abilityID != 0 ) then
	    	call PrintSpellAdd(GetOwningPlayer(hanshang) , GetAbilityName(abilityID) , damage , ",距离伤害加成n为" + I2S(R2I(n * 100) - 100) + "%.")
	    endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Hanshang__Wuqiongtunshi takes nothing returns nothing
        local item it= GetSpellTargetItem()
        local integer i= 0
        local real r= 0
        local integer loopI= 0
        if ( HaveSavedInteger(YDHT, GetHandleId(it), 0xA75AD423) and GetConvertedPlayerId(GetOwningPlayer(hanshang)) != LoadInteger(YDHT, GetHandleId(it), 0xA75AD423) ) then
            call DisplayTextToPlayer(GetOwningPlayer(hanshang), 0, 0, ( "|cFFFF66CC【消息】|r这件东西属于" + ( GetUnitName(udg_H[LoadInteger(YDHT, GetHandleId(it), 0xA75AD423)]) + ",不可吞噬。" ) ))
            set it=null
            return
        endif
        if ( GetItemTypeId(it) == 'I079' ) then
        	return
        endif
	    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\BattleRoar\\RoarCaster.mdl", GetUnitX(hanshang), GetUnitY(hanshang)))
	    if ( IsItemPawnable(it) ) then
	    	set loopI=1
	    	loop
	    		exitwhen i > ( Hanshang__ILianjinChi - 1 )
	    		if ( LoadInteger(spellTable, GetHandleId(hanshang), i) == GetItemTypeId(it) ) then
	    			call DisplayTextToPlayer(GetOwningPlayer(hanshang), 0., 0., "|cFFFF66CC【消息】|r吞噬失败,对同一种真品只能吞噬一次.(复制出来的没这个限制)")
	    			return
	    		endif
	    		set i=i + 1
	    	endloop
	    	call DisplayTextToPlayer(GetOwningPlayer(hanshang), 0, 0, ( "|cFFFF66CC【|r" + ( GetAbilityName(GetSpellAbilityId()) + "|cFFFF66CC】|r吞噬成功，增加的属性值如以下所示：" ) ))
			call SaveInteger(spellTable, GetHandleId(hanshang), Hanshang__ILianjinChi, GetItemTypeId(it))
			set Hanshang__ILianjinChi=Hanshang__ILianjinChi + 1
	        if ( HaveSavedInteger(YDHT, GetItemTypeId(it), 0x5BAE281D) ) then
	            set i=LoadInteger(YDHT, GetItemTypeId(it), 0x5BAE281D) * 2 / 5 * I3(JJ1 , 3 , 1)
	            call DisplayTextToPlayer(GetOwningPlayer(hanshang), 0, 0, ( "|cFFFF66CC【|r全属性|cFFFF66CC】|r+" + I2S(i) ))
	            call ModifyHeroStat(bj_HEROSTAT_STR, hanshang, bj_MODIFYMETHOD_ADD, i)
	            call ModifyHeroStat(bj_HEROSTAT_AGI, hanshang, bj_MODIFYMETHOD_ADD, i)
	            call ModifyHeroStat(bj_HEROSTAT_INT, hanshang, bj_MODIFYMETHOD_ADD, i)
	            set Hanshang__ITotalEat=Hanshang__ITotalEat + i * 3
	        endif
	        if ( HaveSavedInteger(YDHT, GetItemTypeId(it), 0x8D205575) ) then
	            set i=LoadInteger(YDHT, GetItemTypeId(it), 0x8D205575) * 2 / 5 * I3(JJ1 , 3 , 1)
	            call DisplayTextToPlayer(GetOwningPlayer(hanshang), 0, 0, ( "|cFFFF66CC【|r力量|cFFFF66CC】|r+" + I2S(i) ))
	            call ModifyHeroStat(bj_HEROSTAT_STR, hanshang, bj_MODIFYMETHOD_ADD, i)
	            set Hanshang__ITotalEat=Hanshang__ITotalEat + i
	        endif
	        if ( HaveSavedInteger(YDHT, GetItemTypeId(it), 0x384C9D86) ) then
	            set i=LoadInteger(YDHT, GetItemTypeId(it), 0x384C9D86) * 2 / 5 * I3(JJ1 , 3 , 1)
	            call DisplayTextToPlayer(GetOwningPlayer(hanshang), 0, 0, ( "|cFFFF66CC【|r敏捷|cFFFF66CC】|r+" + I2S(i) ))
	            call ModifyHeroStat(bj_HEROSTAT_AGI, hanshang, bj_MODIFYMETHOD_ADD, i)
	            set Hanshang__ITotalEat=Hanshang__ITotalEat + i
	        endif
	        if ( HaveSavedInteger(YDHT, GetItemTypeId(it), 0x1B5C932E) ) then
	            set i=LoadInteger(YDHT, GetItemTypeId(it), 0x1B5C932E) * 2 / 5 * I3(JJ1 , 3 , 1)
	            call DisplayTextToPlayer(GetOwningPlayer(hanshang), 0, 0, ( "|cFFFF66CC【|r智力|cFFFF66CC】|r+" + I2S(i) ))
	            call ModifyHeroStat(bj_HEROSTAT_INT, hanshang, bj_MODIFYMETHOD_ADD, i)
	            set Hanshang__ITotalEat=Hanshang__ITotalEat + i
	        endif
	        if ( HaveSavedInteger(YDHT, GetItemTypeId(it), 0x5039AFFB) ) then
	            set i=LoadInteger(YDHT, GetItemTypeId(it), 0x5039AFFB) * 2 / 5 * I3(JJ1 , 3 , 1)
	            call DisplayTextToPlayer(GetOwningPlayer(hanshang), 0, 0, ( "|cFFFF66CC【|r攻击|cFFFF66CC】|r+" + I2S(i) ))
	            call AddAttack(hanshang , i)
	        endif
	        if ( HaveSavedInteger(YDHT, GetItemTypeId(it), 0xFCD961C9) ) then
	            set i=LoadInteger(YDHT, GetItemTypeId(it), 0xFCD961C9) * 2 / 5 * I3(JJ1 , 3 , 1)
	            call DisplayTextToPlayer(GetOwningPlayer(hanshang), 0, 0, ( "|cFFFF66CC【|r生命上限|cFFFF66CC】|r+" + I2S(i) ))
	            call AddHP(hanshang , i)
	        endif
	        if ( HaveSavedReal(YDHT, GetItemTypeId(it), 0x06C64278) ) then
	            set r=LoadReal(YDHT, GetItemTypeId(it), 0x06C64278) / 5 * R3(JJ1 , 3. , 1.)
	            call DisplayTextToPlayer(GetOwningPlayer(hanshang), 0, 0, "|cFFFF66CC【|r力量加成|cFFFF66CC】|r+" + I2S(R2I(r * 100.00)) + "%。")
	            call AddStrPercent(GetConvertedPlayerId(GetOwningPlayer(hanshang)) , r)
	        endif
	        if ( HaveSavedReal(YDHT, GetItemTypeId(it), 0x6FFF4132) ) then
	            set r=LoadReal(YDHT, GetItemTypeId(it), 0x6FFF4132) / 5 * R3(JJ1 , 3. , 1.)
	            call DisplayTextToPlayer(GetOwningPlayer(hanshang), 0, 0, "|cFFFF66CC【|r敏捷加成|cFFFF66CC】|r+" + I2S(R2I(r * 100.00)) + "%。")
	            call AddAgiPercent(GetConvertedPlayerId(GetOwningPlayer(hanshang)) , r)
	        endif
	        if ( HaveSavedReal(YDHT, GetItemTypeId(it), 0xC0C6918C) ) then
	            set r=LoadReal(YDHT, GetItemTypeId(it), 0xC0C6918C) / 5 * R3(JJ1 , 3. , 1.)
	            call DisplayTextToPlayer(GetOwningPlayer(hanshang), 0, 0, "|cFFFF66CC【|r智力加成|cFFFF66CC】|r+" + I2S(R2I(r * 100.00)) + "%。")
	            call AddIntPercent(GetConvertedPlayerId(GetOwningPlayer(hanshang)) , r)
	        endif
	        if ( HaveSavedReal(YDHT, GetItemTypeId(it), 0xFAA305CD) ) then
	            set r=LoadReal(YDHT, GetItemTypeId(it), 0xFAA305CD) / 5 * R3(JJ1 , 3. , 1.)
	            call DisplayTextToPlayer(GetOwningPlayer(hanshang), 0, 0, "|cFFFF66CC【|rHP上限加成|cFFFF66CC】|r+" + I2S(R2I(r * 100.00)) + "%。")
	            call AddHPPercent(GetConvertedPlayerId(GetOwningPlayer(hanshang)) , r)
	        endif
	        if ( HaveSavedReal(YDHT, GetItemTypeId(it), 0x4C0507D9) ) then
	            set r=LoadReal(YDHT, GetItemTypeId(it), 0x4C0507D9) / 5 * R3(JJ1 , 3. , 1.)
	            call DisplayTextToPlayer(GetOwningPlayer(hanshang), 0, 0, "|cFFFF66CC【|r攻击加成|cFFFF66CC】|r+" + I2S(R2I(r * 100.00)) + "%。")
	            call AddAttackPercent(GetConvertedPlayerId(GetOwningPlayer(hanshang)) , r)
	        endif
	        if ( HaveSavedReal(YDHT, GetItemTypeId(it), 0x0B6FB20F) ) then
	            set r=LoadReal(YDHT, GetItemTypeId(it), 0x0B6FB20F) / 5 * R3(JJ1 , 3. , 1.)
	            call DisplayTextToPlayer(GetOwningPlayer(hanshang), 0, 0, "|cFFFF66CC【|r防御加成|cFFFF66CC】|r+" + I2S(R2I(r * 100.00)) + "%。")
	            call AddDefensePercent(GetConvertedPlayerId(GetOwningPlayer(hanshang)) , r)
	        endif
	    else
	    	call DisplayTextToPlayer(GetOwningPlayer(hanshang), 0, 0, ( "|cFFFF66CC【|r" + ( GetAbilityName(GetSpellAbilityId()) + "|cFFFF66CC】|r吞噬成功，增加的属性值如以下所示：" ) ))
	       if ( HaveSavedInteger(YDHT, GetItemTypeId(it), 0x5BAE281D) ) then
	            set i=LoadInteger(YDHT, GetItemTypeId(it), 0x5BAE281D) / 20 * I3(JJ1 , 3 , 1)
	            call DisplayTextToPlayer(GetOwningPlayer(hanshang), 0, 0, ( "|cFFFF66CC【|r全属性|cFFFF66CC】|r+" + I2S(i) ))
	            call ModifyHeroStat(bj_HEROSTAT_STR, hanshang, bj_MODIFYMETHOD_ADD, i)
	            call ModifyHeroStat(bj_HEROSTAT_AGI, hanshang, bj_MODIFYMETHOD_ADD, i)
	            call ModifyHeroStat(bj_HEROSTAT_INT, hanshang, bj_MODIFYMETHOD_ADD, i)
	            set Hanshang__ITotalEat=Hanshang__ITotalEat + i * 3
	        endif
	        if ( HaveSavedInteger(YDHT, GetItemTypeId(it), 0x8D205575) ) then
	            set i=LoadInteger(YDHT, GetItemTypeId(it), 0x8D205575) / 20 * I3(JJ1 , 3 , 1)
	            call DisplayTextToPlayer(GetOwningPlayer(hanshang), 0, 0, ( "|cFFFF66CC【|r力量|cFFFF66CC】|r+" + I2S(i) ))
	            call ModifyHeroStat(bj_HEROSTAT_STR, hanshang, bj_MODIFYMETHOD_ADD, i)
	            set Hanshang__ITotalEat=Hanshang__ITotalEat + i
	        endif
	        if ( HaveSavedInteger(YDHT, GetItemTypeId(it), 0x384C9D86) ) then
	            set i=LoadInteger(YDHT, GetItemTypeId(it), 0x384C9D86) / 20 * I3(JJ1 , 3 , 1)
	            call DisplayTextToPlayer(GetOwningPlayer(hanshang), 0, 0, ( "|cFFFF66CC【|r敏捷|cFFFF66CC】|r+" + I2S(i) ))
	            call ModifyHeroStat(bj_HEROSTAT_AGI, hanshang, bj_MODIFYMETHOD_ADD, i)
	            set Hanshang__ITotalEat=Hanshang__ITotalEat + i
	        endif
	        if ( HaveSavedInteger(YDHT, GetItemTypeId(it), 0x1B5C932E) ) then
	            set i=LoadInteger(YDHT, GetItemTypeId(it), 0x1B5C932E) / 20 * I3(JJ1 , 3 , 1)
	            call DisplayTextToPlayer(GetOwningPlayer(hanshang), 0, 0, ( "|cFFFF66CC【|r智力|cFFFF66CC】|r+" + I2S(i) ))
	            call ModifyHeroStat(bj_HEROSTAT_INT, hanshang, bj_MODIFYMETHOD_ADD, i)
	            set Hanshang__ITotalEat=Hanshang__ITotalEat + i
	        endif
	        if ( HaveSavedInteger(YDHT, GetItemTypeId(it), 0x5039AFFB) ) then
	            set i=LoadInteger(YDHT, GetItemTypeId(it), 0x5039AFFB) / 20 * I3(JJ1 , 3 , 1)
	            call DisplayTextToPlayer(GetOwningPlayer(hanshang), 0, 0, ( "|cFFFF66CC【|r攻击|cFFFF66CC】|r+" + I2S(i) ))
	            call AddAttack(hanshang , i)
	        endif
	        if ( HaveSavedInteger(YDHT, GetItemTypeId(it), 0xFCD961C9) ) then
	            set i=LoadInteger(YDHT, GetItemTypeId(it), 0xFCD961C9) / 20 * I3(JJ1 , 3 , 1)
	            call DisplayTextToPlayer(GetOwningPlayer(hanshang), 0, 0, ( "|cFFFF66CC【|r生命上限|cFFFF66CC】|r+" + I2S(i) ))
	            call AddHP(hanshang , i)
	        endif
	    endif
	    if ( Hanshang__ITotalEat > 5000000 ) then
       call SetHanshang1SpinOK(GetOwningPlayer(hanshang))
	    endif
	    call RemoveItem(it)
	    set it=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Hanshang__TSpellHanshang2Con takes nothing returns boolean
	    return ( ( GetAttackedUnitBJ() == hanshang ) and ( IsSecondSpellOK(hanshang) == true ) and ( GetRandomInt(1, 10) == 1 ) and ( GetUnitStateSwap(UNIT_STATE_MANA, hanshang) > 200.00 ) and GetUnitAbilityLevel(hanshang, 'A0IK') >= 1 )
	endfunction
 function Hanshang__TSpellHanshang2Act takes nothing returns nothing
		call DisableTrigger(GetTriggeringTrigger())
		call SiShenZhaDan(GetUnitX(GetAttacker()) , GetUnitY(GetAttacker()) , 0.33 , 'A0IK')
		call YDWEPolledWaitNull(5)
		call EnableTrigger(GetTriggeringTrigger())
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Hanshang__LianJinZhiShuTimer takes nothing returns nothing
  local integer lumber= GetPlayerState(GetOwningPlayer(hanshang), PLAYER_STATE_RESOURCE_LUMBER)
  local integer update= 0
  local real Rupdate
		if ( lumber > 100000 ) then
			set update=90
			set Hanshang__RLianjin2=0.72
		elseif ( lumber > 10000 ) then
			set update=75
			set Hanshang__RLianjin2=0.6
		elseif ( lumber > 1000 ) then
			set update=60
			set Hanshang__RLianjin2=0.48
		elseif ( lumber > 100 ) then
			set update=45
			set Hanshang__RLianjin2=0.36
		elseif ( lumber > 10 ) then
			set update=30
			set Hanshang__RLianjin2=0.24
		elseif ( lumber > 1 ) then
			set update=15
			set Hanshang__RLianjin2=0.12
		endif
		set Rupdate=I2R(update) / 100
		if ( Hanshang__RLianjin != Rupdate ) then
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Transmute\\PileofGold.mdl", GetUnitX(hanshang), GetUnitY(hanshang)))
			call PrintSpellContent(GetOwningPlayer(hanshang) , GetAbilityName('A0BN') , "额外技能伤害加成" + I2S(update) + "%.")
			call AddSpellPercent(GetConvertedPlayerId(GetOwningPlayer(hanshang)) , Rupdate - Hanshang__RLianjin)
			set Hanshang__RLianjin=Rupdate
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Hanshang__LianhuanBoomTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local real x= LoadReal(spellTable, id, kLianhuanBoomX)
  local real y= LoadReal(spellTable, id, kLianhuanBoomY)
		if ( ( GetUnitState(hanshang, UNIT_STATE_MANA) >= 100 ) and ( Hanshang__IsLianhuan == true ) ) then
			call SetUnitManaBJ(hanshang, GetUnitState(hanshang, UNIT_STATE_MANA) - 100)
			call SiShenZhaDan(x , y , 1 , 0)
		else
        	call IssueImmediateOrder(hanshang, "stop")
        	set Hanshang__IsLianhuan=false
			call PrintSpellContent(GetOwningPlayer(hanshang) , GetAbilityName('A0F0') , "施法结束.")
			call PauseTimer(t)
			call DestroyTimer(t)
			call FlushChildHashtable(spellTable, id)
		endif
		set t=null
	endfunction
 function Hanshang__LianhuanBoom takes nothing returns nothing
  local timer t= CreateTimer()
		set Hanshang__IsLianhuan=true
		call EnableTrigger(Hanshang__TSpellHanshang4)
		call SaveReal(spellTable, GetHandleId(t), kLianhuanBoomX, GetSpellTargetX())
		call SaveReal(spellTable, GetHandleId(t), kLianhuanBoomY, GetSpellTargetY())
		call TimerStart(t, 0.5, true, function Hanshang__LianhuanBoomTimer)
		call PrintSpellName(GetOwningPlayer(hanshang) , GetAbilityName('A0F0'))
		set t=null
	endfunction
	
 function Hanshang__TSpellHanshang4Con takes nothing returns boolean
	    return ( ( GetSpellAbilityId() == 'A0F0' ) )
	endfunction
 function Hanshang__TSpellHanshang4Act takes nothing returns nothing
		set Hanshang__IsLianhuan=false
		call DisableTrigger(Hanshang__TSpellHanshang4)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Hanshang__GiveDiyu takes nothing returns nothing
  local integer i= GetRandomInt(1, 3)
		if ( IsFourthSpellOK(hanshang) and GetUnitAbilityLevel(hanshang, 'A0F0') == 1 ) then
			if ( i == 1 ) then
				call UnitAddItemByIdSwapped('I06A', UDepot[GetConvertedPlayerId(GetOwningPlayer(hanshang))])
			elseif ( i == 2 ) then
				call UnitAddItemByIdSwapped('I06J', UDepot[GetConvertedPlayerId(GetOwningPlayer(hanshang))])
			elseif ( i == 3 ) then
				call UnitAddItemByIdSwapped('I06B', UDepot[GetConvertedPlayerId(GetOwningPlayer(hanshang))])
			endif
			call PrintSpellContent(GetOwningPlayer(hanshang) , GetAbilityName('A0F0') , "获得了" + GetItemName(GetLastCreatedItem()) + "存放于仓库.")
            call PingMinimapForForce(YDWEGetForceOfPlayerNull(GetOwningPlayer(hanshang)), GetUnitX(UDepot[GetConvertedPlayerId(GetOwningPlayer(hanshang))]), GetUnitY(UDepot[GetConvertedPlayerId(GetOwningPlayer(hanshang))]), 2.00)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Hanshang__DuwumizhenTimer takes nothing returns nothing
		if ( ( IsUnitAliveBJ(Hanshang__UDuwu) ) and ( GetUnitAbilityLevelSwapped('Avul', Hanshang__UDuwu) < 1 ) and ( IsUnitAliveBJ(hanshang) == true ) ) then
	    	call DamageArea(hanshang , GetUnitX(Hanshang__UDuwu) , GetUnitY(Hanshang__UDuwu) , 400 , GetDamageAgi(hanshang) * 0.6)
		else
			call PauseTimer(Hanshang__TDuwu)
			call DestroyTimer(Hanshang__TDuwu)
			set Hanshang__TDuwu=null
			set Hanshang__UDuwu=null
			call DestroyEffect(Hanshang__EffectDu)
			set Hanshang__EffectDu=null
		endif
	endfunction
 function Hanshang__Duwumizhen takes nothing returns nothing
		if ( Hanshang__EffectDu != null ) then
        	call DestroyEffect(Hanshang__EffectDu)
		endif
	    set Hanshang__UDuwu=GetSpellTargetUnit()
	    set Hanshang__EffectDu=AddSpecialEffectTarget("war3mapImported\\radioactivecloud.mdl", Hanshang__UDuwu, "chest")
    	call PrintSpell(GetOwningPlayer(hanshang) , GetAbilityName(GetSpellAbilityId()) , GetDamageAgi(hanshang) * 0.6)
		if ( Hanshang__TDuwu == null ) then
			set Hanshang__TDuwu=CreateTimer()
			call TimerStart(Hanshang__TDuwu, 1, true, function Hanshang__DuwumizhenTimer)
		endif
		call PlaySoundBJ(gg_snd_hanshang_5)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Hanshang__TSpellHanshangCon takes nothing returns boolean
	    return ( GetSpellAbilityUnit() == hanshang )
	endfunction
 function Hanshang__TSpellHanshangAct takes nothing returns nothing
		if ( ( GetSpellAbilityId() == 'A0IJ' ) ) then
			call SiShenZhaDan(GetSpellTargetX() , GetSpellTargetY() , 1 , GetSpellAbilityId())
		elseif ( ( GetSpellAbilityId() == 'A0F0' ) ) then
			call Hanshang__LianhuanBoom()
		//鬼斧神工
        elseif ( ( GetSpellAbilityId() == 'A0II' ) ) then
            call Hanshang__Guifushengong()
        //无穷吞噬
        elseif ( ( GetSpellAbilityId() == 'A0IK' ) ) then
            call Hanshang__Wuqiongtunshi()
        //毒雾迷阵
        elseif ( ( GetSpellAbilityId() == 'AUfa' ) ) then
            call Hanshang__Duwumizhen()
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Hanshang__TSpellHanshang3Con takes nothing returns boolean
		return IsThirdSpellOK(hanshang) == true and GetUnitAbilityLevel(hanshang, 'A0BN') == 1 and GetEventDamage() > 100 and GetTriggerUnit() == hanshang and IsUnitAliveBJ(hanshang)
	endfunction
 function Hanshang__TSpellHanshang3Act takes nothing returns nothing
		call SetUnitLifeBJ(hanshang, GetUnitState(hanshang, UNIT_STATE_LIFE) + GetEventDamage() * Hanshang__RLianjin2)
	endfunction
//---------------------------------------------------------------------------------------------------
	
	//按照12345来判断
 function LearnSkillHanshangI takes unit learner,integer whichSpell returns nothing
		if ( learner == hanshang ) then
			if ( whichSpell == 3 and IsThirdSpellOK(hanshang) == true and GetUnitAbilityLevel(hanshang, 'A0BN') == 1 ) then
				//技能3初始化
		        call AddMoneyPercent(GetConvertedPlayerId(GetOwningPlayer(hanshang)) , 0.25)
       			call InitHanshangAura()
       			//炼金之术
       			call TimerStart(CreateTimer(), 3, true, function Hanshang__LianJinZhiShuTimer)
       		endif
		endif
	endfunction
 function LearnSkillHanshang takes unit learner,integer learnSpellID returns nothing
		if ( learner == hanshang ) then
			if ( learnSpellID == 'A0IJ' ) then
				call LearnSkillHanshangI(learner , 1)
			elseif ( learnSpellID == 'A0IK' ) then
				call LearnSkillHanshangI(learner , 2)
			elseif ( learnSpellID == 'A0BN' ) then
				call LearnSkillHanshangI(learner , 3)
			elseif ( learnSpellID == 'A0F0' ) then
				call LearnSkillHanshangI(learner , 4)
			elseif ( learnSpellID == 'AUfa' ) then
				call LearnSkillHanshangI(learner , 5)
			endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Hanshang__TDuxinAct takes nothing returns nothing
  local integer i
		if ( Hanshang__HTHS == null ) then
			return
		endif
		if ( GetHanshang2Spin(GetOwningPlayer(hanshang)) ) then
			return
		endif
		set i=1
		loop
			exitwhen i > Hanshang__IDuxin
    		if ( LoadInteger(Hanshang__HTHS, GetHandleId(hanshang), i) == GetItemTypeId(GetManipulatedItem()) ) then
    			return
    		endif
			set i=i + 1
		endloop
		set Hanshang__IDuxin=Hanshang__IDuxin + 1
		call SaveInteger(Hanshang__HTHS, GetHandleId(hanshang), Hanshang__IDuxin, GetItemTypeId(GetManipulatedItem()))
		if ( Hanshang__IDuxin < 520 ) then
			call DisplayTextToPlayer(GetOwningPlayer(hanshang), 0., 0., "|cFF3333FF【耀金独心|r】|r进度:" + I2S(Hanshang__IDuxin) + "/520.")
		else
    call SetHanshang2SpinOK(GetOwningPlayer(hanshang))
		endif
	endfunction
 function InitDuxin takes nothing returns nothing
		set Hanshang__TDuxin=CreateTrigger()
		set Hanshang__HTHS=InitHashtable()
    	call TriggerRegisterUnitEvent(Hanshang__TDuxin, hanshang, EVENT_UNIT_PICKUP_ITEM)
		call TriggerAddAction(Hanshang__TDuxin, function Hanshang__TDuxinAct)
		set Hanshang__TDuxin=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Hanshang__InitHanshangSpin takes unit u returns unit
        if ( IsHanshangSpin2(GetOwningPlayer(u)) ) then
            set udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]=CreateUnit(GetOwningPlayer(u), 'E00H', GetUnitX(u), GetUnitY(u), 0)
            set gg_unit_E00C_0217=udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
            call UnitAddItemByIdSwapped('I006', udg_H[GetConvertedPlayerId(GetOwningPlayer(u))])
            call AddMoneyPercent(GetConvertedPlayerId(GetOwningPlayer(u)) , 0.1)
            call SetUnitManaPercentBJ(udg_H[GetConvertedPlayerId(GetOwningPlayer(u))], 1000)
            call RemoveUnit(u)
            set u=udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
        endif
		if ( IsHanshangSpin1(GetOwningPlayer(u)) ) then
			call UnitAddAbility(u, 'A0KV')
			call AddDamagePercent(GetConvertedPlayerId(GetOwningPlayer(u)) , 0.08)
			return u
		else
			return u
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitHanshang takes unit u returns nothing
		set hanshang=Hanshang__InitHanshangSpin(u)
		//1
	    set Hanshang__TSpellHanshang=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(Hanshang__TSpellHanshang, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	    call TriggerAddCondition(Hanshang__TSpellHanshang, Condition(function Hanshang__TSpellHanshangCon))
	    call TriggerAddAction(Hanshang__TSpellHanshang, function Hanshang__TSpellHanshangAct)
	    //2
	    set Hanshang__TSpellHanshang2=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(Hanshang__TSpellHanshang2, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(Hanshang__TSpellHanshang2, Condition(function Hanshang__TSpellHanshang2Con))
	    call TriggerAddAction(Hanshang__TSpellHanshang2, function Hanshang__TSpellHanshang2Act)
	    //魔能等级低于5则减少受到的50%伤害
	    set Hanshang__TSpellHanshang3=CreateTrigger()
	    call TriggerRegisterUnitEvent(Hanshang__TSpellHanshang3, hanshang, EVENT_UNIT_DAMAGED)
	    call TriggerAddCondition(Hanshang__TSpellHanshang3, Condition(function Hanshang__TSpellHanshang3Con))
	    call TriggerAddAction(Hanshang__TSpellHanshang3, function Hanshang__TSpellHanshang3Act)
	    //4
	    set Hanshang__TSpellHanshang4=CreateTrigger()
	    call DisableTrigger(Hanshang__TSpellHanshang4)
	    call TriggerRegisterAnyUnitEventBJ(Hanshang__TSpellHanshang4, EVENT_PLAYER_UNIT_SPELL_ENDCAST)
	    call TriggerRegisterAnyUnitEventBJ(Hanshang__TSpellHanshang4, EVENT_PLAYER_UNIT_SPELL_FINISH)
	    call TriggerAddCondition(Hanshang__TSpellHanshang4, Condition(function Hanshang__TSpellHanshang4Con))
	    call TriggerAddAction(Hanshang__TSpellHanshang4, function Hanshang__TSpellHanshang4Act)
		call AddMoneyPercent(GetConvertedPlayerId(GetOwningPlayer(hanshang)) , 0.3)
		call TimerStart(CreateTimer(), CModeH(150 , 75), true, function Hanshang__GiveDiyu)
	endfunction

//library Hanshang ends
//library Heiyan:
//---------------------------------------------------------------------------------------------------
	
 function Heiyan__SpinTongji takes nothing returns nothing
		if not ( GetHeiyan1Spin(GetOwningPlayer(Heiyan)) ) then
			set Heiyan__ISpinHeiyan=Heiyan__ISpinHeiyan + 1
			if ( ModuloInteger(Heiyan__ISpinHeiyan, 25) == 0 and Heiyan__ISpinHeiyan > 0 ) then
				call DisplayTextToPlayer(GetOwningPlayer(Heiyan), 0., 0., "【|cff0000ff七阴之恸|r】完成进度" + I2S(Heiyan__ISpinHeiyan) + "/300.")
			endif
    if ( Heiyan__ISpinHeiyan >= 300 ) then
     call SetHeiyanSpinOK(GetOwningPlayer(Heiyan))
    endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Heiyan__IsFull takes nothing returns boolean
		return CountUnitsInGroup(Heiyan__GSacri) >= Heiyan__ISacriMaxCount
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Heiyan__CreateBasicSacrifice takes real tx,real ty returns nothing
  local unit u
  local real angle
  local real x
  local real y
  local integer i= 3
		if ( Heiyan__IsFull() ) then
			return
		endif
		if ( Heiyan__IsDouble == true ) then
			set i=1
		endif
		loop
			exitwhen i > 3
			set angle=GetRandomReal(0, 360)
			set x=YDWECoordinateX(tx + 80 * CosBJ(angle))
			set y=YDWECoordinateY(ty + 80 * SinBJ(angle))
			if ( Heiyan__BIsMojie == true ) then
				set u=CreateUnit(Player(11), 'h012', x, y, 0)
			else
				set u=CreateUnit(GetOwningPlayer(Heiyan), 'h012', x, y, 0)
			endif
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl", x, y))
		    call UnitApplyTimedLifeBJ(6 + IJ1(Heiyan , 3 , 0) + IJ2(Heiyan , 3 , 0), 'BHwe', u)
	    	call GroupAddUnit(Heiyan__GSacri, u)
		    set i=i + 1
		endloop
		set u=null
	endfunction
 function Heiyan__CreateSuperSacrifice takes real x,real y returns nothing
  local unit u
  local integer i= 3
		if ( Heiyan__IsDouble == true ) then
			set i=1
		endif
		loop
			exitwhen i > 3
			set u=CreateUnit(GetOwningPlayer(Heiyan), 'h011', x, y, 0)
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl", x, y))
		    call UnitApplyTimedLifeBJ(30, 'BHwe', u)
			set i=i + 1
		endloop
		set u=null
	endfunction
 function Heiyan__CreateSacrifice takes unit creater returns nothing
		call Heiyan__CreateBasicSacrifice(GetUnitX(creater) , GetUnitY(creater))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Heiyan__SacriDamageFlash takes nothing returns nothing
		set Heiyan__DamageSacri=GetDamageStr(Heiyan) * 0.01
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SimulateDamageHeiyan takes unit u returns boolean
		//祭品的伤害
		if ( GetUnitTypeId(u) == 'h012' ) then
			if ( IsUnitEnemy(GetTriggerUnit(), GetOwningPlayer(Heiyan)) ) then
				call DisableTrigger(GetTriggeringTrigger())
				if ( BJuexing3[GetConvertedPlayerId(GetOwningPlayer(Heiyan))] ) then
					call UnitDamageTarget(u, GetTriggerUnit(), RMaxBJ(Heiyan__DamageSacri * IJ2(Heiyan , 12 , IJ1(Heiyan , 6 , 3)), GetUnitState(GetTriggerUnit(), UNIT_STATE_MAX_LIFE) * 0.01 * 0.5), false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
				else
					call UnitDamageTarget(u, GetTriggerUnit(), Heiyan__DamageSacri * IJ2(Heiyan , 12 , IJ1(Heiyan , 6 , 3)), false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
				endif
				call EnableTrigger(GetTriggeringTrigger())
			else
				call SetUnitLifeBJ(GetTriggerUnit(), GetUnitState(GetTriggerUnit(), UNIT_STATE_LIFE) + GetUnitState(GetTriggerUnit(), UNIT_STATE_MAX_LIFE) * RJ2(Heiyan , 0.12 , RJ1(Heiyan , 0.06 , 0.03)))
				call SetUnitManaBJ(GetTriggerUnit(), GetUnitState(GetTriggerUnit(), UNIT_STATE_MANA) + 3)
			endif
				return true
		endif
		//泣罗刹后续与高级祭品
		if ( GetUnitTypeId(u) == 'hh04' ) then
			call DisableTrigger(GetTriggeringTrigger())
			call UnitDamageTarget(u, GetTriggerUnit(), Heiyan__DamageSacri * 10, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
			call EnableTrigger(GetTriggeringTrigger())
			return true
		endif
		if ( GetUnitTypeId(u) == 'h011' ) then
			call DisableTrigger(GetTriggeringTrigger())
			call UnitDamageTarget(u, GetTriggerUnit(), Heiyan__DamageSacri * 50, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
			call SetUnitLifeBJ(Heiyan, GetUnitState(Heiyan, UNIT_STATE_LIFE) + Heiyan__DamageSacri * 1.5)
			call EnableTrigger(GetTriggeringTrigger())
			return true
		endif
		return false
	endfunction
//---------------------------------------------------------------------------------------------------
	
	//魔界
 function Heiyan__YeShenJi takes nothing returns nothing
  local unit u= GetSpellAbilityUnit()
  local group l_group= CreateGroup()
  local unit l_unit
		set Heiyan__BIsMojie=not ( Heiyan__BIsMojie )
		call GroupAddGroup(Heiyan__GSacri, l_group)
		if ( Heiyan__BIsMojie == true ) then
		    call PrintSpellContent(GetOwningPlayer(u) , GetAbilityName(GetSpellAbilityId()) , "当前祭品控制权为魔界.")
		    loop
		        set l_unit=FirstOfGroup(l_group)
		        exitwhen l_unit == null
		        call GroupRemoveUnit(l_group, l_unit)
		        call SetUnitOwner(l_unit, Player(11), true)
		    endloop
		else
		    call PrintSpellContent(GetOwningPlayer(u) , GetAbilityName(GetSpellAbilityId()) , "当前祭品控制权为自己.")
		    loop
		        set l_unit=FirstOfGroup(l_group)
		        exitwhen l_unit == null
		        call GroupRemoveUnit(l_group, l_unit)
		    	call SetUnitOwner(l_unit, GetOwningPlayer(Heiyan), true)
		    endloop
		endif
		call DestroyGroup(l_group)
		set l_group=null
		set u=null
		set l_unit=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Heiyan__TSpellHeiyan00Con takes nothing returns boolean
		return ( GetKillingUnitBJ() == Heiyan and IsUnitIllusion(GetKillingUnitBJ()) == false and GetUnitPointValue(GetDyingUnit()) != 123 and GetUnitPointValue(GetDyingUnit()) != 0 and IsUnitEnemy(GetDyingUnit(), GetOwningPlayer(GetKillingUnitBJ())) and GetUnitTypeId(GetDyingUnit()) != 'h012' )
	endfunction
 function Heiyan__TSpellHeiyan00Act takes nothing returns nothing
		call Heiyan__CreateSacrifice(GetDyingUnit())
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Heiyan__HeiyanFilter takes nothing returns boolean
		return ( IsEnemy(GetFilterUnit() , Heiyan) or IsUnitInGroup(GetFilterUnit(), Heiyan__GSacri) )
	endfunction
 function Heiyan__QianGuiXie takes unit speller,unit target,real damageRate,integer abilityID returns nothing
  local unit u= speller
  local real damage= GetDamageStr(u) * damageRate
     local group l_group= CreateGroup()
     local unit l_unit
     local integer count
	    call CreateUnitEffect(GetOwningPlayer(u) , 'h008' , GetUnitX(target) , GetUnitY(target) , 0)
	    call GroupEnumUnitsInRange(l_group, GetUnitX(target), GetUnitY(target), 600, Condition(function Heiyan__HeiyanFilter))
	    set count=CountUnitsInGroup(l_group)
	    set damage=damage * ( 0.5 + 0.20 * count )
	    loop
	        set l_unit=FirstOfGroup(l_group)
	        exitwhen l_unit == null
	        call GroupRemoveUnit(l_group, l_unit)
	        if not ( IsUnitInGroup(l_unit, Heiyan__GSacri) ) then
	        	call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Undead\\UndeadDissipate\\UndeadDissipate.mdl", GetUnitX(l_unit), GetUnitY(l_unit)))
	    		call UnitDamageTarget(u, l_unit, damage, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
	        endif
	    endloop
	    //输出伤害
	    call PrintSpellAdd(GetOwningPlayer(u) , GetAbilityName(abilityID) , damage , ",敌人数量" + I2S(count) + "个")
	    call DestroyGroup(l_group)
	    set l_group=null
	    set l_unit=null
		set u=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
    function Heiyan__TSpellHeiyan2Con takes nothing returns boolean
    	return GetAttacker() == Heiyan and IsSecondSpellOK(Heiyan) == true and GetUnitState(Heiyan, UNIT_STATE_MANA) >= 250 and CountUnitsInGroup(Heiyan__GSacri) >= 1 and GetUnitAbilityLevel(Heiyan, 'A0C8') == 1
    endfunction
    function Heiyan__TSpellHeiyan2Act takes nothing returns nothing
    	call DisableTrigger(GetTriggeringTrigger())
		call Heiyan__QianGuiXie(Heiyan , GetAttackedUnitBJ() , 0.4 , 'A0C8')
		call YDWEPolledWaitNull(2)
    	call EnableTrigger(GetTriggeringTrigger())
    endfunction
    
    function Heiyan__YanLuoDianCreate takes nothing returns nothing
     local timer t= GetExpiredTimer()
     local unit u= LoadUnitHandle(spellTable, GetHandleId(t), kUYanluo)
    	if ( IsUnitAliveBJ(u) == true ) then
    		call Heiyan__CreateSacrifice(u)
    	else
    		call PauseTimer(t)
    		call DestroyTimer(t)
    		call FlushChildHashtable(spellTable, GetHandleId(t))
    	endif
    	set u=null
    	set t=null
    endfunction
    function Heiyan__YanLuoDian takes nothing returns nothing
     local timer t= CreateTimer()
     local unit u= CreateUnit(GetOwningPlayer(GetSpellAbilityUnit()), 'hh02', GetSpellTargetX(), GetSpellTargetY(), 0)
	    call UnitApplyTimedLifeBJ(30.00, 'BHwe', u)
    	call SaveUnitHandle(spellTable, GetHandleId(t), kUYanluo, u)
    	call TimerStart(t, 1, true, function Heiyan__YanLuoDianCreate)
		call PrintSpellName(GetOwningPlayer(u) , GetAbilityName(GetSpellAbilityId()))
    	set u=null
    	set t=null
    endfunction
//---------------------------------------------------------------------------------------------------
	
 function Heiyan__SheHunJue takes nothing returns nothing
		call Heiyan__CreateSuperSacrifice(GetSpellTargetX() , GetSpellTargetY())
		call PrintSpell(GetOwningPlayer(GetSpellAbilityUnit()) , GetAbilityName(GetSpellAbilityId()) , Heiyan__DamageSacri)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Heiyan__SimulateDeathHeiyanBoom takes unit u returns nothing
	    call CreateUnitEffectSpecifyTime(GetOwningPlayer(Heiyan) , 'hh04' , GetUnitX(u) , GetUnitY(u) , 0 , 1.8)
	endfunction
	
 function SimulateDeathHeiyan takes unit u returns nothing
		if not ( IsUnitInGroup(u, Heiyan__GSacri) == true ) then
			return
		endif
		call GroupRemoveUnit(Heiyan__GSacri, GetDyingUnit())
		if ( IsFourthSpellOK(Heiyan) == true and GetUnitAbilityLevel(Heiyan, 'A0D2') == 1 and GetUnitState(Heiyan, UNIT_STATE_MANA) >= 600 ) then
			call Heiyan__SimulateDeathHeiyanBoom(u)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Heiyan__QiLuoCha takes nothing returns nothing
		set Heiyan__IsDouble=true
		call PrintSpellName(GetOwningPlayer(GetSpellAbilityUnit()) , GetAbilityName(GetSpellAbilityId()))
		call YDWETimerDestroyEffect(60 , AddSpecialEffectTargetUnitBJ("chest", Heiyan, "war3mapImported\\doomtargetpurpl.mdx"))
		call YDWEPolledWaitNull(60)
		call PrintSpellContent(GetOwningPlayer(GetSpellAbilityUnit()) , GetAbilityName(GetSpellAbilityId()) , "加速结束。")
		set Heiyan__IsDouble=false
	endfunction
	
 function Heiyan__TSpellHeiyan41Con takes nothing returns boolean
		return ( GetEventDamage() > GetUnitState(Heiyan, UNIT_STATE_LIFE) and ( CountUnitsInGroup(Heiyan__GSacri) >= 1 ) and ( IsFourthSpellOK(Heiyan) == true ) and ( GetUnitAbilityLevel(Heiyan, 'A0D2') == 1 ) ) and ( GetEventDamage() < GetUnitState(Heiyan, UNIT_STATE_MAX_LIFE) or GetRandomInt(1, 2) == 1 )
	endfunction
 function Heiyan__TSpellHeiyan41Act takes nothing returns nothing
		call KillUnit(FirstOfGroup(Heiyan__GSacri))
    	call RecoverUnitHP(Heiyan , 0.1)
		call ImmuteDamageInterval(Heiyan , 0.1)
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl", GetUnitX(Heiyan), GetUnitY(Heiyan)))
		call PrintSpellContent(GetOwningPlayer(Heiyan) , GetAbilityName('A0D2') , "抵消致死伤害.")
		call Heiyan__SpinTongji()
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Heiyan__ZangJiuTianTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local real x= GetUnitX(Heiyan__UZangJiuTian)
  local real y= GetUnitY(Heiyan__UZangJiuTian)
  local integer ii= 1
		//如果祭品没有了则阵消失
		if ( CountUnitsInGroup(Heiyan__GSacri) >= 1 ) then
			loop
				exitwhen ii > 6
					call DestroyEffect(AddSpecialEffect("war3mapImported\\GhostStrike.mdx", x + CosBJ(ii * 60) * GetRandomInt(100, 500), y + SinBJ(ii * 60) * GetRandomInt(100, 500)))
				set ii=ii + 1
			endloop
			call DamageArea(Heiyan , x , y , 600 , GetDamageStr(Heiyan))
		else
			call RemoveUnit(Heiyan__UZangJiuTian)
			call PauseTimer(t)
			call DestroyTimer(t)
			set Heiyan__UZangJiuTian=null
		endif
		set t=null
	endfunction
 function Heiyan__ZangJiuTian takes nothing returns nothing
  local timer t= CreateTimer()
		call RemoveUnit(Heiyan__UZangJiuTian)
		set Heiyan__UZangJiuTian=CreateUnit(GetOwningPlayer(GetSpellAbilityUnit()), 'hh05', GetUnitX(GetSpellAbilityUnit()), GetUnitY(GetSpellAbilityUnit()), 0)
	    call PrintSpell(GetOwningPlayer(GetSpellAbilityUnit()) , GetAbilityName(GetSpellAbilityId()) , GetDamageStr(Heiyan))
		call TimerStart(t, 1, true, function Heiyan__ZangJiuTianTimer)
        call PlaySoundBJ(gg_snd_heiyan_5)
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Heiyan__TSpellHeiyanAct takes nothing returns nothing
  local integer i= 1
		if ( GetSpellAbilityId() == 'A0C7' ) then
			call Heiyan__QianGuiXie(Heiyan , GetSpellTargetUnit() , 1 , GetSpellAbilityId())
		elseif ( GetSpellAbilityId() == 'A0A3' or GetSpellAbilityId() == 'A0BI' ) then
			call Heiyan__YeShenJi()
			//不召唤祭品
			return
		elseif ( GetSpellAbilityId() == 'A0C8' ) then
			call Heiyan__YanLuoDian()
		elseif ( GetSpellAbilityId() == 'A0JH' ) then
			call Heiyan__SheHunJue()
		elseif ( GetSpellAbilityId() == 'A0D2' ) then
			call Heiyan__QiLuoCha()
		elseif ( GetSpellAbilityId() == 'A0DD' ) then
			call Heiyan__ZangJiuTian()
		endif
		if not ( GetUnitState(Heiyan, UNIT_STATE_MANA) >= 100 ) then
			return
		endif
		call Heiyan__CreateSacrifice(GetSpellAbilityUnit())
	endfunction
//---------------------------------------------------------------------------------------------------
	
	//按照12345来判断
 function LearnSkillHeiyanI takes unit learner,integer whichSpell returns nothing
  local integer i
		if ( learner == Heiyan ) then
			if ( whichSpell == 1 ) then
				set Heiyan__ISacriMaxCount=Heiyan__ISacriMaxCount + 3
			elseif ( whichSpell == 2 and IsSecondSpellOK(Heiyan) == true and GetUnitAbilityLevel(Heiyan, 'A0C8') == 1 ) then
				//技能2初始化
				set Heiyan__ISacriMaxCount=Heiyan__ISacriMaxCount + 3
			elseif ( whichSpell == 3 and IsThirdSpellOK(Heiyan) == true and GetUnitAbilityLevel(Heiyan, 'A0JH') == 1 ) then
				//技能3初始化
				set Heiyan__ISacriMaxCount=Heiyan__ISacriMaxCount + 3
				call AddSpecialEffectTargetUnitBJ("origin", Heiyan, "war3mapImported\\devilaura.mdl")
				call InitHeiyanAura()
			elseif ( whichSpell == 4 and IsFourthSpellOK(Heiyan) == true and GetUnitAbilityLevel(Heiyan, 'A0D2') == 1 ) then
				//技能4初始化
				set Heiyan__ISacriMaxCount=Heiyan__ISacriMaxCount + 3
			elseif ( whichSpell == 5 and IsFifthSpellOK(Heiyan) == true and GetUnitAbilityLevel(Heiyan, 'A0DD') == 1 ) then
				//技能5初始化
				set Heiyan__ISacriMaxCount=Heiyan__ISacriMaxCount + 6
			endif
		endif
	endfunction
 function LearnSkillHeiyan takes unit learner,integer learnSpellID returns nothing
		if ( learner == Heiyan ) then
			if ( learnSpellID == 'A0C7' ) then
				call LearnSkillHeiyanI(learner , 1)
			elseif ( learnSpellID == 'A0C8' ) then
				call LearnSkillHeiyanI(learner , 2)
			elseif ( learnSpellID == 'A0JH' ) then
				call LearnSkillHeiyanI(learner , 3)
			elseif ( learnSpellID == 'A0D2' ) then
				call LearnSkillHeiyanI(learner , 4)
			elseif ( learnSpellID == 'A0DD' ) then
				call LearnSkillHeiyanI(learner , 5)
			endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function AfterReviveHeiyan takes unit u returns nothing
		if ( u == Heiyan ) then
    		call SetUnitPathing(Heiyan, false)
    		set Heiyan__ISpinHeiyan=- 1000
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Heiyan__InitHeiyanSpin takes unit u returns unit
		if ( IsHeiyanSpin1(GetOwningPlayer(u)) ) then
			set udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]=CreateUnit(GetOwningPlayer(u), 'U003', GetUnitX(u), GetUnitY(u), 0)
			call UnitAddItemByIdSwapped('I006', udg_H[GetConvertedPlayerId(GetOwningPlayer(u))])
			call SetUnitManaPercentBJ(udg_H[GetConvertedPlayerId(GetOwningPlayer(u))], 100)
			call RemoveUnit(u)
			set Heiyan__ISacriMaxCount=Heiyan__ISacriMaxCount + 2
			return udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
		else
			return u
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitHeiyan takes unit u returns nothing
  local timer t= CreateTimer()
		set Heiyan__GSacri=CreateGroup()
		set Heiyan=Heiyan__InitHeiyanSpin(u)
		call SetUnitPathing(Heiyan, false)
		//主英雄技能
		set Heiyan__TSpellHeiyan1=CreateTrigger()
	    call TriggerRegisterUnitEvent(Heiyan__TSpellHeiyan1, Heiyan, EVENT_UNIT_SPELL_EFFECT)
	    call TriggerAddAction(Heiyan__TSpellHeiyan1, function Heiyan__TSpellHeiyanAct)
	    //主英雄杀敌事件
	    set Heiyan__TSpellHeiyan00=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(Heiyan__TSpellHeiyan00, EVENT_PLAYER_UNIT_DEATH)
	    call TriggerAddCondition(Heiyan__TSpellHeiyan00, Condition(function Heiyan__TSpellHeiyan00Con))
	    call TriggerAddAction(Heiyan__TSpellHeiyan00, function Heiyan__TSpellHeiyan00Act)
	    //英雄第二个技能攻击事件
	    set Heiyan__TSpellHeiyan2=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(Heiyan__TSpellHeiyan2, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(Heiyan__TSpellHeiyan2, Condition(function Heiyan__TSpellHeiyan2Con))
	    call TriggerAddAction(Heiyan__TSpellHeiyan2, function Heiyan__TSpellHeiyan2Act)
		//祭品伤害的刷新
		call TimerStart(t, 3, true, function Heiyan__SacriDamageFlash)
		set t=null
		//英雄第四个技能时的无敌
	    set Heiyan__TSpellHeiyan41=CreateTrigger()
	    call TriggerRegisterUnitEvent(Heiyan__TSpellHeiyan41, Heiyan, EVENT_UNIT_DAMAGED)
		call TriggerAddCondition(Heiyan__TSpellHeiyan41, Condition(function Heiyan__TSpellHeiyan41Con))
		call TriggerAddAction(Heiyan__TSpellHeiyan41, function Heiyan__TSpellHeiyan41Act)
	endfunction

//library Heiyan ends
//library Huanyi:
//---------------------------------------------------------------------------------------------------
	
 function Huanyi___RandomSetHuanyiTiaozhan takes nothing returns nothing
  local integer i= GetRandomInt(1, 16)
		if ( i == 1 ) then
			set HuanyiTiaozhanCurrent='AHH5'
		elseif ( i == 2 ) then
			set HuanyiTiaozhanCurrent='AHH6'
		elseif ( i == 3 ) then
			set HuanyiTiaozhanCurrent='AHH7'
		elseif ( i == 4 ) then
			set HuanyiTiaozhanCurrent='AHH8'
		elseif ( i == 5 ) then
			set HuanyiTiaozhanCurrent='AHH9'
		elseif ( i == 6 ) then
			set HuanyiTiaozhanCurrent='AHHA'
		elseif ( i == 7 ) then
			set HuanyiTiaozhanCurrent='AHHB'
		elseif ( i == 8 ) then
			set HuanyiTiaozhanCurrent='AHHC'
		elseif ( i == 9 ) then
			set HuanyiTiaozhanCurrent='AHHD'
		elseif ( i == 10 ) then
			set HuanyiTiaozhanCurrent='AHHE'
		elseif ( i == 11 ) then
			set HuanyiTiaozhanCurrent='AHHF'
		elseif ( i == 12 ) then
			set HuanyiTiaozhanCurrent='AHHG'
		elseif ( i == 13 ) then
			set HuanyiTiaozhanCurrent='AHHH'
		elseif ( i == 14 ) then
			set HuanyiTiaozhanCurrent='AHHI'
		elseif ( i == 15 ) then
			set HuanyiTiaozhanCurrent='AHHJ'
		else
			set HuanyiTiaozhanCurrent='AHHK'
		endif
		call DisplayTextToPlayer(GetOwningPlayer(Huanyi), 0., 0., "|cFFFF66CC【消息】|r你的" + I2S(HuanyiTiaozhanCount) + "次技能挑战为" + GetAbilityName(HuanyiTiaozhanCurrent) + ".")
	endfunction
    function Huanyi___HuanyiTiaozhanTimeout takes nothing returns nothing
    	call DisplayTextToPlayer(GetOwningPlayer(Huanyi), 0., 0., "|cFFFF66CC【消息】|r你成功在30秒内完成了" + I2S(HuanyiTiaozhanCount) + "个技能.")
    	if ( HuanyiTiaozhanCount >= 25 ) then
       call SetHuanyiSpinOK(GetOwningPlayer(Huanyi))
    	endif
        call TimerDialogDisplay(TiDiaHuanyiTiaozhan, false)
        call DestroyTimerDialog(TiDiaHuanyiTiaozhan)
        call PauseTimer(TiHuanyiTiaozhan)
        call DestroyTimer(TiHuanyiTiaozhan)
        set TiHuanyiTiaozhan=null
        set TiDiaHuanyiTiaozhan=null
		set HuanyiWrongTimes=0
        set HuanyiTiaozhanCount=0
    endfunction
 function Huanyi___HuanyiTiaozhanPanding takes nothing returns nothing
		if ( ICurrentSpell == HuanyiTiaozhanCurrent ) then
			set HuanyiTiaozhanCount=HuanyiTiaozhanCount + 1
			call Huanyi___RandomSetHuanyiTiaozhan()
			set HuanyiWrongTimes=0
		else
			set HuanyiWrongTimes=HuanyiWrongTimes + 1
			if ( HuanyiWrongTimes >= 7 ) then
				set HuanyiTiaozhanCount=0
				set HuanyiWrongTimes=0
				call DisplayTextToPlayer(GetOwningPlayer(Huanyi), 0., 0., "|cFFFF66CC【消息】|r7次按键不能正确切换,清空挑战值.")
			endif
		endif
	endfunction
 function InitHuanyiTiaozhan takes nothing returns nothing
		if ( TiHuanyiTiaozhan != null ) then
			call DisplayTextToPlayer(GetOwningPlayer(Huanyi), 0., 0., "|cFFFF66CC【消息】|r请完成目前挑战再重新输入!")
			return
		endif
        set TiHuanyiTiaozhan=CreateTimer()
        set TiDiaHuanyiTiaozhan=CreateTimerDialogBJ(TiHuanyiTiaozhan, "幻逸挑战")
        call TimerStart(TiHuanyiTiaozhan, 30, false, function Huanyi___HuanyiTiaozhanTimeout)
        call TimerDialogDisplay(TiDiaHuanyiTiaozhan, true)
        set HuanyiTiaozhanCount=1
        call Huanyi___RandomSetHuanyiTiaozhan()
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SimulateDamageHuanyi takes unit u returns boolean
		//风
		if ( GetUnitTypeId(u) == 'hhh3' ) then
			call UnitDamageTarget(Huanyi, GetTriggerUnit(), Huanyi___RDamageHuanyi * 0.3, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
			return true
		endif
		//冰火
		if ( GetUnitTypeId(u) == 'h01B' and udg_H[GetConvertedPlayerId(GetOwningPlayer(u))] == Huanyi ) then
			call UnitDamageTarget(Huanyi, GetTriggerUnit(), Huanyi___RDamageHuanyi * 0.4, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
			return true
		endif
		return false
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SimulateDeathHuanyi takes unit u returns nothing
		if ( GetUnitTypeId(u) == 'hhh7' ) then
			call DamageArea(Huanyi , GetUnitX(u) , GetUnitY(u) , 300 , Huanyi___RDamageHuanyi * 1.5)
	    	call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Other\\NeutralBuildingExplosion\\NeutralBuildingExplosion.mdl", GetUnitX(u), GetUnitY(u)))
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Huanyi___GetMultiSpell takes nothing returns integer
		if ( BJuexing3[GetConvertedPlayerId(GetOwningPlayer(Huanyi))] ) then
			return I3(IsWanjie() , 6 , 5)
		endif
		if not ( IsThirdSpellOK(Huanyi) == true and GetUnitAbilityLevel(Huanyi, 'AHH2') == 1 ) then
			return 1 + IJ2(Huanyi , 1 , 0)
		endif
		return IMaxBJ(IMinBJ(Huanyi___IMoneng / 2, I3(IsWanjie() , 4 , 5)), 1) + IJ2(Huanyi , 1 , 0)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Huanyi___NoneTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local real intTimes= LoadReal(spellTable, GetHandleId(t), kNoneIntTimes)
		call AddIntPercentImme(GetConvertedPlayerId(GetOwningPlayer(Huanyi)) , - 1 * intTimes)
		call FlushChildHashtable(spellTable, GetHandleId(t))
		call PauseTimer(t)
		call DestroyTimer(t)
		set t=null
	endfunction
 function Huanyi___None takes nothing returns nothing
  local integer times= Huanyi___GetMultiSpell()
  local real intTimes= times * 0.2
  local real time= times * 10
  local timer t= CreateTimer()
		call SaveReal(spellTable, GetHandleId(t), kNoneIntTimes, intTimes)
		call TimerStart(t, time, false, function Huanyi___NoneTimer)
		call AddIntPercentImme(GetConvertedPlayerId(GetOwningPlayer(Huanyi)) , intTimes)
		call YDWETimerDestroyEffect(time , AddSpecialEffectTargetUnitBJ("overhead", Huanyi, "war3mapImported\\music.mdx"))
		if ( times > 1 ) then
	    	call CreateSpellTextTag(I2S(times) + "重施法" , Huanyi , 0 , 100 , 0 , 4)
		endif
	    call PrintSpellContent(GetOwningPlayer(Huanyi) , GetAbilityName('AHH5') , "成功增加" + I2S(times * 20) + "%的智力，持续" + I2S(times * 10) + "秒。")
	    set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Huanyi___Fire takes real x,real y returns nothing
  local integer times= Huanyi___GetMultiSpell()
  local real damage= Huanyi___RDamageHuanyi
  local integer i= 1
		if ( times > 1 ) then
	    	call CreateSpellTextTag(I2S(times) + "重施法" , Huanyi , 0 , 100 , 0 , 4)
		endif
	    call PrintSpell(GetOwningPlayer(Huanyi) , GetAbilityName('AHH6') , damage)
		loop
			set times=times - 1
	        call CreateUnitEffect(GetOwningPlayer(Huanyi) , 'hhh1' , x , y , 0)
	        set i=1
			loop
				exitwhen i > 6
	        	call CreateUnitEffect(GetOwningPlayer(Huanyi) , 'hhh1' , x + 400 * CosBJ(i * 60) , y + 400 * SinBJ(i * 60) , 0)
				set i=i + 1
			endloop
			call DamageArea(Huanyi , x , y , 600 , damage)
			exitwhen times <= 0
			call YDWEPolledWaitNull(0.5)
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Huanyi___Lumber takes nothing returns nothing
  local integer times= Huanyi___GetMultiSpell()
  local integer attack= GetHeroInt(Huanyi, true) + GetAttack(Huanyi)
  local integer defense= GetHeroAgi(Huanyi, true) / 100 + GetDefense(Huanyi)
  local integer hp= GetHeroStr(Huanyi, true) * 10 + GetHP(Huanyi)
  local unit u
  local integer i= 1
		loop
			exitwhen i > times
			set u=CreateUnit(GetOwningPlayer(Huanyi), 'hhh2', GetUnitX(Huanyi), GetUnitY(Huanyi), 0)
			call SetUnitAnimation(u, "birth")
			call UnitApplyTimedLifeBJ(180.00, 'BHwe', u)
			call SetAttack(u , attack)
			call SetDefense(u , defense)
			call SetHP(u , hp)
			set i=i + 1
		endloop
		if ( times > 1 ) then
	    	call CreateSpellTextTag(I2S(times) + "重施法" , Huanyi , 0 , 100 , 0 , 4)
		endif
	    call PrintSpellName(GetOwningPlayer(Huanyi) , GetAbilityName('AHH8'))
	    set u=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Huanyi___Wind takes nothing returns nothing
  local integer times= Huanyi___GetMultiSpell()
  local unit u
  local integer i= 1
		loop
			exitwhen i > times
			set u=CreateUnit(GetOwningPlayer(Huanyi), 'hhh3', YDWECoordinateX(GetUnitX(Huanyi) + GetRandomInt(- 100, 100)), YDWECoordinateY(GetUnitY(Huanyi) + GetRandomInt(- 100, 100)), 0)
			call UnitApplyTimedLifeBJ(15.00, 'BHwe', u)
			set i=i + 1
		endloop
		if ( times > 1 ) then
	    	call CreateSpellTextTag(I2S(times) + "重施法" , Huanyi , 0 , 100 , 0 , 4)
		endif
	    call PrintSpellName(GetOwningPlayer(Huanyi) , GetAbilityName('AHH9'))
	    set u=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Huanyi___FireWater takes nothing returns nothing
  local integer times= Huanyi___GetMultiSpell()
  local real damage= Huanyi___RDamageHuanyi * 0.6
  local integer i= 6 * times
		if ( times > 1 ) then
	    	call CreateSpellTextTag(I2S(times) + "重施法" , Huanyi , 0 , 100 , 0 , 4)
		endif
	    call PrintSpell(GetOwningPlayer(Huanyi) , GetAbilityName('AHHA') , damage)
		loop
			set i=i - 1
	 		call SimulateSpell4(Huanyi , YDWECoordinateX(GetUnitX(Huanyi) + GetRandomReal(- 600, 600)) , YDWECoordinateY(GetUnitY(Huanyi) + GetRandomReal(- 600, 600)) , 'A05S' , 1 , 6 , "blizzard")
	 		call SimulateSpell4(Huanyi , YDWECoordinateX(GetUnitX(Huanyi) + GetRandomReal(- 600, 600)) , YDWECoordinateY(GetUnitY(Huanyi) + GetRandomReal(- 600, 600)) , 'A00U' , 1 , 6 , "blizzard")
			exitwhen i <= 0
			call YDWEPolledWaitNull(0.5 / times)
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Huanyi___FireLumber takes real x,real y returns nothing
  local integer times= Huanyi___GetMultiSpell()
  local real damage= Huanyi___RDamageHuanyi * 0.15
  local integer i= 1
  local integer ii= 1
  local real range= 150 * times
		if ( IsInForbitRegion(x , y , Huanyi) ) then
	        call DisplayTextToPlayer(GetOwningPlayer(Huanyi), 0, 0, "|cFFFF66CC【消息】|r此处禁止瞬移到达.")
	        return
		endif
		if ( times > 1 ) then
	    	call CreateSpellTextTag(I2S(times) + "重施法" , Huanyi , 0 , 100 , 0 , 4)
		endif
		call SetUnitManaBJ(Huanyi, GetUnitState(Huanyi, UNIT_STATE_MANA) - 75)
	    call PrintSpell(GetOwningPlayer(Huanyi) , GetAbilityName('AHHB') , damage)
		call SetUnitX(Huanyi, x)
		call SetUnitY(Huanyi, y)
		call IssueImmediateOrder(Huanyi, "stop")
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\Blink\\BlinkCaster.mdl", x, y))
		loop
			exitwhen i > times - 1
			set ii=1
			loop
				exitwhen ii > i * 1 + 4
				call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\Blink\\BlinkCaster.mdl", YDWECoordinateX(x + 150 * i * CosBJ(360 * ii / ( i * 1 + 4 ))), YDWECoordinateY(y + 150 * i * SinBJ(360 * ii / ( i * 1 + 4 )))))
				set ii=ii + 1
			endloop
			set i=i + 1
		endloop
		call DamageArea(Huanyi , x , y , range , damage)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Huanyi___FireWind takes real x2,real y2 returns nothing
  local integer times= Huanyi___GetMultiSpell()
  local real damage= Huanyi___RDamageHuanyi
  local integer i= 1
     local real x1
     local real y1
     local real facing
  local unit u
		if ( times > 1 ) then
	    	call CreateSpellTextTag(I2S(times) + "重施法" , Huanyi , 0 , 100 , 0 , 4)
		endif
	    call PrintSpell(GetOwningPlayer(Huanyi) , GetAbilityName('AHHC') , damage)
		loop
			set times=times - 1
		    set x1=GetUnitX(Huanyi)
		    set y1=GetUnitY(Huanyi)
		    set facing=Atan2BJ(y2 - y1, x2 - x1)
			set u=CreateUnit(GetOwningPlayer(Huanyi), 'hhh4', x1, y1, facing)
	    	call UnitApplyTimedLifeBJ(2, 'BHwe', u)
		    call YDWETimerPatternRushSlide(u , facing , 1400 , 2 , 0.05 , damage , 300. , false , true , true , "origin" , "" , "Abilities\\Spells\\Other\\Incinerate\\FireLordDeathExplode.mdl")
			exitwhen times <= 0
			call YDWEPolledWaitNull(0.5)
		endloop
	    set u=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Huanyi___WaterWindTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local unit u= LoadUnitHandle(spellTable, id, kUHuanyiQuan)
  local group l_group= CreateGroup()
  local unit l_unit
		if ( IsUnitAliveBJ(u) ) then
			call GroupEnumUnitsInRange(l_group, GetUnitX(u), GetUnitY(u), 600, null)
			loop
			    set l_unit=FirstOfGroup(l_group)
			    exitwhen l_unit == null
			    call GroupRemoveUnit(l_group, l_unit)
			    if ( IsAlly(l_unit , Huanyi) and IsUnitAliveBJ(l_unit) ) then
			    	call RecoverUnitHP(l_unit , 0.3)
			    	call RecoverUnitMP(l_unit , 20)
			    	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\AIma\\AImaTarget.mdl", GetUnitX(l_unit), GetUnitY(l_unit)))
			    endif
			endloop
			call DestroyGroup(l_group)
			set l_group=null
			set l_unit=null
		else
			call RemoveUnit(u)
			call FlushChildHashtable(spellTable, id)
			call PauseTimer(t)
			call DestroyTimer(t)
		endif
		set u=null
		set t=null
		call DestroyGroup(l_group)
		set l_unit=null
		set l_group=null
	endfunction
 function Huanyi___WaterWind takes real x,real y returns nothing
  local integer times= Huanyi___GetMultiSpell()
  local timer t= CreateTimer()
  local unit u= CreateUnit(GetOwningPlayer(Huanyi), 'hhh5', x, y, 0)
		if ( times > 1 ) then
	    	call CreateSpellTextTag(I2S(times) + "重施法" , Huanyi , 0 , 100 , 0 , 4)
		endif
    	call UnitApplyTimedLifeBJ(15 * times, 'BHwe', u)
		call SaveUnitHandle(spellTable, GetHandleId(t), kUHuanyiQuan, u)
		call TimerStart(t, 1, true, function Huanyi___WaterWindTimer)
	    call PrintSpellContent(GetOwningPlayer(Huanyi) , GetAbilityName('AHHE') , "持续" + I2S(15 * times) + "秒。")
		set t=null
		set u=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Huanyi___WaterLumberWindTimer takes nothing returns nothing
  local integer id= GetHandleId(TGuCan)
  local integer times= LoadInteger(spellTable, id, kIGuCan)
  local integer i= 1
  local integer ii= 1
		if ( IsUnitAliveBJ(Huanyi) ) then
			call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\NightElf\\NECancelDeath\\NECancelDeath.mdl", GetUnitX(Huanyi___UGucan), GetUnitY(Huanyi___UGucan)))
			loop
				exitwhen i > times - 1
				set ii=1
				loop
					exitwhen ii > i * 1 + 2
					call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\NightElf\\NECancelDeath\\NECancelDeath.mdl", YDWECoordinateX(GetUnitX(Huanyi___UGucan) + 150 * i * CosBJ(360 * ii / ( i * 1 + 2 ))), YDWECoordinateY(GetUnitY(Huanyi___UGucan) + 150 * i * SinBJ(360 * ii / ( i * 1 + 2 )))))
					set ii=ii + 1
				endloop
				set i=i + 1
			endloop
			call DamageAreaMirror(Huanyi , GetUnitX(Huanyi___UGucan) , GetUnitY(Huanyi___UGucan) , times * 150 , Huanyi___RDamageHuanyi * 0.15)
		else
			call RemoveUnit(Huanyi___UGucan)
			set Huanyi___UGucan=null
			call FlushChildHashtable(spellTable, id)
			call PauseTimer(TGuCan)
			call DestroyTimer(TGuCan)
			set TGuCan=null
		endif
	endfunction
 function Huanyi___WaterLumberWind takes real x,real y returns nothing
  local integer times= Huanyi___GetMultiSpell()
		if ( Huanyi___UGucan != null ) then
			call RemoveUnit(Huanyi___UGucan)
		endif
		if ( TGuCan != null ) then
			call PauseTimer(TGuCan)
			call DestroyTimer(TGuCan)
		endif
		set TGuCan=CreateTimer()
		set Huanyi___UGucan=CreateUnit(GetOwningPlayer(Huanyi), 'hhh6', x, y, 270)
		if ( times > 1 ) then
	    	call CreateSpellTextTag(I2S(times) + "重施法" , Huanyi , 0 , 100 , 0 , 4)
		endif
    	call SetUnitScalePercent(Huanyi___UGucan, 100.00 + times * 20.00, 100.00 + times * 20.00, 100.00 + times * 20.00)
    	call SetUnitAnimation(Huanyi___UGucan, "stand birth alternate work upgrade")
		call SaveInteger(spellTable, GetHandleId(TGuCan), kIGuCan, times)
		call TimerStart(TGuCan, 1, true, function Huanyi___WaterLumberWindTimer)
	    call PrintSpellName(GetOwningPlayer(Huanyi) , GetAbilityName('AHHG'))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Huanyi___FireLumberWind takes nothing returns nothing
  local integer times= Huanyi___GetMultiSpell()
		if ( times > 1 ) then
	    	call CreateSpellTextTag(I2S(times) + "重施法" , Huanyi , 0 , 100 , 0 , 4)
		endif
	    call PrintSpellContent(GetOwningPlayer(Huanyi) , GetAbilityName('AHHH') , ",眩晕" + I2S(times * 2) + "秒。")
 		call SimulateSpell(Huanyi , Huanyi , 'A0BI' , times , 6 , "stomp" , false , true , false)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Huanyi___FireWaterWind takes real x,real y returns nothing
  local integer times= Huanyi___GetMultiSpell()
  local real damage= Huanyi___RDamageHuanyi * 1.5
  local unit u
  local integer i= 1
		if ( times > 1 ) then
	    	call CreateSpellTextTag(I2S(times) + "重施法" , Huanyi , 0 , 100 , 0 , 4)
		endif
	    call PrintSpell(GetOwningPlayer(Huanyi) , GetAbilityName('AHHI') , damage)
		loop
			set times=times - 1
			set u=CreateUnit(GetOwningPlayer(Huanyi), 'hhh7', x, y, 0)
    		call SetUnitFlyHeight(u, 0.00, 333.00)
			exitwhen times <= 0
			call YDWEPolledWaitNull(0.5)
		endloop
		set u=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Huanyi___FireWaterLumber takes real x,real y returns nothing
  local integer times= Huanyi___GetMultiSpell()
  local integer i= 1
  local unit u
     local integer attract
	    if ( IsTerrainPathable(x, y, PATHING_TYPE_WALKABILITY) ) then
	    	call DisplayTextToPlayer(GetOwningPlayer(Huanyi), 0., 0., "|cFFFF66CC【消息】|r目标地点不能通行,技能施法无效！")
	    	return
	    endif
		set u=CreateUnit(GetOwningPlayer(Huanyi), 'hhh8', x, y, 0)
	    set attract=s__Attract_create(u , I3(IsInDiamondRegion(x , y) , 1200 , 900 * times) , 0.05 , 50 * times)
		if ( times > 1 ) then
	    	call CreateSpellTextTag(I2S(times) + "重施法" , Huanyi , 0 , 100 , 0 , 4)
		endif
	    call PrintSpellContent(GetOwningPlayer(Huanyi) , GetAbilityName('AHHJ') , "范围" + I2S(900 * times) + "s.")
		call UnitApplyTimedLifeBJ(3, 'BHwe', u)
		call s__Attract_SetForbitHero(attract)
	    call s__Attract_start(attract)
	    set u=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Huanyi___FireWaterLumberWindTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local real attrTimes= LoadReal(spellTable, GetHandleId(t), kHuanyuTimes)
		call AddIntPercentImme(GetConvertedPlayerId(GetOwningPlayer(Huanyi)) , - 1 * attrTimes)
		call AddAgiPercentImme(GetConvertedPlayerId(GetOwningPlayer(Huanyi)) , - 1 * attrTimes)
		call AddStrPercentImme(GetConvertedPlayerId(GetOwningPlayer(Huanyi)) , - 1 * attrTimes)
		call FlushChildHashtable(spellTable, GetHandleId(t))
		call PauseTimer(t)
		call DestroyTimer(t)
		set t=null
	endfunction
 function Huanyi___FireWaterLumberWind takes nothing returns nothing
  local integer times= Huanyi___GetMultiSpell()
  local real attrTimes= times * 0.2
  local real time= times * 10
  local timer t= CreateTimer()
		call SaveReal(spellTable, GetHandleId(t), kHuanyuTimes, attrTimes)
		call TimerStart(t, time, false, function Huanyi___FireWaterLumberWindTimer)
		call AddIntPercentImme(GetConvertedPlayerId(GetOwningPlayer(Huanyi)) , attrTimes)
		call AddAgiPercentImme(GetConvertedPlayerId(GetOwningPlayer(Huanyi)) , attrTimes)
		call AddStrPercentImme(GetConvertedPlayerId(GetOwningPlayer(Huanyi)) , attrTimes)
		call YDWETimerDestroyEffect(time , AddSpecialEffectTargetUnitBJ("origin", Huanyi, "war3mapImported\\blackbird.mdx"))
		if ( times > 1 ) then
	    	call CreateSpellTextTag(I2S(times) + "重施法" , Huanyi , 0 , 100 , 0 , 4)
		endif
	    call PrintSpellContent(GetOwningPlayer(Huanyi) , GetAbilityName('AHHK') , "成功增加" + I2S(times * 20) + "%的三围属性，持续" + I2S(times * 10) + "秒。")
	    set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Huanyi___Fusu takes nothing returns nothing
  local real x= GetSpellTargetX()
  local real y= GetSpellTargetY()
        call PlaySoundBJ(gg_snd_huanyi_5)
		//幻元伏心
		call Huanyi___None()
		call YDWEPolledWaitNull(1)
		//七炎焚狱
		if ( GetUnitState(Huanyi, UNIT_STATE_MANA) < 100 ) then
	    	call PrintSpellContent(GetOwningPlayer(Huanyi) , GetAbilityName('AHH4') , ",施法结束.")
			return
		endif
		call RecoverUnitMP(Huanyi , - 100)
		call Huanyi___Fire(x , y)
		call YDWEPolledWaitNull(1)
		//冰芯之铠
		if ( GetUnitState(Huanyi, UNIT_STATE_MANA) < 15 ) then
	    	call PrintSpellContent(GetOwningPlayer(Huanyi) , GetAbilityName('AHH4') , ",施法结束.")
			return
		endif
		call RecoverUnitMP(Huanyi , - 15)
 		call SimulateSpell(Huanyi , Huanyi , 'AHH7' , GetHeroLevel(Huanyi) / 2 , 5 , "frostarmoron" , false , false , true)
	    call PrintSpellName(GetOwningPlayer(Huanyi) , GetAbilityName('AHH7'))
		call YDWEPolledWaitNull(1)
 		//天古木精
		if ( GetUnitState(Huanyi, UNIT_STATE_MANA) < 100 ) then
	    	call PrintSpellContent(GetOwningPlayer(Huanyi) , GetAbilityName('AHH4') , ",施法结束.")
			return
		endif
		call RecoverUnitMP(Huanyi , - 100)
		call Huanyi___Lumber()
		call YDWEPolledWaitNull(1)
		//幻化残卷
		if ( GetUnitState(Huanyi, UNIT_STATE_MANA) < 200 ) then
	    	call PrintSpellContent(GetOwningPlayer(Huanyi) , GetAbilityName('AHH4') , ",施法结束.")
			return
		endif
		call RecoverUnitMP(Huanyi , - 200)
		call Huanyi___Wind()
		call YDWEPolledWaitNull(1)
		//冰火双绝
		if ( GetUnitState(Huanyi, UNIT_STATE_MANA) < 150 ) then
	    	call PrintSpellContent(GetOwningPlayer(Huanyi) , GetAbilityName('AHH4') , ",施法结束.")
			return
		endif
		call RecoverUnitMP(Huanyi , - 150)
		call Huanyi___FireWater()
		call YDWEPolledWaitNull(1)
		//万象归影
		if ( GetUnitState(Huanyi, UNIT_STATE_MANA) < 100 ) then
	    	call PrintSpellContent(GetOwningPlayer(Huanyi) , GetAbilityName('AHH4') , ",施法结束.")
			return
		endif
		call RecoverUnitMP(Huanyi , - 100)
		call Huanyi___FireLumber(x , y)
		call YDWEPolledWaitNull(1)
		//火轮烁日
		if ( GetUnitState(Huanyi, UNIT_STATE_MANA) < 150 ) then
	    	call PrintSpellContent(GetOwningPlayer(Huanyi) , GetAbilityName('AHH4') , ",施法结束.")
			return
		endif
		call RecoverUnitMP(Huanyi , - 150)
		call Huanyi___FireWind(x , y)
		call YDWEPolledWaitNull(1)
		//幻冥天泉
		if ( GetUnitState(Huanyi, UNIT_STATE_MANA) < 300 ) then
	    	call PrintSpellContent(GetOwningPlayer(Huanyi) , GetAbilityName('AHH4') , ",施法结束.")
			return
		endif
		call RecoverUnitMP(Huanyi , - 300)
		call Huanyi___WaterWind(x , y)
		call YDWEPolledWaitNull(1)
		//沧怒古参
		if ( GetUnitState(Huanyi, UNIT_STATE_MANA) < 1500 ) then
	    	call PrintSpellContent(GetOwningPlayer(Huanyi) , GetAbilityName('AHH4') , ",施法结束.")
			return
		endif
		call RecoverUnitMP(Huanyi , - 1500)
		call Huanyi___WaterLumberWind(x , y)
		call YDWEPolledWaitNull(1)
		//雨玥千里
		if ( GetUnitState(Huanyi, UNIT_STATE_MANA) < 200 ) then
	    	call PrintSpellContent(GetOwningPlayer(Huanyi) , GetAbilityName('AHH4') , ",施法结束.")
			return
		endif
		call RecoverUnitMP(Huanyi , - 200)
		call Huanyi___FireLumberWind()
		call YDWEPolledWaitNull(1)
		//残月流星
		if ( GetUnitState(Huanyi, UNIT_STATE_MANA) < 100 ) then
	    	call PrintSpellContent(GetOwningPlayer(Huanyi) , GetAbilityName('AHH4') , ",施法结束.")
			return
		endif
		call RecoverUnitMP(Huanyi , - 100)
		call Huanyi___FireWaterWind(x , y)
		call YDWEPolledWaitNull(1)
		//引力界场
		if ( GetUnitState(Huanyi, UNIT_STATE_MANA) < 360 ) then
	    	call PrintSpellContent(GetOwningPlayer(Huanyi) , GetAbilityName('AHH4') , ",施法结束.")
			return
		endif
		call RecoverUnitMP(Huanyi , - 360)
		call Huanyi___FireWaterLumber(x , y)
		call YDWEPolledWaitNull(1)
		//寰宇归一
		if ( GetUnitState(Huanyi, UNIT_STATE_MANA) < 800 ) then
	    	call PrintSpellContent(GetOwningPlayer(Huanyi) , GetAbilityName('AHH4') , ",施法结束.")
			return
		endif
		call RecoverUnitMP(Huanyi , - 800)
		call Huanyi___FireWaterLumberWind()
	    call PrintSpellContent(GetOwningPlayer(Huanyi) , GetAbilityName('AHH4') , ",施法结束.")
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Huanyi___TSpellHuanyi2Act takes nothing returns nothing
		call SetUnitAbilityLevel(Huanyi, 'AHH7', IMinBJ(100, GetHeroLevel(Huanyi) / 2))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Huanyi___TSpellHuanyi3Con takes nothing returns boolean
		return IsFourthSpellOK(Huanyi) == true and GetUnitAbilityLevel(Huanyi, 'AHH3') == 1 and Huanyi___IMoneng <= 5 and GetRandomInt(1, 2) == 1
	endfunction
 function Huanyi___TSpellHuanyi3Act takes nothing returns nothing
		call SetUnitLifeBJ(Huanyi, GetUnitState(Huanyi, UNIT_STATE_LIFE) + GetEventDamage())
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Huanyi___FlashPowerData takes nothing returns nothing
		call SetTextTagPosUnitBJ(Huanyi___TTMoneng, Huanyi, 20)
		if ( ( GetUnitState(Huanyi, UNIT_STATE_MANA) >= GetUnitState(Huanyi, UNIT_STATE_MAX_MANA) * 0.9 ) and Huanyi___IMoneng < 10 ) then
			call SetUnitManaPercentBJ(Huanyi, 30)
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Avatar\\AvatarCaster.mdl", GetUnitX(Huanyi), GetUnitY(Huanyi)))
			set Huanyi___IMoneng=Huanyi___IMoneng + 1
			call AddSpellPercent(GetConvertedPlayerId(GetOwningPlayer(Huanyi)) , 0.1)
			if ( Huanyi___ELowMoneng != null and Huanyi___IMoneng > 5 ) then
				call DestroyEffect(Huanyi___ELowMoneng)
				set Huanyi___ELowMoneng=null
			endif
		elseif ( ( GetUnitState(Huanyi, UNIT_STATE_MANA) < GetUnitState(Huanyi, UNIT_STATE_MAX_MANA) * 0.2 ) and Huanyi___IMoneng > 0 ) then
			call SetUnitManaPercentBJ(Huanyi, 80)
			set Huanyi___IMoneng=Huanyi___IMoneng - 1
	    	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\HealingWave\\HealingWaveTarget.mdl", GetUnitX(Huanyi), GetUnitY(Huanyi)))
			call AddSpellPercent(GetConvertedPlayerId(GetOwningPlayer(Huanyi)) , - 0.1)
			if ( Huanyi___ELowMoneng == null and Huanyi___IMoneng <= 5 ) then
				set Huanyi___ELowMoneng=AddSpecialEffectTargetUnitBJ("origin", Huanyi, "Abilities\\Spells\\Human\\ManaShield\\ManaShieldCaster.mdl")
			endif
	    else
	    	return
		endif
		call SetTextTagTextBJ(Huanyi___TTMoneng, I2S(Huanyi___IMoneng) + "级魔能", 20)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Huanyi___InitPower takes nothing returns nothing
  local timer ti= CreateTimer()
		set Huanyi___IMoneng=0
		set Huanyi___TTMoneng=CreateTextTagUnitBJ("0级魔能", Huanyi, 0, 20, 0, 50, 100, 0)
		call TimerStart(ti, 0.05, true, function Huanyi___FlashPowerData)
		set Huanyi___ELowMoneng=AddSpecialEffectTargetUnitBJ("origin", Huanyi, "Abilities\\Spells\\Human\\ManaShield\\ManaShieldCaster.mdl")
		set ti=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Huanyi___SetHuanyiSpell takes nothing returns nothing
		call SetPlayerAbilityAvailable(GetOwningPlayer(Huanyi), ICurrentSpell, false)
		if ( ICurrentSpell == 'AHHF' ) then
			call UnitRemoveAbility(Huanyi, 'AHHF')
		endif
		//0排列
		if ( not ( Huanyi___IsFire ) and not ( Huanyi___IsWater ) and not ( Huanyi___IsLumber ) and not ( Huanyi___IsWind ) ) then
			set ICurrentSpell='AHH5'
		//1排列
		elseif ( ( Huanyi___IsFire ) and not ( Huanyi___IsWater ) and not ( Huanyi___IsLumber ) and not ( Huanyi___IsWind ) ) then
			set ICurrentSpell='AHH6'
		elseif ( not ( Huanyi___IsFire ) and ( Huanyi___IsWater ) and not ( Huanyi___IsLumber ) and not ( Huanyi___IsWind ) ) then
			set ICurrentSpell='AHH7'
		elseif ( not ( Huanyi___IsFire ) and not ( Huanyi___IsWater ) and ( Huanyi___IsLumber ) and not ( Huanyi___IsWind ) ) then
			set ICurrentSpell='AHH8'
		elseif ( not ( Huanyi___IsFire ) and not ( Huanyi___IsWater ) and not ( Huanyi___IsLumber ) and ( Huanyi___IsWind ) ) then
			set ICurrentSpell='AHH9'
		//2排列
		elseif ( ( Huanyi___IsFire ) and ( Huanyi___IsWater ) and not ( Huanyi___IsLumber ) and not ( Huanyi___IsWind ) ) then
			set ICurrentSpell='AHHA'
		elseif ( ( Huanyi___IsFire ) and not ( Huanyi___IsWater ) and ( Huanyi___IsLumber ) and not ( Huanyi___IsWind ) ) then
			set ICurrentSpell='AHHB'
		elseif ( ( Huanyi___IsFire ) and not ( Huanyi___IsWater ) and not ( Huanyi___IsLumber ) and ( Huanyi___IsWind ) ) then
			set ICurrentSpell='AHHC'
		elseif ( not ( Huanyi___IsFire ) and ( Huanyi___IsWater ) and ( Huanyi___IsLumber ) and not ( Huanyi___IsWind ) ) then
			set ICurrentSpell='AHHD'
		elseif ( not ( Huanyi___IsFire ) and ( Huanyi___IsWater ) and not ( Huanyi___IsLumber ) and ( Huanyi___IsWind ) ) then
			set ICurrentSpell='AHHE'
		elseif ( not ( Huanyi___IsFire ) and not ( Huanyi___IsWater ) and ( Huanyi___IsLumber ) and ( Huanyi___IsWind ) ) then
			set ICurrentSpell='AHHF'
			call UnitAddAbility(Huanyi, 'AHHF')
		//1排列
		elseif ( not ( Huanyi___IsFire ) and ( Huanyi___IsWater ) and ( Huanyi___IsLumber ) and ( Huanyi___IsWind ) ) then
			set ICurrentSpell='AHHG'
		elseif ( ( Huanyi___IsFire ) and not ( Huanyi___IsWater ) and ( Huanyi___IsLumber ) and ( Huanyi___IsWind ) ) then
			set ICurrentSpell='AHHH'
		elseif ( ( Huanyi___IsFire ) and ( Huanyi___IsWater ) and not ( Huanyi___IsLumber ) and ( Huanyi___IsWind ) ) then
			set ICurrentSpell='AHHI'
		elseif ( ( Huanyi___IsFire ) and ( Huanyi___IsWater ) and ( Huanyi___IsLumber ) and not ( Huanyi___IsWind ) ) then
			set ICurrentSpell='AHHJ'
		//0排列
		else
			set ICurrentSpell='AHHK'
		endif
		if not ( BTianfu ) then
			call SetPlayerAbilityAvailable(GetOwningPlayer(Huanyi), ICurrentSpell, true)
		endif
		if ( TiHuanyiTiaozhan != null ) then
			call Huanyi___HuanyiTiaozhanPanding()
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Huanyi___TSpellHuanyiAct takes nothing returns nothing
		//四相
		if ( GetSpellAbilityId() == 'AHH0' ) then
			set Huanyi___IsFire=not ( Huanyi___IsFire )
			call Huanyi___SetHuanyiSpell()
		elseif ( GetSpellAbilityId() == 'AHH1' ) then
			set Huanyi___IsWater=not ( Huanyi___IsWater )
			call Huanyi___SetHuanyiSpell()
		elseif ( GetSpellAbilityId() == 'AHH2' ) then
			set Huanyi___IsLumber=not ( Huanyi___IsLumber )
			call Huanyi___SetHuanyiSpell()
		elseif ( GetSpellAbilityId() == 'AHH3' ) then
			set Huanyi___IsWind=not ( Huanyi___IsWind )
			call Huanyi___SetHuanyiSpell()
		//复苏
		elseif ( GetSpellAbilityId() == 'AHH4' ) then
			call Huanyi___Fusu()
		//幻元伏心
		elseif ( GetSpellAbilityId() == 'AHH5' ) then
			call Huanyi___None()
		//七炎焚狱
		elseif ( GetSpellAbilityId() == 'AHH6' ) then
			call Huanyi___Fire(GetSpellTargetX() , GetSpellTargetY())
		//天古木精
		elseif ( GetSpellAbilityId() == 'AHH8' ) then
			call Huanyi___Lumber()
		//幻化残卷
		elseif ( GetSpellAbilityId() == 'AHH9' ) then
			call Huanyi___Wind()
		//冰火双绝
		elseif ( GetSpellAbilityId() == 'AHHA' ) then
			call Huanyi___FireWater()
		//万象归影
		elseif ( GetSpellAbilityId() == 'AHHB' ) then
			call Huanyi___FireLumber(GetSpellTargetX() , GetSpellTargetY())
		//火轮烁日
		elseif ( GetSpellAbilityId() == 'AHHC' ) then
			call Huanyi___FireWind(GetSpellTargetX() , GetSpellTargetY())
		//幻冥天泉
		elseif ( GetSpellAbilityId() == 'AHHE' ) then
			call Huanyi___WaterWind(GetSpellTargetX() , GetSpellTargetY())
		//沧怒古参
		elseif ( GetSpellAbilityId() == 'AHHG' ) then
			call Huanyi___WaterLumberWind(GetSpellTargetX() , GetSpellTargetY())
		//雨玥千里
		elseif ( GetSpellAbilityId() == 'AHHH' ) then
			call Huanyi___FireLumberWind()
		//残月流星
		elseif ( GetSpellAbilityId() == 'AHHI' ) then
			call Huanyi___FireWaterWind(GetSpellTargetX() , GetSpellTargetY())
		//引力界场
		elseif ( GetSpellAbilityId() == 'AHHJ' ) then
			call Huanyi___FireWaterLumber(GetSpellTargetX() , GetSpellTargetY())
		//寰宇归一
		elseif ( GetSpellAbilityId() == 'AHHK' ) then
			call Huanyi___FireWaterLumberWind()
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Huanyi___FlashHuanyiDamage takes nothing returns nothing
		set Huanyi___RDamageHuanyi=GetDamageInt(Huanyi)
	endfunction
//---------------------------------------------------------------------------------------------------
	
	//按照12345来判断
 function LearnSkillHuanyiI takes unit learner,integer whichSpell returns nothing
  local integer i
		if ( learner == Huanyi ) then
			if ( whichSpell == 2 and IsSecondSpellOK(Huanyi) == true and GetUnitAbilityLevel(Huanyi, 'AHH1') == 1 ) then
				//技能2初始化
				call Huanyi___InitPower()
			elseif ( whichSpell == 4 and IsFourthSpellOK(Huanyi) == true and GetUnitAbilityLevel(Huanyi, 'AHH3') == 1 ) then
				call InitHuanyiAura()
				call AddSpecialEffectTargetUnitBJ("origin", Huanyi, "war3mapImported\\sichongjiejie_b.mdx")
			endif
		endif
	endfunction
 function LearnSkillHuanyi takes unit learner,integer learnSpellID returns nothing
		if ( learner == Huanyi ) then
			if ( learnSpellID == 'AHH0' ) then
				call LearnSkillHuanyiI(learner , 1)
			elseif ( learnSpellID == 'AHH1' ) then
				call LearnSkillHuanyiI(learner , 2)
			elseif ( learnSpellID == 'AHH2' ) then
				call LearnSkillHuanyiI(learner , 3)
			elseif ( learnSpellID == 'AHH3' ) then
				call LearnSkillHuanyiI(learner , 4)
			elseif ( learnSpellID == 'AHH4' ) then
				call LearnSkillHuanyiI(learner , 5)
			endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Huanyi___InitHuanyiSpin takes unit u returns unit
		if ( IsHuanyiSpin1(GetOwningPlayer(u)) ) then
			set udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]=CreateUnit(GetOwningPlayer(u), 'H026', GetUnitX(u), GetUnitY(u), 0)
			set gg_unit_Hant_0205=udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
			call UnitAddItemByIdSwapped('I006', udg_H[GetConvertedPlayerId(GetOwningPlayer(u))])
			call AddSpellPercent(GetConvertedPlayerId(GetOwningPlayer(u)) , 0.1)
			call SetUnitManaPercentBJ(udg_H[GetConvertedPlayerId(GetOwningPlayer(u))], 1000)
			call RemoveUnit(u)
			return udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
		else
			return u
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitHuanyi takes unit u returns nothing
  local trigger t= CreateTrigger()
		set Huanyi=Huanyi___InitHuanyiSpin(u)
		set ICurrentSpell='AHH5'
		//主英雄技能
		set Huanyi___TSpellHuanyi=CreateTrigger()
	    call TriggerRegisterUnitEvent(Huanyi___TSpellHuanyi, Huanyi, EVENT_UNIT_SPELL_EFFECT)
	    call TriggerAddAction(Huanyi___TSpellHuanyi, function Huanyi___TSpellHuanyiAct)
	    //魔能等级低于5则减少受到的50%伤害
	    call TriggerRegisterUnitEvent(t, Huanyi, EVENT_UNIT_DAMAGED)
	    call TriggerAddCondition(t, Condition(function Huanyi___TSpellHuanyi3Con))
	    call TriggerAddAction(t, function Huanyi___TSpellHuanyi3Act)
	    //刷新伤害
	    call TimerStart(CreateTimer(), 1, true, function Huanyi___FlashHuanyiDamage)
	    //冰甲的等级刷新
	    set t=CreateTrigger()
	    call TriggerRegisterUnitEvent(t, Huanyi, EVENT_UNIT_HERO_LEVEL)
	    call TriggerAddAction(t, function Huanyi___TSpellHuanyi2Act)
	    set t=null
	    //初始化技能状态
	    call UnitAddAbility(Huanyi, 'AHH6')
	    call UnitAddAbility(Huanyi, 'AHH7')
	    call UnitAddAbility(Huanyi, 'AHH8')
	    call UnitAddAbility(Huanyi, 'AHH9')
	    call UnitAddAbility(Huanyi, 'AHHA')
	    call UnitAddAbility(Huanyi, 'AHHB')
	    call UnitAddAbility(Huanyi, 'AHHC')
	    call UnitAddAbility(Huanyi, 'AHHD')
	    call UnitAddAbility(Huanyi, 'AHHE')
	    call UnitAddAbility(Huanyi, 'AHHG')
	    call UnitAddAbility(Huanyi, 'AHHH')
	    call UnitAddAbility(Huanyi, 'AHHI')
	    call UnitAddAbility(Huanyi, 'AHHJ')
	    call UnitAddAbility(Huanyi, 'AHHK')
		call SetPlayerAbilityAvailable(GetOwningPlayer(Huanyi), 'AHH6', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(Huanyi), 'AHH7', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(Huanyi), 'AHH8', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(Huanyi), 'AHH9', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(Huanyi), 'AHHA', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(Huanyi), 'AHHB', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(Huanyi), 'AHHC', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(Huanyi), 'AHHD', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(Huanyi), 'AHHE', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(Huanyi), 'AHHF', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(Huanyi), 'AHHG', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(Huanyi), 'AHHH', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(Huanyi), 'AHHI', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(Huanyi), 'AHHJ', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(Huanyi), 'AHHK', false)
		//幻逸回魔
		call SetPlayerAbilityAvailable(GetOwningPlayer(Huanyi), 'A0HX', false)
	endfunction

//library Huanyi ends
//library Kaisa:
//---------------------------------------------------------------------------------------------------
	
 function Kaisa__CreateEffect1 takes real x,real y returns nothing
  local integer i= 1
		loop
		    exitwhen i > 6
		    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Thunderclap\\ThunderClapCaster.mdl", YDWECoordinateX(x + 400 * CosBJ(i * 360.0 / ( 6 ))), YDWECoordinateY(y + 400 * SinBJ(i * 360.0 / ( 6 )))))
		    set i=i + 1
		endloop
	endfunction
 function SimulateDamageKaisa takes unit u returns boolean
		//小牛头的伤害
		if ( GetUnitTypeId(u) == 'h02R' ) then
			call Kaisa__CreateEffect1(GetUnitX(u) , GetUnitY(u))
			call DamageArea(kaisa , GetUnitX(u) , GetUnitY(u) , 600 , GetDamageStr(kaisa) * 0.4)
			if ( GetRandomInt(1, 7) == 1 ) then
				call CreateSpellTextTag("地震" , u , 0 , 100 , 50 , 3)
				call SimulateSpell(u , GetTriggerUnit() , 'A0NP' , 1 , 6 , "stomp" , false , true , false)
			endif
			return true
		endif
		return false
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SimulateDeathKaisa takes unit u returns nothing
		if ( GetUnitTypeId(u) == 'h02R' ) then
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\BattleRoar\\RoarCaster.mdl", GetUnitX(u), GetUnitY(u)))
            call FlushChildHashtable(YDHT, GetHandleId(u))
            call RemoveUnit(u)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Kaisa__DestroyLiebianTimer takes nothing returns nothing
		call PauseTimer(Kaisa__TLiebian)
		call DestroyTimer(Kaisa__TLiebian)
		set Kaisa__TLiebian=null
		call SetUnitScalePercent(kaisa, 100.00, 100.00, 100.00)
		call s__TextTagBind_deallocate(Kaisa__TTBLiebian)
		set Kaisa__ILiebian=0
		set BLiebian=false
		set Kaisa__RLiebianX=0.
		set Kaisa__RLiebianY=0.
		set Kaisa__RDistanceLiebian=0.
		call DestroyEffect(Kaisa__ELiebian)
	endfunction
 function Kaisa__TiandiliebianTimer takes nothing returns nothing
		if ( IsUnitAliveBJ(kaisa) and BLiebian ) then
    		set Kaisa__ILiebian=IMinBJ(800, Kaisa__ILiebian + 1)
			call s__TextTagBind_setContent(Kaisa__TTBLiebian,I2S(Kaisa__ILiebian / 4) + "%")
    		call SetUnitScalePercent(kaisa, 100.00 + 0.25 * Kaisa__ILiebian, 100.00 + 0.25 * Kaisa__ILiebian, 100.00 + 0.25 * Kaisa__ILiebian)
    		if ( Kaisa__RLiebianX != GetUnitX(kaisa) or Kaisa__RLiebianY != GetUnitY(kaisa) ) then
	    		set Kaisa__RDistanceLiebian=Kaisa__RDistanceLiebian + GetDistance(Kaisa__RLiebianX , Kaisa__RLiebianY , GetUnitX(kaisa) , GetUnitY(kaisa))
	    		set Kaisa__RLiebianX=GetUnitX(kaisa)
	    		set Kaisa__RLiebianY=GetUnitY(kaisa)
	    		if ( Kaisa__RDistanceLiebian >= 250.0 ) then
	    			call DamageArea(kaisa , GetUnitX(kaisa) , GetUnitY(kaisa) , 450.0 , GetDamageStr(kaisa) * 0.01 * I2R(Kaisa__ILiebian) * 0.25)
	    			call DestroyEffect(AddSpecialEffect("war3mapImported\\longj2.mdl", GetUnitX(kaisa), GetUnitY(kaisa)))
	    			set Kaisa__RDistanceLiebian=0.0
	    		endif
    		endif
    	else
    		call Kaisa__DestroyLiebianTimer()
		endif
	endfunction
 function Tiandiliebian takes nothing returns nothing
		if ( Kaisa__TLiebian == null ) then
			set Kaisa__TLiebian=CreateTimer()
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\BattleRoar\\RoarCaster.mdl", GetUnitX(kaisa), GetUnitY(kaisa)))
			call TimerStart(Kaisa__TLiebian, 0.1, true, function Kaisa__TiandiliebianTimer)
			set Kaisa__ILiebian=0
			set BLiebian=true
			set Kaisa__TTBLiebian=s__TextTagBind_create(kaisa , 35 , 35)
			set Kaisa__ELiebian=AddSpecialEffectTargetUnitBJ("chest", kaisa, "war3mapImported\\DefenceMatrix.mdl")
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Kaisa__CreateEffect2 takes real x,real y returns nothing
  local integer i= 1
		loop
		    exitwhen i > 6
		    call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Other\\NeutralBuildingExplosion\\NeutralBuildingExplosion.mdl", YDWECoordinateX(x + 300 * CosBJ(i * 360.0 / ( 6 ))), YDWECoordinateY(y + 300 * SinBJ(i * 360.0 / ( 6 )))))
		    set i=i + 1
		endloop
	endfunction
 function Kaisa__ChongzhuangTimer takes nothing returns nothing
     local timer t= GetExpiredTimer()
     local integer id= GetHandleId(t)
	    //i是速度
     local integer i= LoadInteger(spellTable, id, 1)
  local real facing= LoadReal(spellTable, GetHandleId(t), 2)
  local group temp= GetEnemyGroup(GetOwningPlayer(kaisa) , GetUnitX(kaisa) , GetUnitY(kaisa) , 400)
  local real xp= GetUnitX(kaisa) + CosBJ(facing) * I2R(i)
  local real yp= GetUnitY(kaisa) + SinBJ(facing) * I2R(i)
		//判断数量
	    if ( CountUnitsInGroup(temp) == 0 and xp < yd_MapMaxX and xp > yd_MapMinX and yp < yd_MapMaxY and yp > yd_MapMinY ) then
	    	//速度加快
	        set i=i + 2
	        call SaveInteger(spellTable, GetHandleId(t), 1, i)
			call SetUnitX(kaisa, xp)
			call SetUnitY(kaisa, yp)
	    else
	    	//伤害：每2秒加100%？
	    	call DamageArea(kaisa , GetUnitX(kaisa) , GetUnitY(kaisa) , 600 , GetDamageStr(kaisa) * ( R2I(i) / 30.0 ))
	    	call Kaisa__CreateEffect2(GetUnitX(kaisa) , GetUnitY(kaisa))
	    	call PrintSpell(GetOwningPlayer(kaisa) , GetAbilityName('A0NQ') , GetDamageStr(kaisa) * ( R2I(i) / 30.0 ))
	    	call SimulateSpell(kaisa , kaisa , 'A0NN' , i / 100 , 6 , "stomp" , false , true , false)
	    	call PauseUnit(kaisa, false)
	    	call UnitRemoveAbility(kaisa, 'Avul')
	        call PauseTimer(t)
	        call FlushChildHashtable(spellTable, id)
	        call DestroyTimer(t)
			call SetUnitTimeScale(kaisa, 3.00)
	    endif
	    call DestroyGroup(temp)
	    set temp=null
	    set t=null
	endfunction
 function Tianlingchongzhuang takes nothing returns nothing
  local real facing= GetFacingBetweenXY(GetUnitX(kaisa) , GetUnitY(kaisa) , GetSpellTargetX() , GetSpellTargetY())
  local timer t= CreateTimer()
		call PauseUnit(kaisa, true)
		call UnitAddAbility(kaisa, 'Avul')
		call SetUnitFacing(kaisa, facing)
		call SaveInteger(spellTable, GetHandleId(t), 1, 20)
		call SaveReal(spellTable, GetHandleId(t), 2, facing)
		call TimerStart(t, 0.05, true, function Kaisa__ChongzhuangTimer)
		call SetUnitAnimationByIndex(kaisa, 3)
		call SetUnitTimeScale(kaisa, 3.00)
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Kaisa__CreateXiaoNiutou takes unit u,real lifeTime returns nothing
  local real x= YDWECoordinateX(GetUnitX(u) + GetRandomReal(- 600.0, 600.0))
  local real y= YDWECoordinateY(GetUnitY(u) + GetRandomReal(- 600.0, 600.0))
     local unit temp= CreateUnit(GetOwningPlayer(u), 'h02R', x, y, 0)
		call DestroyEffect(AddSpecialEffect("war3mapImported\\LionSong.mdx", x, y))
    	call UnitApplyTimedLifeBJ(lifeTime, 'BHwe', temp)
    	set temp=null
	endfunction
 function Kaisa__PeriodicCreateNiutou takes nothing returns nothing
     local timer t= GetExpiredTimer()
     local integer id= GetHandleId(t)
  local unit u= LoadUnitHandle(spellTable, GetHandleId(t), 1)
	    if ( IsUnitAliveBJ(u) ) then
	    	call Kaisa__CreateXiaoNiutou(u , 5.0)
	    else
	        call PauseTimer(t)
	        call FlushChildHashtable(spellTable, id)
	        call DestroyTimer(t)
	    endif
	    set t=null
	endfunction
 function Kaisa__TimerCreateNiutou takes unit u returns nothing
  local timer t= CreateTimer()
		call SaveUnitHandle(spellTable, GetHandleId(t), 1, u)
		call TimerStart(t, 5, true, function Kaisa__PeriodicCreateNiutou)
		set t=null
	endfunction
 function Tuteng takes nothing returns nothing
  local unit u= null
		if ( BFanzhuanKS and IsFifthSpellOK(kaisa) and GetUnitAbilityLevel(kaisa, 'A0NO') == 1 ) then
			if ( CountUnitsInGroup(Kaisa__GTuteng) > 2 ) then
				set u=FirstOfGroup(Kaisa__GTuteng)
				call DestroyEffect(AddSpecialEffect("war3mapImported\\LionSong.mdx", GetUnitX(u), GetUnitY(u)))
				call GroupRemoveUnit(Kaisa__GTuteng, u)
				call RemoveUnit(u)
			endif
			set u=CreateUnit(GetOwningPlayer(kaisa), 'h02S', GetUnitX(kaisa), GetUnitY(kaisa), 0)
			call DestroyEffect(AddSpecialEffect("war3mapImported\\LionSong.mdx", GetUnitX(u), GetUnitY(u)))
			call GroupAddUnit(Kaisa__GTuteng, u)
			call Kaisa__TimerCreateNiutou(u)
	    	call PrintSpellName(GetOwningPlayer(kaisa) , GetAbilityName('A0NO'))
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Kaisa__Wanhuangtuteng takes nothing returns nothing
  local group l_group2= CreateGroup()
  local unit l_unit= null
		call GroupAddGroup(Kaisa__GTuteng, l_group2)
		loop
		    set l_unit=FirstOfGroup(l_group2)
		    exitwhen l_unit == null
		    call GroupRemoveUnit(l_group2, l_unit)
		    call Kaisa__CreateXiaoNiutou(l_unit , 15.0)
		    call Kaisa__CreateXiaoNiutou(l_unit , 15.0)
		    call Kaisa__CreateXiaoNiutou(l_unit , 15.0)
		endloop
		call DestroyGroup(l_group2)
		set l_group2=null
		set l_unit=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CountKaisa takes unit u returns nothing
		if not ( GetKaisaSpin(GetOwningPlayer(kaisa)) ) then
			if not ( IsUnitAliveBJ(u) ) then
				set Kaisa__INiuSpinCount=Kaisa__INiuSpinCount + 1
				if ( ModuloInteger(Kaisa__INiuSpinCount, 100) == 0 ) then
					call DisplayTextToPlayer(GetOwningPlayer(kaisa), 0., 0., "【|cFF6699FF熔日煌世|r】完成进度" + I2S(Kaisa__INiuSpinCount) + "/2500.")
				endif
     if ( Kaisa__INiuSpinCount >= 2500 ) then
      call SetKaisaSpinOK(GetOwningPlayer(kaisa))
     endif
			endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function KaisaSanjiejuxing takes nothing returns nothing
		if ( BJuexing3[GetConvertedPlayerId(GetOwningPlayer(kaisa))] ) then
			call SetUnitManaPercentBJ(kaisa, 100)
			call ImmuteDamageInterval(kaisa , 3)
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl", GetUnitX(seyu), GetUnitY(seyu)))
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Kaisa__Lianxueyiji takes nothing returns nothing
  local unit target= GetSpellTargetUnit()
     local real facing= Atan2BJ(GetUnitY(target) - GetUnitY(kaisa), GetUnitX(target) - GetUnitX(kaisa))
  local real damage= ( GetUnitState(kaisa, UNIT_STATE_LIFE) / 500.0 ) * SquareRoot(I2R(GetHeroLevel(kaisa))) * GetUnitState(kaisa, UNIT_STATE_MANA)
     local integer i= 1
	    call PrintSpell(GetOwningPlayer(kaisa) , GetAbilityName(GetSpellAbilityId()) , damage)
	    loop
	    	exitwhen i > 6
       		call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Other\\NeutralBuildingExplosion\\NeutralBuildingExplosion.mdl", YDWECoordinateX(GetUnitX(kaisa) + 300.00 * I2R(i) * CosBJ(facing)), YDWECoordinateY(GetUnitY(kaisa) + 300.00 * I2R(i) * SinBJ(facing))))
	    	set i=i + 1
	    endloop
	    call UnitDamageTarget(kaisa, target, damage, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
	    call SetUnitManaPercentBJ(kaisa, 1)
	    call SetUnitLifePercentBJ(kaisa, 1)
	    set target=null
	endfunction
//---------------------------------------------------------------------------------------------------
	//按照12345来判断
 function LearnSkillKaisaI takes unit learner,integer whichSpell returns nothing
  local integer i= 0
		if ( learner == kaisa ) then
			if ( whichSpell == 3 and IsThirdSpellOK(kaisa) and GetUnitAbilityLevel(kaisa, 'A007') == 1 ) then
				//忠诚之躯
		        call EnableTrigger(gg_trg_____________17)
		        call EnableTrigger(gg_trg_____________18)
			elseif ( whichSpell == 3 and IsThirdSpellOK(kaisa) and GetUnitAbilityLevel(kaisa, 'A0NR') == 1 ) then
				//天地裂变
				call InitKaisaAura()
			elseif ( whichSpell == 4 and IsFourthSpellOK(kaisa) and GetUnitAbilityLevel(kaisa, 'A0B0') == 1 ) then
				//战栗灵魂
		        call EnableTrigger(gg_trg_____________19)
		        call EnableTrigger(gg_trg_____________22)
			elseif ( whichSpell == 4 and IsFourthSpellOK(kaisa) and GetUnitAbilityLevel(kaisa, 'A0NQ') == 1 ) then
				//天灵冲撞
		        call EnableTrigger(gg_trg_____________22)
			endif
		endif
	endfunction
 function LearnSkillKaisa takes unit learner,integer learnSpellID returns nothing
		if ( learner == kaisa ) then
			if ( learnSpellID == 'A007' or learnSpellID == 'A0NR' ) then
				call LearnSkillKaisaI(learner , 3)
			elseif ( learnSpellID == 'A0B0' or learnSpellID == 'A0NQ' ) then
				call LearnSkillKaisaI(learner , 4)
			endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Kaisa__TSpellKaisaAct takes nothing returns nothing
		if ( GetSpellAbilityId() == 'AOhx' ) then
			call Kaisa__Lianxueyiji()
		elseif ( GetSpellAbilityId() == 'A0NR' ) then
			//天地裂变
			call Tiandiliebian()
		elseif ( GetSpellAbilityId() == 'A0NQ' ) then
			//天灵冲撞
			call Tianlingchongzhuang()
		elseif ( GetSpellAbilityId() == 'A0NO' ) then
			//万荒图腾
			call Kaisa__Wanhuangtuteng()
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitFanzhuanKaisa takes nothing returns nothing
		call UnitAddAbility(kaisa, 'A0NM')
		call SetPlayerAbilityAvailable(GetOwningPlayer(kaisa), 'A0NM', false)
		call BJDebugMsg("|cFFFF66CC【消息】|r" + GetPlayerName(GetOwningPlayer(kaisa)) + "变化了英雄|cffff0000凯撒|r的技能形态!")
		call BJDebugMsg("|cFFFF66CC【消息】|r" + GetPlayerName(GetOwningPlayer(kaisa)) + "变化了英雄|cffff0000凯撒|r的技能形态!")
		call BJDebugMsg("|cFFFF66CC【消息】|r" + GetPlayerName(GetOwningPlayer(kaisa)) + "变化了英雄|cffff0000凯撒|r的技能形态!")
		call BJDebugMsg("|cFFFF66CC【消息】|r" + GetPlayerName(GetOwningPlayer(kaisa)) + "变化了英雄|cffff0000凯撒|r的技能形态!")
		set BFanzhuanKS=true
		call CinematicFadeBJ(bj_CINEFADETYPE_FADEOUTIN, 3.00, "ReplaceableTextures\\CameraMasks\\White_mask.blp", 100.00, 0, 0, 0)
		call PlaySoundBJ(gg_snd_fanzhuan)
		set Kaisa__GTuteng=CreateGroup()
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Kaisa__InitKaisaSpin takes unit u returns unit
		if ( IsKaisaSpin1(GetOwningPlayer(u)) ) then
			set udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]=CreateUnit(GetOwningPlayer(u), 'O002', GetUnitX(u), GetUnitY(u), 0)
			set gg_unit_Ocbh_0251=udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
			call UnitAddItemByIdSwapped('I006', udg_H[GetConvertedPlayerId(GetOwningPlayer(u))])
			call SetUnitManaPercentBJ(udg_H[GetConvertedPlayerId(GetOwningPlayer(u))], 1000)
			call RemoveUnit(u)
			return udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
		else
			return u
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitKaisa takes unit u returns nothing
		set kaisa=Kaisa__InitKaisaSpin(u)
		//主英雄技能
		set Kaisa__TSpellKaisa=CreateTrigger()
	    call TriggerRegisterUnitEvent(Kaisa__TSpellKaisa, kaisa, EVENT_UNIT_SPELL_EFFECT)
	    call TriggerAddAction(Kaisa__TSpellKaisa, function Kaisa__TSpellKaisaAct)
		call TriggerRegisterUnitEvent(gg_trg_____________7, kaisa, EVENT_UNIT_DAMAGED)
      if ( DzAPI_Map_GetMapLevel(GetOwningPlayer(kaisa)) >= 3 or IsPIV(GetOwningPlayer(kaisa)) ) then
	    	call CreateFanzhuanItem(kaisa)
      endif
	endfunction

//library Kaisa ends
//library Lichi:
//---------------------------------------------------------------------------------------------------
	
 function Lichi___SpinTongji takes nothing returns nothing
		if not ( GetLichi1Spin(GetOwningPlayer(lichi)) ) then
			set Lichi___ISpinLichi=Lichi___ISpinLichi + 1
			if ( ModuloInteger(Lichi___ISpinLichi, 10) == 0 ) then
				call DisplayTextToPlayer(GetOwningPlayer(lichi), 0., 0., "【|cffff6800谜幻逸空|r】完成进度" + I2S(Lichi___ISpinLichi) + "/100.")
			endif
    if ( Lichi___ISpinLichi >= 100 ) then
     call SetLichiSpinOK(GetOwningPlayer(lichi))
    endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsLichiSpin takes nothing returns boolean
		return GetUnitTypeId(lichi) == 'H02E'
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SimulateDeathLichi takes unit u returns nothing
		if ( GetUnitTypeId(u) == 'h02A' ) then
			call DamageArea(lichi , GetUnitX(u) , GetUnitY(u) , 350 , Lichi___LichiDamage * 0.25)
 			call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Undead\\UndeadDissipate\\UndeadDissipate.mdl", GetUnitX(u), GetUnitY(u)))
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SimulateDamageLichi takes unit u returns boolean
		//幻影
		if ( GetUnitTypeId(u) == 'h028' or GetUnitTypeId(u) == 'h02F' ) then
			call UnitDamageTarget(lichi, GetTriggerUnit(), Lichi___LichiDamage * 0.05 * IJ3(lichi , 2 , 1), false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
			return true
		endif
		if ( GetUnitTypeId(u) == 'h02A' ) then
			call UnitDamageTarget(lichi, GetTriggerUnit(), Lichi___LichiDamage * 0.01, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
			return true
		endif
		return false
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Lichi___GetHuanyingIndex takes integer id returns integer
		if ( ModuloInteger(id, 2) == 1 ) then
			// 奇数
			return ( id / 2 ) + 1
		else
			return - 1 * ( id / 2 )
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Lichi___GetHuanyingCount takes nothing returns integer
  local integer i= 1
  local integer result= 0
		loop
			exitwhen i > IMaxHuanying
			if ( Lichi___UHuan[i] != null ) then
				set result=result + 1
			endif
			set i=i + 1
		endloop
		return result
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CreateHuanying takes nothing returns nothing
  local integer i= 1
  local integer index= 0
		loop
			exitwhen i > IMaxHuanying
			if ( Lichi___UHuan[i] == null ) then
				set index=Lichi___GetHuanyingIndex(i)
				set Lichi___UHuan[i]=CreateUnit(GetOwningPlayer(lichi), I3(IsLichiSpin() , 'h02F' , 'h028'), GetUnitX(lichi) + IAbsBJ(index) * 150 * CosBJ(GetUnitFacing(lichi) + R3(index > 0 , 90. , - 90.)), GetUnitY(lichi) + IAbsBJ(index) * 150 * SinBJ(GetUnitFacing(lichi) + R3(index > 0 , 90. , - 90.)), GetUnitFacing(lichi))
				call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl", GetUnitX(Lichi___UHuan[i]), GetUnitY(Lichi___UHuan[i])))
        		call UnitAddType(Lichi___UHuan[i], UNIT_TYPE_PEON)
    			call SetUnitAcquireRange(Lichi___UHuan[i], 1.00)
        		call IssueTargetOrder(Lichi___UHuan[i], "attack", lichi)
				return
			endif
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function KillCountHuanying takes integer i returns nothing
		if ( BTianfu ) then
			return
		endif
		set Lichi___IHuanyingCount=Lichi___IHuanyingCount + i
		if ( Lichi___IHuanyingCount >= 200 ) then
			call CreateHuanying()
			set Lichi___IHuanyingCount=0
		elseif ( ModuloInteger(Lichi___IHuanyingCount, 50) == 0 ) then
    		call CreateTextTagA("影:" + I2S(Lichi___IHuanyingCount) , lichi , 0 , 100 , 100 , 3 , 12)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Lichi___JudgeLichiMove takes nothing returns nothing
  local integer i
  local integer index
    	if ( Lichi___NiLiX != GetUnitX(lichi) or Lichi___NiLiY != GetUnitY(lichi) ) then
    		set Lichi___NiLiX=GetUnitX(lichi)
    		set Lichi___NiLiY=GetUnitY(lichi)
    		set i=1
    		loop
    			exitwhen i > IMaxHuanying
				set index=Lichi___GetHuanyingIndex(i)
    			call SetUnitX(Lichi___UHuan[i], GetUnitX(lichi) + IAbsBJ(index) * 150 * CosBJ(GetUnitFacing(lichi) + R3(index > 0 , 90. , - 90.)))
    			call SetUnitY(Lichi___UHuan[i], GetUnitY(lichi) + IAbsBJ(index) * 150 * SinBJ(GetUnitFacing(lichi) + R3(index > 0 , 90. , - 90.)))
    			call SetUnitFacing(Lichi___UHuan[i], GetUnitFacing(lichi))
    			set i=i + 1
    		endloop
    		//移动
    		if ( Lichi___ILichiDoing != 1 ) then
    			set Lichi___ILichiDoing=1
    			set i=1
    			loop
    				exitwhen i > IMaxHuanying
        			call IssueImmediateOrder(Lichi___UHuan[i], "stop")
	    			call SetUnitAnimationByIndex(Lichi___UHuan[i], 2)
    				set i=i + 1
    			endloop
    		endif
    	else
    		//静止
    		if ( Lichi___ILichiDoing == 1 ) then
    			set Lichi___ILichiDoing=0
    			call SetUnitAnimationByIndex(lichi, 1)
    			set i=1
    			loop
    				exitwhen i > IMaxHuanying
	    			call SetUnitAnimationByIndex(Lichi___UHuan[i], 1)
        			call IssueImmediateOrder(Lichi___UHuan[i], "stop")
    				set i=i + 1
    			endloop
    		endif
    	endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
	//神月盈爆炸
 function Lichi___ShenyueyingBoom takes nothing returns nothing
  local integer i= 1
  local real x= GetUnitX(lichi)
  local real y= GetUnitY(lichi)
  local real damage= Lichi___LichiDamage * 5
		call DestroyEffect(AddSpecialEffect("war3mapImported\\DarkNova.mdx", x, y))
		loop
			exitwhen i > 6
			call DestroyEffect(AddSpecialEffect("war3mapImported\\DarkNova.mdx", YDWECoordinateX(x + 900 * CosBJ(i * 60)), YDWECoordinateY(y + 900 * SinBJ(i * 60))))
			set i=i + 1
		endloop
	    call PrintSpell(GetOwningPlayer(lichi) , GetAbilityName('A0MP') , damage)
		call DamageArea(lichi , x , y , 1800 , damage)
		call Lichi___SpinTongji()
	endfunction
	//神月盈判断
 function Lichi___ShenyueyingJudge takes nothing returns nothing
		if not ( Lichi___BShenyue ) then
			if ( IsUnitInGroup(GetEnumUnit(), Lichi___GShenyue[1]) and IsUnitInGroup(GetEnumUnit(), Lichi___GShenyue[2]) and IsUnitInGroup(GetEnumUnit(), Lichi___GShenyue[3]) and IsUnitInGroup(GetEnumUnit(), Lichi___GShenyue[4]) ) then
				set Lichi___BShenyue=true
			endif
		endif
	endfunction
	//伤害并进行统计
 function Lichi___ShenyueyingCount takes real x,real y,real damage returns nothing
        local group l_group= CreateGroup()
        local unit l_unit
        set Lichi___IShenyue=I3(Lichi___IShenyue >= 4 , 1 , Lichi___IShenyue + 1)
        call GroupClear(Lichi___GShenyue[Lichi___IShenyue])
        call GroupEnumUnitsInRange(l_group, x, y, 350 + RJ3(lichi , 50 , 0), null)
        loop
            set l_unit=FirstOfGroup(l_group)
            exitwhen l_unit == null
            call GroupRemoveUnit(l_group, l_unit)
            if ( IsEnemy(l_unit , lichi) ) then
                call UnitDamageTarget(lichi, l_unit, damage, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
                call GroupAddUnit(Lichi___GShenyue[Lichi___IShenyue], l_unit)
            endif
        endloop
        call DestroyGroup(l_group)
        set l_group=null
        set l_unit=null
        call ForGroup(Lichi___GShenyue[Lichi___IShenyue], function Lichi___ShenyueyingJudge)
        //如果有就爆炸
        if ( Lichi___BShenyue ) then
        	call Lichi___ShenyueyingBoom()
        endif
        set Lichi___BShenyue=false
	endfunction
 function Lichi___Yingyanjue takes integer abilityID,real x,real y returns nothing
  local real damage= Lichi___LichiDamage
  local integer i= 1
  local integer index= 0
  local real nx= 0.
  local real ny= 0.
	    call PrintSpell(GetOwningPlayer(lichi) , GetAbilityName(abilityID) , damage)
	    call DestroyEffect(AddSpecialEffect("war3mapImported\\lichi1.mdx", x, y))
	    if ( IsFourthSpellOK(lichi) and GetUnitAbilityLevel(lichi, 'A0MP') == 1 and abilityID != 'A0MN' ) then
	    	call Lichi___ShenyueyingCount(x , y , damage)
	    else
			call DamageArea(lichi , x , y , 350 + RJ3(lichi , 50 , 0) + R3(IsLichiSpin() , 25 , 0) , damage)
	    endif
		loop
			exitwhen i > IMaxHuanying
			if ( Lichi___UHuan[i] != null ) then
				set index=Lichi___GetHuanyingIndex(i)
				set nx=x + IAbsBJ(index) * 150 * CosBJ(GetUnitFacing(lichi) + R3(index > 0 , 90. , - 90.))
				set ny=y + IAbsBJ(index) * 150 * SinBJ(GetUnitFacing(lichi) + R3(index > 0 , 90. , - 90.))
				call DamageArea(lichi , nx , ny , 350 + RJ3(lichi , 50 , 0) + R3(IsLichiSpin() , 25 , 0) , damage)
	    		call DestroyEffect(AddSpecialEffect("war3mapImported\\lichi1.mdx", nx, ny))
    		    call SetUnitAnimation(Lichi___UHuan[i], "Spell Throw")
			endif
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
    function Lichi___TAttackLichiCon takes nothing returns boolean
    	return GetAttacker() == lichi or GetAttackedUnitBJ() == lichi
    endfunction
    function Lichi___TAttackLichiAct takes nothing returns nothing
     local integer i
    	if ( GetAttacker() == lichi ) then
    		//英雄攻击,命令幻影攻击
    		if not ( Lichi___BHuanAttack ) then
    			set Lichi___BHuanAttack=true
    			set i=1
    			loop
    				exitwhen i > IMaxHuanying
					if ( Lichi___UHuan[i] != null ) then
        				call IssueTargetOrder(Lichi___UHuan[i], "attack", GetAttackedUnitBJ())
					endif
    				set i=i + 1
    			endloop
    			call YDWEPolledWaitNull(0.6)
    			set Lichi___BHuanAttack=false
    		endif
    	else
    		//英雄被攻击，放第二个技能
    		if ( not ( Lichi___BTongyun ) and IsSecondSpellOK(lichi) and GetUnitAbilityLevel(lichi, 'A0MN') == 1 and GetUnitState(lichi, UNIT_STATE_MANA) > 200 and GetRandomInt(1, 20) == 1 ) then
    			set Lichi___BTongyun=true
    			call Lichi___Yingyanjue('A0MN' , GetUnitX(GetAttacker()) , GetUnitY(GetAttacker()))
    			call YDWEPolledWaitNull(10)
    			set Lichi___BTongyun=false
    		endif
    	endif
    endfunction
//---------------------------------------------------------------------------------------------------
	
    function Lichi___TSpellLichiDamageCon takes nothing returns boolean
    	return GetEventDamage() > GetUnitState(lichi, UNIT_STATE_LIFE) and not ( BTianfu )
    endfunction
    function Lichi___TSpellLichiDamageAct takes nothing returns nothing
     local integer i= 1
    	loop
    		exitwhen i > IMaxHuanying
    		if ( Lichi___UHuan[i] != null ) then
    			call KillUnit(Lichi___UHuan[i])
				call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl", GetUnitX(Lichi___UHuan[i]), GetUnitY(Lichi___UHuan[i])))
    			set Lichi___UHuan[i]=null
				call ImmuteDamageInterval(lichi , 1)
				call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl", GetUnitX(lichi), GetUnitY(lichi)))
				call SetUnitLifePercentBJ(lichi, 100)
				call PrintSpellContent(GetOwningPlayer(lichi) , GetAbilityName('A0MH') , "续命.")
			    call PlaySoundBJ(gg_snd_Baodiao)
    			return
    		endif
    		set i=i + 1
    	endloop
    endfunction
//---------------------------------------------------------------------------------------------------
	
	//清除湮魂印的遗留物
 function Lichi___ClearYanhun takes nothing returns nothing
  local integer i= 0
		set Iyanhun=0
		set Uyanhun=null
		loop
			exitwhen i > IMaxHuanying
			if ( Lichi___CYanhun[i] != 0 and Lichi___UHuan[i] != null ) then
				call s__Connect_deallocate(Lichi___CYanhun[i])
				set Lichi___CYanhun[i]=0
			endif
			set i=i + 1
		endloop
	endfunction
 function Lichi___YanhunyinTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer count= Lichi___GetHuanyingCount()
		if ( IsUnitAliveBJ(Uyanhun) and IsUnitAliveBJ(lichi) and GetUnitDistance(Uyanhun , lichi) < 2000 ) then
			call UnitDamageTarget(lichi, Uyanhun, GetUnitState(lichi, UNIT_STATE_MAX_LIFE) * 0.1 * count, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_SLOW_POISON, WEAPON_TYPE_WHOKNOWS)
			call SetUnitLifeBJ(lichi, GetUnitState(lichi, UNIT_STATE_LIFE) + GetUnitState(lichi, UNIT_STATE_MAX_LIFE) * 0.1 * count)
			call SetUnitManaBJ(Uyanhun, GetUnitState(Uyanhun, UNIT_STATE_MANA) - 5 * count)
			call SetUnitManaBJ(lichi, GetUnitState(lichi, UNIT_STATE_MANA) + 5 * count)
		else
			call PauseTimer(t)
			call DestroyTimer(t)
			call Lichi___ClearYanhun()
		endif
		set t=null
	endfunction
 function Lichi___Yanhunyin takes unit u returns nothing
  local integer i= 1
  local timer t= CreateTimer()
		call Lichi___ClearYanhun()
		set Iyanhun=1
		loop
			exitwhen i > IMaxHuanying
     		if ( Lichi___UHuan[i] != null ) then
				set Lichi___CYanhun[i]=s__Connect_create(Lichi___UHuan[i] , u , "LEAS")
				call s__Connect_setDieVanish(Lichi___CYanhun[i])
				set Iyanhun=Iyanhun + 1
    		endif
			set i=i + 1
		endloop
		set Lichi___CYanhun[0]=s__Connect_create(lichi , u , "LEAS")
		call s__Connect_setDieVanish(Lichi___CYanhun[0])
		set Uyanhun=u
		call TimerStart(t, 1, true, function Lichi___YanhunyinTimer)
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Lichi___ShenyueyingTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer i= 1
		if not ( BJuexing1[GetConvertedPlayerId(GetOwningPlayer(lichi))] ) then
	    	call UnitRemoveAbility(lichi, 'A0B9')
	    	loop
	    		exitwhen i > IMaxHuanying
	    		if ( Lichi___UHuan[i] != null ) then
	    			call UnitRemoveAbility(Lichi___UHuan[i], 'A0B9')
	    		endif
	    		set i=i + 1
	    	endloop
		endif
		call CreateSpellTextTag("神月盈时间到！" , lichi , 0 , 50 , 100 , 3)
		call PauseTimer(t)
		call DestroyTimer(t)
		set t=null
	endfunction
 function Lichi___Shenyueying takes nothing returns nothing
  local integer i= 1
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Avatar\\AvatarCaster.mdl", GetUnitX(lichi), GetUnitY(lichi)))
	    call UnitAddAbility(lichi, 'A0B9')
		loop
			exitwhen i > IMaxHuanying
     		if ( Lichi___UHuan[i] != null ) then
				call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Avatar\\AvatarCaster.mdl", GetUnitX(Lichi___UHuan[i]), GetUnitY(Lichi___UHuan[i])))
	    		call UnitAddAbility(Lichi___UHuan[i], 'A0B9')
    		    call SetUnitAnimation(Lichi___UHuan[i], "Spell Throw")
    		endif
			set i=i + 1
		endloop
		call TimerStart(CreateTimer(), 20, false, function Lichi___ShenyueyingTimer)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Lichi___QiutiandiSmart takes real x,real y returns nothing
  local unit u= null
		if ( GetDistance(GetUnitX(lichi) , GetUnitY(lichi) , x , y) > 1200 ) then
			return
		endif
		set u=CreateUnit(GetOwningPlayer(lichi), 'h02A', x, y, 0)
		set Lichi___IQiutian=Lichi___IQiutian + 1
		if ( Lichi___IQiutian >= 30 ) then
			set Lichi___IQiutian=0
			call SetUnitLifePercentBJ(lichi, 100)
			call ImmuteDamageInterval(lichi , 2)
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl", x, y))
		endif
		call UnitApplyTimedLifeBJ(3, 'BHwe', u)
        call IssuePointOrder(lichi, "move", GetUnitX(lichi), GetUnitY(lichi))
		set u=null
	endfunction
 function Lichi___Qiutiandi takes nothing returns nothing
  local real time= GetUnitState(lichi, UNIT_STATE_MANA) * 0.01 * 0.5
  local unit u= CreateUnit(GetOwningPlayer(lichi), 'h029', GetUnitX(lichi), GetUnitY(lichi), 0)
     local integer attract= s__Attract_create(u , 1200 , 0.05 , 20)
	    call s__Attract_start(attract)
		call UnitApplyTimedLifeBJ(time, 'BHwe', u)
		call PlaySoundBJ(gg_snd_lichidazhao)
	    call EnableTrigger(Lichi___TSpellLichi51)
	    call EnableTrigger(Lichi___TSpellLichi52)
	    call PrintSpellContent(GetOwningPlayer(lichi) , GetAbilityName(GetSpellAbilityId()) , "持续" + I2S(R2I(time)) + "s.")
	    call SetUnitManaPercentBJ(lichi, 0)
	    call YDWEPolledWaitNull(time)
	    call DisableTrigger(Lichi___TSpellLichi51)
	    call DisableTrigger(Lichi___TSpellLichi52)
	    call PrintSpellContent(GetOwningPlayer(lichi) , GetAbilityName('A0MQ') , ",施法结束.")
	    set u=null
	endfunction
 function Lichi___TSpellLichi5Con takes nothing returns boolean
	    return ( ( GetIssuedOrderIdBJ() == String2OrderIdBJ("smart") ) )
	endfunction
 function Lichi___TSpellLichi51Act takes nothing returns nothing
	    call Lichi___QiutiandiSmart(GetUnitX(GetOrderTargetUnit()) , GetUnitY(GetOrderTargetUnit()))
	endfunction
 function Lichi___TSpellLichi52Act takes nothing returns nothing
	    call Lichi___QiutiandiSmart(GetOrderPointX() , GetOrderPointY())
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Lichi___TSpellLichiAct takes nothing returns nothing
		if ( GetSpellAbilityId() == 'A0MJ' ) then
			call Lichi___Yingyanjue(GetSpellAbilityId() , GetUnitX(lichi) + 250 * CosBJ(GetUnitFacing(lichi)) , GetUnitY(lichi) + 250 * SinBJ(GetUnitFacing(lichi)))
		elseif ( GetSpellAbilityId() == 'A0MK' ) then
			call Lichi___Yingyanjue(GetSpellAbilityId() , GetUnitX(lichi) + 500 * CosBJ(GetUnitFacing(lichi)) , GetUnitY(lichi) + 500 * SinBJ(GetUnitFacing(lichi)))
		elseif ( GetSpellAbilityId() == 'A0ML' ) then
			call Lichi___Yingyanjue(GetSpellAbilityId() , GetUnitX(lichi) + 750 * CosBJ(GetUnitFacing(lichi)) , GetUnitY(lichi) + 750 * SinBJ(GetUnitFacing(lichi)))
		elseif ( GetSpellAbilityId() == 'A0MM' ) then
			call Lichi___Yingyanjue(GetSpellAbilityId() , GetUnitX(lichi) + 1000 * CosBJ(GetUnitFacing(lichi)) , GetUnitY(lichi) + 1000 * SinBJ(GetUnitFacing(lichi)))
		elseif ( GetSpellAbilityId() == 'A0MO' ) then
			//湮魂印
			call Lichi___Yanhunyin(GetSpellTargetUnit())
		elseif ( GetSpellAbilityId() == 'A0MP' ) then
			//神月盈
			call Lichi___Shenyueying()
		elseif ( GetSpellAbilityId() == 'A0MQ' ) then
			//囚天地
			call Lichi___Qiutiandi()
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Lichi___FlashLichiDamage takes nothing returns nothing
		set Lichi___LichiDamage=GetDamageInt(lichi)
		if ( IsSecondSpellOK(lichi) and GetUnitAbilityLevel(lichi, 'A0MN') == 1 ) then
			if ( GetUnitLifePercent(lichi) < 98 ) then
				call SetUnitLifeBJ(lichi, ( GetUnitState(lichi, UNIT_STATE_LIFE) / 6 ) * 5 + GetUnitState(lichi, UNIT_STATE_MAX_LIFE) / 6)
		    	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\AIma\\AImaTarget.mdl", GetUnitX(lichi), GetUnitY(lichi)))
			endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
	//按照12345来判断
 function LearnSkillLichiI takes unit learner,integer whichSpell returns nothing
  local integer i
		if ( learner == lichi ) then
			if ( whichSpell == 3 and IsThirdSpellOK(lichi) and GetUnitAbilityLevel(lichi, 'A0MO') == 1 ) then
				call InitLichiAura()
				call AddSpecialEffectTargetUnitBJ("origin", lichi, "war3mapImported\\yanbao.mdx")
			endif
		endif
	endfunction
 function LearnSkillLichi takes unit learner,integer learnSpellID returns nothing
		if ( learner == lichi ) then
			if ( learnSpellID == 'A0MI' ) then
				call LearnSkillLichiI(learner , 1)
			elseif ( learnSpellID == 'A0MN' ) then
				call LearnSkillLichiI(learner , 2)
			elseif ( learnSpellID == 'A0MO' ) then
				call LearnSkillLichiI(learner , 3)
			elseif ( learnSpellID == 'A0MP' ) then
				call LearnSkillLichiI(learner , 4)
			elseif ( learnSpellID == 'A0MQ' ) then
				call LearnSkillLichiI(learner , 5)
			endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Lichi___InitLichiSpin takes unit u returns unit
		if ( IsLichiSpin1(GetOwningPlayer(u)) ) then
			set udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]=CreateUnit(GetOwningPlayer(u), 'H02E', GetUnitX(u), GetUnitY(u), 0)
			call UnitAddItemByIdSwapped('I006', udg_H[GetConvertedPlayerId(GetOwningPlayer(u))])
			call SetUnitManaPercentBJ(udg_H[GetConvertedPlayerId(GetOwningPlayer(u))], 100)
			call RemoveUnit(u)
			return udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
		else
			return u
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitLichi takes unit u returns nothing
  local integer i= 1
		loop
			exitwhen i > 4
			set Lichi___GShenyue[i]=CreateGroup()
			set i=i + 1
		endloop
		set lichi=Lichi___InitLichiSpin(u)
		set Lichi___UHuan[0]=lichi
		//上限是4
		set IMaxHuanying=4
		//施法总事件
		set Lichi___TSpellLichi=CreateTrigger()
	    call TriggerRegisterUnitEvent(Lichi___TSpellLichi, lichi, EVENT_UNIT_SPELL_EFFECT)
	    call TriggerAddAction(Lichi___TSpellLichi, function Lichi___TSpellLichiAct)
	    //初始加成
	    call AddAttackPercent(GetConvertedPlayerId(GetOwningPlayer(lichi)) , 5.)
	    call AddIntPercent(GetConvertedPlayerId(GetOwningPlayer(lichi)) , 0.5)
	    //刷新伤害,还有每秒判断形态是否扣血,还有加属性的判断
	    call TimerStart(CreateTimer(), 1, true, function Lichi___FlashLichiDamage)
	    call UnitRemoveAbility(lichi, 'A0B9')
	    //一致的步调动作与位置
	    call TimerStart(CreateTimer(), 0.05, true, function Lichi___JudgeLichiMove)
	    //call TimerStart(CreateTimer(),0.055,true,function JudgeLichiPos)
	    //攻击与被攻击事件
		set Lichi___TAttackLichi=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(Lichi___TAttackLichi, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(Lichi___TAttackLichi, Condition(function Lichi___TAttackLichiCon))
	    call TriggerAddAction(Lichi___TAttackLichi, function Lichi___TAttackLichiAct)
	    //伤害免疫事件
	    set Lichi___TSpellLichiDamage=CreateTrigger()
	    call TriggerRegisterUnitEvent(Lichi___TSpellLichiDamage, lichi, EVENT_UNIT_DAMAGED)
	    call TriggerAddCondition(Lichi___TSpellLichiDamage, Condition(function Lichi___TSpellLichiDamageCon))
	    call TriggerAddAction(Lichi___TSpellLichiDamage, function Lichi___TSpellLichiDamageAct)
	    //囚天地
	    set Lichi___TSpellLichi51=CreateTrigger()
	    call TriggerRegisterUnitEvent(Lichi___TSpellLichi51, lichi, EVENT_UNIT_ISSUED_TARGET_ORDER)
	    call TriggerAddCondition(Lichi___TSpellLichi51, Condition(function Lichi___TSpellLichi5Con))
	    call TriggerAddAction(Lichi___TSpellLichi51, function Lichi___TSpellLichi51Act)
	    call DisableTrigger(Lichi___TSpellLichi51)
	    set Lichi___TSpellLichi52=CreateTrigger()
	    call TriggerRegisterUnitEvent(Lichi___TSpellLichi52, lichi, EVENT_UNIT_ISSUED_POINT_ORDER)
	    call TriggerAddCondition(Lichi___TSpellLichi52, Condition(function Lichi___TSpellLichi5Con))
	    call TriggerAddAction(Lichi___TSpellLichi52, function Lichi___TSpellLichi52Act)
	    call DisableTrigger(Lichi___TSpellLichi52)
	    call CreateHuanying()
	    call CreateHuanying()
	endfunction

//library Lichi ends
//library Lingxue:
//---------------------------------------------------------------------------------------------------
	
 function AfterReviveLingxue takes unit u returns nothing
		if ( u == lingxue ) then
    		call SetUnitPathing(lingxue, false)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Lingxue___InitLingxueSpin takes unit u returns unit
		if ( IsLingxueSpin1(GetOwningPlayer(u)) ) then
			set udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]=CreateUnit(GetOwningPlayer(u), 'H01V', GetUnitX(u), GetUnitY(u), 0)
			set gg_unit_Hjai_0014=udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
			call UnitAddItemByIdSwapped('I006', udg_H[GetConvertedPlayerId(GetOwningPlayer(u))])
			call AddSpellPercent(GetConvertedPlayerId(GetOwningPlayer(u)) , 0.1)
			call SetUnitManaPercentBJ(udg_H[GetConvertedPlayerId(GetOwningPlayer(u))], 1000)
			call RemoveUnit(u)
			return udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
		else
			return u
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
 function InitLingxue takes unit u returns nothing
		set lingxue=Lingxue___InitLingxueSpin(u)
    	call TriggerRegisterUnitEvent(gg_trg_____________21, lingxue, EVENT_UNIT_DAMAGED)
    	call SetUnitPathing(lingxue, false)
	endfunction

//library Lingxue ends
//library MonsterSpell:
	
 function FocusCow takes unit selected returns nothing
		if ( GetUnitAbilityLevel(selected, 'A09W') >= 1 and IsUnitAliveBJ(selected) ) then
			call SetUnitState(selected, UNIT_STATE_LIFE, GetUnitState(selected, UNIT_STATE_LIFE) + GetUnitState(selected, UNIT_STATE_MAX_LIFE) * 0.05)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function MonsterSpell__TSpellQianFaEnemyFilter takes nothing returns boolean
	    return ( ( ( IsUnitAliveBJ(GetFilterUnit()) == true ) and ( IsUnitEnemy(GetFilterUnit(), GetOwningPlayer(GetAttacker())) == true ) ) )
	endfunction
 function MonsterSpell__TSpellQianFaAct takes nothing returns nothing
     local integer i
     local group ydl_group
     local unit ydl_unit
     local real x
     local real y
	    set x=GetUnitX(GetAttackedUnitBJ())
	    set y=GetUnitY(GetAttackedUnitBJ())
	    call DisableTrigger(GetTriggeringTrigger())
	    call SetUnitManaBJ(GetAttacker(), ( GetUnitStateSwap(UNIT_STATE_MANA, GetAttacker()) - 333.00 ))
	    //特效
	    set i=1
	    loop
	        exitwhen i > 8
	        call UnitApplyTimedLifeBJ(5.00, 'BHwe', CreateUnit(GetOwningPlayer(GetAttacker()), 'h00J', x, y, 45 * I2R(i)))
	        set i=i + 1
	    endloop
	    //巨能
	    if ( ( GetUnitTypeId(GetAttacker()) == 'N00Q' ) ) then
	    		set ydl_group=CreateGroup()
			    call GroupEnumUnitsInRange(ydl_group, x, y, 900, Condition(function MonsterSpell__TSpellQianFaEnemyFilter))
			    loop
			        set ydl_unit=FirstOfGroup(ydl_group)
			        exitwhen ydl_unit == null
			        call GroupRemoveUnit(ydl_group, ydl_unit)
			        //造成75%生命的伤害
		            call UnitDamageTarget(GetAttacker(), ydl_unit, ( 0.5 * GetUnitStateSwap(UNIT_STATE_LIFE, ydl_unit) ), false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_SLOW_POISON, WEAPON_TYPE_WHOKNOWS)
			    endloop
		 	elseif ( ( GetUnitTypeId(GetAttacker()) == 'Nngs' ) or ( GetUnitTypeId(GetAttacker()) == 'Nbrn' ) ) then
		//仙炼或生克
	    		set ydl_group=CreateGroup()
				call GroupEnumUnitsInRange(ydl_group, x, y, 900, Condition(function MonsterSpell__TSpellQianFaEnemyFilter))
				loop
				    set ydl_unit=FirstOfGroup(ydl_group)
				    exitwhen ydl_unit == null
				    call GroupRemoveUnit(ydl_group, ydl_unit)
			        //造成50%生命的伤害
			        call UnitDamageTarget(GetAttacker(), ydl_unit, ( 0.3 * GetUnitStateSwap(UNIT_STATE_LIFE, ydl_unit) ), false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_SLOW_POISON, WEAPON_TYPE_WHOKNOWS)
				endloop
	    endif
	    //文字
	    call CreateSpellTextTag("虚--千罚之光" , GetAttacker() , 100 , 100 , 0 , 2)
	    call YDWEPolledWaitNull(5.00)
	    call EnableTrigger(GetTriggeringTrigger())
	    call DestroyGroup(ydl_group)
	    set ydl_group=null
	    set ydl_unit=null
	endfunction
 function MonsterSpell__TSpellQianFaCon takes nothing returns boolean
	    return ( ( ( GetUnitTypeId(GetAttacker()) == 'Nngs' ) or ( GetUnitTypeId(GetAttacker()) == 'Nbrn' ) or ( GetUnitTypeId(GetAttacker()) == 'N00Q' ) ) and ( IsUnitIllusionBJ(GetAttacker()) != true ) and ( GetUnitStateSwap(UNIT_STATE_MANA, GetAttacker()) > 333.00 ) and ( GetRandomInt(1, 10) == 1 ) )
	endfunction
//---------------------------------------------------------------------------------------------------
	
	
 function MonsterSpell__DiamondTransmit takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local unit u= LoadUnitHandle(spellTable, id, 1)
		if ( IsUnitAliveBJ(u) ) then
			call TLeaveDiamondRegion1Act()
		else
			call PauseTimer(t)
			call FlushChildHashtable(spellTable, id)
			call DestroyTimer(t)
		endif
		set u=null
		set t=null
	endfunction
 function StartJudgeTransmit takes unit u returns nothing
  local timer t= CreateTimer()
  local integer shield
		call SaveUnitHandle(spellTable, GetHandleId(t), 1, u)
		call TimerStart(t, 2, true, function MonsterSpell__DiamondTransmit)
		if ( GetDiffculty() == 8 ) then
			set shield=s__SuperShield_create(u , 1)
		elseif ( GetDiffculty() > 8 ) then
			set shield=s__SuperShield_create(u , 5)
		endif
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function MonsterSpell__TSpellJunlinAct takes nothing returns nothing
		if ( udg_H[GetConvertedPlayerId(GetOwningPlayer(GetAttackedUnitBJ()))] == xuanxue and BJuexing3[GetConvertedPlayerId(GetOwningPlayer(xuanxue))] ) then
	    	call RecoverUnitHP(GetAttackedUnitBJ() , - 0.1)
		else
        	call SetUnitOwner(GetAttackedUnitBJ(), GetOwningPlayer(GetAttacker()), true)
		endif
	    call CreateSpellTextTag("臣服于我" , GetAttacker() , 100 , 0 , 0 , 2)
	    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\RaiseSkeletonWarrior\\RaiseSkeleton.mdl", GetUnitX(GetAttackedUnitBJ()), GetUnitY(GetAttackedUnitBJ())))
	endfunction
 function MonsterSpell__TSpellJunlinCon takes nothing returns boolean
	    return ( ( GetUnitAbilityLevel(GetAttacker(), 'A0P1') >= 1 ) and ( IsUnitIllusionBJ(GetAttackedUnitBJ()) != true ) and ( GetUnitStateSwap(UNIT_STATE_MANA, GetAttacker()) > 100.00 ) and ( GetRandomInt(1, 100) <= udg_Nandu_JJJ * 3 ) and ( IsEnemyM(GetAttackedUnitBJ() , GetAttacker()) == true ) and ( GetPlayerController(GetOwningPlayer(GetAttackedUnitBJ())) == MAP_CONTROL_USER ) and ( IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) != true ) and ( IsUnitType(GetTriggerUnit(), UNIT_TYPE_MECHANICAL) == false ) )
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function MonsterSpell__TSpellYuanshaAct takes nothing returns nothing
		call UnitDamageTarget(GetAttackedUnitBJ(), GetAttacker(), GetUnitState(GetAttacker(), UNIT_STATE_LIFE) * 10, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_SLOW_POISON, WEAPON_TYPE_WHOKNOWS)
	endfunction
 function MonsterSpell__TSpellYuanshaCon takes nothing returns boolean
	    return ( GetUnitAbilityLevel(GetAttackedUnitBJ(), 'A0HE') >= 1 ) and ( IsYuansu(GetAttacker()) )
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function MonsterSpell__TSpellPetAct takes nothing returns nothing
  local real per= ( 0.02 * ( GetUnitLevel(GetAttacker()) - GetUnitLevel(GetAttackedUnitBJ()) + 1 ) )
		call UnitDamageTarget(GetAttacker(), GetAttackedUnitBJ(), GetUnitState(GetAttacker(), UNIT_STATE_MAX_LIFE) * per, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_POISON, WEAPON_TYPE_WHOKNOWS)
	endfunction
 function MonsterSpell__TSpellPetCon takes nothing returns boolean
	    return ( ( ( GetUnitAbilityLevel(GetAttackedUnitBJ(), 'A0P0') >= 1 ) or ( GetUnitAbilityLevel(GetAttackedUnitBJ(), 'A0P0') >= 1 ) ) and ( IsEnemy(GetAttackedUnitBJ() , GetAttacker()) == true ) and GetUnitLevel(GetAttacker()) >= 50 and GetUnitLevel(GetAttacker()) >= GetUnitLevel(GetAttackedUnitBJ()) )
	endfunction
//---------------------------------------------------------------------------------------------------
	
    function MonsterSpell__YouxiangZhibao takes nothing returns nothing
     local group l_group= CreateGroup()
     local unit l_unit
    	call GroupEnumUnitsInRange(l_group, GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit()), 600, null)
    	call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Other\\NeutralBuildingExplosion\\NeutralBuildingExplosion.mdl", GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit())))
    	loop
    	    set l_unit=FirstOfGroup(l_group)
    	    exitwhen l_unit == null
    	    call GroupRemoveUnit(l_group, l_unit)
    	    if ( IsEnemyM(l_unit , GetDyingUnit()) and ( GetPlayerController(GetOwningPlayer(l_unit)) == MAP_CONTROL_USER ) ) then
    	    	call UnitDamageTarget(GetDyingUnit(), l_unit, GetUnitState(l_unit, UNIT_STATE_LIFE) * 0.9, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_SLOW_POISON, WEAPON_TYPE_WHOKNOWS)
    	    endif
    	endloop
    	call DestroyGroup(l_group)
    	set l_group=null
    	set l_unit=null
    endfunction
    function MonsterSpell__Leitongyuan takes nothing returns nothing
     local group l_group= CreateGroup()
     local unit l_unit
    	call GroupEnumUnitsInRange(l_group, GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit()), 6000, null)
    	loop
    	    set l_unit=FirstOfGroup(l_group)
    	    exitwhen l_unit == null
    	    call GroupRemoveUnit(l_group, l_unit)
    	    if ( GetUnitTypeId(GetDyingUnit()) == GetUnitTypeId(l_unit) ) then
    	    	call SetUnitLifePercentBJ(l_unit, 100)
    	    	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\ImmolationRed\\ImmolationRedTarget.mdl", GetUnitX(l_unit), GetUnitY(l_unit)))
    	    endif
    	endloop
    	call DestroyGroup(l_group)
    	set l_group=null
    	set l_unit=null
    endfunction
    function MonsterSpell__TMijingDeathAct takes nothing returns nothing
    	if ( GetUnitAbilityLevel(GetDyingUnit(), 'A0I4') >= 1 ) then
    		//幽象之爆
    		call MonsterSpell__YouxiangZhibao()
    	endif
    	if ( GetUnitAbilityLevel(GetDyingUnit(), 'A0I5') >= 1 ) then
    		//类同源
    		call MonsterSpell__Leitongyuan()
    	endif
    endfunction
//---------------------------------------------------------------------------------------------------
	
    function MonsterSpell__TMijingAttackSpellCon takes nothing returns boolean
    	return GetUnitTypeId(GetAttacker()) == 'nrwm'
    endfunction
    function MonsterSpell__TMijingAttackSpellAct takes nothing returns nothing
    	if ( GetRandomInt(1, 10) == 1 ) then
    		call IssuePointOrder(GetAttacker(), "clusterrockets", GetUnitX(GetAttackedUnitBJ()), GetUnitY(GetAttackedUnitBJ()))
    		return
    	endif
    	if ( GetRandomInt(1, 10) == 1 ) then
    		call IssuePointOrder(GetAttacker(), "silence", GetUnitX(GetAttackedUnitBJ()), GetUnitY(GetAttackedUnitBJ()))
    		return
    	endif
    endfunction
//---------------------------------------------------------------------------------------------------
	
 function MonsterSpell__TSpellDratAct takes nothing returns nothing
  local integer i= - 1
     local real x1
     local real y1
     local real x2
     local real y2
     local unit drat
     local real facing
	    set x1=GetUnitX(GetAttackedUnitBJ())
	    set y1=GetUnitY(GetAttackedUnitBJ())
	    set x2=GetUnitX(GetAttacker())
	    set y2=GetUnitY(GetAttacker())
	    set facing=Atan2BJ(y2 - y1, x2 - x1)
	    call DisableTrigger(GetTriggeringTrigger())
	    call SetUnitManaBJ(GetAttackedUnitBJ(), ( GetUnitStateSwap(UNIT_STATE_MANA, GetAttackedUnitBJ()) - 333.00 ))
	    //巨能
	    if ( ( GetUnitTypeId(GetAttackedUnitBJ()) == 'N00Q' ) ) then
	    	loop
	    		exitwhen i > 1
	    		set drat=CreateUnit(GetOwningPlayer(GetAttackedUnitBJ()), 'hs00', x1, y1, facing)
	        	call UnitApplyTimedLifeBJ(10.00, 'BHwe', drat)
	        	    call DIYRushSlide(drat , facing + i * 30 , 20000.00 , 10.00 , 0.05 , DRAT_JUNENG * ( 1 + 0.2 * I2R(level_juneng) ) , 60. , false , true , false , "origin" , "" , "Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl")
	    		set i=i + 1
	    	endloop
		 	elseif ( ( GetUnitTypeId(GetAttackedUnitBJ()) == 'Nngs' ) or ( GetUnitTypeId(GetAttackedUnitBJ()) == 'Nbrn' ) ) then
		//仙炼或生克
	    		set drat=CreateUnit(GetOwningPlayer(GetAttackedUnitBJ()), 'hs00', x1, y1, facing)
	        	call UnitApplyTimedLifeBJ(10.00, 'BHwe', drat)
	        	    call DIYRushSlide(drat , facing , 20000.00 , 10.00 , 0.05 , R3(IsTianyan , 1000000000 , DRAT_XIANLIAN) , 60. , false , true , false , "origin" , "" , "Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl")
	    endif
	    //文字
	    call CreateSpellTextTag("虚--弹射飞镖" , GetAttacker() , 0 , 100 , 1000 , 2)
	    call YDWEPolledWaitNull(10.00)
	    call EnableTrigger(GetTriggeringTrigger())
	    set drat=null
	endfunction
 function MonsterSpell__TSpellDratCon takes nothing returns boolean
	    return ( ( ( GetUnitTypeId(GetAttackedUnitBJ()) == 'Nngs' ) or ( GetUnitTypeId(GetAttackedUnitBJ()) == 'Nbrn' ) or ( GetUnitTypeId(GetAttackedUnitBJ()) == 'N00Q' ) ) and ( IsUnitIllusionBJ(GetAttackedUnitBJ()) != true ) and ( GetUnitStateSwap(UNIT_STATE_MANA, GetAttackedUnitBJ()) > 333.00 ) and ( GetRandomInt(1, 10) == 1 ) )
	endfunction
//---------------------------------------------------------------------------------------------------
 function MonsterSpell__InitMonsterSpell takes nothing returns nothing
  local trigger t= CreateTrigger()
		//巨能,仙炼还有生克的千罚之光
	    set TSpellQianfa=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(TSpellQianfa, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(TSpellQianfa, Condition(function MonsterSpell__TSpellQianFaCon))
	    call TriggerAddAction(TSpellQianfa, function MonsterSpell__TSpellQianFaAct)
	    call DisableTrigger(TSpellQianfa)
	    //巨能,仙炼还有生克的手里剑
	    set TSpellDart=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(TSpellDart, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(TSpellDart, Condition(function MonsterSpell__TSpellDratCon))
	    call TriggerAddAction(TSpellDart, function MonsterSpell__TSpellDratAct)
	    call DisableTrigger(TSpellDart)
	    //臣服于我
	    set t=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(t, Condition(function MonsterSpell__TSpellJunlinCon))
	    call TriggerAddAction(t, function MonsterSpell__TSpellJunlinAct)
	    //元素杀手
	    set t=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(t, Condition(function MonsterSpell__TSpellYuanshaCon))
	    call TriggerAddAction(t, function MonsterSpell__TSpellYuanshaAct)
	    //幽象之体
	    set t=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_DEATH)
	    call TriggerAddAction(t, function MonsterSpell__TMijingDeathAct)
	    set t=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(t, Condition(function MonsterSpell__TMijingAttackSpellCon))
	    call TriggerAddAction(t, function MonsterSpell__TMijingAttackSpellAct)
	    //宠物掉血
	    set t=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(t, Condition(function MonsterSpell__TSpellPetCon))
	    call TriggerAddAction(t, function MonsterSpell__TSpellPetAct)
	    set t=null
	endfunction

//library MonsterSpell ends
//library Moqi:
//---------------------------------------------------------------------------------------------------
	
 function SimulateDamageMoqi takes unit u returns boolean
		//星璇的伤害
		if ( GetUnitTypeId(u) == 'h02Q' ) then
			if not ( IsUnitInGroup(GetTriggerUnit(), Moqi___GMoqiXingxuan) ) then
				call UnitDamageTarget(moqi, GetTriggerUnit(), GetDamageAgi(moqi) * 0.04 * GetUnitUserData(u), false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_POISON, WEAPON_TYPE_WHOKNOWS)
				call GroupAddUnit(Moqi___GMoqiXingxuan, GetTriggerUnit())
			endif
			return true
		endif
		return false
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SimulateDeathMoqi takes unit u returns nothing
		if ( GetUnitTypeId(u) == 'h02P' ) then
			//星落
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Thunderclap\\ThunderClapCaster.mdl", GetUnitX(u), GetUnitY(u)))
		elseif ( GetUnitTypeId(u) == 'h001' ) then
			//星雨
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Thunderclap\\ThunderClapCaster.mdl", GetUnitX(u), GetUnitY(u)))
			call DamageArea(moqi , GetUnitX(u) , GetUnitY(u) , 450 , GetDamageAgi(moqi) * 0.35)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Moqi___XingchenOldTimer takes nothing returns nothing
     local timer t= GetExpiredTimer()
     local integer id= GetHandleId(t)
  local effect e= LoadEffectHandle(spellTable, GetHandleId(t), 1)
  local integer n= LoadInteger(spellTable, GetHandleId(t), 2)
		call AddIntPercentImme(GetConvertedPlayerId(GetOwningPlayer(moqi)) , - 0.3 * n)
		call AddAgiPercentImme(GetConvertedPlayerId(GetOwningPlayer(moqi)) , - 0.3 * n)
		call AddStrPercentImme(GetConvertedPlayerId(GetOwningPlayer(moqi)) , - 0.3 * n)
		call DestroyEffect(e)
	    call PauseTimer(t)
	    call FlushChildHashtable(spellTable, id)
	    call DestroyTimer(t)
	    set t=null
	endfunction
 function XingchenOld takes nothing returns nothing
  local integer i= 1
  local integer n= 0
  local effect e= null
  local timer t= CreateTimer()
		loop
			exitwhen i > 7
			if ( IsUnitAliveBJ(udg_Unit_Qixing[i]) ) then
				call KillUnit(udg_Unit_Qixing[i])
				set n=n + 1
			endif
			set i=i + 1
		endloop
		call PrintSpellContent(GetOwningPlayer(moqi) , GetAbilityName(GetSpellAbilityId()) , "成功增加" + I2S(n * 30) + "%的三围.")
		call AddIntPercentImme(GetConvertedPlayerId(GetOwningPlayer(moqi)) , 0.3 * n)
		call AddAgiPercentImme(GetConvertedPlayerId(GetOwningPlayer(moqi)) , 0.3 * n)
		call AddStrPercentImme(GetConvertedPlayerId(GetOwningPlayer(moqi)) , 0.3 * n)
		set e=AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\Starfall\\StarfallCaster.mdl", moqi, "chest")
		call SaveEffectHandle(spellTable, GetHandleId(t), 1, e)
		call SaveInteger(spellTable, GetHandleId(t), 2, n)
		call TimerStart(t, 60, false, function Moqi___XingchenOldTimer)
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function XingxuanTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local unit u= LoadUnitHandle(spellTable, id, 1)
  local integer times= LoadInteger(spellTable, GetHandleId(t), 2)
		//是第几颗星星
  local integer i= LoadInteger(spellTable, GetHandleId(t), 3)
  local real degree= ModuloReal(( ( ( - 80.0 ) * times / 200.0 ) + 90.0 ) * times, 360.) + i * 51.42
  local real x= 20 * times * CosBJ(degree) + GetUnitX(moqi)
  local real y= 20 * times * SinBJ(degree) + GetUnitY(moqi)
		//call DisplayTextToPlayer(Player(0), 0., 0., "|cFFFF66CC【消息】|r"+I2S(times)+":"+R2S(degree))
		if ( times < 100 ) then
			set times=times + 1
			//call CreateUnit(Player(0),'hpea', x,y ,0)
			call SetUnitUserData(u, times * 2 + 50)
			call SaveInteger(spellTable, GetHandleId(t), 2, times)
			//call DisplayTextToPlayer(Player(0), 0., 0., "|cFFFF66CC【消息】|r"+I2S(times))
			call SetUnitX(u, x)
			call SetUnitY(u, y)
			call SetUnitFacing(u, degree + 90)
		else
			call DestroyGroup(Moqi___GMoqiXingxuan)
			set Moqi___GMoqiXingxuan=null
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl", x, y))
			call RemoveUnit(u)
			call PauseTimer(t)
			call FlushChildHashtable(spellTable, id)
			call DestroyTimer(t)
		endif
		set u=null
		set t=null
	endfunction
 function XingxuanStart takes unit u,integer i returns nothing
  local timer t= CreateTimer()
		call SaveUnitHandle(spellTable, GetHandleId(t), 1, CreateUnit(Player(0), 'h02Q', GetUnitX(u), GetUnitY(u), 0))
		call TimerStart(t, 0.05, true, function XingxuanTimer)
		call SaveInteger(spellTable, GetHandleId(t), 2, 0)
		call SaveInteger(spellTable, GetHandleId(t), 3, i)
		set t=null
	endfunction
 function Xingxuan takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > 7
			if ( IsUnitAliveBJ(udg_Unit_Qixing[i]) ) then
				call XingxuanStart(udg_Unit_Qixing[i] , i)
			endif
			set i=i + 1
		endloop
		set Moqi___GMoqiXingxuan=CreateGroup()
		call PrintSpellName(GetOwningPlayer(moqi) , GetAbilityName(GetSpellAbilityId()))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Moqi___XingchenTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local unit u= LoadUnitHandle(spellTable, id, 1)
  local real x= LoadReal(spellTable, GetHandleId(t), 2)
  local real y= LoadReal(spellTable, GetHandleId(t), 3)
  local real facing= LoadReal(spellTable, GetHandleId(t), 4)
		if ( GetDistance(GetUnitX(u) , GetUnitY(u) , x , y) > 50. and IsUnitAliveBJ(u) and GetUnitUserData(u) == 1 ) then
			call SetUnitX(u, YDWECoordinateX(GetUnitX(u) + CosBJ(facing) * 75.))
			call SetUnitY(u, YDWECoordinateY(GetUnitY(u) + SinBJ(facing) * 75.))
		else
			call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Other\\NeutralBuildingExplosion\\NeutralBuildingExplosion.mdl", GetUnitX(u), GetUnitY(u)))
	    	call DamageArea(moqi , GetUnitX(u) , GetUnitY(u) , 450 , GetDamageAgi(moqi) * 0.7)
			call KillUnit(u)
			call PauseTimer(t)
			call FlushChildHashtable(spellTable, id)
			call DestroyTimer(t)
		endif
		set u=null
		set t=null
	endfunction
 function XingchenStart takes unit u,real x,real y returns nothing
  local timer t= CreateTimer()
  local real facing= GetFacingBetweenXY(GetUnitX(u) , GetUnitY(u) , x , y)
		call SetUnitUserData(u, 1)
		call SaveUnitHandle(spellTable, GetHandleId(t), 1, u)
		call SaveReal(spellTable, GetHandleId(t), 2, x)
		call SaveReal(spellTable, GetHandleId(t), 3, y)
		call SaveReal(spellTable, GetHandleId(t), 4, facing)
		call SetUnitFacing(u, facing)
		call TimerStart(t, 0.05, true, function Moqi___XingchenTimer)
		set t=null
	endfunction
 function Xingchen takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > 7
			if ( IsUnitAliveBJ(udg_Unit_Qixing[i]) ) then
				call XingchenStart(udg_Unit_Qixing[i] , GetSpellTargetX() , GetSpellTargetY())
			endif
			set i=i + 1
		endloop
	    call PrintSpellName(GetOwningPlayer(moqi) , GetAbilityName(GetSpellAbilityId()))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Moqi___CreateEffect1 takes real x,real y returns nothing
     local integer i= 1
     local integer j= 1
     local unit u= null
        set u=CreateUnit(GetOwningPlayer(moqi), 'h02P', x, y, 0)
        call SetUnitFlyHeight(u, 0.00, 2000.00)
	    loop
	        exitwhen j > 3
	        set i=1
	        loop
	            exitwhen i > 8
	            set u=CreateUnit(GetOwningPlayer(moqi), 'h02P', YDWECoordinateX(x + 300 * j * CosBJ(i * 360.0 / I2R(8))), YDWECoordinateY(y + 300 * j * SinBJ(i * 360.0 / I2R(8))), 0)
	            call SetUnitFlyHeight(u, 0.00, 2000.00)
	            set i=i + 1
	        endloop
	        set j=j + 1
	    endloop
	    set u=null
	endfunction
 function Moqi___XingluoDamageTimer takes nothing returns nothing
     local timer t= GetExpiredTimer()
     local integer id= GetHandleId(t)
     local real x= LoadReal(spellTable, GetHandleId(t), 1)
     local real y= LoadReal(spellTable, GetHandleId(t), 2)
     local real rate= LoadReal(spellTable, GetHandleId(t), 3)
	    call DamageArea(moqi , x , y , 900 , GetDamageAgi(moqi) * rate)
	    call PauseTimer(t)
	    call FlushChildHashtable(spellTable, id)
	    call DestroyTimer(t)
	    set t=null
	endfunction
 function CreateXingluo takes real rate returns nothing
     local timer t= CreateTimer()
	    call Moqi___CreateEffect1(GetUnitX(moqi) , GetUnitY(moqi))
	    call SaveReal(spellTable, GetHandleId(t), 1, GetUnitX(moqi))
	    call SaveReal(spellTable, GetHandleId(t), 2, GetUnitY(moqi))
	    call SaveReal(spellTable, GetHandleId(t), 3, rate)
	    call TimerStart(t, 1, false, function Moqi___XingluoDamageTimer)
	    set t=null
	endfunction
 function Moqi___XingluoStartCreate takes nothing returns nothing
     local timer t= GetExpiredTimer()
     local integer id= GetHandleId(t)
     local integer i= LoadInteger(spellTable, id, 1)
  local real rate= LoadReal(spellTable, GetHandleId(t), 2)
	    if ( i <= 1 + IJ1(moqi , 1 , 0) + IJ2(moqi , 1 , 0) ) then
	        set i=i + 1
	        call SaveInteger(spellTable, GetHandleId(t), 1, i)
	        call CreateXingluo(rate)
	    else
	        call PauseTimer(t)
	        call FlushChildHashtable(spellTable, id)
	        call DestroyTimer(t)
	    endif
	    set t=null
	endfunction
 function Xingluo takes real damageRate,integer abilityID,real x2,real y2 returns nothing
  local real x= GetUnitX(moqi)
  local real y= GetUnitY(moqi)
  local real damage= GetDamageAgi(moqi)
  local timer t= CreateTimer()
		call SaveInteger(spellTable, GetHandleId(t), 1, 1)
		call SaveReal(spellTable, GetHandleId(t), 2, damageRate)
		call TimerStart(t, 0.5, true, function Moqi___XingluoStartCreate)
		set t=null
	    call PrintSpell(GetOwningPlayer(moqi) , GetAbilityName(abilityID) , damage)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Moqi___TSpellMoqiAct takes nothing returns nothing
		if ( GetSpellAbilityId() == 'A0NH' ) then
			//箭落
			call Xingluo(1.0 , GetSpellAbilityId() , GetUnitX(moqi) , GetUnitY(moqi))
		elseif ( GetSpellAbilityId() == 'A0NI' ) then
			//星尘
			call Xingchen()
		elseif ( GetSpellAbilityId() == 'A04L' ) then
			//星辰
			call XingchenOld()
		elseif ( GetSpellAbilityId() == 'A0NJ' ) then
			//星辰
			call Xingxuan()
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	//按照12345来判断
 function LearnSkillMoqiI takes unit learner,integer whichSpell returns nothing
  local integer i
		if ( learner == moqi ) then
			if ( whichSpell == 1 ) then
				//技能1初始化
        		call EnableTrigger(gg_trg_______18)
			elseif ( whichSpell == 2 and IsSecondSpellOK(moqi) and ( GetUnitAbilityLevel(moqi, 'A0G0') == 1 or GetUnitAbilityLevel(moqi, 'A0NI') == 1 ) ) then
				//技能2初始化
        		call EnableTrigger(gg_trg_______19)
			endif
		endif
	endfunction
 function LearnSkillMoqi takes unit learner,integer learnSpellID returns nothing
		if ( learner == moqi ) then
			if ( learnSpellID == 'A0FZ' ) then
				call LearnSkillMoqiI(learner , 1)
			elseif ( learnSpellID == 'A0G0' or learnSpellID == 'A0NI' ) then
				call LearnSkillMoqiI(learner , 2)
			endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function FlashJianluo takes nothing returns nothing
	    if ( BFanzhuanMQ ) then
	        call UnitRemoveAbility(moqi, 'A0NH')
	        call UnitAddAbility(moqi, 'A0NH')
	    endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function JudgeMoqiSpin takes nothing returns nothing
  local location point1= null
  local location point2= null
  local real angle= 0.
		if ( GetDistance(GetUnitX(moqi) , GetUnitY(moqi) , GetSpellTargetX() , GetSpellTargetY()) < 10 ) then
			return
		endif
		set point1=GetUnitLoc(moqi)
		set point2=GetSpellTargetLoc()
		set angle=AngleBetweenPoints(point1, point2)
		call DisplayTextToPlayer(GetOwningPlayer(moqi), 0., 0., "|cFFFF66CC【消息】|r技能施放角度为" + R2S(angle) + "度.")
		if ( angle < 90.1 and angle > 89.9 ) then
    call SetMoqiSpinOK(GetOwningPlayer(moqi))
		endif
		call RemoveLocation(point1)
		call RemoveLocation(point2)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function XingJuxing2 takes unit u returns nothing
		if ( BJuexing2[GetConvertedPlayerId(GetOwningPlayer(moqi))] ) then
			call UnitAddAbility(u, 'A0HW')
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function JuexingMoqi2 takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > 7
			call UnitAddAbility(udg_Unit_Qixing[i], 'A0HW')
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function QJuexingMoqi takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > 7
			call UnitRemoveAbility(udg_Unit_Qixing[i], 'A0HW')
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsMoqiSpin takes nothing returns boolean
		return GetUnitTypeId(xiaoyue) == 'H01X'
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitFanzhuanMoqi takes nothing returns nothing
		call UnitAddAbility(moqi, 'A0NL')
		call SetPlayerAbilityAvailable(GetOwningPlayer(moqi), 'A0NL', false)
		call BJDebugMsg("|cFFFF66CC【消息】|r" + GetPlayerName(GetOwningPlayer(moqi)) + "变化了英雄|cFF999900莫琪|r的技能形态!")
		call BJDebugMsg("|cFFFF66CC【消息】|r" + GetPlayerName(GetOwningPlayer(moqi)) + "变化了英雄|cFF999900莫琪|r的技能形态!")
		call BJDebugMsg("|cFFFF66CC【消息】|r" + GetPlayerName(GetOwningPlayer(moqi)) + "变化了英雄|cFF999900莫琪|r的技能形态!")
		call BJDebugMsg("|cFFFF66CC【消息】|r" + GetPlayerName(GetOwningPlayer(moqi)) + "变化了英雄|cFF999900莫琪|r的技能形态!")
		set BFanzhuanMQ=true
		call CinematicFadeBJ(bj_CINEFADETYPE_FADEOUTIN, 3.00, "ReplaceableTextures\\CameraMasks\\White_mask.blp", 100.00, 0, 0, 0)
		call PlaySoundBJ(gg_snd_fanzhuan)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Moqi___InitMoqiSpin takes unit u returns unit
		if ( IsMoqiSpin1(GetOwningPlayer(u)) ) then
			set udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]=CreateUnit(GetOwningPlayer(u), 'H01X', GetUnitX(u), GetUnitY(u), 0)
			set gg_unit_Hvwd_0016=udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
			call UnitAddItemByIdSwapped('I006', udg_H[GetConvertedPlayerId(GetOwningPlayer(u))])
			call SetUnitManaPercentBJ(udg_H[GetConvertedPlayerId(GetOwningPlayer(u))], 1000)
			call RemoveUnit(u)
			return udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
		else
			return u
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitMoqi takes unit u returns nothing
		set moqi=Moqi___InitMoqiSpin(u)
		call TriggerRegisterUnitEvent(gg_trg_______17, moqi, EVENT_UNIT_DAMAGED)
		call TriggerRegisterUnitEvent(gg_trg_______19, moqi, EVENT_UNIT_ATTACKED)
		set Moqi___TSpellMoqi=CreateTrigger()
	    call TriggerRegisterUnitEvent(Moqi___TSpellMoqi, moqi, EVENT_UNIT_SPELL_EFFECT)
	    call TriggerAddAction(Moqi___TSpellMoqi, function Moqi___TSpellMoqiAct)
      if ( DzAPI_Map_GetMapLevel(GetOwningPlayer(moqi)) >= 3 or IsPIV(GetOwningPlayer(moqi)) ) then
	    	call CreateFanzhuanItem(moqi)
      endif
	endfunction

//library Moqi ends
//library Seyu:
//---------------------------------------------------------------------------------------------------
	
 function JuexingSeyu1 takes nothing returns nothing
		call SetPlayerAbilityAvailable(GetOwningPlayer(seyu), 'A0G1', true)
	endfunction
 function JuexingSeyu2 takes nothing returns nothing
		call SetPlayerAbilityAvailable(GetOwningPlayer(seyu), 'ACam', true)
	endfunction
 function QJuexingSeyu takes nothing returns nothing
		call SetPlayerAbilityAvailable(GetOwningPlayer(seyu), 'ACam', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(seyu), 'A0G1', false)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Seyu___ShowChongdongHint takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > IMinBJ(8, Seyu___chongCount)
			if ( chongdongs[i] != null ) then
	            call PingMinimapForForce(YDWEGetForceOfPlayerNull(GetOwningPlayer(seyu)), GetUnitX(chongdongs[i]), GetUnitY(chongdongs[i]), 2.00)
			endif
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ChongdongFilter takes nothing returns boolean
	    return ( ( GetUnitTypeId(GetFilterUnit()) == 'h015' ) )
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function TSpellSeyuUpdateAct takes nothing returns nothing
  local integer i= 1
	    loop
	    	exitwhen i > IMinBJ(8, Seyu___chongCount)
	    	if ( chongdongs[i] != null ) then
	            call SetUnitAbilityLevel(chongdongs[i], 'ACfu', IMinBJ(100, GetHeroLevel(seyu) / 2))
	    	endif
	    	set i=i + 1
	    endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CreateChongdong takes nothing returns nothing
  local integer i= 1
  local group l_group= CreateGroup()
  local unit l_unit= null
		call GroupEnumUnitsInRange(l_group, GetSpellTargetX(), GetSpellTargetY(), 900, Condition(function ChongdongFilter))
		if ( CountUnitsInGroup(l_group) > 0 ) then
			call DisplayTextToPlayer(GetOwningPlayer(seyu), 0., 0., "|cFFFF66CC【虫洞】|r周围900范围内存在一个虫洞，请在远点的位置释放。")
			call DestroyGroup(l_group)
			set l_group=null
			set l_unit=null
			return
		endif
		call DestroyGroup(l_group)
		set l_group=null
		set l_unit=null
		loop
			if ( i > IMinBJ(8, Seyu___chongCount) ) then
				//空洞满了就提示满了
				call Seyu___ShowChongdongHint()
				call DisplayTextToPlayer(GetOwningPlayer(seyu), 0., 0., "|cFFFF66CC【虫洞】|r虫洞可释放的数量已满,请手动取消多余的虫洞!")
				return
			endif
			if ( chongdongs[i] == null ) then
				set chongdongs[i]=CreateUnit(GetOwningPlayer(seyu), 'h015', GetSpellTargetX(), GetSpellTargetY(), 270)
				set Seyu___TTCD[i]=CreateTextTagUnitBJ("虫洞" + I2S(i) + "号", chongdongs[i], 0, 20.00, 100, 0, 0, 0)
	            call PingMinimapForForce(YDWEGetForceOfPlayerNull(GetOwningPlayer(seyu)), GetSpellTargetX(), GetSpellTargetY(), 2.00)
	            //冰甲技能的设定
	            call TSpellSeyuUpdateAct()
	            return
			endif
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CancelChongdong takes nothing returns nothing
  local integer i= 1
	    loop
	        exitwhen i > IMinBJ(8, Seyu___chongCount)
	        if ( GetSpellAbilityUnit() == chongdongs[i] ) then
	        	call RemoveUnit(chongdongs[i])
	            call DestroyTextTag(Seyu___TTCD[i])
	            set chongdongs[i]=null
	            set Seyu___TTCD[i]=null
	            return
	        endif
	        set i=i + 1
	    endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Seyu___ChongdongSpell takes nothing returns nothing
		if ( GetSpellAbilityId() == 'A0E6' ) then
			call CancelChongdong()
		//空间免疫
		elseif ( GetSpellAbilityId() == 'ACam' ) then
			if ( GetUnitAbilityLevel(GetSpellTargetUnit(), 'Avul') == 0 ) then
				call ImmuteDamageInterval(GetSpellTargetUnit() , 3)
				call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl", GetUnitX(GetSpellTargetUnit()), GetUnitY(GetSpellTargetUnit())))
			endif
		//空间囚笼
		elseif ( GetSpellAbilityId() == 'A0G1' ) then
 			call SimulateSpell(GetSpellAbilityUnit() , GetSpellAbilityUnit() , 'A0G2' , 1 , 6 , "stomp" , false , true , false)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Seyu___EnemyFilterSeyu takes nothing returns boolean
		return IsEnemy(GetFilterUnit() , seyu) == true
	endfunction
    
    function GetRandomUnitAround takes unit u,real radius returns unit
  local group l_group= CreateGroup()
     local unit result= null
	    call GroupEnumUnitsInRange(l_group, GetUnitX(u), GetUnitY(u), radius, Condition(function Seyu___EnemyFilterSeyu))
	    set result=FirstOfGroup(l_group)
	    call DestroyGroup(l_group)
	    set l_group=null
	    return result
    endfunction
//---------------------------------------------------------------------------------------------------
	
 function Mantuoluo takes real damageRate,integer abilityID returns nothing
  local real damage= GetDamageAgi(seyu) * damageRate * 0.8
     local integer i= 1
	    loop
	    	exitwhen i > IMinBJ(8, Seyu___chongCount)
	    	if ( chongdongs[i] != null ) then
	    		call DamageAreaEffMirror(seyu , GetUnitX(chongdongs[i]) , GetUnitY(chongdongs[i]) , 600 , damage , "Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl")
	    	endif
	    	set i=i + 1
	    endloop
		call DamageAreaEffMirror(seyu , GetUnitX(seyu) , GetUnitY(seyu) , 600 , damage , "Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl")
		call CreateUnitEffect(GetOwningPlayer(seyu) , 'h00E' , GetUnitX(seyu) , GetUnitY(seyu) , 0)
	    //输出伤害
	    call PrintSpell(GetOwningPlayer(seyu) , GetAbilityName(abilityID) , damage)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function TSpellSeyu2Con takes nothing returns boolean
	    return ( ( ( GetAttacker() == seyu ) or ( GetUnitTypeId(GetAttacker()) == 'n01I' ) ) and ( IsSecondSpellOK(seyu) == true ) and ( GetRandomInt(1, 20) == 1 ) and ( GetUnitStateSwap(UNIT_STATE_MANA, seyu) > 200.00 ) and ( GetUnitAbilityLevel(seyu, 'A0C2') > 0 ) )
	endfunction
 function TSpellSeyu2Act takes nothing returns nothing
		call DisableTrigger(GetTriggeringTrigger())
		call Mantuoluo(1 , 'A0C2')
		call YDWEPolledWaitNull(5)
		call EnableTrigger(GetTriggeringTrigger())
	endfunction
//---------------------------------------------------------------------------------------------------
	
	//位置刷新，0.05s
 function Seyu___FlashPowerLocation takes nothing returns nothing
		call SetTextTagPosUnitBJ(Seyu___TTPower, seyu, 25)
	endfunction
	//数值刷新,1秒1次
 function Seyu___FlashPowerData takes nothing returns nothing
  local integer index= GetConvertedPlayerId(GetOwningPlayer(seyu))
  local real delta
		//限制能量在0-105之间
		set Seyu___IPower=IMinBJ(IMaxBJ(Seyu___IPower - IJ3(seyu , GetRandomInt(1, 2) , 1), 0), IJ3(seyu , 255 , 105))
   if ( Seyu___ItempPower == 0 and Seyu___IPower >= 105 ) then
    call SetSeyuSpinOK(GetOwningPlayer(seyu))
   endif
   set Seyu___ItempPower=Seyu___IPower
		call SetTextTagTextBJ(Seyu___TTPower, I2S(Seyu___IPower) + "%能量", 20)
		set delta=I2R(( Seyu___IPower / 10 ) * 10) / 100
		if ( Seyu___RAddtion != delta ) then
			call AddStrPercent(index , delta - Seyu___RAddtion)
			call AddIntPercent(index , delta - Seyu___RAddtion)
			call AddAgiPercent(index , delta - Seyu___RAddtion)
			set Seyu___RAddtion=delta
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Demon\\DarkPortal\\DarkPortalTarget.mdl", GetUnitX(seyu), GetUnitY(seyu)))
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Seyu___TDeathAddPowerCon takes nothing returns boolean
		return ( udg_H[GetConvertedPlayerId(GetOwningPlayer(GetKillingUnitBJ()))] == seyu )
	endfunction
 function Seyu___TDeathAddPowerAct takes nothing returns nothing
		set Seyu___IPower=Seyu___IPower + 1
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Seyu___InitPower takes nothing returns nothing
  local timer ti= CreateTimer()
  local trigger t= CreateTrigger()
		//异界能量触发
		call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_DEATH)
		call TriggerAddCondition(t, Condition(function Seyu___TDeathAddPowerCon))
		call TriggerAddAction(t, function Seyu___TDeathAddPowerAct)
		set Seyu___IPower=0
		set Seyu___RAddtion=0
		set Seyu___TTPower=CreateTextTagUnitBJ(I2S(Seyu___IPower) + "%能量", seyu, 0, 20, 100, 0, 100, 0)
		call TimerStart(ti, 0.05, true, function Seyu___FlashPowerLocation)
		set ti=CreateTimer()
		call TimerStart(ti, 1, true, function Seyu___FlashPowerData)
		set ti=null
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Seyu___TSpellSeyu3Con takes nothing returns boolean
    	return GetAttackedUnitBJ() == seyu and GetRandomInt(1, 20) == 1 and GetUnitState(seyu, UNIT_STATE_MANA) >= 400 and IsThirdSpellOK(seyu) == true and GetUnitAbilityLevel(seyu, 'AEar') == 1
	endfunction
 function Seyu___TSpellSeyu3Act takes nothing returns nothing
  local real damage= GetDamageAgi(seyu) * 2
  local integer i= 1
  local unit u= null
		call DisableTrigger(GetTriggeringTrigger())
		loop
			exitwhen i > IMinBJ(8, Seyu___chongCount)
			if ( chongdongs[i] != null ) then
				set u=GetRandomUnitAround(chongdongs[i] , 600)
	        	call CreateUnitEffect(GetOwningPlayer(u) , 'hh00' , GetUnitX(u) , GetUnitY(u) , 0)
	    		call CreateSpellTextTag("冻" , u , 0 , 100 , 0 , 4)
				call UnitDamageTarget(seyu, u, damage, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
			endif
			set i=i + 1
		endloop
		set u=GetRandomUnitAround(seyu , 600)
    	call CreateUnitEffect(GetOwningPlayer(u) , 'hh00' , GetUnitX(u) , GetUnitY(u) , 0)
		call CreateSpellTextTag("冻" , u , 0 , 100 , 0 , 4)
		call UnitDamageTarget(seyu, u, damage, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
	    call PrintSpell(GetOwningPlayer(seyu) , GetAbilityName('AEar') , damage)
		set u=null
		call YDWEPolledWaitNull(8)
		call EnableTrigger(GetTriggeringTrigger())
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Kongjianshashou takes nothing returns nothing
  local integer i= 1
  local integer ii= 1
  local integer attack= R2I(I2R(GetHeroAgi(seyu, true)) * SquareRoot(GetHeroLevel(seyu)))
		call PrintSpellContent(GetOwningPlayer(seyu) , GetAbilityName(GetSpellAbilityId()) , "攻击力" + I2S(attack) + ".")
        call PlaySoundBJ(gg_snd_seyu_4)
		loop
			exitwhen i > IMinBJ(8, Seyu___chongCount)
			if ( shashous[i] != null ) then
	        	call FlushChildHashtable(YDHT, GetHandleId(shashous[i]))
				call RemoveUnit(shashous[i])
			endif
			set i=i + 1
		endloop
		loop
			exitwhen ii > IMinBJ(8, Seyu___chongCount)
			if ( chongdongs[ii] != null ) then
				set shashous[ii]=CreateUnit(GetOwningPlayer(seyu), 'n01I', GetUnitX(chongdongs[ii]), GetUnitY(chongdongs[ii]), 270)
				call UnitApplyTimedLifeBJ(120, 'BHwe', shashous[ii])
				call SetAttack(shashous[ii] , attack)
			endif
			set ii=ii + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function FlashShashouLocation takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > IMinBJ(8, Seyu___chongCount)
			if ( IsUnitAliveBJ(shashous[i]) and shashous[i] != null ) then
				if not ( IsUnitInRange(shashous[i], chongdongs[i], 1800.00) ) then
					call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", GetUnitX(shashous[i]), GetUnitY(shashous[i])))
					call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", GetUnitX(chongdongs[i]), GetUnitY(chongdongs[i])))
					call SetUnitPosition(shashous[i], GetUnitX(chongdongs[i]), GetUnitY(chongdongs[i]))
				endif
			else
				set shashous[i]=null
			endif
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Seyu___AnShaZhiWuTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local real damage= GetDamageAgi(seyu) * 0.5
  local integer value= LoadInteger(spellTable, id, kAnShaCount)
  local integer i= 1
		if ( value < 30 ) then
			//++1
			call SaveInteger(spellTable, id, kAnShaCount, value + 1)
			//特效
	        call CreateUnitEffect(GetOwningPlayer(seyu) , 'h00E' , GetUnitX(seyu) , GetUnitY(seyu) , 0)
    		call DamageArea(seyu , GetUnitX(seyu) , GetUnitY(seyu) , 600 , damage)
			loop
				exitwhen i > 8
				if ( chongdongs[i] != null ) then
	       			call CreateUnitEffect(GetOwningPlayer(seyu) , 'h00E' , GetUnitX(chongdongs[i]) , GetUnitY(chongdongs[i]) , 0)
	    			call DamageArea(seyu , GetUnitX(chongdongs[i]) , GetUnitY(chongdongs[i]) , 600 , damage)
				endif
				set i=i + 1
			endloop
		else
			call PauseTimer(t)
			call DestroyTimer(t)
			call FlushChildHashtable(spellTable, id)
		endif
		set t=null
	endfunction
 function Seyu___AnShaZhiWu takes nothing returns nothing
  local timer t= CreateTimer()
	    call PrintSpell(GetOwningPlayer(seyu) , GetAbilityName(GetSpellAbilityId()) , GetDamageAgi(seyu))
		call SaveInteger(spellTable, GetHandleId(t), kAnShaCount, 0)
        call PlaySoundBJ(gg_snd_seyu_5)
		call TimerStart(t, 0.5, true, function Seyu___AnShaZhiWuTimer)
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Seyu___TSpellSeyuCon takes nothing returns boolean
	    return ( GetSpellAbilityUnit() == seyu )
	endfunction
 function Seyu___TSpellSeyuAct takes nothing returns nothing
		if ( ( GetSpellAbilityId() == 'A0IM' ) ) then
			call Mantuoluo(1 , GetSpellAbilityId())
		//放虫洞
		elseif ( GetSpellAbilityId() == 'A0IL' ) then
			call CreateChongdong()
		//空间杀手
		elseif ( GetSpellAbilityId() == 'AEsv' ) then
			call Kongjianshashou()
		elseif ( ( GetSpellAbilityId() == 'AEst' ) ) then
			call Seyu___AnShaZhiWu()
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
	//按照12345来判断
 function LearnSkillSeyuI takes unit learner,integer whichSpell returns nothing
  local integer i
		if ( learner == seyu ) then
			if ( whichSpell == 1 ) then
				set Seyu___chongCount=Seyu___chongCount + 1
			elseif ( whichSpell == 2 and IsSecondSpellOK(seyu) == true and GetUnitAbilityLevel(seyu, 'A0C2') == 1 ) then
				//技能2初始化
				call Seyu___InitPower()
				set Seyu___chongCount=Seyu___chongCount + 1
			elseif ( whichSpell == 3 and IsThirdSpellOK(seyu) == true and GetUnitAbilityLevel(seyu, 'AEar') == 1 ) then
				//技能3初始化
				call SetPlayerTechResearchedSwap('R00D', 1, GetOwningPlayer(seyu))
				set Seyu___chongCount=Seyu___chongCount + 1
				call InitSeyuAura()
			elseif ( whichSpell == 4 and IsFourthSpellOK(seyu) == true and GetUnitAbilityLevel(seyu, 'AEsv') == 1 ) then
				//技能4初始化
				set Seyu___chongCount=Seyu___chongCount + 1
			elseif ( whichSpell == 5 and IsFifthSpellOK(seyu) == true and GetUnitAbilityLevel(seyu, 'AEst') == 1 ) then
				//技能5初始化
				set Seyu___chongCount=Seyu___chongCount + 2
			endif
		endif
	endfunction
 function LearnSkillSeyu takes unit learner,integer learnSpellID returns nothing
		if ( learner == seyu ) then
			if ( learnSpellID == 'A0IM' ) then
				call LearnSkillSeyuI(learner , 1)
			elseif ( learnSpellID == 'A0C2' ) then
				call LearnSkillSeyuI(learner , 2)
			elseif ( learnSpellID == 'AEar' ) then
				call LearnSkillSeyuI(learner , 3)
			elseif ( learnSpellID == 'AEsv' ) then
				call LearnSkillSeyuI(learner , 4)
			elseif ( learnSpellID == 'AEst' ) then
				call LearnSkillSeyuI(learner , 5)
			endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Seyu___InitSeyuSpin takes unit u returns unit
		if ( IsSeyuSpin1(GetOwningPlayer(u)) ) then
			set udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]=CreateUnit(GetOwningPlayer(u), 'E00E', GetUnitX(u), GetUnitY(u), 0)
			call UnitAddItemByIdSwapped('I006', udg_H[GetConvertedPlayerId(GetOwningPlayer(u))])
			call AddSpellPercent(GetConvertedPlayerId(GetOwningPlayer(u)) , 0.1)
			call SetUnitManaPercentBJ(udg_H[GetConvertedPlayerId(GetOwningPlayer(u))], 100)
			call RemoveUnit(u)
			return udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
		else
			return u
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitSeyu takes unit u returns nothing
  local integer i= 1
 		//皮肤
		set seyu=Seyu___InitSeyuSpin(u)
		set Seyu___chongCount=2
		//1
	    set Seyu___TSpellSeyu=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(Seyu___TSpellSeyu, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	    call TriggerAddCondition(Seyu___TSpellSeyu, Condition(function Seyu___TSpellSeyuCon))
	    call TriggerAddAction(Seyu___TSpellSeyu, function Seyu___TSpellSeyuAct)
		//1
	    set Seyu___TSpellChongdong=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(Seyu___TSpellChongdong, EVENT_PLAYER_UNIT_SPELL_EFFECT)
	    call TriggerAddAction(Seyu___TSpellChongdong, function Seyu___ChongdongSpell)
	    //2
	    set Seyu___TSpellSeyu2=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(Seyu___TSpellSeyu2, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(Seyu___TSpellSeyu2, Condition(function TSpellSeyu2Con))
	    call TriggerAddAction(Seyu___TSpellSeyu2, function TSpellSeyu2Act)
	    //注册空间封冻技能
	    set Seyu___TSpellSeyu3=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(Seyu___TSpellSeyu3, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(Seyu___TSpellSeyu3, Condition(function Seyu___TSpellSeyu3Con))
	    call TriggerAddAction(Seyu___TSpellSeyu3, function Seyu___TSpellSeyu3Act)
		//杀手位置刷新
		call TimerStart(CreateTimer(), 5, true, function FlashShashouLocation)
	    //升级顺便提高虫洞技能等级
	    set Seyu___TSpellSeyuUpdate=CreateTrigger()
	    call TriggerRegisterUnitEvent(Seyu___TSpellSeyuUpdate, seyu, EVENT_UNIT_HERO_LEVEL)
	    call TriggerAddAction(Seyu___TSpellSeyuUpdate, function TSpellSeyuUpdateAct)
	    call QJuexingSeyu()
	endfunction

//library Seyu ends
//library Sheyan:
//---------------------------------------------------------------------------------------------------
	
 function ShowSheyanDialog takes unit u returns nothing
		if ( not ( BSheyanBUG ) and u == sheyan ) then
			set BSheyanBUG=true
			call ShowGameHint(GetOwningPlayer(sheyan) , "\n				该英雄目前存在着以下:\n				使用小狼打巨能会出现\n				英雄死亡不会复活的BUG。\n				目前版本请不要使用小狼打巨能.")
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Sheyan__InitSheyanSpin takes unit u returns unit
		if ( IsSheyanSpin1(GetOwningPlayer(u)) ) then
			set udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]=CreateUnit(GetOwningPlayer(u), 'O004', GetUnitX(u), GetUnitY(u), 0)
			set gg_unit_Othr_0256=udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
			call UnitAddItemByIdSwapped('I006', udg_H[GetConvertedPlayerId(GetOwningPlayer(u))])
			call AddSpellPercent(GetConvertedPlayerId(GetOwningPlayer(u)) , 0.1)
			call SetUnitManaPercentBJ(udg_H[GetConvertedPlayerId(GetOwningPlayer(u))], 1000)
			call RemoveUnit(u)
			return udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
		else
			return u
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitSheyan takes unit u returns nothing
		set sheyan=Sheyan__InitSheyanSpin(u)
	endfunction

//library Sheyan ends
//library Shilian:
//---------------------------------------------------------------------------------------------------
	
 function Shilian___TZheCon takes nothing returns boolean
		return ( GetEventDamage() > GetUnitState(GetTriggerUnit(), UNIT_STATE_LIFE) ) and Shilian___BShilianing[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]
	endfunction
 function Shilian___TZheAct takes nothing returns nothing
		if ( GetUnitAbilityLevel(gg_unit_n01S_0258, 'A0M5') == 0 ) then
			set IZheCountOnce[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]=IZheCountOnce[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] + 1
		endif
		call ImmuteDamageInterval(GetTriggerUnit() , 0.1)
		call SetUnitLifePercentBJ(GetTriggerUnit(), 100)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Shilian___TXingCon takes nothing returns boolean
		return ( GetIssuedOrderIdBJ() == String2OrderIdBJ("smart") ) and ( Shilian___BShilianing[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] or IKuanghuanType[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] == 2 )
	endfunction
 function Shilian___TXingAct takes nothing returns nothing
		if ( IsInForbitRegion(GetOrderPointX() , GetOrderPointY() , GetTriggerUnit()) ) then
			call IssueImmediateOrder(GetTriggerUnit(), "stop")
	        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, "|cFFFF66CC【消息】|r此处禁止瞬移到达.")
	        return
		endif
	    if ( IsTerrainPathable(GetOrderPointX(), GetOrderPointY(), PATHING_TYPE_WALKABILITY) ) then
	    	call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【消息】|r目标地点不能通行,瞬移失败！")
	    	return
	    endif
		call SetUnitX(GetTriggerUnit(), GetOrderPointX())
		call SetUnitY(GetTriggerUnit(), GetOrderPointY())
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\MirrorImage\\MirrorImageCaster.mdl", GetOrderPointX(), GetOrderPointY()))
	endfunction
//---------------------------------------------------------------------------------------------------
	
	//临
 function SLSpellLin takes unit u returns nothing
	endfunction
	//兵
 function SLSpellBing takes unit u returns nothing
  local group l_group= null
  local unit l_unit= null
  local unit temp= null
		if ( ModuloInteger(Shilian___IShilianTime[GetConvertedPlayerId(GetOwningPlayer(u))], 10) != 0 ) then
			return
		endif
		set l_group=CreateGroup()
		call GroupEnumUnitsInRange(l_group, GetUnitX(u), GetUnitY(u), 600, null)
		loop
		    set l_unit=FirstOfGroup(l_group)
		    exitwhen l_unit == null
		    call GroupRemoveUnit(l_group, l_unit)
		    if ( IsEnemy(l_unit , u) ) then
			    if ( GetUnitState(l_unit, UNIT_STATE_LIFE) > GetUnitState(temp, UNIT_STATE_LIFE) ) then
			    	set temp=l_unit
			    endif
		    endif
		endloop
		call DestroyGroup(l_group)
		set l_group=null
		set l_unit=null
		if ( temp != null ) then
			call UnitDamageTarget(u, temp, GetDamageBase(u) * 0.6, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
			call DestroyEffect(AddSpecialEffect("war3mapImported\\ImpaleMissTarget_Portrait.mdl", GetUnitX(temp), GetUnitY(temp)))
		endif
		set temp=null
	endfunction
	//阵
 function SLSpellZhen takes unit u returns nothing
		if ( ModuloInteger(Shilian___IShilianTime[GetConvertedPlayerId(GetOwningPlayer(u))], 10) != 0 ) then
			return
		endif
		call DamageAreaEff(u , GetUnitX(u) , GetUnitY(u) , 600 , GetDamageBase(u) * 0.2 , "war3mapImported\\Artillery.mdl")
	endfunction
	//总索引
 function ShilianTimerContent takes player p returns nothing
  local integer id= GetConvertedPlayerId(p)
		if ( IShilianType[id] == 2 ) then
			call SLSpellBing(udg_H[id])
		elseif ( IShilianType[id] == 6 ) then
			call SLSpellZhen(udg_H[id])
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Shilian___InitJieDamage takes player p returns nothing
  local integer index= GetConvertedPlayerId(p)
		set Shilian___IJie1[index]=Mdamage1[index]
		set Shilian___IJie2[index]=Mdamage2[index]
	endfunction
 function Shilian___JieDamageExpose takes player p returns nothing
  local integer index= GetConvertedPlayerId(p)
  local real damage1= I2R(Mdamage1[index] - Shilian___IJie1[index]) * 0.3
  local real damage2= I2R(Mdamage2[index] - Shilian___IJie2[index]) * 0.3
  local real damage= 0.
  local group l_group= CreateGroup()
  local unit l_unit= null
  local integer count= 0
		call GroupEnumUnitsInRange(l_group, GetUnitX(udg_H[GetConvertedPlayerId(p)]), GetUnitY(udg_H[GetConvertedPlayerId(p)]), 900, null)
		loop
		    set l_unit=FirstOfGroup(l_group)
		    exitwhen l_unit == null
		    call GroupRemoveUnit(l_group, l_unit)
		    if ( IsEnemy(l_unit , udg_H[GetConvertedPlayerId(p)]) ) then
		    	set count=count + 1
		    endif
		endloop
		if ( count >= 120 and not ( IsInRect(GetUnitX(udg_H[GetConvertedPlayerId(p)]) , GetUnitY(udg_H[GetConvertedPlayerId(p)]) , gg_rct__________u) ) ) then
    call GetAchievementAndSave(p , 421)
		elseif ( count >= 20 ) then
			call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r数量:" + I2S(count))
		endif
		call DestroyGroup(l_group)
		set damage=RMinBJ(300000000. * 100, damage2 * 100000000 + damage1) / IMaxBJ(1, count)
		call CreateTextTagA(I2S(R2I(damage / 10000)) + "万伤害!" , udg_H[GetConvertedPlayerId(p)] , 100 , 0 , 0 , 3 , 30)
		set l_group=CreateGroup()
		call GroupEnumUnitsInRange(l_group, GetUnitX(udg_H[GetConvertedPlayerId(p)]), GetUnitY(udg_H[GetConvertedPlayerId(p)]), 900, null)
		loop
		    set l_unit=FirstOfGroup(l_group)
		    exitwhen l_unit == null
		    call GroupRemoveUnit(l_group, l_unit)
		    if ( IsEnemy(l_unit , udg_H[GetConvertedPlayerId(p)]) ) then
		    	if ( IsUnitType(l_unit, UNIT_TYPE_HERO) ) then
		    		call UnitDamageTarget(udg_H[GetConvertedPlayerId(p)], l_unit, RMinBJ(damage, GetUnitState(l_unit, UNIT_STATE_MAX_LIFE) * 0.2), false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
		    	else
		    		call UnitDamageTarget(udg_H[GetConvertedPlayerId(p)], l_unit, damage, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
		    	endif
				call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Orc\\Orcblood\\BattrollBlood.mdl", GetUnitX(l_unit), GetUnitY(l_unit)))
		    endif
		endloop
		call DestroyGroup(l_group)
		set l_group=null
		set l_unit=null
		set Shilian___IJie1[index]=0
		set Shilian___IJie2[index]=0
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Shilian___SyncQian takes player p returns nothing
  local integer id= GetConvertedPlayerId(p)
  local unit u= udg_H[GetConvertedPlayerId(p)]
  local integer i= 1
		if ( IsUnitAliveBJ(Shilian___UQian[id]) ) then
			call SetUnitUserData(Shilian___UQian[id], 0)
			loop
				exitwhen i > 6
				if ( GetItemTypeId(UnitItemInSlotBJ(u, i)) != GetItemTypeId(UnitItemInSlotBJ(Shilian___UQian[id], i)) ) then
					call RemoveItem(UnitItemInSlotBJ(Shilian___UQian[id], i))
					call UnitAddItemToSlotById(Shilian___UQian[id], GetItemTypeId(UnitItemInSlotBJ(u, i)), i - 1)
				    call SetItemDroppable(UnitItemInSlotBJ(Shilian___UQian[id], i), false)
				    call SetItemPawnable(UnitItemInSlotBJ(Shilian___UQian[id], i), false)
				endif
				set i=i + 1
			endloop
			call SetUnitUserData(Shilian___UQian[id], 1)
			if not ( Shilian___BQian[id] ) then
				call SetAttack(Shilian___UQian[id] , R2I(GetAttack(u) * 0.1))
				call SetDefense(Shilian___UQian[id] , R2I(GetDefense(u) * 0.1))
				call SetHP(Shilian___UQian[id] , R2I(GetHP(u) * 0.1))
				call SetHeroInt(Shilian___UQian[id], R2I(GetHeroInt(u, false) * 0.1), false)
				call SetHeroStr(Shilian___UQian[id], R2I(GetHeroStr(u, false) * 0.1), false)
				call SetHeroAgi(Shilian___UQian[id], R2I(GetHeroAgi(u, false) * 0.1), false)
			else
				call SetAttack(Shilian___UQian[id] , GetAttack(u))
				call SetDefense(Shilian___UQian[id] , GetDefense(u))
				call SetHP(Shilian___UQian[id] , GetHP(u))
				call SetHeroStr(Shilian___UQian[id], GetHeroStr(u, false), false)
				call SetHeroAgi(Shilian___UQian[id], GetHeroAgi(u, false), false)
				call SetHeroInt(Shilian___UQian[id], GetHeroInt(u, false), false)
			endif
		endif
		set u=null
	endfunction
 function Shilian___QianTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local player p= LoadPlayerHandle(LHTable, id, 1)
		call Shilian___SyncQian(p)
		set p=null
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitSyncQianAttr takes player p returns nothing
  local timer t= CreateTimer()
		call Shilian___SyncQian(p)
		call SavePlayerHandle(LHTable, GetHandleId(t), 1, p)
		call TimerStart(t, 10, true, function Shilian___QianTimer)
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitShilianSpell takes player p returns nothing
  local integer id= GetConvertedPlayerId(p)
		if ( IShilianType[id] == 1 ) then
			set Shilian___ALin[id]=s__Attract_create(udg_H[id] , 900 , 0.05 , 50)
			call s__Attract_SetForbitHero(Shilian___ALin[id])
			call s__Attract_SetDeathContinue(Shilian___ALin[id])
		    call s__Attract_start(Shilian___ALin[id])
		elseif ( IShilianType[id] == 2 ) then
		elseif ( IShilianType[id] == 3 ) then
			call UnitAddAbilityP(udg_H[id] , 'A0LC')
		elseif ( IShilianType[id] == 4 ) then
			set IZheCountOnce[id]=0
		elseif ( IShilianType[id] == 5 ) then
			call Shilian___InitJieDamage(p)
		elseif ( IShilianType[id] == 6 ) then
		elseif ( IShilianType[id] == 7 ) then
			call UnitAddAbilityP(udg_H[id] , 'A0MA')
			set BGoldGongxiang[id]=true
		elseif ( IShilianType[id] == 8 ) then
			set Shilian___BQian[id]=true
			call Shilian___SyncQian(p)
		elseif ( IShilianType[id] == 9 ) then
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CloseShilianSpell takes player p returns nothing
  local integer id= GetConvertedPlayerId(p)
		if ( IShilianType[id] == 1 ) then
		    call s__Attract_deallocate(Shilian___ALin[id])
			set Shilian___ALin[id]=0
		elseif ( IShilianType[id] == 3 ) then
			call UnitRemoveAbility(udg_H[id], 'A0LC')
		elseif ( IShilianType[id] == 4 ) then
			if ( IZheCountOnce[id] > 0 ) then
				if ( IZheCountOnce[id] >= 18 ) then
      call GetAchievementAndSave(p , 423)
				else
					call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【者之尘】|r" + I2S(IZheCountOnce[id]))
				endif
			endif
		elseif ( IShilianType[id] == 5 ) then
			call Shilian___JieDamageExpose(p)
		elseif ( IShilianType[id] == 6 ) then
		elseif ( IShilianType[id] == 7 ) then
			call UnitRemoveAbility(udg_H[id], 'A0MA')
			set BGoldGongxiang[id]=false
		elseif ( IShilianType[id] == 8 ) then
			set Shilian___BQian[id]=false
			call Shilian___SyncQian(p)
		elseif ( IShilianType[id] == 9 ) then
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function DestroyShilianSpell takes player p returns nothing
  local integer id= GetConvertedPlayerId(p)
		set Shilian___BShilianing[id]=false
		call s__Connect_deallocate(Shilian___CShilian[id])
		set Shilian___CShilian[id]=0
		call FlushChildHashtable(LHTable, GetHandleId(Shilian___TShilian[id]))
		call PauseTimer(Shilian___TShilian[id])
		call DestroyTimer(Shilian___TShilian[id])
		set Shilian___TShilian[id]=null
		call s__TextTagBind_deallocate(Shilian___TTBShilian[id])
		call CloseShilianSpell(p)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function FlashShilianTimer takes nothing returns nothing
  local player p= LoadPlayerHandle(LHTable, GetHandleId(GetExpiredTimer()), 1)
  local integer id= GetConvertedPlayerId(p)
        set Shilian___IShilianTime[id]=Shilian___IShilianTime[id] - 1
        if ( Shilian___IShilianTime[id] <= 0 ) then
        	call DestroyShilianSpell(p)
        	set p=null
        	return
        endif
		call s__TextTagBind_setContent(Shilian___TTBShilian[id],I2S(Shilian___IShilianTime[id] / 10) + "." + I2S(ModuloInteger(Shilian___IShilianTime[id], 10)) + "s")
    	call ShilianTimerContent(p)
        set p=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function StartShilianSpell takes player p returns nothing
  local integer id= GetConvertedPlayerId(p)
		set Shilian___BShilianing[id]=true
		set Shilian___CShilian[id]=s__Connect_create(UShilian , udg_H[id] , "HWPB")
		set Shilian___TShilian[id]=CreateTimer()
		call SavePlayerHandle(LHTable, GetHandleId(Shilian___TShilian[id]), 1, p)
		call TimerStart(Shilian___TShilian[id], 0.1, true, function FlashShilianTimer)
		set Shilian___TTBShilian[id]=s__TextTagBind_create(udg_H[id] , 70 , 70)
		call InitShilianSpell(p)
		if not ( Shilian___BFirstShilian2[id] ) then
			set Shilian___BFirstShilian2[id]=true
			call ShowGameHint(p , "\n			|cff00ccff每次完成挑战你将得到\n			" + I2S(Shilian___IShilianTime[id] / 10) + "s的主动技能持续时间.|r\n			|cffffff00在开启该技能时该持续时间会不断消耗.|r\n			|cffff6800你可以再次通过双击(点击2次)Esc键\n			来关闭主动技能,停止时间消耗.|r\n")
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SpellShilian takes player p returns nothing
  local integer id= GetConvertedPlayerId(p)
		if not ( Shilian___BShilianing[id] ) then
			// 开始施放技能
			if ( Shilian___IShilianTime[id] > 0 ) then
				call StartShilianSpell(p)
			else
				call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r你的试练充能时间已经用光了,请重新试练吧!")
			endif
		else
			//已经开始施放了,则关闭
			call DestroyShilianSpell(p)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Shilian___TDoubleEscAct takes nothing returns nothing
  local integer id= GetConvertedPlayerId(GetTriggerPlayer())
		if ( BEscOnce[id] ) then
			set BEscOnce[id]=false
			if not ( BEscTwice[id] ) then
				call SpellShilian(GetTriggerPlayer())
				set BEscTwice[id]=true
				call YDWEPolledWaitNull(0.3)
				set BEscTwice[id]=false
				set BEscOnce[id]=false
			endif
		else
			set BEscOnce[id]=true
			call YDWEPolledWaitNull(0.3)
			set BEscOnce[id]=false
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function AddXingUnit takes unit u returns nothing
    	if ( Shilian___TXing == null ) then
			set Shilian___TXing=CreateTrigger()
			call TriggerAddCondition(Shilian___TXing, Condition(function Shilian___TXingCon))
			call TriggerAddAction(Shilian___TXing, function Shilian___TXingAct)
		endif
    	call TriggerRegisterUnitEvent(Shilian___TXing, u, EVENT_UNIT_ISSUED_POINT_ORDER)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ChooseShilian takes player p,integer index returns nothing
  local integer id= GetConvertedPlayerId(p)
		set IShilianType[id]=index
		if ( index == 1 ) then
			//临
			call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r你成功的将|cff00ccff九字真言 - 临|r定为你的试练内容.")
			call UnitAddAbilityP(udg_H[id] , 'A0L7')
			call AddAgiPercentImme(id , 0.05)
			call AddStrPercentImme(id , 0.05)
			call AddIntPercentImme(id , 0.05)
		elseif ( index == 2 ) then
			//兵
			call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r你成功的将|cff00ccff九字真言 - 兵|r定为你的试练内容.")
			call UnitAddAbilityP(udg_H[id] , 'A0KX')
		elseif ( index == 3 ) then
			//斗
			call UnitAddAbilityP(udg_H[id] , 'A0L4')
			call UnitAddAbilityP(udg_H[id] , 'A0LE')
			call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r你成功的将|cff00ccff九字真言 - 斗|r定为你的试练内容.")
			call SetPlayerAbilityAvailable(p, 'A0LE', false)
			call SetPlayerAbilityAvailable(p, 'A0LC', false)
		elseif ( index == 4 ) then
			//者
			call UnitAddAbilityP(udg_H[id] , 'A0LF')
			call SetPlayerAbilityAvailable(p, 'A0LF', false)
			call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r你成功的将|cff00ccff九字真言 - 者|r定为你的试练内容.")
			call UnitAddAbilityP(udg_H[id] , 'A0LA')
			if ( Shilian___TZhe == null ) then
				set Shilian___TZhe=CreateTrigger()
				call TriggerAddCondition(Shilian___TZhe, Condition(function Shilian___TZheCon))
				call TriggerAddAction(Shilian___TZhe, function Shilian___TZheAct)
			endif
	   		call TriggerRegisterUnitEvent(Shilian___TZhe, udg_H[GetConvertedPlayerId(p)], EVENT_UNIT_DAMAGED)
		elseif ( index == 5 ) then
			//皆
			call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r你成功的将|cff00ccff九字真言 - 皆|r定为你的试练内容.")
			call UnitAddAbilityP(udg_H[id] , 'A0L6')
			call AddHPPercent(id , 0.1)
		elseif ( index == 6 ) then
			//阵
			call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r你成功的将|cff00ccff九字真言 - 阵|r定为你的试练内容.")
			call AddDamagePercent(GetConvertedPlayerId(p) , 0.08)
			call UnitAddAbilityP(udg_H[id] , 'A0LB')
		elseif ( index == 7 ) then
			//列
			call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r你成功的将|cff00ccff九字真言 - 列|r定为你的试练内容.")
			call UnitAddAbilityP(udg_H[id] , 'A0L5')
			call AddDefensePercent(id , 0.1)
			call SetPlayerAbilityAvailable(p, 'A0MA', false)
		elseif ( index == 8 ) then
			//前
			call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r你成功的将|cff00ccff九字真言 - 前|r定为你的试练内容.")
			call UnitAddAbilityP(udg_H[id] , 'A0L8')
			set Shilian___UQian[id]=CreateUnit(p, 'N01Y', GetUnitX(udg_H[id]), GetUnitY(udg_H[id]), 0)
			call InitSyncQianAttr(p)
		elseif ( index == 9 ) then
			//行
			call UnitAddAbilityP(udg_H[id] , 'A0L9')
			call UnitAddAbilityP(udg_H[id] , 'A0LG')
			call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r你成功的将|cff00ccff九字真言 - 行|r定为你的试练内容.")
			call SetPlayerAbilityAvailable(p, 'A0LG', false)
			call AddXingUnit(udg_H[GetConvertedPlayerId(p)])
		endif
		call ShowGameHint(p , "\n			恭喜你完成了传承试练!\n			|cff00ccff你获得了对应该传承的\n			主动技能与被动技能.|r\n			|cffffff00被动技能将会一直存在.|r\n			|cffff6800你可以通过双击(点击2次)Esc键\n			来开启主动技能.|r\n")
    	call SetPlayerTechResearchedSwap('R01K', 1, p)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Shilian___AddMonsterRandomAbility takes unit u returns nothing
  local integer i= GetRandomInt(1, 24)
		if ( i == 1 ) then
			call UnitAddAbility(u, 'A044')
			call SetUnitAbilityLevel(u, 'A044', udg_Nandu_JJJ)
		elseif ( i == 2 ) then
			call UnitAddAbility(u, 'A0AN')
		elseif ( i == 3 ) then
			call UnitAddAbility(u, 'A00A')
		elseif ( i == 4 ) then
			call UnitAddAbility(u, 'ACat')
			call SetUnitAbilityLevel(u, 'ACat', udg_Nandu_JJJ)
		elseif ( i == 5 ) then
			call UnitAddAbility(u, 'A03T')
			call SetUnitAbilityLevel(u, 'A03T', udg_Nandu_JJJ)
			call UnitAddAbility(u, 'A06K')
			call SetUnitAbilityLevel(u, 'A06K', udg_Nandu_JJJ)
		elseif ( i == 6 ) then
			call UnitAddAbility(u, 'A05N')
			call SetUnitAbilityLevel(u, 'A05N', udg_Nandu_JJJ)
		elseif ( i == 7 ) then
			call UnitAddAbility(u, 'A08H')
			call SetUnitAbilityLevel(u, 'A08H', udg_Nandu_JJJ)
			call UnitAddAbility(u, 'A05O')
			call SetUnitAbilityLevel(u, 'A05O', udg_Nandu_JJJ)
		elseif ( i == 8 ) then
			call UnitAddAbility(u, 'uban')
			call SetUnitAbilityLevel(u, 'uban', udg_Nandu_JJJ)
		elseif ( i == 9 ) then
			call UnitAddAbility(u, 'A05V')
			call SetUnitAbilityLevel(u, 'A05V', udg_Nandu_JJJ)
		elseif ( i == 10 ) then
			call UnitAddAbility(u, 'A05I')
			call SetUnitAbilityLevel(u, 'A05I', udg_Nandu_JJJ)
		elseif ( i == 11 ) then
			call UnitAddAbility(u, 'Ablo')
			call SetUnitAbilityLevel(u, 'Ablo', udg_Nandu_JJJ)
		elseif ( i == 12 ) then
			call UnitAddAbility(u, 'A09G')
			call SetUnitAbilityLevel(u, 'A09G', udg_Nandu_JJJ)
		elseif ( i == 13 ) then
			call UnitAddAbility(u, 'A09N')
			call SetUnitAbilityLevel(u, 'A09N', udg_Nandu_JJJ)
		elseif ( i == 14 ) then
			//归一
			//call UnitAddAbility(u,'A095')
		elseif ( i == 15 ) then
			call UnitAddAbility(u, 'Aams')
			call SetUnitAbilityLevel(u, 'Aams', udg_Nandu_JJJ)
		elseif ( i == 16 ) then
			call UnitAddAbility(u, 'A08A')
			call SetUnitAbilityLevel(u, 'A08A', udg_Nandu_JJJ)
		elseif ( i == 17 ) then
			call UnitAddAbility(u, 'A0A1')
			call SetUnitAbilityLevel(u, 'A0A1', udg_Nandu_JJJ)
		elseif ( i == 18 ) then
			call UnitAddAbility(u, 'A09C')
			call SetUnitAbilityLevel(u, 'A09C', udg_Nandu_JJJ)
		elseif ( i == 19 ) then
			call UnitAddAbility(u, 'A0LH')
		elseif ( i == 20 ) then
			call UnitAddAbility(u, 'ANr2')
			call SetUnitAbilityLevel(u, 'ANr2', udg_Nandu_JJJ)
		elseif ( i == 21 ) then
			call UnitAddAbility(u, 'A0LI')
		elseif ( i == 22 ) then
			call UnitAddAbility(u, 'A08F')
			call SetUnitAbilityLevel(u, 'A08F', udg_Nandu_JJJ)
		elseif ( i == 23 ) then
			call UnitAddAbility(u, 'A0B8')
		elseif ( i == 24 ) then
			call UnitAddAbility(u, 'A0BD')
			call SetUnitAbilityLevel(u, 'A0BD', udg_Nandu_JJJ)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Shilian___MonsterSetPower takes unit u,player p returns nothing
  local integer id= GetConvertedPlayerId(p)
		if ( udg_Zhandouli[id] < 500 ) then
			call SetHeroInt(u, 20, true)
			call SetHeroAgi(u, 5000, true)
			call SetHeroStr(u, 1000, true)
		elseif ( udg_Zhandouli[id] < 2500 ) then
			call SetHeroInt(u, 80, true)
			call SetHeroAgi(u, 15000, true)
			call SetHeroStr(u, 30000, true)
		elseif ( udg_Zhandouli[id] < 8500 ) then
			call SetHeroInt(u, 500, true)
			call SetHeroAgi(u, 30000, true)
			call SetHeroStr(u, 150000, true)
		elseif ( udg_Zhandouli[id] < 15000 ) then
			call SetHeroInt(u, 5000, true)
			call SetHeroAgi(u, 50000, true)
			call SetHeroStr(u, 500000, true)
		elseif ( udg_Zhandouli[id] < 30000 ) then
			call SetHeroInt(u, 30000, true)
			call SetHeroAgi(u, 80000, true)
			call SetHeroStr(u, 1300000, true)
		elseif ( udg_Zhandouli[id] < 60000 ) then
			call SetHeroInt(u, 60000, true)
			call SetHeroAgi(u, 120000, true)
			call SetHeroStr(u, 3000000, true)
		elseif ( udg_Zhandouli[id] < 120000 ) then
			call SetHeroInt(u, 150000, true)
			call SetHeroAgi(u, 120000, true)
			call SetHeroStr(u, 10000000, true)
		elseif ( udg_Zhandouli[id] < 250000 ) then
			call SetHeroInt(u, 800000, true)
			call SetHeroAgi(u, 200000, true)
			call SetHeroStr(u, 30000000, true)
		elseif ( udg_Zhandouli[id] < 500000 ) then
			call SetHeroInt(u, 3000000, true)
			call SetHeroAgi(u, 400000, true)
			call SetHeroStr(u, 100000000, true)
		elseif ( udg_Zhandouli[id] < 700000 ) then
			call SetHeroInt(u, 5000000, true)
			call SetHeroAgi(u, 500000, true)
			call SetHeroStr(u, 200000000, true)
		elseif ( udg_Zhandouli[id] < 800000 ) then
			call SetHeroInt(u, 6000000, true)
			call SetHeroAgi(u, 600000, true)
			call SetHeroStr(u, 300000000, true)
		elseif ( udg_Zhandouli[id] < 900000 ) then
			call SetHeroInt(u, 8000000, true)
			call SetHeroAgi(u, 700000, true)
			call SetHeroStr(u, 500000000, true)
		elseif ( udg_Zhandouli[id] < 1000000 ) then
			call SetHeroInt(u, 10000000, true)
			call SetHeroAgi(u, 1000000, true)
			call SetHeroStr(u, 800000000, true)
		elseif ( udg_Zhandouli[id] < 1200000 ) then
			call SetHeroInt(u, 18000000, true)
			call SetHeroAgi(u, 1300000, true)
			call SetHeroStr(u, 1000000000, true)
		elseif ( udg_Zhandouli[id] < 1500000 ) then
			call SetHeroInt(u, 24000000, true)
			call SetHeroAgi(u, 1500000, true)
			call SetHeroStr(u, 1400000000, true)
		elseif ( udg_Zhandouli[id] < 1800000 ) then
			call SetHeroInt(u, 29000000, true)
			call SetHeroAgi(u, 1800000, true)
			call SetHeroStr(u, 1600000000, true)
		else
			call SetHeroInt(u, 34000000, true)
			call SetHeroAgi(u, 2200000, true)
			call SetHeroStr(u, 2000000000, true)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Shilian___CreateShilianMonster takes player p returns nothing
  local integer i= 1
  local unit u= null
		call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r你的战斗力为" + I2S(udg_Zhandouli[GetConvertedPlayerId(p)]) + ".")
		loop
			exitwhen i > 20
            set u=CreateUnit(Player(11), 'N01U', GetRandomReal(GetRectMinX(gg_rct_Chuancheng), GetRectMaxX(gg_rct_Chuancheng)), GetRandomReal(GetRectMinY(gg_rct_Chuancheng), GetRectMaxY(gg_rct_Chuancheng)), GetRandomReal(0, 360))
        	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\Blink\\BlinkTarget.mdl", GetUnitX(u), GetUnitY(u)))
        	call Shilian___AddMonsterRandomAbility(u)
    		call TriggerExecute(gg_trg_zhandouli2)
        	call Shilian___MonsterSetPower(u , p)
            call EnhanceDiffAttack(u)
			call GroupAddUnit(Shilian___GShilian, u)
			set i=i + 1
		endloop
		set u=null
	endfunction
//---------------------------------------------------------------------------------------------------
    
    function Shilian___GetShilianMonsterCount takes nothing returns integer
        local group l_group= CreateGroup()
        local unit l_unit
        local integer count= 0
        call GroupAddGroup(Shilian___GShilian, l_group)
        loop
            set l_unit=FirstOfGroup(l_group)
            exitwhen l_unit == null
            call GroupRemoveUnit(l_group, l_unit)
            if ( IsUnitAliveBJ(l_unit) and GetOwningPlayer(l_unit) == Player(11) ) then
                set count=count + 1
                call UnitRemoveBuffsBJ(bj_REMOVEBUFFS_ALL, l_unit)
            endif
        endloop
        call DestroyGroup(l_group)
        set l_group=null
        set l_unit=null
        return count
    endfunction
//---------------------------------------------------------------------------------------------------
	
 function Shilian___RemoveChuanchengUnit takes nothing returns nothing
        if ( IsUnitAliveBJ(GetEnumUnit()) and GetOwningPlayer(GetEnumUnit()) == Player(11) ) then
            call FlushChildHashtable(YDHT, GetHandleId(GetEnumUnit()))
            call RemoveUnit(GetEnumUnit())
        endif
	endfunction
 function Shilian___ClearChuancheng takes nothing returns nothing
		call ForGroup(Shilian___GShilian, function Shilian___RemoveChuanchengUnit)
		call DestroyGroup(Shilian___GShilian)
		set Shilian___GShilian=null
		set Shilian___IContinousShilian=0
		set Shilian___PShilian=null
		call PauseTimer(Shilian___TChuanchengRest)
		call DestroyTimer(Shilian___TChuanchengRest)
		call DestroyTimerDialog(Shilian___TDChuanchengRest)
		set Shilian___TChuanchengRest=null
		set Shilian___TDChuanchengRest=null
		call PauseTimer(Shilian___TChuanchengJudge)
		call DestroyTimer(Shilian___TChuanchengJudge)
		set Shilian___TChuanchengJudge=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Shilian___ChuanchengJudge takes nothing returns nothing
        if ( Shilian___GetShilianMonsterCount() == 0 ) then
        	if ( IShilianType[GetConvertedPlayerId(Shilian___PShilian)] == 0 ) then
        		call ChooseShilian(Shilian___PShilian , Shilian___IContinousShilian)
        	endif
			set Shilian___IShilianTimes[GetConvertedPlayerId(Shilian___PShilian)]=Shilian___IShilianTimes[GetConvertedPlayerId(Shilian___PShilian)] + 1
        	if ( IShilianType[GetConvertedPlayerId(Shilian___PShilian)] == 1 ) then
        		set Shilian___IShilianTime[GetConvertedPlayerId(Shilian___PShilian)]=250 * I3(GetUnitAbilityLevel(gg_unit_n01S_0258, 'A0M5') == 1 , 2 , 1)
        	elseif ( IShilianType[GetConvertedPlayerId(Shilian___PShilian)] == 2 ) then
        		set Shilian___IShilianTime[GetConvertedPlayerId(Shilian___PShilian)]=600 * I3(GetUnitAbilityLevel(gg_unit_n01S_0258, 'A0M5') == 1 , 2 , 1)
        	elseif ( IShilianType[GetConvertedPlayerId(Shilian___PShilian)] == 3 ) then
        		set Shilian___IShilianTime[GetConvertedPlayerId(Shilian___PShilian)]=900 * I3(GetUnitAbilityLevel(gg_unit_n01S_0258, 'A0M5') == 1 , 2 , 1)
        	elseif ( IShilianType[GetConvertedPlayerId(Shilian___PShilian)] == 4 ) then
        		set Shilian___IShilianTime[GetConvertedPlayerId(Shilian___PShilian)]=50 * I3(GetUnitAbilityLevel(gg_unit_n01S_0258, 'A0M5') == 1 , 2 , 1)
        	elseif ( IShilianType[GetConvertedPlayerId(Shilian___PShilian)] == 5 ) then
        		set Shilian___IShilianTime[GetConvertedPlayerId(Shilian___PShilian)]=250 * I3(GetUnitAbilityLevel(gg_unit_n01S_0258, 'A0M5') == 1 , 2 , 1)
        	elseif ( IShilianType[GetConvertedPlayerId(Shilian___PShilian)] == 6 ) then
        		set Shilian___IShilianTime[GetConvertedPlayerId(Shilian___PShilian)]=600 * I3(GetUnitAbilityLevel(gg_unit_n01S_0258, 'A0M5') == 1 , 2 , 1)
        	elseif ( IShilianType[GetConvertedPlayerId(Shilian___PShilian)] == 7 ) then
        		set Shilian___IShilianTime[GetConvertedPlayerId(Shilian___PShilian)]=900 * I3(GetUnitAbilityLevel(gg_unit_n01S_0258, 'A0M5') == 1 , 2 , 1)
        	elseif ( IShilianType[GetConvertedPlayerId(Shilian___PShilian)] == 8 ) then
        		set Shilian___IShilianTime[GetConvertedPlayerId(Shilian___PShilian)]=900 * I3(GetUnitAbilityLevel(gg_unit_n01S_0258, 'A0M5') == 1 , 2 , 1)
        	elseif ( IShilianType[GetConvertedPlayerId(Shilian___PShilian)] == 9 ) then
        		set Shilian___IShilianTime[GetConvertedPlayerId(Shilian___PShilian)]=450 * I3(GetUnitAbilityLevel(gg_unit_n01S_0258, 'A0M5') == 1 , 2 , 1)
        	endif
        	call DisplayTextToPlayer(Shilian___PShilian, 0., 0., "|cFFFF66CC【消息】|r你的主动技能时间充能至" + I2S(Shilian___IShilianTime[GetConvertedPlayerId(Shilian___PShilian)] / 10) + "s.")
			call Shilian___ClearChuancheng()
        endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Shilian___ChuanchengTimeOut takes nothing returns nothing
		//清除传承有关的东西
		call DisplayTextToPlayer(Shilian___PShilian, 0., 0., "|cFFFF66CC【消息】|r你的传承试练失败了！")
		call Shilian___ClearChuancheng()
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function StartShilian takes player p,integer i returns nothing
  local integer id= GetConvertedPlayerId(p)
		if ( i != IShilianType[id] and IShilianType[id] != 0 ) then
			call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r每一局游戏只能选择一种试练并不能更改.")
			return
		endif
		if not ( udg_H[id] == GetBuyingUnit() and RectContainsUnit(gg_rct_Chuancheng, GetBuyingUnit()) ) then
            call DisplayTextToPlayer(p, 0, 0, "|cFFFF66CC【消息】|r请用英雄来试练。")
            return
		endif
		if ( Shilian___PShilian != null ) then
            call DisplayTextToPlayer(p, 0, 0, "|cFFFF66CC【消息】|r有人正在试练!")
            return
		endif
		if ( Shilian___IShilianTime[GetConvertedPlayerId(p)] > 0 ) then
			call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r你的时间未用完，请把所有时间用完再来试练！")
            return
		endif
        if ( GetPlayerState(p, PLAYER_STATE_RESOURCE_LUMBER) < ( R2I(Pow(2, Shilian___IShilianTimes[GetConvertedPlayerId(p)])) * 10 ) ) then
            call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r你的木头不足" + I2S(( R2I(Pow(2, Shilian___IShilianTimes[GetConvertedPlayerId(p)])) * 10 )) + ".")
            return
        endif
        call AdjustPlayerStateBJ(- 1 * ( R2I(Pow(2, Shilian___IShilianTimes[GetConvertedPlayerId(p)])) * 10 ), p, PLAYER_STATE_RESOURCE_LUMBER)
		set Shilian___IContinousShilian=i
		set Shilian___GShilian=CreateGroup()
		set Shilian___PShilian=p
		if not ( Shilian___BFirstShilian1[id] ) then
			set Shilian___BFirstShilian1[id]=true
			call ShowGameHint(p , "传承试练介绍\n				|cff00ccff在1分钟内清除与自身战斗力有关的20只怪物,\n				每只怪物有24波进攻怪的随机技能,\n				便可以获得对应主动技能与被动技能!|r\n				|cffffff00主动技能在挑战结束后会充能一定的时间,\n				使用主动技能会消耗该充能时间,\n				再次双击Esc能随时关闭该主动技能,\n				在把时间用光后请继续来挑战获取时间.|r\n				|cffff6800注意:每次挑战都要花费一定的木头,\n				第1次为10,第2次为20,第3次为40,\n				……第5次为160,第6次为320……\n				以此类推,每次都会在原基础*2。|r\n				挑战将在5秒后开始。\n")
			call YDWEPolledWaitNull(5)
		endif
		call Shilian___CreateShilianMonster(p)
        set Shilian___TChuanchengRest=CreateTimer()
        set Shilian___TDChuanchengRest=CreateTimerDialogBJ(Shilian___TChuanchengRest, "传承试练")
        call TimerStart(Shilian___TChuanchengRest, 60, false, function Shilian___ChuanchengTimeOut)
        call TimerDialogDisplay(Shilian___TDChuanchengRest, true)
        set Shilian___TChuanchengJudge=CreateTimer()
        call TimerStart(Shilian___TChuanchengJudge, 1, true, function Shilian___ChuanchengJudge)
        set p=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Shilian___TLeaveShilianCon takes nothing returns boolean
		return GetLeavingUnit() == udg_H[GetConvertedPlayerId(Shilian___PShilian)]
	endfunction
 function Shilian___TLeaveShilianAct takes nothing returns nothing
		call DisplayTextToPlayer(Shilian___PShilian, 0., 0., "|cFFFF66CC【消息】|r你的传承试练失败了！")
		call Shilian___ClearChuancheng()
	endfunction
//---------------------------------------------------------------------------------------------------
    
    function EnterShilian takes nothing returns nothing
        local real x
        local real y
        if ( ( GetItemTypeId(GetSoldItem()) == 'I06P' ) ) then
            set x=GetRectCenterX(gg_rct_Chuancheng)
            set y=GetRectCenterY(gg_rct_Chuancheng)
            call SetUnitX(GetBuyingUnit(), x)
            call SetUnitY(GetBuyingUnit(), y)
            call PanCameraToTimedForPlayer(GetOwningPlayer(GetBuyingUnit()), x, y, 0.2)
            call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", x, y))
            call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r回去输入“HG”。")
        endif
        //试练
        if ( ( GetItemTypeId(GetSoldItem()) == 'I06Q' ) ) then
        	call StartShilian(GetOwningPlayer(GetBuyingUnit()) , 1)
        elseif ( ( GetItemTypeId(GetSoldItem()) == 'I06R' ) ) then
        	call StartShilian(GetOwningPlayer(GetBuyingUnit()) , 2)
        elseif ( ( GetItemTypeId(GetSoldItem()) == 'I06S' ) ) then
        	call StartShilian(GetOwningPlayer(GetBuyingUnit()) , 3)
        elseif ( ( GetItemTypeId(GetSoldItem()) == 'I06T' ) ) then
        	call StartShilian(GetOwningPlayer(GetBuyingUnit()) , 4)
        elseif ( ( GetItemTypeId(GetSoldItem()) == 'I06U' ) ) then
        	call StartShilian(GetOwningPlayer(GetBuyingUnit()) , 5)
        elseif ( ( GetItemTypeId(GetSoldItem()) == 'I06V' ) ) then
        	call StartShilian(GetOwningPlayer(GetBuyingUnit()) , 6)
        elseif ( ( GetItemTypeId(GetSoldItem()) == 'I06W' ) ) then
        	call StartShilian(GetOwningPlayer(GetBuyingUnit()) , 7)
        elseif ( ( GetItemTypeId(GetSoldItem()) == 'I06X' ) ) then
        	call StartShilian(GetOwningPlayer(GetBuyingUnit()) , 8)
        elseif ( ( GetItemTypeId(GetSoldItem()) == 'I077' ) ) then
        	call StartShilian(GetOwningPlayer(GetBuyingUnit()) , 9)
        endif
    endfunction
//---------------------------------------------------------------------------------------------------
	
 function ZheBeidong takes unit u returns nothing
		if ( IShilianType[GetConvertedPlayerId(GetOwningPlayer(u))] == 2 ) then
			set Shilian___IShilianTime[GetConvertedPlayerId(GetOwningPlayer(u))]=Shilian___IShilianTime[GetConvertedPlayerId(GetOwningPlayer(u))] + 50
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function QianAchievement takes player p returns nothing
		if ( GetUnitTypeId(GetKillingUnitBJ()) == 'N01Y' or ( GetUnitTypeId(GetKillingUnitBJ()) == 'h02T' and GetUnitUserData(GetKillingUnitBJ()) == 1 ) ) then
			set IQianAchievement[GetConvertedPlayerId(p)]=IQianAchievement[GetConvertedPlayerId(p)] + CModeH(1 , 2)
			if ( IQianAchievement[GetConvertedPlayerId(p)] >= 6700 ) then
     call GetAchievementAndSave(p , 422)
			elseif ( ModuloInteger(IQianAchievement[GetConvertedPlayerId(p)], 100) == 0 ) then
				call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【前之痕】|r:" + I2S(IQianAchievement[GetConvertedPlayerId(p)]))
			endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Shilian___InitShilian takes nothing returns nothing
  local trigger t= CreateTrigger()
		set UShilian=CreateUnit(Player(PLAYER_NEUTRAL_PASSIVE), 'n01T', - 14272.0, - 5440.0, 270.000)
    	call TriggerRegisterPlayerEventEndCinematic(t, Player(0))
    	call TriggerRegisterPlayerEventEndCinematic(t, Player(1))
    	call TriggerRegisterPlayerEventEndCinematic(t, Player(2))
    	call TriggerRegisterPlayerEventEndCinematic(t, Player(3))
    	call TriggerRegisterPlayerEventEndCinematic(t, Player(4))
    	call TriggerRegisterPlayerEventEndCinematic(t, Player(5))
		call TriggerAddAction(t, function Shilian___TDoubleEscAct)
        set t=CreateTrigger()
        call YDWETriggerRegisterLeaveRectSimpleNull(t , gg_rct_Chuancheng)
        call TriggerAddCondition(t, Condition(function Shilian___TLeaveShilianCon))
        call TriggerAddAction(t, function Shilian___TLeaveShilianAct)
		set t=null
	endfunction

//library Shilian ends
//library Sichen:
//---------------------------------------------------------------------------------------------------
	
 function Sichen__AddAllMoney takes real value returns nothing
  local integer i= 1
		loop
			exitwhen i > 6
	        if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) ) then
	            call AddMoneyPercent(i , value)
	        endif
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Sichen__AddAll3W takes real value returns nothing
  local integer i= 1
		loop
			exitwhen i > 6
	        if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) ) then
                call AddIntPercent(i , value)
                call AddAgiPercent(i , value)
                call AddStrPercent(i , value)
	        endif
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Sichen__CloserWudiTowerCon takes nothing returns boolean
		return GetTriggerUnit() == udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]
	endfunction
 function Sichen__CloserWudiTowerAct takes nothing returns nothing
  local unit u= LoadUnitHandle(spellTable, GetHandleId(GetTriggeringTrigger()), 1)
		if ( GetUnitState(u, UNIT_STATE_MANA) > 1333 and not ( IsWudi(GetTriggerUnit()) ) ) then
			call ImmuteDamageInterval(GetTriggerUnit() , 3)
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl", GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit())))
			call RecoverUnitMP(u , - 1333)
		endif
		set u=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Sichen__InitWudi takes unit u returns nothing
  local trigger t= CreateTrigger()
	    call TriggerRegisterUnitInRangeSimple(t, 100, u)
	    call TriggerAddCondition(t, Condition(function Sichen__CloserWudiTowerCon))
	    call TriggerAddAction(t, function Sichen__CloserWudiTowerAct)
	    call SaveUnitHandle(spellTable, GetHandleId(t), 1, u)
	    call SaveTriggerHandle(spellTable, GetHandleId(u), 1, t)
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Sichen__DestroyWudi takes unit u returns nothing
  local trigger t= LoadTriggerHandle(spellTable, GetHandleId(u), 1)
		call FlushChildHashtable(spellTable, GetHandleId(t))
		call DestroyTrigger(t)
		call FlushChildHashtable(spellTable, GetHandleId(u))
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SimulateDeathSichen takes unit u returns nothing
		if ( IsUnitInGroup(u, Sichen__GTower) ) then
			if ( GetUnitTypeId(GetDyingUnit()) == 'h0s2' ) then
				call DestroyEffect(LoadEffectHandle(spellTable, GetHandleId(GetDyingUnit()), 1))
				call FlushChildHashtable(spellTable, GetHandleId(GetDyingUnit()))
			elseif ( GetUnitTypeId(GetDyingUnit()) == 'h1s3' ) then
    			call Sichen__AddAllMoney(- 0.1)
			elseif ( GetUnitTypeId(GetDyingUnit()) == 'h01F' ) then
    			call Sichen__AddAll3W(- 0.02)
			elseif ( GetUnitTypeId(GetDyingUnit()) == 'h1s6' ) then
				call Sichen__DestroyWudi(GetDyingUnit())
			elseif ( GetUnitTypeId(GetDyingUnit()) == 'h1s7' ) then
    			call Sichen__AddAllMoney(- 0.1)
    			call Sichen__AddAll3W(- 0.02)
				call Sichen__DestroyWudi(GetDyingUnit())
			endif
			call GroupRemoveUnit(Sichen__GTower, u)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Sichen__GetSichenAttack takes nothing returns integer
		return GetHeroInt(sichen, true) + GetAttack(sichen)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Sichen__GetSichenHP takes nothing returns integer
		return GetHeroStr(sichen, true) * 10 + GetHP(sichen)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Sichen__GetSichenDefense takes nothing returns integer
		return GetHeroAgi(sichen, true) / 100 + GetDefense(sichen)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Sichen__InitHeidong takes unit u returns nothing
     local integer attract= s__Attract_create(u , 900 , 0.05 , 15)
		call s__Attract_SetForbitHero(attract)
		call s__Attract_start(attract)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function TSichenBuildingCon takes nothing returns boolean
		return GetOwningPlayer(GetTriggerUnit()) == GetOwningPlayer(sichen)
	endfunction
 function TSichenBuildingUpdate takes nothing returns nothing
     local unit u= GetTriggerUnit()
    	call UnitSetUpgradeProgress(GetTriggerUnit(), 100)
    	if ( GetUnitTypeId(u) == 'h0s3' ) then
			call SetDefense(u , Sichen__GetSichenDefense() * 4)
			call SetHP(u , Sichen__GetSichenHP() * 3)
			if ( IsThirdSpellOK(sichen) == true and GetUnitAbilityLevel(sichen, 'A0IS') == 1 ) then
				call UnitAddAbility(u, 'A0HG')
			endif
    	elseif ( GetUnitTypeId(u) == 'h0s6' ) then
			call SetDefense(u , Sichen__GetSichenDefense() * 5)
			call SetHP(u , Sichen__GetSichenHP() * 5)
			call SetAttack(u , Sichen__GetSichenAttack() * 5)
			if ( IsThirdSpellOK(sichen) == true and GetUnitAbilityLevel(sichen, 'A0IS') == 1 ) then
				call UnitAddAbility(u, 'A0HG')
			endif
    	elseif ( GetUnitTypeId(u) == 'h01C' ) then
			call SetDefense(u , Sichen__GetSichenDefense())
			call SetHP(u , Sichen__GetSichenHP())
			call SetAttack(u , Sichen__GetSichenAttack() * 5)
			if ( IsThirdSpellOK(sichen) == true and GetUnitAbilityLevel(sichen, 'A0IS') == 1 ) then
				call UnitAddAbility(u, 'A0HG')
			endif
    	elseif ( GetUnitTypeId(u) == 'h0s2' ) then
			call SetDefense(u , Sichen__GetSichenDefense())
			call SetHP(u , Sichen__GetSichenHP())
			call SaveEffectHandle(spellTable, GetHandleId(u), 1, AddSpecialEffectTargetUnitBJ("chest", u, "war3mapImported\\IceTornado.mdx"))
			if ( IsThirdSpellOK(sichen) == true and GetUnitAbilityLevel(sichen, 'A0IS') == 1 ) then
				call UnitAddAbility(u, 'A0HG')
			endif
    	elseif ( GetUnitTypeId(u) == 'h0s1' ) then
			call SetDefense(u , Sichen__GetSichenDefense())
			call SetHP(u , Sichen__GetSichenHP())
			call SetAttack(u , Sichen__GetSichenAttack() * 5)
			if ( IsThirdSpellOK(sichen) == true and GetUnitAbilityLevel(sichen, 'A0IS') == 1 ) then
				call UnitAddAbility(u, 'A0HG')
			endif
    	elseif ( GetUnitTypeId(u) == 'h0s5' ) then
			call SetDefense(u , Sichen__GetSichenDefense() * 2)
			call SetHP(u , Sichen__GetSichenHP() * 2)
			call SetAttack(u , Sichen__GetSichenAttack() * 2)
			if ( IsThirdSpellOK(sichen) == true and GetUnitAbilityLevel(sichen, 'A0IS') == 1 ) then
				call UnitAddAbility(u, 'A0HG')
			endif
    	elseif ( GetUnitTypeId(u) == 'h0s8' ) then
			call SetDefense(u , Sichen__GetSichenDefense() * 4)
			call SetHP(u , Sichen__GetSichenHP() * 4)
			call SetAttack(u , Sichen__GetSichenAttack() * 5)
			if ( IsThirdSpellOK(sichen) == true and GetUnitAbilityLevel(sichen, 'A0IS') == 1 ) then
				call UnitAddAbility(u, 'A0HG')
			endif
    	elseif ( GetUnitTypeId(u) == 'h0s4' ) then
			call SetHP(u , Sichen__GetSichenHP() * 2)
			call SetAttack(u , Sichen__GetSichenAttack())
			call SetDefense(u , Sichen__GetSichenDefense())
			if ( IsThirdSpellOK(sichen) == true and GetUnitAbilityLevel(sichen, 'A0IS') == 1 ) then
				call UnitAddAbility(u, 'A0HG')
			endif
    	elseif ( GetUnitTypeId(u) == 'h0s7' ) then
			call SetDefense(u , Sichen__GetSichenDefense())
			call SetHP(u , Sichen__GetSichenHP())
			call SetAttack(u , Sichen__GetSichenAttack())
			if ( IsThirdSpellOK(sichen) == true and GetUnitAbilityLevel(sichen, 'A0IS') == 1 ) then
				call UnitAddAbility(u, 'A0HG')
			endif
    	elseif ( GetUnitTypeId(u) == 'h1s1' ) then
    		call Sichen__InitHeidong(u)
			call SetDefense(u , Sichen__GetSichenDefense())
			call SetHP(u , Sichen__GetSichenHP())
			if ( IsThirdSpellOK(sichen) == true and GetUnitAbilityLevel(sichen, 'A0IS') == 1 ) then
				call UnitAddAbility(u, 'A0HG')
			endif
    	elseif ( GetUnitTypeId(u) == 'h1s3' ) then
    		call Sichen__AddAllMoney(0.1)
    	elseif ( GetUnitTypeId(u) == 'h01F' ) then
    		call Sichen__AddAll3W(0.02)
    	elseif ( GetUnitTypeId(u) == 'h1s6' ) then
    		call Sichen__InitWudi(u)
    	elseif ( GetUnitTypeId(u) == 'h1s7' ) then
    		call Sichen__AddAllMoney(0.1)
    		call Sichen__AddAll3W(0.02)
    		call Sichen__InitWudi(u)
    	endif
    	set u=null
	endfunction
    function TSichenBuilding takes nothing returns nothing
     local unit u= GetTriggerUnit()
    	call GroupAddUnit(Sichen__GTower, u)
    	if ( GetUnitTypeId(u) == 'hmtt' ) then
    		if ( GetPlayerState(GetOwningPlayer(sichen), PLAYER_STATE_RESOURCE_FOOD_USED) > ( GetPlayerState(GetOwningPlayer(sichen), PLAYER_STATE_RESOURCE_FOOD_CAP) - 0 ) ) then
    			call RemoveUnit(u)
                call DisplayTextToPlayer(GetOwningPlayer(sichen), 0, 0, "|cFFFF66CC【消息】|r你的人口已满.")
    		endif
    	endif
    	set u=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Sichen__Yunluoliuyan takes integer abilityID,unit caster,integer zhenshu returns nothing
  local integer i= 1
  local unit u= null
		if ( abilityID != 0 ) then
	    	call PrintSpell(GetOwningPlayer(sichen) , GetAbilityName(abilityID) , GetDamageAgi(sichen) * 0.33)
		endif
		loop
			exitwhen i > zhenshu
			set u=CreateUnit(GetOwningPlayer(sichen), 'h01G', GetUnitX(caster), GetUnitY(caster), 0)
			if ( BJuexing2[GetConvertedPlayerId(GetOwningPlayer(sichen))] ) then
				call SetUnitAbilityLevel(u, 'A0JA', 2)
			endif
			call UnitApplyTimedLifeBJ(3.00, 'BHwe', u)
			if ( i < zhenshu ) then
				call YDWEPolledWaitNull(0.5)
			endif
			set i=i + 1
		endloop
		set u=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SimulateDamageSichen takes nothing returns boolean
		if ( GetEventDamage() > 0 ) then
			//塔1
			if ( GetUnitTypeId(GetEventDamageSource()) == 'h01C' ) then
				call UnitDamageTarget(sichen, GetTriggerUnit(), Sichen__SichenDamage * 0.1, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
				return true
			//塔2
			elseif ( GetUnitTypeId(GetEventDamageSource()) == 'h0s1' ) then
				call UnitDamageTarget(sichen, GetTriggerUnit(), Sichen__SichenDamage * 0.1, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
				call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Incinerate\\FireLordDeathExplode.mdl", GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit())))
				return true
			//千刃
			elseif ( GetUnitTypeId(GetEventDamageSource()) == 'h0s2' ) then
				call UnitDamageTarget(sichen, GetTriggerUnit(), Sichen__SichenDamage * 0.15, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
				return true
			//神镜
			elseif ( GetUnitTypeId(GetEventDamageSource()) == 'h0s4' ) then
				call Sichen__Yunluoliuyan(0 , GetTriggerUnit() , 6)
				return true
			//散华
			elseif ( GetUnitTypeId(GetEventDamageSource()) == 'h0s5' ) then
				call UnitDamageTarget(sichen, GetTriggerUnit(), Sichen__SichenDamage * 0.2, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
				call SetUnitLifeBJ(sichen, GetUnitState(sichen, UNIT_STATE_LIFE) + Sichen__SichenDamage * 0.02)
				call SetUnitLifeBJ(GetTriggerUnit(), GetUnitState(GetTriggerUnit(), UNIT_STATE_LIFE) + GetDamageAgi(GetTriggerUnit()) * 0.02)
				return true
			//十绝一灭
			elseif ( GetUnitTypeId(GetEventDamageSource()) == 'h0s6' ) then
				if ( GetUnitUserData(GetEventDamageSource()) >= 10 ) then
	    			call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Other\\NeutralBuildingExplosion\\NeutralBuildingExplosion.mdl", GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit())))
	    			call CreateSpellTextTag("一灭" , GetTriggerUnit() , 0 , 100 , 0 , 3)
	    			call DamageArea(sichen , GetUnitX(GetTriggerUnit()) , GetUnitY(GetTriggerUnit()) , 400 , Sichen__SichenDamage * 5)
					call SetUnitUserData(GetEventDamageSource(), 0)
	    		else
					call SetUnitUserData(GetEventDamageSource(), GetUnitUserData(GetEventDamageSource()) + 1)
				endif
				call UnitDamageTarget(sichen, GetTriggerUnit(), Sichen__SichenDamage * 0.5, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
				return true
			//穿云
			elseif ( GetUnitTypeId(GetEventDamageSource()) == 'h0s7' ) then
				call UnitDamageTarget(sichen, GetTriggerUnit(), Sichen__SichenDamage * 2, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
				return true
			//孤鸿
			elseif ( GetUnitTypeId(GetEventDamageSource()) == 'h0s8' ) then
				call SetUnitLifeBJ(sichen, GetUnitState(sichen, UNIT_STATE_LIFE) + Sichen__SichenDamage * 0.1)
				call SetUnitLifeBJ(GetTriggerUnit(), GetUnitState(GetTriggerUnit(), UNIT_STATE_LIFE) + GetDamageAgi(GetTriggerUnit()) * 0.1)
				call UnitDamageTarget(sichen, GetTriggerUnit(), Sichen__SichenDamage, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
				call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\DeathCoil\\DeathCoilSpecialArt.mdl", GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit())))
				return true
			//抓宠物
			elseif ( GetUnitTypeId(GetEventDamageSource()) == 'h1s7' or GetUnitTypeId(GetEventDamageSource()) == 'h1s4' ) then
				if ( ( not ( IsLoyalUnit(GetTriggerUnit()) ) ) and ( GetPlayerState(GetOwningPlayer(sichen), PLAYER_STATE_RESOURCE_FOOD_USED) < ( GetPlayerState(GetOwningPlayer(sichen), PLAYER_STATE_RESOURCE_FOOD_CAP) ) ) and GetRandomInt(1, 100) < ( GetHeroLevel(sichen) - GetUnitLevel(GetTriggerUnit()) ) and not ( IsUnitType(GetTriggerUnit(), UNIT_TYPE_HERO) ) and not ( IsUnitIllusion(GetTriggerUnit()) ) ) then
					call CreatePet(GetOwningPlayer(sichen) , GetTriggerUnit())
				endif
			//硫炎
			elseif ( GetUnitTypeId(GetEventDamageSource()) == 'h01G' ) then
				call UnitDamageTarget(sichen, GetTriggerUnit(), Sichen__SichenDamage * 0.33, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
				return true
			//火箭
			elseif ( GetUnitTypeId(GetEventDamageSource()) == 'h01H' ) then
				call UnitDamageTarget(sichen, GetTriggerUnit(), Sichen__SichenDamage * 0.75, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
				return true
			endif
		endif
		return false
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Sichen__GenyuetiandiA takes nothing returns boolean
		return udg_H[GetConvertedPlayerId(GetOwningPlayer(GetFilterUnit()))] == GetFilterUnit() and not ( IsWudi(GetFilterUnit()) )
	endfunction
    function Sichen__GenyuetiandiB takes nothing returns nothing
        if ( GetEnumUnit() != null ) then
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl", GetUnitX(GetEnumUnit()), GetUnitY(GetEnumUnit())))
			call UnitRemoveAbility(GetEnumUnit(), 'Avul')
        endif
    endfunction
    function Sichen__GenyuetiandiC takes nothing returns nothing
	    if ( GetEnumUnit() != null ) then
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl", GetUnitX(GetEnumUnit()), GetUnitY(GetEnumUnit())))
			call UnitAddAbility(GetEnumUnit(), 'Avul')
			call SetUnitLifePercentBJ(GetEnumUnit(), 100)
	    endif
    endfunction
 function Sichen__GenyuetiandiTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local group l_group= LoadGroupHandle(spellTable, id, 1)
        call ForGroupBJ(l_group, function Sichen__GenyuetiandiB)
		call PauseTimer(t)
		call FlushChildHashtable(spellTable, id)
		call DestroyTimer(t)
		call DestroyGroup(l_group)
		set l_group=null
		set t=null
	endfunction
 function Sichen__Genyuetiandi takes nothing returns nothing
  local group l_group= CreateGroup()
  local timer t= CreateTimer()
  local group l_group1= CreateGroup()
  local unit l_unit1
	    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\BattleRoar\\RoarCaster.mdl", GetUnitX(sichen), GetUnitY(sichen)))
		call GroupEnumUnitsInRange(l_group, GetUnitX(sichen), GetUnitY(sichen), 900, Condition(function Sichen__GenyuetiandiA))
		if not ( IsWudi(sichen) ) then
			call GroupAddUnit(l_group, sichen)
		endif
		//加不无敌的塔进来
		call GroupAddGroup(Sichen__GTower, l_group1)
		call GroupAddUnit(l_group, gg_unit_haro_0030)
		loop
		    set l_unit1=FirstOfGroup(l_group1)
		    exitwhen l_unit1 == null
		    call GroupRemoveUnit(l_group1, l_unit1)
    		if not ( IsWudi(l_unit1) ) then
				call GroupAddUnit(l_group, l_unit1)
			endif
		endloop
		call ForGroup(l_group, function Sichen__GenyuetiandiC)
	    call PrintSpellName(GetOwningPlayer(sichen) , GetAbilityName('A0IR'))
		call SaveGroupHandle(spellTable, GetHandleId(t), 1, l_group)
		call TimerStart(t, 5, false, function Sichen__GenyuetiandiTimer)
		set t=null
		call DestroyGroup(l_group1)
		set l_group1=null
		set l_unit1=null
		set l_group=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
    function Sichen__TSpellSichen2Con takes nothing returns boolean
    	return ( GetAttackedUnitBJ() == sichen or IsUnitInGroup(GetAttackedUnitBJ(), Sichen__GTower) ) and IsSecondSpellOK(sichen) == true and GetUnitState(sichen, UNIT_STATE_MANA) >= 250 and GetUnitAbilityLevel(sichen, 'A0IR') == 1 and GetRandomInt(1, 20) == 1
    endfunction
    function Sichen__TSpellSichen2Act takes nothing returns nothing
    	call DisableTrigger(GetTriggeringTrigger())
		call Sichen__Yunluoliuyan('A0IR' , GetAttackedUnitBJ() , 2)
		call YDWEPolledWaitNull(4.5)
    	call EnableTrigger(GetTriggeringTrigger())
    endfunction
//---------------------------------------------------------------------------------------------------
	
 function Sichen__TSpellSichen3Con takes nothing returns boolean
		return IsThirdSpellOK(sichen) == true and GetUnitAbilityLevel(sichen, 'A0IS') == 1 and GetEventDamage() > GetUnitState(sichen, UNIT_STATE_LIFE) and ( GetTriggerUnit() == sichen or GetTriggerUnit() == Sichen__UCili ) and IsUnitAliveBJ(sichen) and GetRandomInt(1, 2) == 1 and GetTriggerUnit() != null
	endfunction
 function Sichen__TSpellSichen3Act takes nothing returns nothing
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl", GetUnitX(sichen), GetUnitY(sichen)))
		call SetUnitLifePercentBJ(sichen, 100)
	    call CreateSpellTextTag("涅槃化凰" , sichen , 100 , 0 , 0 , 3)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Sichen__ShenghuangciliTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local integer index= LoadInteger(spellTable, id, 2)
  local effect eff= LoadEffectHandle(spellTable, id, 3)
		call DestroyEffect(eff)
		call AddSpellPercent(index , - 0.6)
		if ( Sichen__UCili != null ) then
			call UnitRemoveAbility(Sichen__UCili, 'A0FU')
		endif
	    call PrintSpellContent(GetOwningPlayer(sichen) , GetAbilityName('A0IT') , "，时间结束。")
		call PauseTimer(t)
		call FlushChildHashtable(spellTable, id)
		call DestroyTimer(t)
		set Sichen__UCili=null
		set t=null
		set eff=null
	endfunction
 function Sichen__Shenghuangcili takes nothing returns nothing
  local timer t= CreateTimer()
		//圣皇赐力
		call UnitAddAbility(GetSpellTargetUnit(), 'A0FU')
		call AddSpellPercent(GetConvertedPlayerId(GetOwningPlayer(GetSpellTargetUnit())) , 0.6)
		set Sichen__UCili=GetSpellTargetUnit()
		call SaveInteger(spellTable, GetHandleId(t), 2, GetConvertedPlayerId(GetOwningPlayer(GetSpellTargetUnit())))
		call SaveEffectHandle(spellTable, GetHandleId(t), 3, AddSpecialEffectTargetUnitBJ("chest", GetSpellTargetUnit(), "war3mapImported\\bullerouge.mdx"))
	    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\HowlOfTerror\\HowlCaster.mdl", GetUnitX(GetSpellTargetUnit()), GetUnitY(GetSpellTargetUnit())))
		call TimerStart(t, 60, false, function Sichen__ShenghuangciliTimer)
        call PlaySoundBJ(gg_snd_sichen_4)
	    call PrintSpellName(GetOwningPlayer(sichen) , GetAbilityName('A0IT'))
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Sichen__Huojianzhiyuan2 takes nothing returns nothing
  local group l_group= CreateGroup()
  local unit l_unit
		call GroupAddGroup(Sichen__GTower, l_group)
		loop
		    set l_unit=FirstOfGroup(l_group)
		    exitwhen l_unit == null
		    call GroupRemoveUnit(l_group, l_unit)
		    if ( not ( IsWudi(l_unit) ) ) then
				call UnitApplyTimedLifeBJ(2.00, 'BHwe', CreateUnit(GetOwningPlayer(sichen), 'h01H', GetUnitX(l_unit), GetUnitY(l_unit), GetUnitFacing(l_unit)))
		    endif
		endloop
		call DestroyGroup(l_group)
		set l_group=null
		set l_unit=null
	endfunction
 function Sichen__Huojianzhiyuan takes nothing returns nothing
  local integer i
		if not ( UnitHasBuffBJ(sichen, 'B021') ) then
			return
		endif
		set i=1
		loop
			exitwhen i > 6
			if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( udg_H[i] != null ) ) then
				call UnitApplyTimedLifeBJ(2.00, 'BHwe', CreateUnit(GetOwningPlayer(sichen), 'h01H', GetUnitX(udg_H[i]), GetUnitY(udg_H[i]), GetUnitFacing(udg_H[i])))
            endif
			set i=i + 1
		endloop
		if ( BJuexing3[GetConvertedPlayerId(GetOwningPlayer(sichen))] ) then
			call Sichen__Huojianzhiyuan2()
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Sichen__TSpellSichenAct takes nothing returns nothing
		if ( GetSpellAbilityId() == 'A0IQ' ) then
			call Sichen__Yunluoliuyan(GetSpellAbilityId() , sichen , 6)
		elseif ( GetSpellAbilityId() == 'A0IR' ) then
			call Sichen__Genyuetiandi()
		elseif ( GetSpellAbilityId() == 'A0IS' ) then
			call SetUnitLifePercentBJ(GetSpellTargetUnit(), 100)
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl", GetUnitX(GetSpellTargetUnit()), GetUnitY(GetSpellTargetUnit())))
	    	call PrintSpellName(GetOwningPlayer(sichen) , GetAbilityName('A0IS'))
		elseif ( GetSpellAbilityId() == 'A0IT' and GetSpellTargetUnit() != gg_unit_haro_0030 ) then
			call Sichen__Shenghuangcili()
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
	//按照12345来判断
 function LearnSkillSichenI takes unit learner,integer whichSpell returns nothing
  local integer i
		if ( learner == sichen ) then
			if ( whichSpell == 1 ) then
				call SetPlayerStateBJ(GetOwningPlayer(sichen), PLAYER_STATE_RESOURCE_FOOD_CAP, ( GetPlayerState(GetOwningPlayer(sichen), PLAYER_STATE_RESOURCE_FOOD_CAP) + 2 ))
			elseif ( whichSpell == 2 and IsSecondSpellOK(sichen) == true and GetUnitAbilityLevel(sichen, 'A0IR') == 1 ) then
				call SetPlayerStateBJ(GetOwningPlayer(sichen), PLAYER_STATE_RESOURCE_FOOD_CAP, ( GetPlayerState(GetOwningPlayer(sichen), PLAYER_STATE_RESOURCE_FOOD_CAP) + 2 ))
			elseif ( whichSpell == 3 and IsThirdSpellOK(sichen) == true and GetUnitAbilityLevel(sichen, 'A0IS') == 1 ) then
				call SetPlayerStateBJ(GetOwningPlayer(sichen), PLAYER_STATE_RESOURCE_FOOD_CAP, ( GetPlayerState(GetOwningPlayer(sichen), PLAYER_STATE_RESOURCE_FOOD_CAP) + 2 ))
				call AddSpecialEffectTargetUnitBJ("origin", sichen, "war3mapImported\\WarAura.mdx")
				call InitSichenAura()
			elseif ( whichSpell == 4 and IsFourthSpellOK(sichen) == true and GetUnitAbilityLevel(sichen, 'A0IT') == 1 ) then
				call SetPlayerStateBJ(GetOwningPlayer(sichen), PLAYER_STATE_RESOURCE_FOOD_CAP, ( GetPlayerState(GetOwningPlayer(sichen), PLAYER_STATE_RESOURCE_FOOD_CAP) + 2 ))
			elseif ( whichSpell == 5 and IsFifthSpellOK(sichen) == true and GetUnitAbilityLevel(sichen, 'A0IU') == 1 ) then
				call SetPlayerStateBJ(GetOwningPlayer(sichen), PLAYER_STATE_RESOURCE_FOOD_CAP, ( GetPlayerState(GetOwningPlayer(sichen), PLAYER_STATE_RESOURCE_FOOD_CAP) + 2 ))
			endif
		endif
	endfunction
 function LearnSkillSichen takes unit learner,integer learnSpellID returns nothing
		if ( learner == sichen ) then
			if ( learnSpellID == 'A0IQ' ) then
				call LearnSkillSichenI(learner , 1)
			elseif ( learnSpellID == 'A0IR' ) then
				call LearnSkillSichenI(learner , 2)
			elseif ( learnSpellID == 'A0IS' ) then
				call LearnSkillSichenI(learner , 3)
			elseif ( learnSpellID == 'A0IT' ) then
				call LearnSkillSichenI(learner , 4)
			elseif ( learnSpellID == 'A0IU' ) then
				call LearnSkillSichenI(learner , 5)
			endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Sichen__TSpellSichenUpdateAct takes nothing returns nothing
		if ( GetHeroLevel(sichen) >= 25 ) then
			call SetPlayerTechResearchedSwap('R01E', 1, GetOwningPlayer(sichen))
		endif
		if ( GetHeroLevel(sichen) >= 50 ) then
			call SetPlayerTechResearchedSwap('R01B', 1, GetOwningPlayer(sichen))
		endif
		if ( GetHeroLevel(sichen) >= 100 ) then
			call SetPlayerTechResearchedSwap('R01C', 1, GetOwningPlayer(sichen))
		endif
		if ( GetHeroLevel(sichen) >= 150 ) then
			call SetPlayerTechResearchedSwap('R01D', 1, GetOwningPlayer(sichen))
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Sichen__FlashSichenDamage takes nothing returns nothing
		set Sichen__SichenDamage=GetDamageAgi(sichen)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Sichen__InitSichenSpin takes unit u returns unit
		if ( IsSichenSpin1(GetOwningPlayer(u)) ) then
			set udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]=CreateUnit(GetOwningPlayer(u), 'H02C', GetUnitX(u), GetUnitY(u), 0)
			set gg_unit_Hhkl_0218=udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
			call UnitAddItemByIdSwapped('I006', udg_H[GetConvertedPlayerId(GetOwningPlayer(u))])
			call SetUnitManaPercentBJ(udg_H[GetConvertedPlayerId(GetOwningPlayer(u))], 1000)
			call RemoveUnit(u)
			call SetPlayerStateBJ(GetOwningPlayer(u), PLAYER_STATE_RESOURCE_FOOD_CAP, ( GetPlayerState(GetOwningPlayer(u), PLAYER_STATE_RESOURCE_FOOD_CAP) + 1 ))
			return udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
		else
			return u
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
 function InitSichen takes unit u returns nothing
  local trigger t= CreateTrigger()
  local integer i= 1
		set sichen=Sichen__InitSichenSpin(u)
		//主英雄技能
		set Sichen__TSpellSichen=CreateTrigger()
	    call TriggerRegisterUnitEvent(Sichen__TSpellSichen, sichen, EVENT_UNIT_SPELL_EFFECT)
	    call TriggerAddAction(Sichen__TSpellSichen, function Sichen__TSpellSichenAct)
	    //被动被攻击效果
	    set Sichen__TSpellSichen2=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(Sichen__TSpellSichen2, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(Sichen__TSpellSichen2, Condition(function Sichen__TSpellSichen2Con))
	    call TriggerAddAction(Sichen__TSpellSichen2, function Sichen__TSpellSichen2Act)
	    set Sichen__GTower=CreateGroup()
	    //被动3的减伤
	    set Sichen__TSpellSichen3=CreateTrigger()
	    call TriggerRegisterUnitEvent(Sichen__TSpellSichen3, sichen, EVENT_UNIT_DAMAGED)
	    call TriggerAddCondition(Sichen__TSpellSichen3, Condition(function Sichen__TSpellSichen3Con))
	    call TriggerAddAction(Sichen__TSpellSichen3, function Sichen__TSpellSichen3Act)
	    //升级解锁科技
	    set Sichen__TSpellSichenUpdate=CreateTrigger()
	    call TriggerRegisterUnitEvent(Sichen__TSpellSichenUpdate, sichen, EVENT_UNIT_HERO_LEVEL)
	    call TriggerAddAction(Sichen__TSpellSichenUpdate, function Sichen__TSpellSichenUpdateAct)
	    //马甲伤害
	    set Sichen__TSpellSichenDamage=CreateTrigger()
	    call YDWESyStemAnyUnitDamagedRegistTrigger(Sichen__TSpellSichenDamage)
	    call TriggerAddAction(Sichen__TSpellSichenDamage, function SimulateDamageSichen)
		//完成建造
	    call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_CONSTRUCT_FINISH)
	    call TriggerAddCondition(t, Condition(function TSichenBuildingCon))
	    call TriggerAddAction(t, function TSichenBuilding)
	    call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_UPGRADE_START)
	    call TriggerAddCondition(t, Condition(function TSichenBuildingCon))
	    call TriggerAddAction(t, function TSichenBuildingUpdate)
	    call TimerStart(CreateTimer(), 1, true, function Sichen__Huojianzhiyuan)
	    //刷新伤害
	    call TimerStart(CreateTimer(), 1, true, function Sichen__FlashSichenDamage)
		call SetPlayerStateBJ(GetOwningPlayer(sichen), PLAYER_STATE_RESOURCE_FOOD_CAP, ( GetPlayerState(GetOwningPlayer(sichen), PLAYER_STATE_RESOURCE_FOOD_CAP) + 2 ))
	    loop
	    	exitwhen i > 6
            if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) ) then
				call SetPlayerAbilityAvailable(ConvertedPlayer(i), 'A0FU', false)
            endif
	    	set i=i + 1
	    endloop
		call SetPlayerAbilityAvailable(Player(6), 'A0FU', false)
		set t=null
	endfunction

//library Sichen ends
//library Taiya:
//---------------------------------------------------------------------------------------------------
	
 function AddTaiyaSpin takes nothing returns nothing
		if ( Taiya__ITaiyamiao > 2500 ) then
    call SetTaiyaSpinOK(GetOwningPlayer(taiya))
		else
			set Taiya__ITaiyamiao=Taiya__ITaiyamiao + 1
			if ( ModuloInteger(Taiya__ITaiyamiao, 100) == 0 ) then
				call DisplayTextToPlayer(GetOwningPlayer(taiya), 0., 0., "【|cFFCCFF66三弦星谧|r】完成进度" + I2S(Taiya__ITaiyamiao) + "/2500.")
			endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Taiya__InitTaiyaSpin takes unit u returns unit
		if ( IsTaiyaSpin1(GetOwningPlayer(u)) ) then
			set udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]=CreateUnit(GetOwningPlayer(u), 'E00G', GetUnitX(u), GetUnitY(u), 0)
			set gg_unit_Etyr_0017=udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
			call UnitAddItemByIdSwapped('I006', udg_H[GetConvertedPlayerId(GetOwningPlayer(u))])
			call AddSpellPercent(GetConvertedPlayerId(GetOwningPlayer(u)) , 0.1)
			call SetUnitManaPercentBJ(udg_H[GetConvertedPlayerId(GetOwningPlayer(u))], 1000)
			call RemoveUnit(u)
			return udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
		else
			return u
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
 function InitTaiya takes unit u returns nothing
		set taiya=Taiya__InitTaiyaSpin(u)
    	call TriggerRegisterUnitEvent(gg_trg_____________86, taiya, EVENT_UNIT_DAMAGED)
	endfunction

//library Taiya ends
//library Xiaoting:
//---------------------------------------------------------------------------------------------------
	
    function Xiaoting___TAttackXTCon takes nothing returns boolean
    	return GetAttacker() == xiaoting
    endfunction
    function Xiaoting___TAttackXTAct takes nothing returns nothing
     local integer attack= IMinBJ(500000000, Xiaoting___IAttackAdd + GetHeroAgi(xiaoting, true) / 4)
    	if ( Xiaoting___EAttackXT == null ) then
			set Xiaoting___EAttackXT=AddSpecialEffectTargetUnitBJ("overhead", xiaoting, "Abilities\\Spells\\Human\\InnerFire\\InnerFireTarget.mdl")
    	endif
    	call AddAttack(xiaoting , attack - Xiaoting___IAttackAdd)
    	set Xiaoting___IAttackAdd=attack
    	set Xiaoting___ITimeAttackadd=5
    endfunction
    //时间减少
    function Xiaoting___AttackTimeReduce takes nothing returns nothing
    	set Xiaoting___ITimeAttackadd=IMaxBJ(0, Xiaoting___ITimeAttackadd - 1)
    	if ( Xiaoting___ITimeAttackadd == 0 and Xiaoting___EAttackXT != null ) then
    		call DestroyEffect(Xiaoting___EAttackXT)
    		set Xiaoting___EAttackXT=null
	    	call AddAttack(xiaoting , 0 - Xiaoting___IAttackAdd)
	    	set Xiaoting___IAttackAdd=0
    	endif
    endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xiaoting___GetComboMulti takes nothing returns integer
		if not ( IsFourthSpellOK(xiaoting) and GetUnitAbilityLevel(xiaoting, 'A0LZ') == 1 ) then
			return 1
		endif
		if ( ICombo > 40 ) then
			return 4
		elseif ( ICombo > 20 ) then
			return 3
		elseif ( ICombo > 10 ) then
			return 2
		else
			return 1
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
	//private function GetComboTime takes nothing returns real
	//	if (ICombo > 80) then
	//		return 1.
	//	elseif (ICombo > 60) then
	//		return 2.
	//	elseif (ICombo > 40) then
	//		return 3.
	//	elseif (ICombo > 20) then
	//		return 4.
	//	else
	//		return 5.
	//	endif
	//endfunction
//---------------------------------------------------------------------------------------------------
	
 function SimulateDamageXiaoting takes unit u returns boolean
		//绝焱
		if ( GetUnitTypeId(u) == 'h022' ) then
			call UnitDamageTarget(xiaoting, GetTriggerUnit(), Xiaoting___RDamageXiaoting * 1.2 * Xiaoting___GetComboMulti(), false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
			return true
		endif
		return false
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xiaoting___SetShe1Tech takes nothing returns nothing
		if ( Xiaoting___UJianKeji2 != null ) then
			call RemoveUnit(Xiaoting___UJianKeji2)
			set Xiaoting___UJianKeji2=null
		endif
		if ( Xiaoting___UJianKeji1 == null ) then
			set Xiaoting___UJianKeji1=CreateUnit(GetOwningPlayer(xiaoting), 'h01Z', 0, 0, 0)
			call ShowUnitHide(Xiaoting___UJianKeji1)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xiaoting___SetShe2Tech takes nothing returns nothing
		if ( Xiaoting___UJianKeji1 != null ) then
			call RemoveUnit(Xiaoting___UJianKeji1)
			set Xiaoting___UJianKeji1=null
		endif
		if ( Xiaoting___UJianKeji2 == null ) then
			set Xiaoting___UJianKeji2=CreateUnit(GetOwningPlayer(xiaoting), 'h020', 0, 0, 0)
			call ShowUnitHide(Xiaoting___UJianKeji2)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xiaoting___ClearRestArrow takes integer start returns nothing
  local integer i= start
		loop
			exitwhen i > 16
			if ( Xiaoting___UArrow[i] != null ) then
				call RemoveUnit(Xiaoting___UArrow[i])
				set Xiaoting___UArrow[i]=null
				call DestroyGroup(Xiaoting___GArrow[i])
				set Xiaoting___GArrow[i]=null
				set Xiaoting___BShuaijian[i]=false
			endif
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xiaoting___ClearAllArrow takes nothing returns nothing
		call PauseTimer(Xiaoting___TArrow)
		call DestroyTimer(Xiaoting___TArrow)
		set Xiaoting___IZhengmiao=0
		set Xiaoting___TArrow=null
		call Xiaoting___ClearRestArrow(1)
		set Xiaoting___IFantan=0
		set Xiaoting___IJueyan=0
		set Xiaoting___BJingzhi=false
		set Xiaoting___BYujian=false
		call Xiaoting___SetShe1Tech()
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xiaoting___CreateJueyan takes unit u returns nothing
  local unit temp= CreateUnit(GetOwningPlayer(xiaoting), 'h022', GetUnitX(u), GetUnitY(u), 0)
		call UnitApplyTimedLifeBJ(10.00, 'BHwe', temp)
		set temp=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xiaoting___BingqiangFilter takes nothing returns boolean
		return GetUnitTypeId(GetFilterUnit()) == 'hwtw'
	endfunction
 function Xiaoting___PingzhangFilter takes nothing returns boolean
		return GetUnitTypeId(GetFilterUnit()) == 'h021'
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xiaoting___ChangeFacing takes integer i,real facing returns nothing
  local unit temp= CreateUnit(GetOwningPlayer(xiaoting), 'h024', GetUnitX(Xiaoting___UArrow[i]), GetUnitY(Xiaoting___UArrow[i]), facing)
		call RemoveUnit(Xiaoting___UArrow[i])
		set Xiaoting___UArrow[i]=temp
		set temp=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xiaoting___FlashArrowMove takes integer index returns nothing
  local real x= GetUnitX(Xiaoting___UArrow[index])
  local real y= GetUnitY(Xiaoting___UArrow[index])
        local real xp= x + 100. * CosBJ(GetUnitFacing(Xiaoting___UArrow[index]))
        local real yp= y + 100. * SinBJ(GetUnitFacing(Xiaoting___UArrow[index]))
        local group l_group= null
        local unit l_unit
        local integer times= Xiaoting___GetComboMulti()
        local real radius= 200
        local integer IBing= 0
        local boolean isBingqiang= false
        //如果英雄死亡则清除
        if ( BHeroDeath[GetConvertedPlayerId(GetOwningPlayer(xiaoting))] and not ( BJuexing3[GetConvertedPlayerId(GetOwningPlayer(xiaoting))] ) ) then
        	call Xiaoting___ClearAllArrow()
        	return
        endif
        //御箭
        if ( Xiaoting___BYujian and index == 1 ) then
    		call RecoverUnitHP(xiaoting , 0.1)
        	call SetUnitManaPercentBJ(xiaoting, 100)
        	call SetUnitX(xiaoting, GetUnitX(Xiaoting___UArrow[1]))
        	call SetUnitY(xiaoting, GetUnitY(Xiaoting___UArrow[1]))
        endif
        if ( Xiaoting___BJingzhi ) then
        	if ( Xiaoting___IZhengmiao == 1 ) then
        		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Charm\\CharmTarget.mdl", GetUnitX(Xiaoting___UArrow[index]), GetUnitY(Xiaoting___UArrow[index])))
        	endif
        	return
        endif
        set l_group=CreateGroup()
        call GroupEnumUnitsInRange(l_group, x, y, radius, null)
        loop
            set l_unit=FirstOfGroup(l_group)
            exitwhen l_unit == null
            call GroupRemoveUnit(l_group, l_unit)
            if ( IsEnemy(l_unit , xiaoting) and not ( IsUnitInGroup(l_unit, Xiaoting___GArrow[index]) ) ) then
            	call UnitDamageTarget(xiaoting, l_unit, Xiaoting___RDamageXiaoting * R3(Xiaoting___BShuaijian[index] , 0.2 , 1), false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
            	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl", GetUnitX(l_unit), GetUnitY(l_unit)))
            	call GroupAddUnit(Xiaoting___GArrow[index], l_unit)
            endif
        endloop
        call DestroyGroup(l_group)
        set l_group=null
        set l_unit=null
        set l_group=CreateGroup()
        call GroupEnumUnitsInRange(l_group, xp, yp, 100, Condition(function Xiaoting___BingqiangFilter))
        if ( CountUnitsInGroup(l_group) > 0 ) then
        	set IBing=I3(CountUnitsInGroup(l_group) > 0 , GetUnitUserData(FirstOfGroup(l_group)) , 0)
        	set isBingqiang=true
        else
	        call GroupEnumUnitsInRange(l_group, xp, yp, 100, Condition(function Xiaoting___PingzhangFilter))
        	set IBing=I3(CountUnitsInGroup(l_group) > 0 , GetUnitUserData(FirstOfGroup(l_group)) , 0)
        endif
        call DestroyGroup(l_group)
        set l_group=null
        //反弹与静滞
    	if ( IsTerrainPathable(xp, yp, PATHING_TYPE_WALKABILITY) or IBing != 0 ) then
    		if ( xp > yd_MapMaxX or xp < yd_MapMinX ) then
					call Xiaoting___ChangeFacing(index , 180 - GetUnitFacing(Xiaoting___UArrow[index]))
        			return
        	elseif ( yp > yd_MapMaxY or yp < yd_MapMinY ) then
					call Xiaoting___ChangeFacing(index , - GetUnitFacing(Xiaoting___UArrow[index]))
        			return
    		endif
	        if ( Xiaoting___IFantan > 0 ) then
        		if ( IBing != 0 ) then
        			call GroupClear(Xiaoting___GArrow[index])
					call Xiaoting___ChangeFacing(index , R3(IBing >= 1000 , 180 + GetUnitFacing(Xiaoting___UArrow[index]) , 2 * IBing - GetUnitFacing(Xiaoting___UArrow[index])))
					if not ( isBingqiang ) then
						set Xiaoting___BShuaijian[index]=true
					else
						set Xiaoting___BShuaijian[index]=false
					endif
					return
        		endif
        		if not ( IsTerrainPathable(xp, y, PATHING_TYPE_WALKABILITY) ) then
        			call GroupClear(Xiaoting___GArrow[index])
					call Xiaoting___ChangeFacing(index , - GetUnitFacing(Xiaoting___UArrow[index]))
					set Xiaoting___BShuaijian[index]=true
        		elseif not ( IsTerrainPathable(x, yp, PATHING_TYPE_WALKABILITY) ) then
        			call GroupClear(Xiaoting___GArrow[index])
					call Xiaoting___ChangeFacing(index , 180 - GetUnitFacing(Xiaoting___UArrow[index]))
					set Xiaoting___BShuaijian[index]=true
        		elseif not ( IsTerrainPathable(x, y, PATHING_TYPE_WALKABILITY) ) then
					call Xiaoting___ChangeFacing(index , 180 + GetUnitFacing(Xiaoting___UArrow[index]))
        			call GroupClear(Xiaoting___GArrow[index])
					set Xiaoting___BShuaijian[index]=true
        		else
		        	call SetUnitX(Xiaoting___UArrow[index], YDWECoordinateX(xp))
		        	call SetUnitY(Xiaoting___UArrow[index], YDWECoordinateY(yp))
				    //绝焱
			        if ( Xiaoting___IJueyan > 0 ) then
			        	if ( ModuloInteger(Xiaoting___IZhengmiao, 3) == 0 ) then
			        		call Xiaoting___CreateJueyan(Xiaoting___UArrow[index])
			        	endif
			        endif
        		endif
        	else
	        	call SetUnitX(Xiaoting___UArrow[index], YDWECoordinateX(xp))
	        	call SetUnitY(Xiaoting___UArrow[index], YDWECoordinateY(yp))
	        	//绝焱
		        if ( Xiaoting___IJueyan > 0 ) then
		        	if ( ModuloInteger(Xiaoting___IZhengmiao, 3) == 0 ) then
		        		call Xiaoting___CreateJueyan(Xiaoting___UArrow[index])
		        	endif
		        endif
			endif
    	else
        	call SetUnitX(Xiaoting___UArrow[index], YDWECoordinateX(xp))
        	call SetUnitY(Xiaoting___UArrow[index], YDWECoordinateY(yp))
	        //绝焱
	        if ( Xiaoting___IJueyan > 0 ) then
	        	if ( ModuloInteger(Xiaoting___IZhengmiao, 3) == 0 ) then
	        		call Xiaoting___CreateJueyan(Xiaoting___UArrow[index])
	        	endif
	        endif
    	endif
	endfunction
 function Xiaoting___FlashArrowMoveTimer takes nothing returns nothing
  local integer i= 1
		set Xiaoting___IZhengmiao=I3(Xiaoting___IZhengmiao >= 20 , 1 , Xiaoting___IZhengmiao + 1)
		if ( Xiaoting___IZhengmiao == 1 ) then
			set Xiaoting___IFantan=I3(Xiaoting___IFantan > 0 , Xiaoting___IFantan - 1 , 0)
			set Xiaoting___IJueyan=I3(Xiaoting___IJueyan > 0 , Xiaoting___IJueyan - 1 , 0)
		endif
		loop
			exitwhen i > Xiaoting___IMaxCombo
			if ( Xiaoting___UArrow[i] != null ) then
				call Xiaoting___FlashArrowMove(i)
			endif
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xiaoting___Guanhongjian takes real x,real y,real facing,boolean spellID returns nothing
  local integer i= 1
		call Xiaoting___SetShe2Tech()
		if ( spellID ) then
	    	call PrintSpell(GetOwningPlayer(xiaoting) , GetAbilityName(GetSpellAbilityId()) , Xiaoting___RDamageXiaoting * Xiaoting___GetComboMulti())
		endif
		loop
			exitwhen i > Xiaoting___IMaxCombo
			if ( Xiaoting___UArrow[i] == null ) then
				set Xiaoting___UArrow[i]=CreateUnit(GetOwningPlayer(xiaoting), 'h024', x, y, facing)
				if ( Xiaoting___TArrow == null ) then
					set Xiaoting___TArrow=CreateTimer()
					set Xiaoting___IZhengmiao=1
					call TimerStart(Xiaoting___TArrow, 0.05, true, function Xiaoting___FlashArrowMoveTimer)
				endif
				set Xiaoting___GArrow[i]=CreateGroup()
				return
			endif
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xiaoting___Zhefan takes nothing returns nothing
		set Xiaoting___IFantan=5
	    call PrintSpellContent(GetOwningPlayer(xiaoting) , GetAbilityName(GetSpellAbilityId()) , "折返剩余时间" + I2S(Xiaoting___IFantan) + "s.")
	    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\BattleRoar\\RoarCaster.mdl", GetUnitX(xiaoting), GetUnitY(xiaoting)))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xiaoting___Yanzhi takes nothing returns nothing
  local integer i= 1
  local group g= CreateGroup()
  local group temp= null
  local unit l_unit= null
		if ( Xiaoting___BJingzhi ) then
			call Xiaoting___ClearAllArrow()
			return
		endif
		loop
			exitwhen i > Xiaoting___IMaxCombo
			if ( Xiaoting___UArrow[i] != null ) then
				set temp=GetEnemyGroup(GetOwningPlayer(xiaoting) , GetUnitX(Xiaoting___UArrow[i]) , GetUnitY(Xiaoting___UArrow[i]) , 900)
				call GroupAddGroup(temp, g)
				call DestroyGroup(temp)
				//call DamageArea(xiaoting,GetUnitX(UArrow[i]),GetUnitY(UArrow[i]),900,RDamageXiaoting* 0.50 * (GetComboMulti() + 1))
				call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Other\\NeutralBuildingExplosion\\NeutralBuildingExplosion.mdl", GetUnitX(Xiaoting___UArrow[i]), GetUnitY(Xiaoting___UArrow[i])))
			endif
			set i=i + 1
		endloop
		//伤害
		loop
		    set l_unit=FirstOfGroup(g)
		    exitwhen l_unit == null
		    call GroupRemoveUnit(g, l_unit)
		    call UnitDamageTarget(xiaoting, l_unit, Xiaoting___RDamageXiaoting * 0.50 * ( Xiaoting___GetComboMulti() + 1 ), false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
		endloop
		call Xiaoting___ClearAllArrow()
	    call PrintSpell(GetOwningPlayer(xiaoting) , GetAbilityName(GetSpellAbilityId()) , Xiaoting___RDamageXiaoting * 0.50 * ( Xiaoting___GetComboMulti() + 1 ))
	    call DestroyGroup(g)
	    set g=null
	    set temp=null
	    set l_unit=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xiaoting___Chenmo takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > Xiaoting___IMaxCombo
			if ( Xiaoting___UArrow[i] != null ) then
				call Xiaoting___ChangeFacing(i , GetFacingBetweenXY(GetUnitX(Xiaoting___UArrow[i]) , GetUnitY(Xiaoting___UArrow[i]) , GetSpellTargetX() , GetSpellTargetY()))
			    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", GetUnitX(Xiaoting___UArrow[i]), GetUnitY(Xiaoting___UArrow[i])))
			endif
			set i=i + 1
		endloop
	    call PrintSpellName(GetOwningPlayer(xiaoting) , GetAbilityName(GetSpellAbilityId()))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xiaoting___Zhuixin takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > Xiaoting___IMaxCombo
			if ( Xiaoting___UArrow[i] != null ) then
				call Xiaoting___ChangeFacing(i , GetFacingBetweenXY(GetUnitX(Xiaoting___UArrow[i]) , GetUnitY(Xiaoting___UArrow[i]) , GetUnitX(xiaoting) , GetUnitY(xiaoting)))
			    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", GetUnitX(Xiaoting___UArrow[i]), GetUnitY(Xiaoting___UArrow[i])))
			endif
			set i=i + 1
		endloop
	    call PrintSpellName(GetOwningPlayer(xiaoting) , GetAbilityName(GetSpellAbilityId()))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xiaoting___Bingqiang takes nothing returns nothing
     local integer i= 1
     local real facing= Atan2BJ(GetSpellTargetY() - GetUnitY(xiaoting), GetSpellTargetX() - GetUnitX(xiaoting))
     local unit u= null
	    loop
	    	exitwhen i > ( 6 + 4 * Xiaoting___GetComboMulti() )
	    	set u=CreateUnit(GetOwningPlayer(xiaoting), 'hwtw', YDWECoordinateX(GetUnitX(xiaoting) + 200.00 * I2R(i) * CosBJ(facing)), YDWECoordinateY(GetUnitY(xiaoting) + 200.00 * I2R(i) * SinBJ(facing)), 0)
	    	if ( i == 1 or i == ( 6 + 4 * Xiaoting___GetComboMulti() ) ) then
	    	endif
	    	call SetUnitUserData(u, R2I(facing) + I3(( i == 1 or i == ( 6 + 4 * Xiaoting___GetComboMulti() ) ) , 2000 , 0))
	    	call UnitApplyTimedLifeBJ(12.00 + RJ2(xiaoting , 5 , 0), 'BHwe', u)
	    	set i=i + 1
	    endloop
	    call PrintSpellName(GetOwningPlayer(xiaoting) , GetAbilityName(GetSpellAbilityId()))
	    set u=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xiaoting___JingtiTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local real intTimes= LoadReal(spellTable, GetHandleId(t), 1)
		call AddAgiPercentImme(GetConvertedPlayerId(GetOwningPlayer(xiaoting)) , - 1 * intTimes)
		call FlushChildHashtable(spellTable, GetHandleId(t))
		call PauseTimer(t)
		call DestroyTimer(t)
		set t=null
	endfunction
 function Xiaoting___Jingti takes nothing returns nothing
  local real intTimes= 0.25 + Xiaoting___GetComboMulti() * 0.25
  local timer t= CreateTimer()
		call SaveReal(spellTable, GetHandleId(t), 1, intTimes)
		call TimerStart(t, 30, false, function Xiaoting___JingtiTimer)
		call AddAgiPercentImme(GetConvertedPlayerId(GetOwningPlayer(xiaoting)) , intTimes)
		call YDWETimerDestroyEffect(30 , AddSpecialEffectTargetUnitBJ("overhead", xiaoting, "war3mapImported\\state_xiaoting.mdx"))
	    call PrintSpellContent(GetOwningPlayer(xiaoting) , GetAbilityName(GetSpellAbilityId()) , "成功增加" + I2S(25 + Xiaoting___GetComboMulti() * 25) + "%的敏捷，持续30秒。")
	    set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xiaoting___FenlieTimeout takes nothing returns nothing
		call Xiaoting___ClearRestArrow(2)
    	call CreateSpellTextTag("分裂箭时间到" , xiaoting , 0 , 100 , 0 , 3)
	endfunction
 function Xiaoting___Fenlie takes nothing returns nothing
  local integer i= 1
  local integer max= 0
		loop
			exitwhen i > Xiaoting___IMaxCombo
			if ( Xiaoting___UArrow[i] == null ) then
				set max=i - 1
				exitwhen true
			endif
			set i=i + 1
		endloop
		set i=1
		loop
			exitwhen i > max
			if ( Xiaoting___UArrow[i] != null ) then
				call Xiaoting___Guanhongjian(GetUnitX(Xiaoting___UArrow[i]) , GetUnitY(Xiaoting___UArrow[i]) , GetUnitFacing(Xiaoting___UArrow[i]) + GetRandomReal(- 15, 15) , false)
				call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\MirrorImage\\MirrorImageCaster.mdl", GetUnitX(Xiaoting___UArrow[i]), GetUnitY(Xiaoting___UArrow[i])))
			endif
			set i=i + 1
		endloop
	    call PrintSpellName(GetOwningPlayer(xiaoting) , GetAbilityName(GetSpellAbilityId()))
	    call TimerStart(Xiaoting___TFenlie, 7, false, function Xiaoting___FenlieTimeout)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xiaoting___Shunti takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > Xiaoting___IMaxCombo
			if ( Xiaoting___UArrow[i] != null ) then
			    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\Blink\\BlinkCaster.mdl", GetUnitX(Xiaoting___UArrow[i]), GetUnitY(Xiaoting___UArrow[i])))
			    call SetUnitX(Xiaoting___UArrow[i], GetUnitX(xiaoting))
				call SetUnitY(Xiaoting___UArrow[i], GetUnitY(xiaoting))
			endif
			set i=i + 1
		endloop
	    call PrintSpellName(GetOwningPlayer(xiaoting) , GetAbilityName(GetSpellAbilityId()))
	endfunction
//---------------------------------------------------------------------------------------------------
	
    function Xiaoting___DuyueTimer takes nothing returns nothing
     local timer t= GetExpiredTimer()
     local integer id= GetHandleId(t)
     local integer attract= LoadInteger(spellTable, id, 1)
    	call s__Attract_deallocate(attract)
		call PauseTimer(t)
		call FlushChildHashtable(spellTable, id)
		call DestroyTimer(t)
    	set t=null
    endfunction
 function Xiaoting___Duyue takes nothing returns nothing
  local integer i= 1
     local timer t= CreateTimer()
     local integer attract= s__Attract_create(xiaoting , I3(IsInDiamondRegion(GetUnitX(xiaoting) , GetUnitY(xiaoting)) , 900 , 900 * Xiaoting___GetComboMulti()) , 0.05 , 50 * Xiaoting___GetComboMulti())
	    call PrintSpellContent(GetOwningPlayer(xiaoting) , GetAbilityName(GetSpellAbilityId()) , "范围" + I2S(900 * Xiaoting___GetComboMulti()) + ".")
		call YDWETimerDestroyEffect(3 , AddSpecialEffectTargetUnitBJ("chest", xiaoting, "war3mapImported\\hole.mdl"))
		call s__Attract_SetForbitHero(attract)
		call s__Attract_SetDeathContinue(attract)
	    call s__Attract_start(attract)
	    call SaveInteger(spellTable, GetHandleId(t), 1, attract)
	    call TimerStart(t, 3, false, function Xiaoting___DuyueTimer)
	    set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xiaoting___Yujian takes nothing returns nothing
		set Xiaoting___BYujian=not ( Xiaoting___BYujian )
		if ( Xiaoting___BYujian ) then
			call PrintSpellContent(GetOwningPlayer(xiaoting) , GetAbilityName(GetSpellAbilityId()) , "开启御箭形态.")
		else
			call PrintSpellContent(GetOwningPlayer(xiaoting) , GetAbilityName(GetSpellAbilityId()) , "关闭御箭形态.")
		endif
	    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\BattleRoar\\RoarCaster.mdl", GetUnitX(xiaoting), GetUnitY(xiaoting)))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xiaoting___Jueyan takes nothing returns nothing
		set Xiaoting___IJueyan=Xiaoting___IJueyan + 2
	    call PrintSpellName(GetOwningPlayer(xiaoting) , GetAbilityName(GetSpellAbilityId()))
	    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\BattleRoar\\RoarCaster.mdl", GetUnitX(xiaoting), GetUnitY(xiaoting)))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xiaoting___Jingzhi takes nothing returns nothing
		set Xiaoting___BJingzhi=not ( Xiaoting___BJingzhi )
		if ( Xiaoting___BJingzhi ) then
			call PrintSpellContent(GetOwningPlayer(xiaoting) , GetAbilityName(GetSpellAbilityId()) , "开启静滞形态.")
		else
			call PrintSpellContent(GetOwningPlayer(xiaoting) , GetAbilityName(GetSpellAbilityId()) , "关闭静滞形态.")
		endif
	    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\BattleRoar\\RoarCaster.mdl", GetUnitX(xiaoting), GetUnitY(xiaoting)))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xiaoting___Jianling takes nothing returns nothing
  local integer times= Xiaoting___GetComboMulti()
  local integer attack= IMinBJ(1000000000, ( GetHeroInt(xiaoting, true) + GetAttack(xiaoting) ) * 4)
  local integer defense=( GetHeroAgi(xiaoting, true) / 100 + GetDefense(xiaoting) )
  local integer hp=( GetHeroStr(xiaoting, true) * 10 + GetHP(xiaoting) )
  local unit u
  local integer i= 1
		loop
			exitwhen i > Xiaoting___IMaxCombo
			if ( Xiaoting___UArrow[i] != null ) then
				set u=CreateUnit(GetOwningPlayer(xiaoting), 'n01V', GetUnitX(Xiaoting___UArrow[i]), GetUnitY(Xiaoting___UArrow[i]), 0)
				call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\AnimateDead\\AnimateDeadTarget.mdl", GetUnitX(u), GetUnitY(u)))
				call UnitApplyTimedLifeBJ(180.00, 'BHwe', u)
				call SetAttack(u , attack)
				call SetDefense(u , defense)
				call SetHP(u , hp)
			endif
			set i=i + 1
		endloop
	    call PrintSpellName(GetOwningPlayer(xiaoting) , GetAbilityName(GetSpellAbilityId()))
	    set u=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xiaoting___Gangti takes nothing returns nothing
  local real defenseAdd= 2. + 1. * Xiaoting___GetComboMulti()
		call AddDefensePercent(GetConvertedPlayerId(GetOwningPlayer(xiaoting)) , defenseAdd)
		call AddDefense(xiaoting , 0)
		call PrintSpellContent(GetOwningPlayer(xiaoting) , GetAbilityName(GetSpellAbilityId()) , "防御成功增加" + I2S(200 + 100 * Xiaoting___GetComboMulti()) + "%.")
	    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\BattleRoar\\RoarCaster.mdl", GetUnitX(xiaoting), GetUnitY(xiaoting)))
	    call YDWEPolledWaitNull(10)
		call AddDefensePercent(GetConvertedPlayerId(GetOwningPlayer(xiaoting)) , - 1 * defenseAdd)
		call AddDefense(xiaoting , 0)
		call PrintSpellContent(GetOwningPlayer(xiaoting) , GetAbilityName(GetSpellAbilityId()) , "防御增益效果结束.")
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xiaoting___PingzhangTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local unit u= LoadUnitHandle(spellTable, id, 1)
  local group l_group= CreateGroup()
  local unit l_unit
		if ( IsUnitAliveBJ(u) ) then
			call GroupEnumUnitsInRange(l_group, GetUnitX(u), GetUnitY(u), 600, null)
			loop
			    set l_unit=FirstOfGroup(l_group)
			    exitwhen l_unit == null
			    call GroupRemoveUnit(l_group, l_unit)
			    if ( IsAlly(l_unit , xiaoting) ) then
			    	call RecoverUnitHP(l_unit , 0.3)
			    	call RecoverUnitMP(l_unit , 20)
			    endif
			endloop
			call DestroyGroup(l_group)
			set l_group=null
			set l_unit=null
		else
			call AddDamagePercent(GetConvertedPlayerId(GetOwningPlayer(xiaoting)) , - 0.3)
			call RemoveUnit(u)
			call FlushChildHashtable(spellTable, id)
			call PauseTimer(t)
			call DestroyTimer(t)
		endif
		set u=null
		set t=null
		call DestroyGroup(l_group)
		set l_unit=null
		set l_group=null
	endfunction
 function Xiaoting___Pingzhang takes nothing returns nothing
  local integer i= 1
  local unit u= null
  local timer t= CreateTimer()
  local unit temp= CreateUnit(GetOwningPlayer(xiaoting), 'h023', GetUnitX(xiaoting), GetUnitY(xiaoting), 0)
		call UnitApplyTimedLifeBJ(10, 'BHwe', temp)
		call AddDamagePercent(GetConvertedPlayerId(GetOwningPlayer(xiaoting)) , 0.3)
		call PrintSpellName(GetOwningPlayer(xiaoting) , GetAbilityName(GetSpellAbilityId()))
		loop
			exitwhen i > 24
			set u=CreateUnit(GetOwningPlayer(xiaoting), 'h021', YDWECoordinateX(GetUnitX(xiaoting) + 600 * CosBJ(i * 15)), YDWECoordinateY(GetUnitY(xiaoting) + 600 * SinBJ(i * 15)), 0)
	    	call SetUnitUserData(u, i * 15 + 90)
 			call UnitApplyTimedLifeBJ(10, 'BHwe', u)
			set i=i + 1
		endloop
		//不断伤害
		call SaveUnitHandle(spellTable, GetHandleId(t), 1, temp)
		call TimerStart(t, 1, true, function Xiaoting___PingzhangTimer)
        call PlaySoundBJ(gg_snd_xiaoting1)
		//快速升级
		set t=null
		set u=null
		set temp=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xiaoting___JianjuetianjiTimeout takes nothing returns nothing
        call AddDamagePercent(GetConvertedPlayerId(GetOwningPlayer(xiaoting)) , - 0.6)
		call PrintSpellContent(GetOwningPlayer(xiaoting) , GetAbilityName('A0M3') , "断了.")
		call PauseTimer(Xiaoting___TDazhao)
		call DestroyTimer(Xiaoting___TDazhao)
		set Xiaoting___TDazhao=null
	endfunction
 function Xiaoting___Jianjuetianji takes nothing returns nothing
		call DestroyEffect(AddSpecialEffect("war3mapImported\\xiaoting_pingzhang.mdx", GetUnitX(xiaoting), GetUnitY(xiaoting)))
		if ( Xiaoting___TDazhao == null ) then
			call PrintSpellName(GetOwningPlayer(xiaoting) , GetAbilityName(GetSpellAbilityId()))
	        //call PlaySoundBJ(gg_snd_xiaoting2)
	        call AddDamagePercent(GetConvertedPlayerId(GetOwningPlayer(xiaoting)) , 0.6)
	        set Xiaoting___TDazhao=CreateTimer()
		endif
		call TimerStart(Xiaoting___TDazhao, 5, false, function Xiaoting___JianjuetianjiTimeout)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xiaoting___SetSpellSet takes integer i returns nothing
		set ISpellState=i
		if ( i == 0 ) then
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LO', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LR', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LV', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0M0', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LQ', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LS', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LX', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0M2', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LP', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LU', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LW', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0M1', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LN', true)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LT', true)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LY', true)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LZ', true)
		elseif ( i == 1 ) then
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LO', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LR', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LV', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0M0', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LP', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LU', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LW', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0M1', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LN', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LT', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LY', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LZ', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LQ', true)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LS', true)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LX', true)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0M2', true)
		elseif ( i == 2 ) then
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LO', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LR', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LV', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0M0', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LN', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LT', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LY', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LZ', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LQ', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LS', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LX', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0M2', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LP', true)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LU', true)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LW', true)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0M1', true)
		elseif ( i == 3 ) then
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LN', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LT', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LY', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LZ', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LQ', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LS', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LX', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0M2', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LP', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LU', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LW', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0M1', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LO', true)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LR', true)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LV', true)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0M0', true)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
	//加属性
 function Xiaoting___FlashComboShuxing takes nothing returns nothing
  local real delta= R3(Xiaoting___GetComboMulti() == 1 , 0. , 0.25 + 0.25 * Xiaoting___GetComboMulti())
		if ( Xiaoting___RAddtion != delta ) then
			call AddStrPercentImme(GetConvertedPlayerId(GetOwningPlayer(xiaoting)) , delta - Xiaoting___RAddtion)
			call AddIntPercentImme(GetConvertedPlayerId(GetOwningPlayer(xiaoting)) , delta - Xiaoting___RAddtion)
			call AddAgiPercentImme(GetConvertedPlayerId(GetOwningPlayer(xiaoting)) , delta - Xiaoting___RAddtion)
			set Xiaoting___RAddtion=delta
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Demon\\DarkPortal\\DarkPortalTarget.mdl", GetUnitX(xiaoting), GetUnitY(xiaoting)))
    		call CreateSpellTextTag(I2S(R2I(delta * 100)) + "%全属性提高" , xiaoting , 0 , 100 , 0 , 3)
		endif
	endfunction
	//判断16个都是否一致
 function Xiaoting___ComboDuan takes nothing returns nothing
		set ICombo=0
    	call CreateSpellTextTag("Combo断了" , xiaoting , 0 , 100 , 0 , 3)
    	call Xiaoting___FlashComboShuxing()
	endfunction
 function Xiaoting___AddCombo takes nothing returns nothing
		if not ( IsSecondSpellOK(xiaoting) == true and GetUnitAbilityLevel(xiaoting, 'A0LT') == 1 ) then
			return
		endif
		set ICombo=ICombo + 1
		call TimerStart(Xiaoting___TComboAdd, RMaxBJ(0.1, I2R(5 + IJ1(xiaoting , 1 , 0) + IJ3(xiaoting , 1 , 0) - ( ICombo / 20 ))) / R3(IsWanjie() , 2.0 , 1.0), false, function Xiaoting___ComboDuan)
    	call CreateSpellTextTag("Combo:" + I2S(ICombo) , xiaoting , 100 , 0 , 0 , 3)
		if ( Xiaoting___GetComboMulti() == 4 and Xiaoting___IMaxCombo != 16 ) then
			set Xiaoting___IMaxCombo=16
		elseif ( Xiaoting___GetComboMulti() == 3 and Xiaoting___IMaxCombo != 12 ) then
			set Xiaoting___IMaxCombo=12
			call Xiaoting___ClearRestArrow(13)
		elseif ( Xiaoting___GetComboMulti() == 2 and Xiaoting___IMaxCombo != 8 ) then
			set Xiaoting___IMaxCombo=8
			call Xiaoting___ClearRestArrow(9)
		elseif ( Xiaoting___GetComboMulti() == 1 and Xiaoting___IMaxCombo != 4 ) then
			set Xiaoting___IMaxCombo=4
			call Xiaoting___ClearRestArrow(5)
		endif
    	call Xiaoting___FlashComboShuxing()
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xiaoting___TSpellXiaotingAct takes nothing returns nothing
		//切换技能套
		if ( GetSpellAbilityId() == 'A0LJ' ) then
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LJ', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LK', true)
			call SetUnitAbilityLevel(xiaoting, 'A0LK', 1 + IJ1(xiaoting , 1 , 0) + IJ2(xiaoting , 1 , 0) + IJ3(xiaoting , 1 , 0))
			call Xiaoting___SetSpellSet(1)
			set ICombo=ICombo + IJ1(xiaoting , 1 , 0) * IJ3(xiaoting , 2 , 1)
		elseif ( GetSpellAbilityId() == 'A0LK' ) then
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LK', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LL', true)
			call SetUnitAbilityLevel(xiaoting, 'A0LL', 1 + IJ1(xiaoting , 1 , 0) + IJ2(xiaoting , 1 , 0) + IJ3(xiaoting , 1 , 0))
			call Xiaoting___SetSpellSet(2)
			set ICombo=ICombo + IJ1(xiaoting , 1 , 0) * IJ3(xiaoting , 2 , 1)
		elseif ( GetSpellAbilityId() == 'A0LL' ) then
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LL', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LM', true)
			call SetUnitAbilityLevel(xiaoting, 'A0LM', 1 + IJ1(xiaoting , 1 , 0) + IJ2(xiaoting , 1 , 0) + IJ3(xiaoting , 1 , 0))
			call Xiaoting___SetSpellSet(3)
			set ICombo=ICombo + IJ1(xiaoting , 1 , 0) * IJ3(xiaoting , 2 , 1)
		elseif ( GetSpellAbilityId() == 'A0LM' ) then
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LM', false)
			call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LJ', true)
			call SetUnitAbilityLevel(xiaoting, 'A0LJ', 1 + IJ1(xiaoting , 1 , 0) + IJ2(xiaoting , 1 , 0) + IJ3(xiaoting , 1 , 0))
			call Xiaoting___SetSpellSet(0)
			set ICombo=ICombo + IJ1(xiaoting , 1 , 0) * IJ3(xiaoting , 2 , 1)
		//大招-箭绝天技
		elseif ( GetSpellAbilityId() == 'A0M3' ) then
			call Xiaoting___AddCombo()
			call Xiaoting___Jianjuetianji()
		//贯虹箭
		elseif ( GetSpellAbilityId() == 'A0LN' ) then
			call Xiaoting___AddCombo()
			call Xiaoting___Guanhongjian(GetSpellTargetX() , GetSpellTargetY() , GetFacingBetweenXY(GetUnitX(xiaoting) , GetUnitY(xiaoting) , GetSpellTargetX() , GetSpellTargetY()) , true)
			call UnitRemoveAbility(xiaoting, 'A0LO')
			call UnitAddAbility(xiaoting, 'A0LO')
			if ( IsFifthSpellOK(xiaoting) and GetUnitAbilityLevel(xiaoting, 'A0M3') == 1 ) then
				call UnitRemoveAbility(xiaoting, 'A0M3')
				call UnitAddAbility(xiaoting, 'A0M3')
			endif
		//箭技-折返
		elseif ( GetSpellAbilityId() == 'A0LO' ) then
			call Xiaoting___AddCombo()
			call Xiaoting___Zhefan()
			if ( IsFifthSpellOK(xiaoting) and GetUnitAbilityLevel(xiaoting, 'A0M3') == 1 ) then
				call UnitRemoveAbility(xiaoting, 'A0M3')
				call UnitAddAbility(xiaoting, 'A0M3')
			endif
		//箭技-炎止
		elseif ( GetSpellAbilityId() == 'A0LP' ) then
			call Xiaoting___AddCombo()
			call Xiaoting___Yanzhi()
			call UnitRemoveAbility(xiaoting, 'A0LO')
			call UnitAddAbility(xiaoting, 'A0LO')
			if ( IsFifthSpellOK(xiaoting) and GetUnitAbilityLevel(xiaoting, 'A0M3') == 1 ) then
				call UnitRemoveAbility(xiaoting, 'A0M3')
				call UnitAddAbility(xiaoting, 'A0M3')
			endif
		//箭技-沉默
		elseif ( GetSpellAbilityId() == 'A0LQ' ) then
			call Xiaoting___AddCombo()
			call Xiaoting___Chenmo()
			call UnitRemoveAbility(xiaoting, 'A0LO')
			call UnitAddAbility(xiaoting, 'A0LO')
			if ( IsFifthSpellOK(xiaoting) and GetUnitAbilityLevel(xiaoting, 'A0M3') == 1 ) then
				call UnitRemoveAbility(xiaoting, 'A0M3')
				call UnitAddAbility(xiaoting, 'A0M3')
			endif
		//箭技-瞬体
		elseif ( GetSpellAbilityId() == 'A0LT' ) then
			call Xiaoting___AddCombo()
			call Xiaoting___Shunti()
			call UnitRemoveAbility(xiaoting, 'A0LO')
			call UnitAddAbility(xiaoting, 'A0LO')
			if ( IsFifthSpellOK(xiaoting) and GetUnitAbilityLevel(xiaoting, 'A0M3') == 1 ) then
				call UnitRemoveAbility(xiaoting, 'A0M3')
				call UnitAddAbility(xiaoting, 'A0M3')
			endif
		//绝技-冰墙
		elseif ( GetSpellAbilityId() == 'A0LR' ) then
			call Xiaoting___AddCombo()
			call Xiaoting___Bingqiang()
			if ( IsFifthSpellOK(xiaoting) and GetUnitAbilityLevel(xiaoting, 'A0M3') == 1 ) then
				call UnitRemoveAbility(xiaoting, 'A0M3')
				call UnitAddAbility(xiaoting, 'A0M3')
			endif
		//绝技-静体
		elseif ( GetSpellAbilityId() == 'A0LU' ) then
			call Xiaoting___AddCombo()
			call Xiaoting___Jingti()
			call UnitRemoveAbility(xiaoting, 'A0LO')
			call UnitAddAbility(xiaoting, 'A0LO')
			if ( IsFifthSpellOK(xiaoting) and GetUnitAbilityLevel(xiaoting, 'A0M3') == 1 ) then
				call UnitRemoveAbility(xiaoting, 'A0M3')
				call UnitAddAbility(xiaoting, 'A0M3')
			endif
		//箭技-分裂
		elseif ( GetSpellAbilityId() == 'A0LS' ) then
			call Xiaoting___AddCombo()
			call Xiaoting___Fenlie()
			call UnitRemoveAbility(xiaoting, 'A0LO')
			call UnitAddAbility(xiaoting, 'A0LO')
			if ( IsFifthSpellOK(xiaoting) and GetUnitAbilityLevel(xiaoting, 'A0M3') == 1 ) then
				call UnitRemoveAbility(xiaoting, 'A0M3')
				call UnitAddAbility(xiaoting, 'A0M3')
			endif
		//箭技-渡越
		elseif ( GetSpellAbilityId() == 'A0LV' ) then
			call Xiaoting___AddCombo()
			call Xiaoting___Duyue()
			call UnitRemoveAbility(xiaoting, 'A0LO')
			call UnitAddAbility(xiaoting, 'A0LO')
			if ( IsFifthSpellOK(xiaoting) and GetUnitAbilityLevel(xiaoting, 'A0M3') == 1 ) then
				call UnitRemoveAbility(xiaoting, 'A0M3')
				call UnitAddAbility(xiaoting, 'A0M3')
			endif
		//箭技-追心
		elseif ( GetSpellAbilityId() == 'A0LY' ) then
			call Xiaoting___AddCombo()
			call Xiaoting___Zhuixin()
			call UnitRemoveAbility(xiaoting, 'A0LO')
			call UnitAddAbility(xiaoting, 'A0LO')
			if ( IsFifthSpellOK(xiaoting) and GetUnitAbilityLevel(xiaoting, 'A0M3') == 1 ) then
				call UnitRemoveAbility(xiaoting, 'A0M3')
				call UnitAddAbility(xiaoting, 'A0M3')
			endif
		//箭技-御箭
		elseif ( GetSpellAbilityId() == 'A0LW' ) then
			call Xiaoting___AddCombo()
			call Xiaoting___Yujian()
			call UnitRemoveAbility(xiaoting, 'A0LO')
			call UnitAddAbility(xiaoting, 'A0LO')
			if ( IsFifthSpellOK(xiaoting) and GetUnitAbilityLevel(xiaoting, 'A0M3') == 1 ) then
				call UnitRemoveAbility(xiaoting, 'A0M3')
				call UnitAddAbility(xiaoting, 'A0M3')
			endif
		//箭技-绝焱
		elseif ( GetSpellAbilityId() == 'A0LX' ) then
			call Xiaoting___AddCombo()
			call Xiaoting___Jueyan()
			call UnitRemoveAbility(xiaoting, 'A0LO')
			call UnitAddAbility(xiaoting, 'A0LO')
			if ( IsFifthSpellOK(xiaoting) and GetUnitAbilityLevel(xiaoting, 'A0M3') == 1 ) then
				call UnitRemoveAbility(xiaoting, 'A0M3')
				call UnitAddAbility(xiaoting, 'A0M3')
			endif
		//箭技-静滞
		elseif ( GetSpellAbilityId() == 'A0LZ' ) then
			call Xiaoting___AddCombo()
			call Xiaoting___Jingzhi()
			call UnitRemoveAbility(xiaoting, 'A0LO')
			call UnitAddAbility(xiaoting, 'A0LO')
			if ( IsFifthSpellOK(xiaoting) and GetUnitAbilityLevel(xiaoting, 'A0M3') == 1 ) then
				call UnitRemoveAbility(xiaoting, 'A0M3')
				call UnitAddAbility(xiaoting, 'A0M3')
			endif
		//箭技-箭灵
		elseif ( GetSpellAbilityId() == 'A0M0' ) then
			call Xiaoting___AddCombo()
			call Xiaoting___Jianling()
			if ( IsFifthSpellOK(xiaoting) and GetUnitAbilityLevel(xiaoting, 'A0M3') == 1 ) then
				call UnitRemoveAbility(xiaoting, 'A0M3')
				call UnitAddAbility(xiaoting, 'A0M3')
			endif
		//箭技-穿刺
		elseif ( GetSpellAbilityId() == 'A0M1' ) then
			call Xiaoting___AddCombo()
			call Xiaoting___Gangti()
			call UnitRemoveAbility(xiaoting, 'A0LO')
			call UnitAddAbility(xiaoting, 'A0LO')
			if ( IsFifthSpellOK(xiaoting) and GetUnitAbilityLevel(xiaoting, 'A0M3') == 1 ) then
				call UnitRemoveAbility(xiaoting, 'A0M3')
				call UnitAddAbility(xiaoting, 'A0M3')
			endif
		//绝技-屏障
		elseif ( GetSpellAbilityId() == 'A0M2' ) then
			call Xiaoting___AddCombo()
			call Xiaoting___Pingzhang()
			call UnitRemoveAbility(xiaoting, 'A0LO')
			call UnitAddAbility(xiaoting, 'A0LO')
			if ( IsFifthSpellOK(xiaoting) and GetUnitAbilityLevel(xiaoting, 'A0M3') == 1 ) then
				call UnitRemoveAbility(xiaoting, 'A0M3')
				call UnitAddAbility(xiaoting, 'A0M3')
			endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xiaoting___FlashXiaotingDamage takes nothing returns nothing
		set Xiaoting___RDamageXiaoting=GetDamageAgi(xiaoting)
		call Xiaoting___AttackTimeReduce()
	endfunction
//---------------------------------------------------------------------------------------------------
	
	//按照12345来判断
 function LearnSkillXiaotingI takes unit learner,integer whichSpell returns nothing
  local integer i
		if ( learner == xiaoting ) then
			if ( whichSpell == 1 ) then
			    call UnitAddAbility(xiaoting, 'A0LO')
			    call UnitAddAbility(xiaoting, 'A0LP')
			    call UnitAddAbility(xiaoting, 'A0LQ')
			elseif ( whichSpell == 2 and IsSecondSpellOK(xiaoting) == true and GetUnitAbilityLevel(xiaoting, 'A0LT') == 1 ) then
				//技能2初始化
			    call UnitAddAbility(xiaoting, 'A0LR')
			    call UnitAddAbility(xiaoting, 'A0LU')
			    call UnitAddAbility(xiaoting, 'A0LS')
			elseif ( whichSpell == 3 and IsThirdSpellOK(xiaoting) == true and GetUnitAbilityLevel(xiaoting, 'A0LY') == 1 ) then
				call InitXiaotingAura()
				call AddSpecialEffectTargetUnitBJ("origin", xiaoting, "war3mapImported\\oakaura.mdx")
			    call UnitAddAbility(xiaoting, 'A0LV')
			    call UnitAddAbility(xiaoting, 'A0LW')
			    call UnitAddAbility(xiaoting, 'A0LX')
			elseif ( whichSpell == 4 and IsFourthSpellOK(xiaoting) == true and GetUnitAbilityLevel(xiaoting, 'A0LZ') == 1 ) then
			    call UnitAddAbility(xiaoting, 'A0M0')
			    call UnitAddAbility(xiaoting, 'A0M1')
			    call UnitAddAbility(xiaoting, 'A0M2')
			elseif ( whichSpell == 5 and IsFifthSpellOK(xiaoting) == true and GetUnitAbilityLevel(xiaoting, 'A0M3') == 1 ) then
			endif
		endif
	endfunction
 function LearnSkillXiaoting takes unit learner,integer learnSpellID returns nothing
		if ( learner == xiaoting ) then
			if ( learnSpellID == 'A0LN' ) then
				call LearnSkillXiaotingI(learner , 1)
			elseif ( learnSpellID == 'A0LT' ) then
				call LearnSkillXiaotingI(learner , 2)
			elseif ( learnSpellID == 'A0LY' ) then
				call LearnSkillXiaotingI(learner , 3)
			elseif ( learnSpellID == 'A0LZ' ) then
				call LearnSkillXiaotingI(learner , 4)
			elseif ( learnSpellID == 'A0M3' ) then
				call LearnSkillXiaotingI(learner , 5)
			endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitXiaoting takes unit u returns nothing
		set xiaoting=u
		//主英雄技能
		set Xiaoting___TSpellXiaoting=CreateTrigger()
	    call TriggerRegisterUnitEvent(Xiaoting___TSpellXiaoting, u, EVENT_UNIT_SPELL_EFFECT)
	    call TriggerAddAction(Xiaoting___TSpellXiaoting, function Xiaoting___TSpellXiaotingAct)
	    //刷新伤害
	    call TimerStart(CreateTimer(), 1, true, function Xiaoting___FlashXiaotingDamage)
	    set Xiaoting___TAttackXT=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(Xiaoting___TAttackXT, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(Xiaoting___TAttackXT, Condition(function Xiaoting___TAttackXTCon))
	    call TriggerAddAction(Xiaoting___TAttackXT, function Xiaoting___TAttackXTAct)
	    set Xiaoting___TComboAdd=CreateTimer()
	    set Xiaoting___TFenlie=CreateTimer()
	    //初始化技能状态
		call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LO', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LP', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LQ', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LR', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LU', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LS', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LV', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LW', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LX', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0M0', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0M1', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0M2', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LK', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LL', false)
		call SetPlayerAbilityAvailable(GetOwningPlayer(xiaoting), 'A0LM', false)
		//箭分裂的上限
		set Xiaoting___IMaxCombo=4
		//科技
		call Xiaoting___SetShe1Tech()
	endfunction

//library Xiaoting ends
//library Xiaoyue:
//---------------------------------------------------------------------------------------------------
	
 function IncreaseZhenfuhuo takes nothing returns nothing
   if ( Xiaoyue__IFuhuo < 150 ) then
    set Xiaoyue__IFuhuo=Xiaoyue__IFuhuo + 1
   elseif ( Xiaoyue__IFuhuo == 150 ) then
    call SetXiaoyueSpinOK(GetOwningPlayer(xiaoyue))
   endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsXiaoyueSpin takes nothing returns boolean
		return GetUnitTypeId(xiaoyue) == 'U001'
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xiaoyue__InitXiaoyueSpin takes unit u returns unit
		if ( IsXiaoyueSpin1(GetOwningPlayer(u)) ) then
			set udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]=CreateUnit(GetOwningPlayer(u), 'U001', GetUnitX(u), GetUnitY(u), 0)
			call UnitAddItemByIdSwapped('I006', udg_H[GetConvertedPlayerId(GetOwningPlayer(u))])
			call SetUnitManaPercentBJ(udg_H[GetConvertedPlayerId(GetOwningPlayer(u))], 100)
			call RemoveUnit(u)
			return udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
		else
			return u
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
 function InitXiaoyue takes unit u returns nothing
		set Xiaoyue__IFuhuo=0
		set xiaoyue=Xiaoyue__InitXiaoyueSpin(u)
	endfunction

//library Xiaoyue ends
//library Xinglong:
//---------------------------------------------------------------------------------------------------
	
 function IncreaseXinglongSpin takes nothing returns nothing
		if not ( GetXinglong1Spin(GetOwningPlayer(xinglong)) ) then
			set Xinglong___ISpinValue=Xinglong___ISpinValue + 1
			if ( ModuloInteger(Xinglong___ISpinValue, 1000) == 0 ) then
				call DisplayTextToPlayer(GetOwningPlayer(xinglong), 0., 0., "【|cffff00ff绯想龙域|r】完成进度" + I2S(Xinglong___ISpinValue) + "/30000.")
			endif
    if ( Xinglong___ISpinValue >= 30000 ) then
     call SetXinglong1SpinOK(GetOwningPlayer(xinglong))
    endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function IsLong takes nothing returns boolean
		return GetUnitTypeId(xinglong) == 'H01I' or GetUnitTypeId(xinglong) == 'H02O'
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SimulateDeathXinglong takes unit u returns nothing
		if ( GetUnitTypeId(u) == 'h01L' ) then
			call DamageArea(xinglong , GetUnitX(u) , GetUnitY(u) , 600 , Xinglong___XinglongDamage * R3(IsLong() , 1.5 , 1) / 10 * GetUnitUserData(u))
 			call DestroyEffect(AddSpecialEffect("war3mapImported\\IceStomp.mdx", GetUnitX(u), GetUnitY(u)))
		endif
		if ( GetUnitTypeId(u) == 'h01J' ) then
			set Xinglong___ILunhui=Xinglong___ILunhui + 1
			if ( Xinglong___ILunhui >= 10 ) then
				set Xinglong___ILunhui=0
				call DamageAreaMirror(xinglong , GetUnitX(u) , GetUnitY(u) , 900 , Xinglong___XinglongDamage * 2.5)
			endif
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl", GetUnitX(u), GetUnitY(u)))
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xinglong___Longhuangfuti takes nothing returns nothing
		if ( GetUnitTypeId(xinglong) == 'Hapm' or GetUnitTypeId(xinglong) == 'H02L' ) then
			if ( not ( Xinglong___BBianshen ) ) then
				call AddDamagePercent(GetConvertedPlayerId(GetOwningPlayer(xinglong)) , 0.2 * ( 1 + IJ2(xinglong , 1 , 0) + IJ3(xinglong , 1 , 0) ))
				call AddDefensePercent(GetConvertedPlayerId(GetOwningPlayer(xinglong)) , 0.1 * ( 1 + IJ2(xinglong , 1 , 0) + IJ3(xinglong , 1 , 0) ))
			endif
			set Xinglong___BBianshen=true
			call YDWEPolledWaitNull(0.01)
			call AddAttack(xinglong , 0)
			call AddDefense(xinglong , 0)
			call AddHP(xinglong , 0)
		elseif ( GetUnitTypeId(xinglong) == 'H01I' or GetUnitTypeId(xinglong) == 'H02O' ) then
			set Xinglong___BBianshen=false
			call AddDamagePercent(GetConvertedPlayerId(GetOwningPlayer(xinglong)) , - 0.2 * ( 1 + IJ2(xinglong , 1 , 0) + IJ3(xinglong , 1 , 0) ))
			call AddDefensePercent(GetConvertedPlayerId(GetOwningPlayer(xinglong)) , - 0.1 * ( 1 + IJ2(xinglong , 1 , 0) + IJ3(xinglong , 1 , 0) ))
			call YDWEPolledWaitNull(0.01)
			call AddAttack(xinglong , 0)
			call AddDefense(xinglong , 0)
			call AddHP(xinglong , 0)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xinglong___Longhuangtuxi2 takes boolean diyfacing,real x,real y,real damage,integer times returns nothing
  local real facing= R3(diyfacing , GetFacingBetweenXY(GetUnitX(xinglong) , GetUnitY(xinglong) , x , y) , GetUnitFacing(xinglong))
  local real distance= R3(diyfacing , GetDistance(GetUnitX(xinglong) , GetUnitY(xinglong) , x , y) , 1200)
  local unit u= CreateUnit(GetOwningPlayer(xinglong), 'h01L', GetUnitX(xinglong), GetUnitY(xinglong), facing)
    	call SetUnitScalePercent(u, 100.00 + times * 10.00, 100.00 + times * 10.00, 100.00 + times * 10.00)
    	call SetUnitUserData(u, times)
    	call UnitApplyTimedLifeBJ(distance / 900, 'BHwe', u)
	    call YDWETimerPatternRushSlide(u , facing , distance , distance / 900 , 0.05 , damage / 10 * times , 180 + times * 20. , false , true , true , "origin" , "" , "Abilities\\Spells\\Undead\\FrostNova\\FrostNovaTarget.mdl")
	endfunction
 function Xinglong___Longhuangtuxi takes real x,real y,integer abilityID,real rate returns nothing
  local integer times= I3(( IsSecondSpellOK(xinglong) and GetUnitAbilityLevel(xinglong, 'A0JO') == 1 ) , 3 , 1)
  local integer i= 1
		if ( ITuxi >= 3 ) then
			return
		endif
		set ITuxi=ITuxi + 1
		if ( abilityID != 0 ) then
	    	call PrintSpell(GetOwningPlayer(xinglong) , GetAbilityName(abilityID) , Xinglong___XinglongDamage)
		endif
		call Xinglong___Longhuangtuxi2(true , GetSpellTargetX() , GetSpellTargetY() , Xinglong___XinglongDamage * rate , 10)
		if ( IsSecondSpellOK(xinglong) and GetUnitAbilityLevel(xinglong, 'A0JO') == 1 ) then
			call YDWEPolledWaitNull(0.5)
			loop
				exitwhen i > 5
				if ( GetRandomInt(1, 100) > I3(BJuexing3[GetConvertedPlayerId(GetOwningPlayer(xinglong))] and IsLong() , 0 , ( i * 10 )) ) then
					call Xinglong___Longhuangtuxi2(false , 0 , 0 , Xinglong___XinglongDamage * rate * 0.1 * i * 2 , i * 2)
	    			call CreateSpellTextTag(I2S(i) + "次共鸣！" , xinglong , 100 , 0 , 0 , 3)
					call YDWEPolledWaitNull(0.5)
	    		else
	    			exitwhen true
				endif
				set i=i + 1
			endloop
		endif
		set ITuxi=ITuxi - 1
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xinglong___Longhuanggongming takes nothing returns nothing
		call UnitRemoveAbility(xinglong, 'A0JN')
		call UnitAddAbility(xinglong, 'A0JN')
    	call PrintSpellContent(GetOwningPlayer(xinglong) , GetAbilityName('A0JO') , "，刷新成功。")
		call UnitDamageTarget(xinglong, xinglong, GetUnitState(xinglong, UNIT_STATE_MAX_LIFE) * 0.2, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_SLOW_POISON, WEAPON_TYPE_WHOKNOWS)
		call DestroyEffect(AddSpecialEffect("war3mapImported\\longj2.mdl", GetUnitX(xinglong), GetUnitY(xinglong)))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xinglong___TSpellXinglongAttackCon takes nothing returns boolean
		return GetAttacker() == xinglong
	endfunction
 function Xinglong___TSpellXinglongAttackAct takes nothing returns nothing
		if ( IsSecondSpellOK(xinglong) and GetUnitState(xinglong, UNIT_STATE_MANA) >= 250 and GetRandomInt(1, 20) == 1 and GetUnitAbilityLevel(xinglong, 'A0JO') == 1 ) then
			call Xinglong___Longhuangtuxi(GetUnitX(GetAttackedUnitBJ()) , GetUnitY(GetAttackedUnitBJ()) , 'A0JO' , 0.33)
		endif
		if ( IsThirdSpellOK(xinglong) and GetUnitState(xinglong, UNIT_STATE_MANA) >= 400 and GetRandomInt(1, 10) == 1 and GetUnitAbilityLevel(xinglong, 'A0JP') == 1 ) then
			call UnitDamageTarget(xinglong, GetAttackedUnitBJ(), ( GetAttack(xinglong) + GetHeroStr(xinglong, false) ) * 3 * SquareRoot(I2R(GetHeroLevel(xinglong))) * R3(IsLong() , 2 , 1), false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
			call CreateSpellTextTag("弑" , GetAttackedUnitBJ() , 100 , 0 , 100 , 3)
			call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Orc\\Orcblood\\BattrollBlood.mdl", GetUnitX(GetAttackedUnitBJ()), GetUnitY(GetAttackedUnitBJ())))
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
    function Xinglong___TSpellXinglongDamageCon takes nothing returns boolean
    	return IsThirdSpellOK(xinglong) and GetEventDamage() < GetUnitState(xinglong, UNIT_STATE_MAX_LIFE) and GetUnitAbilityLevel(xinglong, 'A0JP') == 1 and IsUnitInUnitBack(xinglong , GetEventDamageSource() , 60) and GetEventDamage() > 0 and GetEventDamageSource() != xinglong
    endfunction
    function Xinglong___TSpellXinglongDamageAct takes nothing returns nothing
		call SetUnitLifeBJ(xinglong, GetUnitState(xinglong, UNIT_STATE_LIFE) + GetEventDamage() * 2)
    	if not ( Xinglong___BDamage ) then
    		set Xinglong___BDamage=true
    		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\ReplenishHealth\\ReplenishHealthCasterOverhead.mdl", GetUnitX(xinglong), GetUnitY(xinglong)))
    		call YDWEPolledWaitNull(1)
    		set Xinglong___BDamage=false
    	endif
    endfunction
//---------------------------------------------------------------------------------------------------
	
	//伤害的计时器
 function Xinglong___LonghuanglunhuiDamageTimer takes nothing returns nothing
		if ( Xinglong___RLunhui >= 0. ) then
			set Xinglong___RLunhui=Xinglong___RLunhui - 0.1
			call SetTextTagTextBJ(Xinglong___TTLunhui, R2S(Xinglong___RLunhui) + "s", 20)
    		call SetUnitFlyHeight(CreateUnit(GetOwningPlayer(xinglong), 'h01J', YDWECoordinateX(GetUnitX(Xinglong___ULunhui) + GetRandomReal(- 900, 900)), YDWECoordinateY(GetUnitY(Xinglong___ULunhui) + GetRandomReal(- 900, 900)), 0), 0.00, 500.00)
		else
			call PauseTimer(Xinglong___TLunhui)
			call DestroyTimer(Xinglong___TLunhui)
			set Xinglong___TLunhui=null
			call RemoveUnit(Xinglong___ULunhui)
			call DestroyTextTag(Xinglong___TTLunhui)
			set Xinglong___ULunhui=null
			set Xinglong___TTLunhui=null
		endif
	endfunction
 function Xinglong___Longhuanglunhui takes nothing returns nothing
  local integer i= GetHeroLevel(xinglong)
		set Xinglong___RLunhui=RMaxBJ(5.0, Xinglong___RLunhui)
		if ( Xinglong___TLunhui == null ) then
			set Xinglong___TLunhui=CreateTimer()
			set Xinglong___ULunhui=CreateUnit(GetOwningPlayer(xinglong), 'h01K', GetUnitX(xinglong), GetUnitY(xinglong), 0)
			set Xinglong___TTLunhui=CreateTextTagUnitBJ(R2S(Xinglong___RLunhui) + "s", xinglong, 20, 20, 0, 0, 100, 0)
		endif
		call SetUnitX(Xinglong___ULunhui, GetUnitX(xinglong))
		call SetUnitY(Xinglong___ULunhui, GetUnitY(xinglong))
		//call SetTextTagPos(TTLunhui,GetUnitX(ULunhui),GetUnitY(ULunhui),0)
        call PlaySoundBJ(gg_snd_xinglong_4)
		call PrintSpellName(GetOwningPlayer(xinglong) , GetAbilityName('A0JQ'))
		// call UnitAddAbility(xinglong,'A0K1')
		// call UnitMakeAbilityPermanent(xinglong,true,'A0K1')
		//不断伤害
		call TimerStart(Xinglong___TLunhui, 0.1, true, function Xinglong___LonghuanglunhuiDamageTimer)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xinglong___TSpellXinglongAct takes nothing returns nothing
		if ( GetSpellAbilityId() == 'A0JN' ) then
			//龙皇吐息
			call Xinglong___Longhuangtuxi(GetSpellTargetX() , GetSpellTargetY() , 'A0JN' , 1)
		elseif ( GetSpellAbilityId() == 'A0JO' ) then
			//龙皇共鸣
			call Xinglong___Longhuanggongming()
		elseif ( GetSpellAbilityId() == 'A0JQ' ) then
			//龙皇轮回
			call Xinglong___Longhuanglunhui()
		elseif ( GetSpellAbilityId() == 'AEme' or GetSpellAbilityId() == 'A0NG' ) then
			//龙皇附体
			call Xinglong___Longhuangfuti()
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xinglong___TSpellXinglongUpdateAct takes nothing returns nothing
		call IncreaseXinglongSpin()
		if ( IsFourthSpellOK(xinglong) and GetUnitAbilityLevel(xinglong, 'A0JQ') == 1 and GetUnitLevel(xinglong) >= 101 ) then
			//龙皇轮回，伤害并眩晕，还有特效
		    call SetHeroLevelBJ(xinglong, 1, false)
		    call UnitAddAbility(xinglong, 'A0JN')
		    call UnitAddAbility(xinglong, 'A0JO')
		    call UnitAddAbility(xinglong, 'A0JP')
		    call UnitAddAbility(xinglong, 'A0JQ')
		    call UnitAddAbility(xinglong, 'A0JR')
	    	call CreateUnitEffect(GetOwningPlayer(xinglong) , 'h01M' , GetUnitX(xinglong) , GetUnitY(xinglong) , 0)
			//call CreateEffect2(GetUnitX(xinglong), GetUnitY(xinglong))
	    	//call PrintSpell(GetOwningPlayer(xinglong),GetAbilityName('A0JQ'),XinglongDamage*10)
	    	//call PolledWait(1)
			//call DamageArea(xinglong,GetUnitX(xinglong), GetUnitY(xinglong),1800,XinglongDamage *3)
	    	return
		endif
		//if (IsSecondSpellOK(xinglong) and GetUnitAbilityLevel(xinglong,'A0JO') == 1 and not(BEffUpdate)) then
		//	call DamageArea(xinglong,GetUnitX(xinglong), GetUnitY(xinglong),1800,XinglongDamage * 0.5)
		//	call CreateEffect1(GetUnitX(xinglong), GetUnitY(xinglong))
		//	set BEffUpdate = true
		//	call PolledWait(2)
		//	set BEffUpdate = false
		//endif
		set Xinglong___RLunhui=RMinBJ(30., Xinglong___RLunhui + 1.0)
    	call SetUnitLifePercentBJ(xinglong, 100)
    	call SetUnitManaBJ(xinglong, GetUnitState(xinglong, UNIT_STATE_MANA) + 200)
    	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\HealingWave\\HealingWaveTarget.mdl", GetUnitX(xinglong), GetUnitY(xinglong)))
    	//if (IsFourthSpellOK(xinglong) and GetUnitAbilityLevel(xinglong,'A0JQ') == 1) then
    	//	set BAttrTime = BAttrTime + 2
//
    	//	if (GetUnitAbilityLevel(xinglong,'A0K2') != 1) then
    	//		call UnitAddAbility(xinglong,'A0K2')
    	//		call UnitMakeAbilityPermanent(xinglong,true,'A0K2')
		//		call AddIntPercentImme(GetConvertedPlayerId(GetOwningPlayer(xinglong)),0.3)
		//		call AddAgiPercentImme(GetConvertedPlayerId(GetOwningPlayer(xinglong)),0.3)
		//		call AddStrPercentImme(GetConvertedPlayerId(GetOwningPlayer(xinglong)),0.3)
    	//	endif
    	//endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xinglong___FlashXinglongDamage takes nothing returns nothing
		set Xinglong___XinglongDamage=GetDamageStr(xinglong)
		if ( IsLong() and IsUnitAliveBJ(xinglong) ) then
			call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Orc\\Orcblood\\BattrollBlood.mdl", GetUnitX(xinglong), GetUnitY(xinglong)))
			call UnitDamageTarget(xinglong, xinglong, GetUnitState(xinglong, UNIT_STATE_MAX_LIFE) * 0.1, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_SLOW_POISON, WEAPON_TYPE_WHOKNOWS)
		endif
    	// if (IsFourthSpellOK(xinglong) and GetUnitAbilityLevel(xinglong,'A0JQ') == 1 and BAttrTime != 0) then
    	// 	set BAttrTime = BAttrTime - 1
    	// 	if (BAttrTime == 0) then
    	// 		call UnitRemoveAbility(xinglong,'A0K2')
		// 		call AddIntPercentImme(GetConvertedPlayerId(GetOwningPlayer(xinglong)),-0.3)
		// 		call AddAgiPercentImme(GetConvertedPlayerId(GetOwningPlayer(xinglong)),-0.3)
		// 		call AddStrPercentImme(GetConvertedPlayerId(GetOwningPlayer(xinglong)),-0.3)
    	// 	endif
    	// endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ChooseAura takes unit u returns nothing
		call InitSpecifyAura(u)
		if ( GetHeroIndex(GetUnitTypeId(u)) == 1 ) then
			call UnitRemoveAbility(u, 'AOre')
		endif
		call KillUnit(u)
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Thunderclap\\ThunderClapCaster.mdl", GetUnitX(u), GetUnitY(u)))
		set IChooseAura=IChooseAura - 1
		if ( IChooseAura == 0 ) then
    		call SetCameraBoundsToRectForPlayerBJ(GetOwningPlayer(xinglong), GetPlayableMapRect())
	    	call PanCameraToTimedForPlayer(GetOwningPlayer(xinglong), GetUnitX(xinglong), GetUnitY(xinglong), 0.20)
	    	set udg_T1[GetConvertedPlayerId(GetOwningPlayer(xinglong))]=true
	    else
	    	call DisplayTextToPlayer(GetOwningPlayer(xinglong), 0., 0., "|cFFFF66CC【消息】|r请双击选择你需要的" + I2S(IChooseAura) + "个英雄光环.")
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitChooseAura takes nothing returns nothing
  local dialog d= DialogCreate()
        local string s= "\n        	请双击英雄选择你需要的" + I2S(IChooseAura) + "个英雄光环."
        call DialogSetMessage(d, s)
        call DialogAddButton(d, "确定|cffff6800(Esc)|r", 512)
        call DialogDisplay(GetOwningPlayer(xinglong), d, true)
        set d=null
	    call PanCameraToTimedForPlayer(GetOwningPlayer(xinglong), GetRectCenterX(gg_rct_______c1), GetRectCenterY(gg_rct_______c1), 0.20)
	    call SetCameraBoundsToRectForPlayerBJ(GetOwningPlayer(xinglong), gg_rct_______c1)
	    call DisplayTextToPlayer(GetOwningPlayer(xinglong), 0., 0., "|cFFFF66CC【消息】|r请双击选择你需要的" + I2S(IChooseAura) + "个英雄光环.")
	    set udg_T1[GetConvertedPlayerId(GetOwningPlayer(xinglong))]=false
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function AfterReviveXinglong takes unit u returns nothing
		if ( u == xinglong and Xinglong___BBianshen ) then
			set Xinglong___BBianshen=false
			call AddDamagePercent(GetConvertedPlayerId(GetOwningPlayer(xinglong)) , - 0.2 * ( 1 + IJ2(xinglong , 1 , 0) + IJ3(xinglong , 1 , 0) ))
			call AddDefensePercent(GetConvertedPlayerId(GetOwningPlayer(xinglong)) , - 0.1 * ( 1 + IJ2(xinglong , 1 , 0) + IJ3(xinglong , 1 , 0) ))
			call YDWEPolledWaitNull(0.01)
			call AddAttack(xinglong , 0)
			call AddDefense(xinglong , 0)
			call AddHP(xinglong , 0)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
	//按照12345来判断
 function LearnSkillXinglongI takes unit learner,integer whichSpell returns nothing
  local integer i
		if ( learner == xinglong ) then
			if ( whichSpell == 3 and IsThirdSpellOK(xinglong) and GetUnitAbilityLevel(xinglong, 'A0JP') == 1 ) then
				set IChooseAura=IChooseAura + 1
				call InitChooseAura()
			elseif ( whichSpell == 5 and IsFifthSpellOK(xinglong) and GetUnitAbilityLevel(xinglong, 'A0JR') == 1 ) then
				set IChooseAura=IChooseAura + 3
				call InitChooseAura()
			endif
		endif
	endfunction
 function LearnSkillXinglong takes unit learner,integer learnSpellID returns nothing
		if ( learner == xinglong ) then
			if ( learnSpellID == 'A0JN' ) then
				call LearnSkillXinglongI(learner , 1)
			elseif ( learnSpellID == 'A0JO' ) then
				call LearnSkillXinglongI(learner , 2)
			elseif ( learnSpellID == 'A0JP' ) then
				call LearnSkillXinglongI(learner , 3)
			elseif ( learnSpellID == 'A0JQ' ) then
				call LearnSkillXinglongI(learner , 4)
			elseif ( learnSpellID == 'A0JR' ) then
				call LearnSkillXinglongI(learner , 5)
			endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xinglong___InitXinglongSpin takes unit u returns unit
		if ( IsXinglongSpin1(GetOwningPlayer(u)) ) then
			set udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]=CreateUnit(GetOwningPlayer(u), 'H02L', GetUnitX(u), GetUnitY(u), 0)
			call UnitAddItemByIdSwapped('I006', udg_H[GetConvertedPlayerId(GetOwningPlayer(u))])
			set BSpinXinglong=true
	    	set udg_I_Jingyan[GetConvertedPlayerId(GetOwningPlayer(u))]=udg_I_Jingyan[GetConvertedPlayerId(GetOwningPlayer(u))] + 0.5
			call SetUnitManaPercentBJ(udg_H[GetConvertedPlayerId(GetOwningPlayer(u))], 1000)
			call RemoveUnit(u)
			return udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
		else
			return u
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitXinglong takes unit u returns nothing
		set xinglong=Xinglong___InitXinglongSpin(u)
		set Xinglong___TSpellXinglong=CreateTrigger()
	    call TriggerRegisterUnitEvent(Xinglong___TSpellXinglong, xinglong, EVENT_UNIT_SPELL_EFFECT)
	    call TriggerAddAction(Xinglong___TSpellXinglong, function Xinglong___TSpellXinglongAct)
	    set udg_I_Jingyan[GetConvertedPlayerId(GetOwningPlayer(xinglong))]=udg_I_Jingyan[GetConvertedPlayerId(GetOwningPlayer(xinglong))] + 5.
	    //刷新伤害,还有每秒判断形态是否扣血,还有加属性的判断
	    call TimerStart(CreateTimer(), 1, true, function Xinglong___FlashXinglongDamage)
	    //升级回血及造成伤害
	    set Xinglong___TSpellXinglongUpdate=CreateTrigger()
	    call TriggerRegisterUnitEvent(Xinglong___TSpellXinglongUpdate, xinglong, EVENT_UNIT_HERO_LEVEL)
	    call TriggerAddAction(Xinglong___TSpellXinglongUpdate, function Xinglong___TSpellXinglongUpdateAct)
	    //攻击触发事件，星胧
	    set Xinglong___TSpellXinglongAttack=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(Xinglong___TSpellXinglongAttack, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(Xinglong___TSpellXinglongAttack, Condition(function Xinglong___TSpellXinglongAttackCon))
	    call TriggerAddAction(Xinglong___TSpellXinglongAttack, function Xinglong___TSpellXinglongAttackAct)
	    //伤害免疫事件
	    set Xinglong___TSpellXinglongDamage=CreateTrigger()
	    call TriggerRegisterUnitEvent(Xinglong___TSpellXinglongDamage, xinglong, EVENT_UNIT_DAMAGED)
	    call TriggerAddCondition(Xinglong___TSpellXinglongDamage, Condition(function Xinglong___TSpellXinglongDamageCon))
	    call TriggerAddAction(Xinglong___TSpellXinglongDamage, function Xinglong___TSpellXinglongDamageAct)
	endfunction

//library Xinglong ends
//library Xuanxue:
//---------------------------------------------------------------------------------------------------
	
 function InitHongdeng takes nothing returns nothing
		set HTXX=InitHashtable()
		set Xuanxue__IQinru=0
	endfunction
 function CountQintu takes unit u returns nothing
  local integer i
		if ( HTXX == null ) then
			return
		endif
		if ( GetXuanxue2Spin(GetOwningPlayer(xuanxue)) ) then
			return
		endif
		set i=1
		loop
			exitwhen i > Xuanxue__IQinru
    		if ( LoadInteger(HTXX, GetHandleId(xuanxue), i) == GetUnitTypeId(u) ) then
    			return
    		endif
			set i=i + 1
		endloop
		set Xuanxue__IQinru=Xuanxue__IQinru + 1
		call SaveInteger(HTXX, GetHandleId(xuanxue), Xuanxue__IQinru, GetUnitTypeId(u))
		if ( Xuanxue__IQinru < 134 ) then
			call BJDebugMsg("|cFFFF0000【凝冰红灯】|r进度:" + I2S(Xuanxue__IQinru) + "/134.")
		else
    call SetXuanxue2SpinOK(GetOwningPlayer(xuanxue))
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Bingzhidiaoling takes unit u returns nothing
  local real damage= GetDamageInt(xuanxue)
  local real x= GetUnitX(u)
  local real y= GetUnitY(u)
	    call PrintSpell(GetOwningPlayer(xuanxue) , GetAbilityName(GetSpellAbilityId()) , damage)
	    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\FrostNova\\FrostNovaTarget.mdl", x, y))
	    call UnitDamageTarget(xuanxue, u, damage, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
	    call YDWEPolledWaitNull(1)
		call DamageAreaEff(xuanxue , x , y , 600 , damage , "Abilities\\Spells\\Undead\\FrostNova\\FrostNovaTarget.mdl")
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Wanguxuanshuang takes unit u returns nothing
		if ( IsEnemy(u , xuanxue) and ( udg_U_Zhuansheng_Dantiao[2] != u or GetAttacker() == xuanxue ) and GetUnitState(xuanxue, UNIT_STATE_MANA) >= 400 ) then
			call UnitDamageTarget(xuanxue, u, GetDamageInt(xuanxue) * 0.1, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Xuanxue__InitXuanxueSpin takes unit u returns unit
        if ( IsXuanxueSpin2(GetOwningPlayer(u)) ) then
            set udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]=CreateUnit(GetOwningPlayer(u), 'U002', GetUnitX(u), GetUnitY(u), 0)
            set gg_unit_Uktl_0018=udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
            call UnitAddItemByIdSwapped('I006', udg_H[GetConvertedPlayerId(GetOwningPlayer(u))])
            call AddSpellPercent(GetConvertedPlayerId(GetOwningPlayer(u)) , 0.1)
            call SetUnitManaPercentBJ(udg_H[GetConvertedPlayerId(GetOwningPlayer(u))], 1000)
            call RemoveUnit(u)
            set u=udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
        endif
		if ( IsXuanxueSpin1(GetOwningPlayer(u)) ) then
			call UnitRemoveAbility(u, 'A046')
			call UnitAddAbility(u, 'A0JM')
			call AddSpellPercent(GetConvertedPlayerId(GetOwningPlayer(u)) , 0.2)
			return u
		else
			return u
		endif
	endfunction
 function InitXuanxue takes unit u returns nothing
		set xuanxue=Xuanxue__InitXuanxueSpin(u)
	endfunction

//library Xuanxue ends
//library Yanmie:
//---------------------------------------------------------------------------------------------------
	
 function Yanmie__CreateEffect1 takes real x,real y returns nothing
  local integer i= 1
	    call CreateUnitEffect(GetOwningPlayer(yanmie) , 'h00C' , x , y , 0)
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Thunderclap\\ThunderClapCaster.mdl", x, y))
		loop
			exitwhen i > 6
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Thunderclap\\ThunderClapCaster.mdl", YDWECoordinateX(x + 600 * CosBJ(i * 60)), YDWECoordinateY(y + 600 * SinBJ(i * 60))))
	   		call CreateUnitEffect(GetOwningPlayer(yanmie) , 'h00C' , YDWECoordinateX(x + 600 * CosBJ(i * 60)) , YDWECoordinateY(y + 600 * SinBJ(i * 60)) , 0)
	   		set i=i + 1
		endloop
	endfunction
 function SimulateDamageYanmie takes unit u returns boolean
		//雷神残影50%伤害
		if ( GetUnitTypeId(u) == 'h010' ) then
			call UnitDamageTarget(yanmie, GetTriggerUnit(), GetDamageAgi(yanmie) * 0.4, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_POISON, WEAPON_TYPE_WHOKNOWS)
			return true
		elseif ( GetUnitTypeId(u) == 'h02M' ) then
				call UnitDamageTarget(yanmie, GetTriggerUnit(), GetDamageAgi(yanmie) * 0.3 * R3(GetUnitUserData(u) == 1 , 2.5 , 1), false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_POISON, WEAPON_TYPE_WHOKNOWS)
			return true
		endif
		return false
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CountYanmieLingyu takes nothing returns nothing
		if ( BJuexing2[GetConvertedPlayerId(GetOwningPlayer(yanmie))] ) then
			set Yanmie__Ilingyu=Yanmie__Ilingyu + 1
			if ( Yanmie__Ilingyu >= 30 ) then
	   			call CreateSpellTextTag("雷神领域" , yanmie , 0 , 50 , 100 , 2)
 				call SimulateSpell(yanmie , yanmie , 'A0HV' , 1 , 5 , "stomp" , false , true , false)
				set Yanmie__Ilingyu=0
			endif
		endif
		if ( BJuexing3[GetConvertedPlayerId(GetOwningPlayer(yanmie))] ) then
			set Yanmie__Ishuaxinyifu=Yanmie__Ishuaxinyifu + 1
			if ( Yanmie__Ishuaxinyifu >= 200 ) then
	   			call CreateSpellTextTag("雷神免疫" , yanmie , 50 , 0 , 100 , 2)
	   			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl", GetUnitX(yanmie), GetUnitY(yanmie)))
	   			set udg_Yifu[GetConvertedPlayerId(GetOwningPlayer(yanmie))]=false
				set Yanmie__Ishuaxinyifu=0
			endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function LeishenzhisuCon takes nothing returns boolean
		return ( ( GetAttackedUnitBJ() == yanmie ) and ( IsUnitIllusionBJ(GetAttackedUnitBJ()) != true ) and ( GetUnitStateSwap(UNIT_STATE_MANA, yanmie) > 200.00 ) )
	endfunction
 function LeishenZhisu takes nothing returns nothing
  local real damage= GetDamageAgi(yanmie) * 0.25
  local integer i= 1
  local real x= GetUnitX(yanmie)
  local real y= GetUnitY(yanmie)
		call PrintSpell(GetOwningPlayer(yanmie) , GetAbilityName('AEev') , damage)
		call DamageArea(yanmie , GetUnitX(yanmie) , GetUnitY(yanmie) , 1800 , damage)
		call DisableTrigger(GetTriggeringTrigger())
		loop
			exitwhen i > 6
			call DestroyEffect(AddSpecialEffect("war3mapImported\\OrbitalRay.mdx", YDWECoordinateX(x + 300 * CosBJ(i * 60)), YDWECoordinateY(y + 300 * SinBJ(i * 60))))
			set i=i + 1
		endloop
		set i=1
		loop
			exitwhen i > 12
			call DestroyEffect(AddSpecialEffect("war3mapImported\\OrbitalRay.mdx", YDWECoordinateX(x + 900 * CosBJ(i * 30)), YDWECoordinateY(y + 900 * SinBJ(i * 30))))
			set i=i + 1
		endloop
		set i=1
		loop
			exitwhen i > 18
			call DestroyEffect(AddSpecialEffect("war3mapImported\\OrbitalRay.mdx", YDWECoordinateX(x + 1500 * CosBJ(i * 20)), YDWECoordinateY(y + 1500 * SinBJ(i * 20))))
			set i=i + 1
		endloop
		call YDWEPolledWaitNull(5)
		call EnableTrigger(GetTriggeringTrigger())
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function BoltShadow takes real x,real y returns nothing
  local unit u
		if not ( IsFourthSpellOK(yanmie) and GetUnitAbilityLevel(yanmie, 'AHab') == 1 and GetUnitState(yanmie, UNIT_STATE_MANA) >= 600 ) then
				return
			endif
		if ( CountUnitsInGroup(Yanmie__GShadow) >= ICountShadowMAX ) then
			return
		endif
		set u=CreateUnit(GetOwningPlayer(yanmie), 'h010', x, y, GetRandomReal(0, 360))
	    call CreateSpellTextTag("影" , u , 100 , 100 , 0 , 2)
		call UnitApplyTimedLifeBJ(4.00, 'BHwe', u)
		call GroupAddUnit(Yanmie__GShadow, u)
		set u=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SimulateDeathYanmie takes unit u returns nothing
		if ( IsUnitInGroup(u, Yanmie__GShadow) ) then
			call GroupAddUnit(Yanmie__GShadow, u)
		elseif ( GetUnitTypeId(u) == 'h02M' and GetUnitUserData(u) == 1 ) then
			set Yanmie__IYingyue=Yanmie__IYingyue + 1
			call DestroyEffect(AddSpecialEffect("war3mapImported\\OrbitalRay.mdx", GetUnitX(u), GetUnitY(u)))
			if ( Yanmie__IYingyue >= 10 and Yanmie__UShijie != null ) then
				call Yanmie__CreateEffect1(GetUnitX(Yanmie__UShijie) , GetUnitY(Yanmie__UShijie))
				call DamageArea(yanmie , GetUnitX(Yanmie__UShijie) , GetUnitY(Yanmie__UShijie) , 1800 , GetDamageAgi(yanmie) * 2)
				set Yanmie__IYingyue=0
			endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Leishenzhinu takes nothing returns nothing
  local real time= GetUnitDistance(yanmie , GetAttacker())
  local real x= GetUnitX(GetAttacker())
  local real y= GetUnitY(GetAttacker())
  local unit u= CreateUnit(GetOwningPlayer(yanmie), 'h000', GetUnitX(yanmie), GetUnitY(yanmie), 0)
        call UnitApplyTimedLifeBJ(5.00, 'BHwe', u)
        call UnitAddAbilityBJ('A0N8', u)
        call IssuePointOrder(u, "clusterrockets", x, y)
        set u=null
		if ( time >= 1800 ) then
			return
		endif
		call DisableTrigger(GetTriggeringTrigger())
 		call YDWEPolledWaitNull(time / 1200)
		call DamageArea(yanmie , x , y , 600 , GetDamageAgi(yanmie) * 0.2)
	    call PrintSpell(GetOwningPlayer(yanmie) , GetAbilityName('A0NA') , GetDamageAgi(yanmie) * 0.2)
		call YDWEPolledWaitNull(2)
		call EnableTrigger(GetTriggeringTrigger())
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Yanmie__DestroyYueying takes nothing returns nothing
		call UnitRemoveAbility(yanmie, 'Avul')
		set Yanmie__BYingyue=false
		set Yanmie__RYingyueX=0.
		set Yanmie__RYingyueY=0.
		call PauseTimer(Yanmie__TYingyue)
		call DestroyTimer(Yanmie__TYingyue)
		set Yanmie__TYingyue=null
	endfunction
 function Yanmie__LeishenyueyingTimer takes nothing returns nothing
  local integer i= LoadInteger(spellTable, GetHandleId(Yanmie__TYingyue), 1)
  local real facing= GetFacingBetweenXY(GetUnitX(yanmie) , GetUnitY(yanmie) , Yanmie__RYingyueX , Yanmie__RYingyueY)
  local unit u= null
		call SaveInteger(spellTable, GetHandleId(Yanmie__TYingyue), 1, i + 1)
		if ( ModuloInteger(i, 3) == 0 ) then
			set u=CreateUnit(GetOwningPlayer(yanmie), 'h02M', GetUnitX(yanmie), GetUnitY(yanmie), GetUnitFacing(yanmie))
			call UnitApplyTimedLifeBJ(3.00, 'BHwe', u)
		endif
		if ( IsUnitDeadBJ(yanmie) ) then
			call Yanmie__DestroyYueying()
		endif
		if ( GetDistance(GetUnitX(yanmie) , GetUnitY(yanmie) , Yanmie__RYingyueX , Yanmie__RYingyueY) > 50. ) then
			call SetUnitX(yanmie, GetUnitX(yanmie) + CosBJ(facing) * 50.)
			call SetUnitY(yanmie, GetUnitY(yanmie) + SinBJ(facing) * 50.)
		else
			call Yanmie__DestroyYueying()
		endif
		if ( Yanmie__UShijie != null ) then
			if ( GetUnitDistance(Yanmie__UShijie , yanmie) > 1200 ) then
				if ( Yanmie__BYingyue ) then
					call UnitRemoveAbility(yanmie, 'Avul')
					set Yanmie__BYingyue=false
				endif
			else
				if not ( Yanmie__BYingyue ) then
					set Yanmie__BYingyue=true
					call UnitAddAbility(yanmie, 'Avul')
				endif
				if ( u != null ) then
					call SetUnitUserData(u, 1)
				endif
			endif
		endif
	endfunction
 function Leishenyueying takes nothing returns nothing
		set Yanmie__RYingyueX=GetOrderPointX()
		set Yanmie__RYingyueY=GetOrderPointY()
		if ( Yanmie__TYingyue == null ) then
			set Yanmie__TYingyue=CreateTimer()
			call SaveInteger(spellTable, GetHandleId(Yanmie__TYingyue), 1, 0)
			call TimerStart(Yanmie__TYingyue, 0.04, true, function Yanmie__LeishenyueyingTimer)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Yanmie__LeishenshijieTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
		if ( IsUnitAliveBJ(Yanmie__UShijie) ) then
			call SimulateSpell(yanmie , Yanmie__UShijie , 'A0N9' , 1 , 5 , "stomp" , false , true , false)
		else
			if ( Yanmie__BYingyue ) then
				call UnitRemoveAbility(yanmie, 'Avul')
				set Yanmie__BYingyue=false
			endif
			set Yanmie__UShijie=null
			call PauseTimer(t)
			call DestroyTimer(t)
		endif
		set t=null
	endfunction
 function Yanmie__Leishenshijie takes nothing returns nothing
  local integer i= GetHeroLevel(xinglong)
		set Yanmie__UShijie=CreateUnit(GetOwningPlayer(yanmie), 'h02N', GetSpellTargetX(), GetSpellTargetY(), 0)
		call UnitApplyTimedLifeBJ(15, 'BHwe', Yanmie__UShijie)
        call PlaySoundBJ(gg_snd_yanmie_5)
		call PrintSpellName(GetOwningPlayer(yanmie) , GetAbilityName(GetSpellAbilityId()))
		call TimerStart(CreateTimer(), 2, true, function Yanmie__LeishenshijieTimer)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Yanmie__Leishenhongming takes nothing returns nothing
  local real radius= GetRandomReal(0, 900)
  local real degree= GetRandomReal(0, 360)
  local real x= YDWECoordinateX(Yanmie__RHongmingX + radius * CosBJ(degree))
  local real y= YDWECoordinateX(Yanmie__RHongmingY + radius * SinBJ(degree))
		if ( IsUnitAliveBJ(yanmie) ) then
			call DamageArea(yanmie , x , y , 450 , GetDamageAgi(yanmie) * 0.4)
		    call CreateUnitEffect(GetOwningPlayer(yanmie) , 'h00C' , x , y , 0)
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Thunderclap\\ThunderClapCaster.mdl", x, y))
		else
			call PauseTimer(Yanmie__THongming)
			call DestroyTimer(Yanmie__THongming)
			set Yanmie__THongming=null
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Yanmie__TSpellYanmieAct takes nothing returns nothing
		if ( GetSpellAbilityId() == 'AHbz' ) then
			//雷神轰鸣
			if ( Yanmie__THongming != null ) then
				call PauseTimer(Yanmie__THongming)
				call DestroyTimer(Yanmie__THongming)
				set Yanmie__THongming=null
			endif
		    set Yanmie__RHongmingX=GetSpellTargetX()
		    set Yanmie__RHongmingY=GetSpellTargetY()
		    set Yanmie__THongming=CreateTimer()
		    call TimerStart(Yanmie__THongming, 0.5, true, function Yanmie__Leishenhongming)
		    call PlaySoundBJ(gg_snd_yanmie_5)
	        call PrintSpellName(GetOwningPlayer(yanmie) , GetAbilityName(GetSpellAbilityId()))
		elseif ( GetSpellAbilityId() == 'A0NC' ) then
			call Yanmie__Leishenshijie()
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	//按照12345来判断
 function LearnSkillYanmieI takes unit learner,integer whichSpell returns nothing
  local integer i
		if ( learner == yanmie ) then
			if ( whichSpell == 2 and IsSecondSpellOK(yanmie) and ( GetUnitAbilityLevel(yanmie, 'AEev') == 1 ) ) then
				//技能2初始化
			    set Yanmie__TSpellYanmie2=CreateTrigger()
			    call TriggerRegisterAnyUnitEventBJ(Yanmie__TSpellYanmie2, EVENT_PLAYER_UNIT_ATTACKED)
			    call TriggerAddCondition(Yanmie__TSpellYanmie2, Condition(function LeishenzhisuCon))
			    call TriggerAddAction(Yanmie__TSpellYanmie2, function LeishenZhisu)
			elseif ( whichSpell == 2 and IsSecondSpellOK(yanmie) and ( GetUnitAbilityLevel(yanmie, 'A0NA') == 1 ) ) then
				//技能2(反)初始化
			    set Yanmie__TSpellYanmie2=CreateTrigger()
			    call TriggerRegisterAnyUnitEventBJ(Yanmie__TSpellYanmie2, EVENT_PLAYER_UNIT_ATTACKED)
			    call TriggerAddCondition(Yanmie__TSpellYanmie2, Condition(function LeishenzhisuCon))
			    call TriggerAddAction(Yanmie__TSpellYanmie2, function Leishenzhinu)
			elseif ( whichSpell == 3 and IsThirdSpellOK(yanmie) and GetUnitAbilityLevel(yanmie, 'AHbh') == 1 ) then
				//技能3初始化
				call AddSpecialEffectTargetUnitBJ("origin", yanmie, "war3mapImported\\etherealaura.mdx")
				call InitYanmieAura()
			elseif ( whichSpell == 4 and IsFourthSpellOK(yanmie) and GetUnitAbilityLevel(yanmie, 'AHab') == 1 ) then
				//技能4初始化
				set Yanmie__GShadow=CreateGroup()
		        call EnableTrigger(gg_trg_____________3)
		        call EnableTrigger(gg_trg_____________5)
			elseif ( whichSpell == 4 and IsFourthSpellOK(yanmie) and GetUnitAbilityLevel(yanmie, 'A0NB') == 1 ) then
				//技能4初始化
		        call EnableTrigger(gg_trg_____________3)
		        call EnableTrigger(gg_trg_____________5)
			endif
		endif
	endfunction
 function LearnSkillYanmie takes unit learner,integer learnSpellID returns nothing
		if ( learner == yanmie ) then
			if ( learnSpellID == 'AEev' or learnSpellID == 'A0NA' ) then
				call LearnSkillYanmieI(learner , 2)
			elseif ( learnSpellID == 'AHbh' ) then
				call LearnSkillYanmieI(learner , 3)
			elseif ( learnSpellID == 'AHab' or learnSpellID == 'A0NB' ) then
				call LearnSkillYanmieI(learner , 4)
			endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitFanzhuanYanmie takes nothing returns nothing
		call UnitAddAbility(yanmie, 'A0ND')
		call SetPlayerAbilityAvailable(GetOwningPlayer(yanmie), 'A0ND', false)
		call BJDebugMsg("|cFFFF66CC【消息】|r" + GetPlayerName(GetOwningPlayer(yanmie)) + "变化了英雄|cFFFFCC66湮灭|r的技能形态!")
		call BJDebugMsg("|cFFFF66CC【消息】|r" + GetPlayerName(GetOwningPlayer(yanmie)) + "变化了英雄|cFFFFCC66湮灭|r的技能形态!")
		call BJDebugMsg("|cFFFF66CC【消息】|r" + GetPlayerName(GetOwningPlayer(yanmie)) + "变化了英雄|cFFFFCC66湮灭|r的技能形态!")
		call BJDebugMsg("|cFFFF66CC【消息】|r" + GetPlayerName(GetOwningPlayer(yanmie)) + "变化了英雄|cFFFFCC66湮灭|r的技能形态!")
		set BFanzhuanYM=true
		call CinematicFadeBJ(bj_CINEFADETYPE_FADEOUTIN, 3.00, "ReplaceableTextures\\CameraMasks\\White_mask.blp", 100.00, 0, 0, 0)
		call PlaySoundBJ(gg_snd_fanzhuan)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitYanmieSpin takes unit u returns unit
		if ( IsYanmieSpin1(GetOwningPlayer(u)) ) then
			set udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]=CreateUnit(GetOwningPlayer(u), 'E00F', GetUnitX(u), GetUnitY(u), 0)
			set gg_unit_Eevi_0020=udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
			call SetUnitManaPercentBJ(udg_H[GetConvertedPlayerId(GetOwningPlayer(u))], 100)
			call UnitAddItemByIdSwapped('I006', udg_H[GetConvertedPlayerId(GetOwningPlayer(u))])
			call AddSpellPercent(GetConvertedPlayerId(GetOwningPlayer(u)) , 0.1)
			call RemoveUnit(u)
			return udg_H[GetConvertedPlayerId(GetOwningPlayer(u))]
		else
			return u
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitYanmie takes unit u returns nothing
		set yanmie=InitYanmieSpin(u)
	    call TriggerRegisterUnitEvent(gg_trg_____________3, yanmie, EVENT_UNIT_ISSUED_POINT_ORDER)
		set Yanmie__TSpellYanmie=CreateTrigger()
	    call TriggerRegisterUnitEvent(Yanmie__TSpellYanmie, yanmie, EVENT_UNIT_SPELL_EFFECT)
	    call TriggerAddAction(Yanmie__TSpellYanmie, function Yanmie__TSpellYanmieAct)
      if ( DzAPI_Map_GetMapLevel(GetOwningPlayer(yanmie)) >= 3 or IsPIV(GetOwningPlayer(yanmie)) ) then
	    	call CreateFanzhuanItem(yanmie)
      endif
	endfunction

//library Yanmie ends
//library HeroSpellBase:
//---------------------------------------------------------------------------------------------------
	
 function HeroSpellBase__HeroLearnSkillCon takes nothing returns boolean
	    return ( ( IsUnitIllusionBJ(GetTriggerUnit()) != true ) and BuyerFilter(GetTriggerUnit()) )
	endfunction
	//直接学习
 function HeroSpellBase__HeroLearnSkillAct takes nothing returns nothing
		set learnSkillHero=udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]
		//加入英雄内部判断
		call LearnSkillHeiyan(learnSkillHero , GetLearnedSkill())
		call LearnSkillSeyu(learnSkillHero , GetLearnedSkill())
		call LearnSkillHanshang(learnSkillHero , GetLearnedSkill())
		call LearnSkillHuanyi(learnSkillHero , GetLearnedSkill())
		call LearnSkillChenji(learnSkillHero , GetLearnedSkill())
		call LearnSkillMengji(learnSkillHero , GetLearnedSkill())
		call LearnSkillYanmie(learnSkillHero , GetLearnedSkill())
		call LearnSkillCangling(learnSkillHero , GetLearnedSkill())
		call LearnSkillSichen(learnSkillHero , GetLearnedSkill())
		call LearnSkillXinglong(learnSkillHero , GetLearnedSkill())
		call LearnSkillXiaoting(learnSkillHero , GetLearnedSkill())
		call LearnSkillLichi(learnSkillHero , GetLearnedSkill())
		call LearnSkillMoqi(learnSkillHero , GetLearnedSkill())
		call LearnSkillKaisa(learnSkillHero , GetLearnedSkill())
	endfunction
	//通过判断学习第几个来判断
 function TriggerAllHeroLearn takes integer convertedPlayerID,integer which returns nothing
		set learnSkillHero=udg_H[convertedPlayerID]
		//加入英雄内部判断
		call LearnSkillHeiyanI(learnSkillHero , which)
		call LearnSkillSeyuI(learnSkillHero , which)
		call LearnSkillHanshangI(learnSkillHero , which)
		call LearnSkillHuanyiI(learnSkillHero , which)
		call LearnSkillChenjiI(learnSkillHero , which)
		call LearnSkillMengjiI(learnSkillHero , which)
		call LearnSkillYanmieI(learnSkillHero , which)
		call LearnSkillCanglingI(learnSkillHero , which)
		call LearnSkillSichenI(learnSkillHero , which)
		call LearnSkillXinglongI(learnSkillHero , which)
		call LearnSkillLichiI(learnSkillHero , which)
		call LearnSkillMoqiI(learnSkillHero , which)
		call LearnSkillXiaotingI(learnSkillHero , which)
		call LearnSkillKaisaI(learnSkillHero , which)
	endfunction
//---------------------------------------------------------------------------------------------------
 function HeroSpellBase__InitHeroSpellBase takes nothing returns nothing
      local trigger t= CreateTrigger()
		    call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_HERO_SKILL)
		    call TriggerAddCondition(t, Condition(function HeroSpellBase__HeroLearnSkillCon))
		    call TriggerAddAction(t, function HeroSpellBase__HeroLearnSkillAct)
		    set t=null
	endfunction

//library HeroSpellBase ends
//library Juexing:
//---------------------------------------------------------------------------------------------------
	
 function ForbidTianfu takes nothing returns nothing
  local integer i= 1
		set BTianfu=true
		loop
			exitwhen i > 6
			if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) ) then
				call UnitAddAbility(udg_H[i], 'A0KK')
				if ( udg_H[i] == Huanyi ) then
					call SetPlayerAbilityAvailable(ConvertedPlayer(i), ICurrentSpell, false)
				elseif ( udg_H[i] == mengji ) then
					call SetPlayerAbilityAvailable(ConvertedPlayer(i), 'A0GX', false)
					call SetPlayerAbilityAvailable(ConvertedPlayer(i), 'A0GY', false)
				elseif ( udg_H[i] == xiaoting ) then
					call SetPlayerAbilityAvailable(ConvertedPlayer(i), 'A0LK', false)
					call SetPlayerAbilityAvailable(ConvertedPlayer(i), 'A0LL', false)
					call SetPlayerAbilityAvailable(ConvertedPlayer(i), 'A0LM', false)
					call SetPlayerAbilityAvailable(ConvertedPlayer(i), 'A0LJ', false)
				else
					call SetPlayerAbilityAvailable(ConvertedPlayer(i), GetHeroTianFu(udg_H[i]), false)
				endif
			endif
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function AllowTianfu takes nothing returns nothing
  local integer i= 1
		set BTianfu=false
		loop
			exitwhen i > 6
			if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) ) then
				call UnitRemoveAbility(udg_H[i], 'A0KK')
				if ( udg_H[i] == Huanyi ) then
					call SetPlayerAbilityAvailable(ConvertedPlayer(i), ICurrentSpell, true)
				elseif ( udg_H[i] == mengji ) then
					call SetPlayerAbilityAvailable(ConvertedPlayer(i), 'A0GX', true)
					call SetPlayerAbilityAvailable(ConvertedPlayer(i), 'A0GY', true)
				elseif ( udg_H[i] == xiaoting ) then
					if ( ISpellState == 0 ) then
						call SetPlayerAbilityAvailable(ConvertedPlayer(i), 'A0LK', true)
						call SetPlayerAbilityAvailable(ConvertedPlayer(i), 'A0LL', false)
						call SetPlayerAbilityAvailable(ConvertedPlayer(i), 'A0LM', false)
						call SetPlayerAbilityAvailable(ConvertedPlayer(i), 'A0LJ', false)
					elseif ( ISpellState == 1 ) then
						call SetPlayerAbilityAvailable(ConvertedPlayer(i), 'A0LL', true)
						call SetPlayerAbilityAvailable(ConvertedPlayer(i), 'A0LK', false)
						call SetPlayerAbilityAvailable(ConvertedPlayer(i), 'A0LM', false)
						call SetPlayerAbilityAvailable(ConvertedPlayer(i), 'A0LJ', false)
					elseif ( ISpellState == 2 ) then
						call SetPlayerAbilityAvailable(ConvertedPlayer(i), 'A0LM', true)
						call SetPlayerAbilityAvailable(ConvertedPlayer(i), 'A0LK', false)
						call SetPlayerAbilityAvailable(ConvertedPlayer(i), 'A0LL', false)
						call SetPlayerAbilityAvailable(ConvertedPlayer(i), 'A0LJ', false)
					elseif ( ISpellState == 3 ) then
						call SetPlayerAbilityAvailable(ConvertedPlayer(i), 'A0LJ', true)
						call SetPlayerAbilityAvailable(ConvertedPlayer(i), 'A0LK', false)
						call SetPlayerAbilityAvailable(ConvertedPlayer(i), 'A0LL', false)
						call SetPlayerAbilityAvailable(ConvertedPlayer(i), 'A0LM', false)
					endif
				else
					call SetPlayerAbilityAvailable(ConvertedPlayer(i), GetHeroTianFu(udg_H[i]), true)
				endif
			endif
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
  function s__TianfuForbidder_allowTimer takes nothing returns nothing
   local integer this= sc__TianfuForbidder__staticgetindex(GetExpiredTimer())
			call AllowTianfu()
			call PauseTimer(s__TianfuForbidder_t[this])
			call TimerStart(s__TianfuForbidder_t[this], s__TianfuForbidder_IAllow[this], false, function sc__TianfuForbidder_forbitTimer)
  endfunction
  function s__TianfuForbidder_forbitTimer takes nothing returns nothing
   local integer this= sc__TianfuForbidder__staticgetindex(GetExpiredTimer())
			call ForbidTianfu()
			call PauseTimer(s__TianfuForbidder_t[this])
			call TimerStart(s__TianfuForbidder_t[this], s__TianfuForbidder_IForbid[this], false, function s__TianfuForbidder_allowTimer)
  endfunction
  function s__TianfuForbidder__staticgetindex takes handle h returns integer
            return YDWEGetIntegerByString("SPellBase" , I2S(YDWEH2I(h)))
        endfunction
        function s__TianfuForbidder__staticsetindex takes handle h,integer value returns nothing
            call YDWESaveIntegerByString("SPellBase" , I2S(YDWEH2I(h)) , value)
        endfunction
        function s__TianfuForbidder_flush takes handle h returns nothing
            call YDWEFlushStoredIntegerByString("SPellBase" , I2S(YDWEH2I(h)))
        endfunction
        function s__TianfuForbidder_create takes unit caster,real forbidTime,real allowTime returns integer
      local integer this= s__TianfuForbidder__allocate()
			set s__TianfuForbidder_IForbid[this]=forbidTime
			set s__TianfuForbidder_IAllow[this]=allowTime
			set s__TianfuForbidder_t[this]=CreateTimer()
			call s__TianfuForbidder__staticsetindex(s__TianfuForbidder_t[this], (this))
			call TimerStart(s__TianfuForbidder_t[this], allowTime, false, function s__TianfuForbidder_forbitTimer)
			return this
  endfunction
  function s__TianfuForbidder_onDestroy takes integer this returns nothing
			call s__TianfuForbidder_flush(s__TianfuForbidder_t[this])
			call AllowTianfu()
			set s__TianfuForbidder_IForbid[this]=0
			set s__TianfuForbidder_IAllow[this]=0
			call PauseTimer(s__TianfuForbidder_t[this])
			call DestroyTimer(s__TianfuForbidder_t[this])
			set s__TianfuForbidder_t[this]=null
  endfunction

//Generated destructor of TianfuForbidder
function s__TianfuForbidder_deallocate takes integer this returns nothing
    if this==null then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: TianfuForbidder")
        return
    elseif (si__TianfuForbidder_V[this]!=-1) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: TianfuForbidder")
        return
    endif
    call s__TianfuForbidder_onDestroy(this)
    set si__TianfuForbidder_V[this]=si__TianfuForbidder_F
    set si__TianfuForbidder_F=this
endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitHeroJuexing1 takes unit u returns nothing
  local integer i= GetHeroTianFu(u)
		if ( JJ4 and playerName[GetConvertedPlayerId(GetOwningPlayer(u))] == "无心使者" ) then
			return
		endif
		call SetUnitAbilityLevel(u, i, 2)
		call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你的" + GetAbilityName(i) + "技能一阶觉醒了!")
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl", GetUnitX(u), GetUnitY(u)))
		set BJuexing1[GetConvertedPlayerId(GetOwningPlayer(u))]=true
		if ( u == seyu ) then
			call JuexingSeyu1()
		elseif ( u == Huanyi ) then
			call UnitAddAbility(Huanyi, 'A0HX')
		elseif ( u == sichen ) then
			call SetPlayerStateBJ(GetOwningPlayer(sichen), PLAYER_STATE_RESOURCE_FOOD_CAP, ( GetPlayerState(GetOwningPlayer(sichen), PLAYER_STATE_RESOURCE_FOOD_CAP) + 2 ))
		elseif ( u == hanshang ) then
			call AddMoneyPercent(GetConvertedPlayerId(GetOwningPlayer(hanshang)) , 0.25)
		elseif ( u == lichi ) then
	    	call UnitAddAbility(lichi, 'A0B9')
		elseif ( u == xinglong and IsLong() ) then
			call AddDamagePercent(GetConvertedPlayerId(GetOwningPlayer(xinglong)) , 0.2)
			call AddDefensePercent(GetConvertedPlayerId(GetOwningPlayer(xinglong)) , 0.1)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitHeroJuexing2 takes unit u returns nothing
  local integer i= GetHeroTianFu(u)
		if ( JJ4 and playerName[GetConvertedPlayerId(GetOwningPlayer(u))] == "无心使者" ) then
			return
		endif
		call SetUnitAbilityLevel(u, i, 3)
		call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你的" + GetAbilityName(i) + "技能二阶觉醒了!")
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl", GetUnitX(u), GetUnitY(u)))
		set BJuexing2[GetConvertedPlayerId(GetOwningPlayer(u))]=true
		if ( u == moqi ) then
			call JuexingMoqi2()
		elseif ( u == seyu ) then
			call JuexingSeyu2()
		elseif ( u == lichi ) then
			set IMaxHuanying=5
		elseif ( u == chenji ) then
			call TriggerExecute(gg_trg_____________127)
		elseif ( u == sichen ) then
			call SetPlayerStateBJ(GetOwningPlayer(sichen), PLAYER_STATE_RESOURCE_FOOD_CAP, ( GetPlayerState(GetOwningPlayer(sichen), PLAYER_STATE_RESOURCE_FOOD_CAP) + 2 ))
		elseif ( u == xinglong and IsLong() ) then
			call AddDamagePercent(GetConvertedPlayerId(GetOwningPlayer(xinglong)) , 0.2)
			call AddDefensePercent(GetConvertedPlayerId(GetOwningPlayer(xinglong)) , 0.1)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitHeroJuexing3 takes unit u returns nothing
  local integer i= GetHeroTianFu(u)
		if ( JJ4 and playerName[GetConvertedPlayerId(GetOwningPlayer(u))] == "无心使者" ) then
			return
		endif
		call SetUnitAbilityLevel(u, i, 4)
		call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你的" + GetAbilityName(i) + "技能三阶觉醒了!")
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl", GetUnitX(u), GetUnitY(u)))
		set BJuexing3[GetConvertedPlayerId(GetOwningPlayer(u))]=true
		if ( u == kaisa ) then
			call AddStrPercentImme(GetConvertedPlayerId(GetOwningPlayer(kaisa)) , 0.5)
		elseif ( u == yanmie ) then
			call AddAgiPercentImme(GetConvertedPlayerId(GetOwningPlayer(yanmie)) , 0.4)
		elseif ( u == bajue ) then
			call AddStrPercentImme(GetConvertedPlayerId(GetOwningPlayer(bajue)) , 0.6)
		elseif ( u == xiaoyue ) then
			call UnitAddAbility(gg_unit_h00K_0254, 'A0IN')
		elseif ( u == lingxue ) then
			call AddIntPercentImme(GetConvertedPlayerId(GetOwningPlayer(lingxue)) , 1)
		elseif ( u == sheyan ) then
			call AddIntPercentImme(GetConvertedPlayerId(GetOwningPlayer(sheyan)) , 0.4)
		elseif ( u == Heiyan ) then
			call AddSpellPercent(GetConvertedPlayerId(GetOwningPlayer(Heiyan)) , 1)
		elseif ( u == cangling ) then
			call AddHP(cangling , 40000000)
		elseif ( u == mengji ) then
			call RuohuanmengChatBack()
		elseif ( u == sichen ) then
			call SetPlayerStateBJ(GetOwningPlayer(sichen), PLAYER_STATE_RESOURCE_FOOD_CAP, ( GetPlayerState(GetOwningPlayer(sichen), PLAYER_STATE_RESOURCE_FOOD_CAP) + 2 ))
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Juexing___CancelJuexing takes unit u returns nothing
  local integer i= GetHeroTianFu(u)
		if ( JJ4 and playerName[GetConvertedPlayerId(GetOwningPlayer(u))] == "无心使者" ) then
			return
		endif
		call SetUnitAbilityLevel(u, i, 1)
		call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r你的" + GetAbilityName(i) + "技能觉醒失效了!")
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl", GetUnitX(u), GetUnitY(u)))
		if ( u == sichen ) then
			if ( BJuexing3[GetConvertedPlayerId(GetOwningPlayer(sichen))] ) then
				call SetPlayerStateBJ(GetOwningPlayer(sichen), PLAYER_STATE_RESOURCE_FOOD_CAP, ( GetPlayerState(GetOwningPlayer(sichen), PLAYER_STATE_RESOURCE_FOOD_CAP) - 2 ))
			endif
			if ( BJuexing2[GetConvertedPlayerId(GetOwningPlayer(sichen))] ) then
				call SetPlayerStateBJ(GetOwningPlayer(sichen), PLAYER_STATE_RESOURCE_FOOD_CAP, ( GetPlayerState(GetOwningPlayer(sichen), PLAYER_STATE_RESOURCE_FOOD_CAP) - 2 ))
			endif
			if ( BJuexing1[GetConvertedPlayerId(GetOwningPlayer(sichen))] ) then
				call SetPlayerStateBJ(GetOwningPlayer(sichen), PLAYER_STATE_RESOURCE_FOOD_CAP, ( GetPlayerState(GetOwningPlayer(sichen), PLAYER_STATE_RESOURCE_FOOD_CAP) - 2 ))
			endif
		endif
		if ( u == xinglong and IsLong() ) then
			if ( BJuexing1[GetConvertedPlayerId(GetOwningPlayer(sichen))] ) then
				call AddDamagePercent(GetConvertedPlayerId(GetOwningPlayer(xinglong)) , - 0.2)
				call AddDefensePercent(GetConvertedPlayerId(GetOwningPlayer(xinglong)) , - 0.1)
			endif
			if ( BJuexing2[GetConvertedPlayerId(GetOwningPlayer(sichen))] ) then
				call AddDamagePercent(GetConvertedPlayerId(GetOwningPlayer(xinglong)) , - 0.2)
				call AddDefensePercent(GetConvertedPlayerId(GetOwningPlayer(xinglong)) , - 0.1)
			endif
		endif
		if ( u == kaisa and BJuexing3[GetConvertedPlayerId(GetOwningPlayer(kaisa))] ) then
			call AddStrPercentImme(GetConvertedPlayerId(GetOwningPlayer(kaisa)) , - 0.5)
		elseif ( u == yanmie and BJuexing3[GetConvertedPlayerId(GetOwningPlayer(yanmie))] ) then
			call AddAgiPercentImme(GetConvertedPlayerId(GetOwningPlayer(yanmie)) , - 0.4)
		elseif ( u == bajue and BJuexing3[GetConvertedPlayerId(GetOwningPlayer(bajue))] ) then
			call AddStrPercentImme(GetConvertedPlayerId(GetOwningPlayer(bajue)) , - 0.6)
		elseif ( u == xiaoyue and BJuexing3[GetConvertedPlayerId(GetOwningPlayer(xiaoyue))] ) then
			call UnitRemoveAbility(gg_unit_h00K_0254, 'A0IN')
		elseif ( u == lingxue and BJuexing3[GetConvertedPlayerId(GetOwningPlayer(lingxue))] ) then
			call AddIntPercentImme(GetConvertedPlayerId(GetOwningPlayer(lingxue)) , - 1)
		elseif ( u == sheyan and BJuexing3[GetConvertedPlayerId(GetOwningPlayer(sheyan))] ) then
			call AddIntPercentImme(GetConvertedPlayerId(GetOwningPlayer(sheyan)) , - 0.4)
		elseif ( u == Heiyan and BJuexing3[GetConvertedPlayerId(GetOwningPlayer(Heiyan))] ) then
			call AddSpellPercent(GetConvertedPlayerId(GetOwningPlayer(Heiyan)) , - 1)
		elseif ( u == cangling and BJuexing3[GetConvertedPlayerId(GetOwningPlayer(cangling))] ) then
			call AddHP(cangling , - 40000000)
		elseif ( u == hanshang ) then
			call AddMoneyPercent(GetConvertedPlayerId(GetOwningPlayer(hanshang)) , - 0.25)
		endif
		set BJuexing1[GetConvertedPlayerId(GetOwningPlayer(u))]=false
		set BJuexing2[GetConvertedPlayerId(GetOwningPlayer(u))]=false
		set BJuexing3[GetConvertedPlayerId(GetOwningPlayer(u))]=false
		if ( u == moqi ) then
			call QJuexingMoqi()
		elseif ( u == seyu ) then
			call QJuexingSeyu()
		elseif ( u == chenji ) then
			call TriggerExecute(gg_trg_____________129)
		elseif ( u == Huanyi ) then
			call UnitRemoveAbility(Huanyi, 'A0HX')
		elseif ( u == mengji ) then
			call RuohuanmengChatBack()
		elseif ( u == lichi ) then
	    	call UnitRemoveAbility(lichi, 'A0B9')
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Juexing___CreateEffect12Yanyanhuo takes real x,real y returns nothing
  local integer i= 1
		call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Other\\NeutralBuildingExplosion\\NeutralBuildingExplosion.mdl", x, y))
		loop
			exitwhen i > 6
			call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Other\\NeutralBuildingExplosion\\NeutralBuildingExplosion.mdl", YDWECoordinateX(x + 900 * CosBJ(i * 60)), YDWECoordinateY(y + 900 * SinBJ(i * 60))))
			set i=i + 1
		endloop
	endfunction
 function Juexing___YanyanhuoTimer12 takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local unit u= LoadUnitHandle(spellTable, id, 1)
  local unit caster= LoadUnitHandle(spellTable, id, 2)
  local integer index= LoadInteger(spellTable, id, 3)
		if ( IsUnitAliveBJ(u) or index <= 80 ) then
			call SaveInteger(spellTable, GetHandleId(t), 3, index + 1)
			if ( ModuloInteger(index, 10) == 0 ) then
				call DamageArea(caster , GetUnitX(u) , GetUnitY(u) , 1800 , GetDamageBase(caster) * 2)
			endif
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl", YDWECoordinateX(GetUnitX(u) + ( 81 - index ) * 25 * CosBJ(index * 45)), YDWECoordinateY(GetUnitY(u) + ( 81 - index ) * 25 * SinBJ(index * 45))))
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl", YDWECoordinateX(GetUnitX(u) + ( 81 - index ) * 25 * CosBJ(index * ( - 45 ) + 180)), YDWECoordinateY(GetUnitY(u) * 25 + ( 81 - index ) * SinBJ(index * ( - 45 ) + 180))))
		else
			call Juexing___CreateEffect12Yanyanhuo(GetUnitX(u) , GetUnitY(u))
			call DamageArea(caster , GetUnitX(u) , GetUnitY(u) , 1800 , GetDamageBase(caster) * 5)
			call RemoveUnit(u)
			call PauseTimer(t)
			call FlushChildHashtable(spellTable, id)
			call DestroyTimer(t)
		endif
		set u=null
		set t=null
	endfunction
 function Yanyanhuo12 takes unit caster returns nothing
  local timer t= CreateTimer()
  local unit u= CreateUnit(GetOwningPlayer(caster), 'h02I', GetUnitX(caster), GetUnitY(caster), 0)
		call UnitApplyTimedLifeBJ(8, 'BHwe', u)
		call UnitMakeAbilityPermanent(xinglong, true, 'A0K1')
		//不断伤害
		call ImmuteDamageInterval(caster , 8)
		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl", GetUnitX(caster), GetUnitY(caster)))
		call SaveUnitHandle(spellTable, GetHandleId(t), 1, u)
		call SaveUnitHandle(spellTable, GetHandleId(t), 2, caster)
		call SaveInteger(spellTable, GetHandleId(t), 3, 1)
		call AddDamagePercent(GetConvertedPlayerId(GetOwningPlayer(caster)) , 0.6)
		call TimerStart(t, 0.1, true, function Juexing___YanyanhuoTimer12)
		set t=null
		set u=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Juexing___TDengEquitCon takes nothing returns boolean
		return ( GetManipulatingUnit() == udg_H[GetConvertedPlayerId(GetOwningPlayer(GetManipulatingUnit()))] ) and IsDeng(GetManipulatedItem())
	endfunction
 function Juexing___TDengEquitAct takes nothing returns nothing
  local integer i= 1
  local integer dengCount= 0
		loop
			exitwhen i > 6
			if ( IsDeng(UnitItemInSlotBJ(GetTriggerUnit(), i)) ) then
				set dengCount=dengCount + 1
			endif
			set i=i + 1
		endloop
		//如果计数君大于1则丢掉
		if ( dengCount > 1 ) then
			call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【消息】|r你只能同时装备上一个秘境至宝！")
			call YDWEPolledWaitNull(0.01)
			call UnitRemoveItemSwapped(GetManipulatedItem(), GetTriggerUnit())
			return
		elseif ( dengCount == 1 ) then
			if ( GetDeng(GetTriggerUnit()) >= 3 ) then
				call InitHeroJuexing1(GetTriggerUnit())
			endif
			if ( GetDeng(GetTriggerUnit()) >= 7 ) then
				call InitHeroJuexing2(GetTriggerUnit())
			endif
			if ( GetDeng(GetTriggerUnit()) >= 12 ) then
				call InitHeroJuexing3(GetTriggerUnit())
			endif
		endif
	endfunction
 function Juexing___TDengDropAct takes nothing returns nothing
  local integer i= 1
  local integer dengCount= 0
		loop
			exitwhen i > 6
			if ( IsDeng(UnitItemInSlotBJ(GetTriggerUnit(), i)) ) then
				set dengCount=dengCount + 1
			endif
			set i=i + 1
		endloop
		if ( dengCount <= 1 and GetDeng(GetTriggerUnit()) >= 3 ) then
			call Juexing___CancelJuexing(GetTriggerUnit())
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
 function Juexing___InitJuexing takes nothing returns nothing
		//只能同时装备一个灯
  local trigger t= CreateTrigger()
		call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_PICKUP_ITEM)
		call TriggerAddCondition(t, Condition(function Juexing___TDengEquitCon))
		call TriggerAddAction(t, function Juexing___TDengEquitAct)
		//丢弃灯事件
		set t=CreateTrigger()
		call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_DROP_ITEM)
		call TriggerAddCondition(t, Condition(function Juexing___TDengEquitCon))
		call TriggerAddAction(t, function Juexing___TDengDropAct)
		set t=null
	endfunction

//library Juexing ends
//library Kuanghuan:
//---------------------------------------------------------------------------------------------------
	
 function Kuanghuan___TRedAttackCon takes nothing returns boolean
		return ( IKuanghuanType[GetConvertedPlayerId(GetOwningPlayer(GetAttackedUnitBJ()))] == 1 and GetAttackedUnitBJ() == udg_H[GetConvertedPlayerId(GetOwningPlayer(GetAttackedUnitBJ()))] ) or ( IKuanghuanType[GetConvertedPlayerId(GetOwningPlayer(GetAttacker()))] == 1 and GetAttacker() == udg_H[GetConvertedPlayerId(GetOwningPlayer(GetAttacker()))] )
	endfunction
 function Kuanghuan___TRedAttackAct takes nothing returns nothing
  local unit u= null
		if ( IKuanghuanType[GetConvertedPlayerId(GetOwningPlayer(GetAttacker()))] == 1 ) then
			if not ( Kuanghuan___BKuanghuanRed[GetConvertedPlayerId(GetOwningPlayer(GetAttacker()))] ) then
				set u=GetAttacker()
				call DestroyEffect(AddSpecialEffect("war3mapImported\\FireNova2.mdl", GetUnitX(GetAttackedUnitBJ()), GetUnitY(GetAttackedUnitBJ())))
				call DamageArea(u , GetUnitX(GetAttackedUnitBJ()) , GetUnitY(GetAttackedUnitBJ()) , 600 , GetDamageBase(u) * 2)
	    		call CreateSpellTextTag("红色泪殇——炎" , u , 100 , 0 , 0 , 4)
				set Kuanghuan___BKuanghuanRed[GetConvertedPlayerId(GetOwningPlayer(u))]=true
				call YDWEPolledWaitNull(3.0)
				set Kuanghuan___BKuanghuanRed[GetConvertedPlayerId(GetOwningPlayer(u))]=false
				set u=null
			endif
		else
			if not ( Kuanghuan___BKuanghuanRed[GetConvertedPlayerId(GetOwningPlayer(GetAttackedUnitBJ()))] ) then
				set u=GetAttackedUnitBJ()
				call RecoverUnitHP(u , 0.6)
		    	call RecoverUnitMP(u , 200)
 				call SimulateSpell(u , u , 'A0NE' , 1 , 6 , "stomp" , false , true , false)
				call DestroyEffect(AddSpecialEffect("war3mapImported\\FrostNova2.mdl", GetUnitX(u), GetUnitY(u)))
	    		call CreateSpellTextTag("红色泪殇——霜" , u , 0 , 0 , 80 , 4)
				set Kuanghuan___BKuanghuanRed[GetConvertedPlayerId(GetOwningPlayer(u))]=true
				call YDWEPolledWaitNull(3.0)
				set Kuanghuan___BKuanghuanRed[GetConvertedPlayerId(GetOwningPlayer(u))]=false
				set u=null
			endif
		endif
	endfunction
 function Kuanghuan___InitRedColor takes player p returns nothing
		set IKuanghuanType[GetConvertedPlayerId(p)]=1
		call CinematicFadeBJ(bj_CINEFADETYPE_FADEOUTIN, 3.00, "ReplaceableTextures\\CameraMasks\\White_mask.blp", 100.00, 0, 0, 0)
		call PlaySoundBJ(gg_snd_fanzhuan)
		call BJDebugMsg("|cFFFF66CC【消息】|r" + GetPlayerName(p) + "获得了狂欢模式的|cffff0000【狂欢BUFF】红色泪殇|r.")
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Kuanghuan___InitBlueColor takes player p returns nothing
		set IKuanghuanType[GetConvertedPlayerId(p)]=2
		call UnitAddAbilityP(udg_H[GetConvertedPlayerId(p)] , 'A0NF')
		call SetPlayerAbilityAvailable(p, 'A0NF', false)
		call CinematicFadeBJ(bj_CINEFADETYPE_FADEOUTIN, 3.00, "ReplaceableTextures\\CameraMasks\\White_mask.blp", 0, 0, 100.0, 0)
		call PlaySoundBJ(gg_snd_fanzhuan)
		call BJDebugMsg("|cFFFF66CC【消息】|r" + GetPlayerName(p) + "获得了狂欢模式的|cff00ccff【狂欢BUFF】蓝焰轰影|r.")
		call AddXingUnit(udg_H[GetConvertedPlayerId(p)])
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GiveGreenEggs takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > 6
			if ( IKuanghuanType[i] == 3 ) then
				call DisplayTextToPlayer(ConvertedPlayer(i), 0., 0., "|cFFFF66CC【消息】你获得了来自狂欢模式中每一波赠送的绿踪彩蛋.|r")
				call DisplayTextToPlayer(ConvertedPlayer(i), 0., 0., "|cFFFF66CC【消息】你获得了来自狂欢模式中每一波赠送的绿踪彩蛋.|r")
				call DisplayTextToPlayer(ConvertedPlayer(i), 0., 0., "|cFFFF66CC【消息】你获得了来自狂欢模式中每一波赠送的绿踪彩蛋.|r")
				call UnitAddItemByIdSwapped('I02U', udg_H[i])
		        call SaveInteger(YDHT, GetHandleId(GetLastCreatedItem()), 0xA75AD423, i)
		        call PingMinimapForForce(YDWEGetForceOfPlayerNull(ConvertedPlayer(i)), GetUnitX(udg_H[i]), GetUnitY(udg_H[i]), 5.00)
			endif
			set i=i + 1
		endloop
	endfunction
 function Kuanghuan___InitGreenColor takes player p returns nothing
		set IKuanghuanType[GetConvertedPlayerId(p)]=3
		//call UnitAddItemByIdSwapped('I02U', udg_H[GetConvertedPlayerId(p)])
        //call SaveInteger(YDHT,GetHandleId(GetLastCreatedItem()),0xA75AD423,GetConvertedPlayerId(p))
		call CinematicFadeBJ(bj_CINEFADETYPE_FADEOUTIN, 3.00, "ReplaceableTextures\\CameraMasks\\White_mask.blp", 0, 100.0, 0, 0)
		call PlaySoundBJ(gg_snd_fanzhuan)
		call BJDebugMsg("|cFFFF66CC【消息】|r" + GetPlayerName(p) + "获得了狂欢模式的|cff99cc00【狂欢BUFF】绿踪彩蛋|r.")
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function GiveRandomEggs takes unit u returns nothing
  local integer pos= 0
  local integer i= 1
		loop
			exitwhen i > ModuloInteger(DzAPI_Map_GetGameStartTime(), 23) + GetConvertedPlayerId(GetOwningPlayer(u)) + udg_Second[1] + udg_Nandu_JJJ
			set pos=GetRandomInt(1, 3)
			set i=i + 1
		endloop
		if ( pos == 1 ) then
			call UnitAddItemByIdSwapped('I031', udg_H[GetConvertedPlayerId(GetOwningPlayer(u))])
			call ShowGameHint(GetOwningPlayer(u) , "\n			该模式是狂欢活动模式:\n			你获得了随机的|cffff0000【狂欢BUFF】红色泪殇|r,\n			注意查看你的背包,\n			使用后将让你获得很强大的能力哦,\n			快去试试吧!")
		elseif ( pos == 2 ) then
			call UnitAddItemByIdSwapped('I02X', udg_H[GetConvertedPlayerId(GetOwningPlayer(u))])
			call ShowGameHint(GetOwningPlayer(u) , "\n			该模式是狂欢活动模式:\n			你获得了随机的|cff00ccff【狂欢BUFF】蓝焰轰影|r,\n			注意查看你的背包,\n			使用后将让你获得很强大的能力哦,\n			快去试试吧!")
		elseif ( pos == 3 ) then
			call UnitAddItemByIdSwapped('I02V', udg_H[GetConvertedPlayerId(GetOwningPlayer(u))])
			call ShowGameHint(GetOwningPlayer(u) , "\n			该模式是狂欢活动模式:\n			你获得了随机的|cff99cc00【狂欢BUFF】绿踪彩蛋|r,\n			注意查看你的背包,\n			使用后将让你获得很强大的能力哦,\n			快去试试吧!")
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ChooseBuffColor takes player p,integer t returns boolean
		if ( t == 'I031' ) then
			call Kuanghuan___InitRedColor(p)
			return true
		elseif ( t == 'I02X' ) then
			call Kuanghuan___InitBlueColor(p)
			return true
		elseif ( t == 'I02V' ) then
			call Kuanghuan___InitGreenColor(p)
			return true
		endif
		return false
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Kuanghuan___InitKuanghuan takes nothing returns nothing
		set Kuanghuan___TRedAttack=CreateTrigger()
		call TriggerRegisterAnyUnitEventBJ(Kuanghuan___TRedAttack, EVENT_PLAYER_UNIT_ATTACKED)
		call TriggerAddCondition(Kuanghuan___TRedAttack, Condition(function Kuanghuan___TRedAttackCon))
		call TriggerAddAction(Kuanghuan___TRedAttack, function Kuanghuan___TRedAttackAct)
	endfunction

//library Kuanghuan ends
//library Revive:
//---------------------------------------------------------------------------------------------------
function TReviveHeroCon takes nothing returns boolean
    return ( ( IsUnitIllusionBJ(GetRevivingUnit()) == false ) and ( GetRevivingUnit() == udg_H[GetConvertedPlayerId(GetOwningPlayer(GetRevivingUnit()))] ) )
endfunction
function TReviveHeroAct takes nothing returns nothing
	call ReviveBeast(GetRevivingUnit())
	call AfterReviveLingxue(GetRevivingUnit())
	call AfterReviveXinglong(GetRevivingUnit())
	call AfterReviveHeiyan(GetRevivingUnit())
	set BHeroDeath[GetConvertedPlayerId(GetOwningPlayer(GetRevivingUnit()))]=false
	if ( GetPlayerSlotState(GetOwningPlayer(GetRevivingUnit())) == PLAYER_SLOT_STATE_LEFT ) then
		call SetUnitPosition(GetRevivingUnit(), GetRectCenterX(gg_rct_QuitRegion), GetRectCenterY(gg_rct_QuitRegion))
	    call SetUnitInvulnerable(GetRevivingUnit(), true)
	    call PauseUnitBJ(true, GetRevivingUnit())
	    call ShowUnitHide(GetRevivingUnit())
	endif
endfunction
//---------------------------------------------------------------------------------------------------
 function Revive___InitRevive takes nothing returns nothing
  local trigger t= CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_HERO_REVIVE_FINISH)
	    call TriggerAddCondition(t, Condition(function TReviveHeroCon))
	    call TriggerAddAction(t, function TReviveHeroAct)
	endfunction

//library Revive ends
//library Boss:
//---------------------------------------------------------------------------------------------------
	
 function BossAddOnlyAttack takes unit u returns boolean
		if ( CT7() ) then
			call s__OnlyAttackBase_create(u)
			return true
		endif
		return false
	endfunction
//---------------------------------------------------------------------------------------------------
	
  function s__DamageTJ_DamageCon takes nothing returns boolean
			return GetEventDamage() > 10000000
  endfunction
  function s__DamageTJ_DamageAct takes nothing returns nothing
   local integer this= sc__DamageTJ__staticgetindex(GetTriggeringTrigger())
   local integer index= GetConvertedPlayerId(GetOwningPlayer(GetEventDamageSource()))
			set s___DamageTJ_RTongji[s__DamageTJ_RTongji[this]+index]=s___DamageTJ_RTongji[s__DamageTJ_RTongji[this]+index] + ( GetEventDamage() / 10000000. )
  endfunction
		//输出伤害显示
  function s__DamageTJ_show takes integer this returns nothing
   local integer i= 1
			call BJDebugMsg("※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※")
			call BJDebugMsg("|cffff6800【总伤害统计】|r" + GetUnitName(s__DamageTJ_monitor[this]))
			loop
				exitwhen i > 6
				if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) ) then
					call BJDebugMsg(GetPlayerName(ConvertedPlayer(i)) + ":" + R2S(s___DamageTJ_RTongji[s__DamageTJ_RTongji[this]+i] / 10) + "亿伤害。")
				endif
				set i=i + 1
			endloop
			call sc__DamageTJ_deallocate(this)
  endfunction
        function s__DamageTJ__staticgetindex takes handle h returns integer
            return YDWEGetIntegerByString("damageTJ" , I2S(YDWEH2I(h)))
        endfunction
        function s__DamageTJ__staticsetindex takes handle h,integer value returns nothing
            call YDWESaveIntegerByString("damageTJ" , I2S(YDWEH2I(h)) , value)
        endfunction
        function s__DamageTJ_flush takes handle h returns nothing
            call YDWEFlushStoredIntegerByString("damageTJ" , I2S(YDWEH2I(h)))
        endfunction
  function s__DamageTJ_create takes unit monitor returns integer
      local integer this= s__DamageTJ__allocate()
   local integer i= 1
			set s__DamageTJ_t[this]=CreateTrigger()
			set s__DamageTJ_monitor[this]=monitor
			loop
				exitwhen i > 6
				set s___DamageTJ_RTongji[s__DamageTJ_RTongji[this]+i]=0.
				set i=i + 1
			endloop
			call TriggerRegisterUnitEvent(s__DamageTJ_t[this], monitor, EVENT_UNIT_DAMAGED)
		    call TriggerAddCondition(s__DamageTJ_t[this], Condition(function s__DamageTJ_DamageCon))
		    call TriggerAddAction(s__DamageTJ_t[this], function s__DamageTJ_DamageAct)
			call s__DamageTJ__staticsetindex(s__DamageTJ_t[this], (this))
			return this
  endfunction
  function s__DamageTJ_onDestroy takes integer this returns nothing
   local integer i= 1
			call s__DamageTJ_flush(s__DamageTJ_t[this])
			set s__DamageTJ_monitor[this]=null
			loop
				exitwhen i > 6
				set s___DamageTJ_RTongji[s__DamageTJ_RTongji[this]+i]=0
				set i=i + 1
			endloop
			call DestroyTrigger(s__DamageTJ_t[this])
			set s__DamageTJ_t[this]=null
  endfunction

//Generated destructor of DamageTJ
function s__DamageTJ_deallocate takes integer this returns nothing
    if this==null then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Attempt to destroy a null struct of type: DamageTJ")
        return
    elseif (si__DamageTJ_V[this]!=-1) then
        call DisplayTimedTextToPlayer(GetLocalPlayer(),0,0,1000.,"Double free of type: DamageTJ")
        return
    endif
    call s__DamageTJ_onDestroy(this)
    set si__DamageTJ_V[this]=si__DamageTJ_F
    set si__DamageTJ_F=this
endfunction
//---------------------------------------------------------------------------------------------------
	
 function Boss___HaiHangTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local real x
  local real y
  local unit temp
  local integer times= IMaxBJ(1, s__MultiLife_getTimes(MLChuanzhang))
		if ( IsUnitAliveBJ(UChuanzhang) or GetUnitAbilityLevel(UChuanzhang, 'A0KH') > 0 ) then
			set x=YDWECoordinateX(GetUnitX(UChuanzhang) + GetRandomReal(- 900, 900))
			set y=YDWECoordinateY(GetUnitY(UChuanzhang) + GetRandomReal(- 900, 900))
			set temp=CreateUnit(Player(10), 'h01S', x, y, GetRandomReal(0, 360))
			call SetUnitAbilityLevel(temp, 'A0KI', udg_Nandu_JJJ)
			call UnitApplyTimedLifeBJ(2.50 * times, 'BHwe', temp)
			call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl", x, y))
		else
			call PauseTimer(t)
			call DestroyTimer(t)
		endif
		set t=null
		set temp=null
	endfunction
 function InitHanghai takes nothing returns nothing
  local timer t= CreateTimer()
		call TimerStart(t, 3, true, function Boss___HaiHangTimer)
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Boss___TimerStoneKaipaoTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local group l_group= CreateGroup()
  local unit l_unit
		call GroupEnumUnitsInRange(l_group, LoadReal(LHTable, GetHandleId(t), 1), LoadReal(LHTable, GetHandleId(t), 2), 300, null)
		loop
		    set l_unit=FirstOfGroup(l_group)
		    exitwhen l_unit == null
		    call GroupRemoveUnit(l_group, l_unit)
		    if ( IsEnemyM(l_unit , UXiaoY) ) then
		    	call UnitDamageTarget(UXiaoY, l_unit, GetUnitState(l_unit, UNIT_STATE_MAX_LIFE) * 2, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_SLOW_POISON, WEAPON_TYPE_WHOKNOWS)
		    endif
		endloop
		call DestroyGroup(l_group)
		set l_group=null
		set l_unit=null
		call PauseTimer(t)
		call FlushChildHashtable(LHTable, id)
		call DestroyTimer(t)
		set t=null
	endfunction
 function Boss___TimerStoneKaipao takes unit u returns nothing
  local timer t= CreateTimer()
		call SaveReal(LHTable, GetHandleId(t), 1, GetUnitX(u))
		call SaveReal(LHTable, GetHandleId(t), 2, GetUnitY(u))
		call DestroyEffect(AddSpecialEffect("Units\\Demon\\Infernal\\InfernalBirth.mdl", GetUnitX(u), GetUnitY(u)))
		call TimerStart(t, 1, false, function Boss___TimerStoneKaipaoTimer)
		set t=null
	endfunction
 function Boss___TimerStoneKill takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer i= 1
		if ( IsUnitAliveBJ(UXiaoY) or GetUnitAbilityLevel(UXiaoY, 'A0KH') > 0 ) then
			set Boss___ILuoshi=Boss___ILuoshi - 1
			if ( Boss___ILuoshi > 3 ) then
				set t=null
				return
			endif
			loop
				exitwhen i > 6
	            if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) and udg_H[i] != null ) then
	            	if ( Boss___ILuoshi <= 0 ) then
	            		call Boss___TimerStoneKaipao(udg_H[i])
	            	else
	    				call CreateSpellTextTag("落石:" + I2S(Boss___ILuoshi) + "s" , udg_H[i] , 100 , 0 , 0 , 2)
        				call PlaySoundBJ(gg_snd_Clock)
	            	endif
            	endif
				set i=i + 1
			endloop
        	if ( Boss___ILuoshi <= 0 ) then
				set Boss___ILuoshi=15 - NanDiff * 2
			endif
		else
			set Boss___ILuoshi=0
			call PauseTimer(t)
			call DestroyTimer(t)
		endif
		set t=null
	endfunction
 function InitTimerStoneKill takes nothing returns nothing
  local timer t= CreateTimer()
		set Boss___ILuoshi=15 - NanDiff * 2
		call TimerStart(t, 1, true, function Boss___TimerStoneKill)
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Boss___StartFashangTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local integer playerID= LoadInteger(LHTable, id, 1)
  local real value= LoadReal(LHTable, id, 2)
		call AddSpellPercent(playerID , value)
		call DisplayTextToPlayer(ConvertedPlayer(playerID), 0., 0., "|cffff0000【注意】你的法伤恢复了,可以正常使用技能了!|r")
		call DisplayTextToPlayer(ConvertedPlayer(playerID), 0., 0., "|cffff0000【注意】你的法伤恢复了,可以正常使用技能了!|r")
		call DisplayTextToPlayer(ConvertedPlayer(playerID), 0., 0., "|cffff0000【注意】你的法伤恢复了,可以正常使用技能了!|r")
		call PauseTimer(t)
		call FlushChildHashtable(LHTable, id)
		call DestroyTimer(t)
		set t=null
	endfunction
 function Boss___StartFashang takes integer playerID returns nothing
  local timer t= null
		if ( udg_I_Jinengjiacheng[playerID] <= 0 ) then
			return
		endif
		set t=CreateTimer()
		call SaveInteger(LHTable, GetHandleId(t), 1, playerID)
		call SaveReal(LHTable, GetHandleId(t), 2, 2 * udg_I_Jinengjiacheng[playerID])
		call AddSpellPercent(playerID , - 2 * udg_I_Jinengjiacheng[playerID])
		call DisplayTextToPlayer(ConvertedPlayer(playerID), 0., 0., "|cffff0000【注意】你的法伤变成了负数状态,请谨慎使用技能!|r")
		call DisplayTextToPlayer(ConvertedPlayer(playerID), 0., 0., "|cffff0000【注意】你的法伤变成了负数状态,请谨慎使用技能!|r")
		call DisplayTextToPlayer(ConvertedPlayer(playerID), 0., 0., "|cffff0000【注意】你的法伤变成了负数状态,请谨慎使用技能!|r")
		call TimerStart(t, 2 * udg_Nandu_JJJ, true, function Boss___StartFashangTimer)
		set t=null
	endfunction
 function Boss___FashangfuTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local group l_group= null
  local unit l_unit= null
    	call CreateUnitEffect(Player(11) , 'h01M' , GetUnitX(UXiaoY) , GetUnitY(UXiaoY) , 0)
		call CreateSpellTextTag("1800范围法伤皆负!" , UXiaoY , 100 , 0 , 0 , 4)
		if ( IsUnitAliveBJ(UXiaoY) or GetUnitAbilityLevel(UXiaoY, 'A0KH') > 0 ) then
			set l_group=CreateGroup()
			call GroupEnumUnitsInRange(l_group, GetUnitX(UXiaoY), GetUnitY(UXiaoY), 1800, null)
			loop
			    set l_unit=FirstOfGroup(l_group)
			    exitwhen l_unit == null
			    call GroupRemoveUnit(l_group, l_unit)
			    if ( udg_H[GetConvertedPlayerId(GetOwningPlayer(l_unit))] == l_unit ) then
			    	call Boss___StartFashang(GetConvertedPlayerId(GetOwningPlayer(l_unit)))
			    endif
			endloop
			call DestroyGroup(l_group)
			set l_group=null
			set l_unit=null
		else
			call PauseTimer(t)
			call FlushChildHashtable(spellTable, id)
			call DestroyTimer(t)
		endif
		set t=null
	endfunction
 function InitFashangfuTimer takes nothing returns nothing
  local timer t= CreateTimer()
		call TimerStart(t, 20, true, function Boss___FashangfuTimer)
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitConnectLine takes nothing returns nothing
  local integer i= 1
  local unit temp= null
		loop
			exitwhen i > 6
			if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) and udg_H[i] != null ) then
				if ( temp != null ) then
					set Boss___LLifeConnect[i - 1]=AddLightning("HWPB", true, GetUnitX(temp), GetUnitY(temp), GetUnitX(udg_H[i]), GetUnitY(udg_H[i]))
				endif
				set temp=udg_H[i]
			endif
			set i=i + 1
		endloop
		set temp=null
	endfunction
	//删除生命连结
 function DestroyConnection takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > 6
			if ( Boss___LLifeConnect[i] != null ) then
				call DestroyLightningBJ(Boss___LLifeConnect[i])
			endif
			set i=i + 1
		endloop
		call PauseTimer(TLifeConnect)
		call DestroyTimer(TLifeConnect)
		set TLifeConnect=null
		set BGongxiang=false
	endfunction
 function Boss___LifeConnectTimer takes nothing returns nothing
  local integer i= 1
  local unit temp= null
		if ( IsUnitAliveBJ(UXiaoY) or GetUnitAbilityLevel(UXiaoY, 'A0KH') > 0 ) then
			loop
				exitwhen i > 6
				if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) and udg_H[i] != null ) then
					if ( temp != null ) then
	    				call MoveLightning(Boss___LLifeConnect[i - 1], true, GetUnitX(temp), GetUnitY(temp), GetUnitX(udg_H[i]), GetUnitY(udg_H[i]))
					endif
					set temp=udg_H[i]
				endif
				set i=i + 1
			endloop
			set temp=null
		else
			call DestroyConnection()
		endif
	endfunction
	//一起死吧~
 function DieTogether takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > 6
			if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) and udg_H[i] != null and IsUnitAliveBJ(udg_H[i]) ) then
				call UnitDamageTarget(GetKillingUnitBJ(), udg_H[i], GetUnitState(udg_H[i], UNIT_STATE_MAX_LIFE) * 2, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_SLOW_POISON, WEAPON_TYPE_WHOKNOWS)
			endif
			set i=i + 1
		endloop
		call BJDebugMsg("|cFFFF66CC【消息】|r由于受到生命共享的影响,你们所有英雄受到了致死伤害.")
   set BShengming=true
	endfunction
	//开始联结之路
 function StartLifeConnect takes nothing returns nothing
		if ( udg_RENSHU < 2 ) then
			return
		endif
		set TLifeConnect=CreateTimer()
		call InitConnectLine()
		call TimerStart(TLifeConnect, 0.05, true, function Boss___LifeConnectTimer)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Boss___GetFocusTarget takes nothing returns unit
  local integer i= 1
		loop
			exitwhen i > 6
			if ( udg_H[i] != null and IsEnemyMP(udg_H[i] , Player(10)) ) then
				return udg_H[i]
			endif
			set i=i + 1
		endloop
		return null
	endfunction
    function Boss___FlashHeroLocation takes nothing returns nothing
        local timer t= GetExpiredTimer()
        local unit target= null
        if ( UGhost != null ) then
            set target=U3(Boss___GetFocusTarget() != null , Boss___GetFocusTarget() , gg_unit_haro_0030)
            call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\Blink\\BlinkTarget.mdl", GetUnitX(UGhost), GetUnitY(UGhost)))
            call SetUnitX(UGhost, GetUnitX(target))
            call SetUnitY(UGhost, GetUnitY(target))
            call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\Blink\\BlinkTarget.mdl", GetUnitX(UGhost), GetUnitY(UGhost)))
            if ( target != gg_unit_haro_0030 ) then
            	call IssueTargetOrder(UGhost, "attack", target)
            else
            	call IssuePointOrderLocBJ(UGhost, "attack", udg_Point_Fuhuo)
            endif
        else
            call PauseTimer(t)
            call DestroyTimer(t)
        endif
        set t=null
    endfunction
 function InitShunshan takes nothing returns nothing
  local timer t= CreateTimer()
		call TimerStart(t, 5, true, function Boss___FlashHeroLocation)
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Boss___GetShiyanCon takes nothing returns boolean
  local integer i= 1
  local integer count= 0
		loop
			exitwhen i > 6
			if ( YDWEUnitHasItemOfTypeBJNull(udg_H[i] , 'I05U') ) then
				set count=count + 1
			endif
			set i=i + 1
		endloop
		set count=count - I3(IsTianyan , 3 , 0)
		return GetRandomInt(1, udg_RENSHU) <= count
	endfunction
 function Boss___ShiyeLiangTimer takes nothing returns nothing
		call CinematicFadeBJ(bj_CINEFADETYPE_FADEIN, 2, "ReplaceableTextures\\CameraMasks\\Black_mask.blp", 0, 0, 0, 0)
		call PauseTimer(TGhostShiye2)
		call DestroyTimer(TGhostShiye2)
		set TGhostShiye2=null
	endfunction
 function Boss___ShiyeAnTimer takes nothing returns nothing
		if not ( Boss___GetShiyanCon() ) then
			call CinematicFadeBJ(bj_CINEFADETYPE_FADEOUT, 2, "ReplaceableTextures\\CameraMasks\\Black_mask.blp", 0, 0, 0, 0)
			set TGhostShiye2=CreateTimer()
			call TimerStart(TGhostShiye2, 7, false, function Boss___ShiyeLiangTimer)
			call BJDebugMsg("|cFFFF66CC【消息】|r天渐渐的暗了下来...")
		else
			call BJDebugMsg("|cFFFF66CC【消息】|r受到战法双魂-夕的照耀,天空保持着常亮.")
		endif
	endfunction
 function InitShiyeTimer takes nothing returns nothing
		set TGhostShiye=CreateTimer()
		call TimerStart(TGhostShiye, 27 - 2 * udg_Nandu_JJJ, true, function Boss___ShiyeAnTimer)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function TSpellGhostCon takes nothing returns boolean
	    return ( GetUnitDistance(GetEventDamageSource() , UGhost) > 1800. and ( GetEventDamage() > 100 ) )
	endfunction
 function TSpellGhostAct takes nothing returns nothing
		call SetUnitLifeBJ(UGhost, GetUnitState(UGhost, UNIT_STATE_LIFE) + GetEventDamage())
		if ( GetRandomInt(1, 5) == 1 ) then
    		call CreateSpellTextTag("1800范围外免疫！" , UGhost , 0 , 0 , 100 , 2)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Boss___AfterQuestionSucceed takes nothing returns nothing
		if ( IsUnitAliveBJ(UGhost) ) then
	    	call RecoverUnitHP(UGhost , - 0.1)
		endif
		if ( IsUnitAliveBJ(UAngle) ) then
	    	call RecoverUnitHP(UAngle , - 0.1)
		endif
   set IKongshen=IKongshen + 1
		if ( IKongshen >= 30 ) then
    call SaveAllPlayerAchievement(415)
		elseif ( ModuloInteger(IKongshen, 5) == 0 ) then
			call BJDebugMsg("|cFFFF66CC【消息】|r你们总共答对了" + I2S(IKongshen) + "道题.")
		endif
	endfunction
 function Boss___QuestionTimer takes nothing returns nothing
		call s__Questions_create(ConvertedPlayer(GetNextPlayerID()) , udg_Nandu_JJJ + 4 , 5 , (3))
	endfunction
 function InitQuestionTimer takes nothing returns nothing
		set TAngleQuestion=CreateTimer()
		call TimerStart(TAngleQuestion, 23 - 2 * udg_Nandu_JJJ, true, function Boss___QuestionTimer)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Boss___GuangmangBoom2 takes nothing returns nothing
  local integer i= 1
        call KillAreaPlayerEnemy(UAngle , GetUnitX(UAngle) , GetUnitY(UAngle) , 1000 , Player(10))
        loop
        	exitwhen i > 12
                call UnitApplyTimedLifeBJ(5, 'BHwe', CreateUnit(GetOwningPlayer(UAngle), 'h00J', GetUnitX(UAngle), GetUnitY(UAngle), i * ( 360 / 12 )))
        	set i=i + 1
        endloop
	endfunction
 function Boss___GuangmangBoom takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer i= 1
		if ( IsUnitAliveBJ(UAngle) or GetUnitAbilityLevel(UAngle, 'A0KH') > 0 ) then
			set Boss___IGuangmang=Boss___IGuangmang - 1
			if ( Boss___IGuangmang > 3 ) then
				set t=null
				return
			elseif ( Boss___IGuangmang == 3 ) then
				call UnitApplyTimedLifeBJ(3.00, 'BHwe', CreateUnit(Player(10), 'h02K', GetUnitX(UAngle), GetUnitY(UAngle), 0))
			else
				call CreateSpellTextTag("光芒:" + I2S(Boss___IGuangmang) + "s" , UAngle , 100 , 0 , 100 , 2)
			endif
			if ( Boss___IGuangmang <= 0 ) then
				set Boss___IGuangmang=15 - NanDiff * 2
				call Boss___GuangmangBoom2()
			endif
		else
			set Boss___IGuangmang=0
			call PauseTimer(t)
			call DestroyTimer(t)
		endif
		set t=null
	endfunction
 function InitGuangmang takes nothing returns nothing
  local timer t= CreateTimer()
		set Boss___IGuangmang=15 - NanDiff * 2
		call TimerStart(t, 1, true, function Boss___GuangmangBoom)
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Boss___DestroyDiduihua takes nothing returns nothing
  local integer i= 1
  local integer j= 1
		loop
			exitwhen i > 6
			if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) ) then
				set j=1
				loop
					exitwhen j > 6
					if ( i != j ) then
    					call SetPlayerAllianceStateBJ(ConvertedPlayer(i), ConvertedPlayer(j), bj_ALLIANCE_ALLIED)
					endif
					set j=j + 1
				endloop
			endif
			set i=i + 1
		endloop
	endfunction
 function InitDiduihua takes nothing returns nothing
  local integer i= 1
  local integer j= 1
		loop
			exitwhen i > 6
			if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) ) then
				set j=1
				loop
					exitwhen j > 6
					if ( i != j ) then
    					call SetPlayerAllianceStateBJ(ConvertedPlayer(i), ConvertedPlayer(j), bj_ALLIANCE_UNALLIED)
					endif
					set j=j + 1
				endloop
			endif
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ReviveDamage takes unit u returns nothing
		if ( UAngle != null ) then
			if ( not ( YDWEUnitHasItemOfTypeBJNull(u , 'I07K') or YDWEUnitHasItemOfTypeBJNull(u , 'I07J') or YDWEUnitHasItemOfTypeBJNull(u , 'I07I') ) and GetRandomInt(1, 2) == 1 and GetDiffculty() >= 6 ) then
	    		call RecoverUnitHP(u , - 1.2)
	    		call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl", GetUnitX(u), GetUnitY(u)))
				call CreateSpellTextTag("复活之火" , u , 0 , 100 , 0 , 2)
			endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
 function CycleFangKa takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local unit u= LoadUnitHandle(bossTable, id, 1)
  local real x2= GetUnitX(u)
  local real y2= GetUnitY(u)
  local real x1
  local real y1
  local real distance
  local real facing
  local integer count= 0
  local group l_group= CreateGroup()
  local unit l_unit
		if ( IsUnitAliveBJ(u) ) then
			call GroupEnumUnitsInRange(l_group, x2, y2, 900, null)
			loop
			    set l_unit=FirstOfGroup(l_group)
			    exitwhen l_unit == null
			    call GroupRemoveUnit(l_group, l_unit)
			    if ( ( IsUnitAliveBJ(l_unit) == true ) and ( GetUnitAbilityLevel(l_unit, 'Avul') < 1 ) and ( GetUnitPointValue(l_unit) != 123 ) and ( IsUnitEnemy(l_unit, Player(11)) == true ) and ( not ( IsTerrainPathable(GetUnitX(l_unit), GetUnitY(l_unit), PATHING_TYPE_WALKABILITY) ) ) ) then
			    	set count=count + 1
			    endif
			endloop
			if ( count == 0 ) then
		    	set x1=GetRectCenterX(gg_rct________1)
		    	set y1=GetRectCenterY(gg_rct________1)
		    	set distance=SquareRoot(( x1 - x2 ) * ( x1 - x2 ) + ( y1 - y2 ) * ( y1 - y2 ))
		    	if ( distance > 600 ) then
			    	set facing=Atan2BJ(y1 - y2, x1 - x2)
			    	call SetUnitX(u, YDWECoordinateX(x2 + CosBJ(facing) * 40))
			    	call SetUnitY(u, YDWECoordinateY(y2 + SinBJ(facing) * 40))
		    	endif
			endif
		else
			call PauseTimer(t)
			call DestroyTimer(t)
	    	call FlushChildHashtable(bossTable, id)
		endif
		set t=null
		set u=null
		call DestroyGroup(l_group)
		set l_group=null
		set l_unit=null
	endfunction
	
 function StartFangKa takes unit fangka returns nothing
  local timer t=CreateTimer()
	    call SaveUnitHandle(bossTable, GetHandleId(t), 1, fangka)
		call TimerStart(t, 0.1, true, function CycleFangKa)
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function TSpellZuoCon takes nothing returns boolean
	    return ( ( IsUnitAliveBJ(GetAttackedUnitBJ()) == true ) and ( IsUnitIllusionBJ(GetAttackedUnitBJ()) != true ) and ( GetRandomInt(1, 10) == 1 ) )
	endfunction
 function TSpellZuoAct takes nothing returns nothing
	    call DisableTrigger(GetTriggeringTrigger())
 		call SimulateSpell(GetAttackedUnitBJ() , GetAttacker() , 'AB00' , udg_Nandu_JJJ , 5 , "magicleash" , false , false , true)
	    call CreateSpellTextTag("死亡枷锁！" , gg_unit_Uear_0242 , 100 , 75 , 0 , 2)
	    call YDWEPolledWaitNull(4.00)
	    call EnableTrigger(GetTriggeringTrigger())
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function TSpellYouCon takes nothing returns boolean
	    return ( ( IsUnitAliveBJ(GetAttackedUnitBJ()) == true ) and ( IsUnitIllusionBJ(GetAttackedUnitBJ()) != true ) and ( GetRandomInt(1, 10) == 1 ) )
	endfunction
 function TSpellYouAct takes nothing returns nothing
	    call DisableTrigger(GetTriggeringTrigger())
 		call SimulateSpell(GetAttackedUnitBJ() , GetAttacker() , 'ANc2' , udg_Nandu_JJJ , 5 , "clusterrockets" , true , false , false)
	    call CreateSpellTextTag("异界冰封！" , gg_unit_Npld_0253 , 25 , 100 , 25 , 2)
	    call YDWEPolledWaitNull(4.00)
	    call EnableTrigger(GetTriggeringTrigger())
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function startMissile takes nothing returns nothing
		call s__Missile_create(gg_unit_Nkjx_0241 , 'hs01' , "Units\\Demon\\Infernal\\InfernalBirth.mdl" , 300 , 1800 , 3 , 1 , 1000000000)
	endfunction
 function refreshMissile takes nothing returns nothing
  local real interval
  local timer t= GetExpiredTimer()
		if ( IsUnitAliveBJ(gg_unit_Nkjx_0241) == true ) then
			set interval=( GetUnitState(gg_unit_Nkjx_0241, UNIT_STATE_LIFE) / GetUnitState(gg_unit_Nkjx_0241, UNIT_STATE_MAX_LIFE) * 0.2 ) + 0.2
			call TimerStart(Boss___TiMissile, interval, true, function startMissile)
		else
			call PauseTimer(t)
			call DestroyTimer(t)
			call PauseTimer(Boss___TiMissile)
			call DestroyTimer(Boss___TiMissile)
		endif
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitMingwang takes nothing returns nothing
  local timer refresh= CreateTimer()
		
        local integer attract= s__Attract_create(gg_unit_Nkjx_0241 , 1800 , 0.05 , 10)
        call s__Attract_start(attract)
        set DTJ1=s__DamageTJ_create(gg_unit_Nkjx_0241)
        set DTJ2=s__DamageTJ_create(gg_unit_Uear_0242)
        set DTJ3=s__DamageTJ_create(gg_unit_Npld_0253)
        //左右护法的技能
	    set Boss___TSpellZuo=CreateTrigger()
	    call TriggerRegisterUnitEvent(Boss___TSpellZuo, gg_unit_Uear_0242, EVENT_UNIT_ATTACKED)
	    call TriggerAddCondition(Boss___TSpellZuo, Condition(function TSpellZuoCon))
	    call TriggerAddAction(Boss___TSpellZuo, function TSpellZuoAct)
	    set Boss___TSpellYou=CreateTrigger()
	    call TriggerRegisterUnitEvent(Boss___TSpellYou, gg_unit_Npld_0253, EVENT_UNIT_ATTACKED)
	    call TriggerAddCondition(Boss___TSpellYou, Condition(function TSpellYouCon))
	    call TriggerAddAction(Boss___TSpellYou, function TSpellYouAct)
	    //冥刹的死亡导弹
		set Boss___TiMissile=CreateTimer()
		//开始疯狂导弹
		call TimerStart(Boss___TiMissile, 0.4, true, function startMissile)
		call TimerStart(refresh, 3, true, function refreshMissile)
		set refresh=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function DestroyMingwang takes nothing returns nothing
		call DestroyTrigger(Boss___TSpellZuo)
		call DestroyTrigger(Boss___TSpellYou)
	endfunction
//---------------------------------------------------------------------------------------------------
 function InitSaisilier takes unit u returns nothing
        local integer attract= s__Attract_create(u , 1800 , 0.05 , 14)
        call s__Attract_start(attract)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Boss___EnemyFilter takes nothing returns boolean
		return IsEnemyMP(GetFilterUnit() , Player(11))
	endfunction
    function Boss___JudgeBossAttackTimer takes nothing returns nothing
     local timer t= GetExpiredTimer()
     local integer id= GetHandleId(t)
     local unit u= LoadUnitHandle(LHTable, id, 1)
     local group l_group= CreateGroup()
    	call GroupEnumUnitsInRange(l_group, GetUnitX(u), GetUnitY(u), 900, Condition(function Boss___EnemyFilter))
    	if ( IsUnitInGroup(gg_unit_haro_0030, l_group) ) then
    		call GroupRemoveUnit(l_group, gg_unit_haro_0030)
    	endif
    	if ( IsUnitAliveBJ(u) or GetUnitAbilityLevel(u, 'A0KH') > 0 ) then
    		if ( CountUnitsInGroup(l_group) >= 1 ) then
    			call IssueTargetOrder(u, "attack", GroupPickRandomUnit(l_group))
    		else
    			call IssuePointOrderLoc(u, "attack", udg_Point_Fuhuo)
    		endif
    	else
    		call PauseTimer(t)
    		call FlushChildHashtable(LHTable, id)
    		call DestroyTimer(t)
    	endif
    	call DestroyGroup(l_group)
    	set l_group=null
    	set u=null
    	set t=null
    endfunction
//---------------------------------------------------------------------------------------------------
	
 function Boss___DaroubangJudge takes nothing returns nothing
		if ( s__MultiLife_getTimes(MLChuanzhang) > IRoubang ) then
			set IRoubang=s__MultiLife_getTimes(MLChuanzhang)
	    	call s__Roubang_create(UChuanzhang , 10 , 100 , 1.33 * IRoubang , GetRandomReal(0, 360) , 'h01T')
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Boss___TDeathGhostAngleAct takes nothing returns nothing
		if ( GetDyingUnit() == UGhost ) then
			call s__MultiLife_deallocate(MLGhost)
			call s__SuperShield_deallocate(TShieldGhost)
			call PauseTimer(TGhostShiye)
			call DestroyTimer(TGhostShiye)
			set TGhostShiye=null
			call DestroyTrigger(TSpellGhost)
			set UGhost=null
		endif
		if ( GetDyingUnit() == UAngle ) then
			call s__MultiLife_deallocate(MLAngle)
			call s__SuperShield_deallocate(TShieldAngle)
			call PauseTimer(TAngleQuestion)
			call DestroyTimer(TAngleQuestion)
			set TAngleQuestion=null
			set Boss___IGuangmang=0
			call Boss___DestroyDiduihua()
			set UAngle=null
		endif
		if ( not ( IsUnitAliveBJ(UGhost) ) and GetUnitAbilityLevel(UGhost, 'A0KH') < 1 and not ( IsUnitAliveBJ(UAngle) ) and GetUnitAbilityLevel(UAngle, 'A0KH') < 1 ) then
		    call PauseTimer(udg_Time_BOSS)
		    call DestroyTimer(udg_Time_BOSS)
	    	call DestroyTimerDialog(udg_Timer_BOSS)
			call CinematicModeBJ(true, GetPlayersAll())
		    call TransmissionFromUnitWithNameBJ(GetPlayersAll(), udg_H[GetConvertedPlayerId(GetFirstPlayer())], GetUnitName(udg_H[GetConvertedPlayerId(GetFirstPlayer())]), null, "看似这场战争暂时性的结束了...不过看似这背后并不简单?", bj_TIMETYPE_ADD, 2.00, true)
		    call YDWEPolledWaitNull(2.00)
		    call TransmissionFromUnitWithNameBJ(GetPlayersAll(), udg_H[GetConvertedPlayerId(GetFirstPlayer())], GetUnitName(udg_H[GetConvertedPlayerId(GetFirstPlayer())]), null, "游戏将在60秒后结束...", bj_TIMETYPE_ADD, 2.00, true)
		    call YDWEPolledWaitNull(2.00)
	        call s__DamageTJ_show(DTJ1)
	        call s__DamageTJ_show(DTJ2)
	        set DTJ1=0
	        set DTJ2=0
		    call PrintMengjiPassword()
		    call PrintMengjiPassword()
		    call PrintMengjiPassword()
		    call PrintMengjiPassword()
		    call PrintCanglingPassword()
		    call PrintCanglingPassword()
		    call PrintCanglingPassword()
		    call PrintCanglingPassword()
		    call PrintXinglongPassword()
		    call PrintXinglongPassword()
		    call PrintXinglongPassword()
		    call PrintXinglongPassword()
		    call PrintXiaotingPassword()
		    call PrintXiaotingPassword()
		    call PrintXiaotingPassword()
		    call PrintXiaotingPassword()
       call SaveAchievementKuilei2()
		    ////debug call CreateAllYuebing()
		    call CinematicModeBJ(false, GetPlayersAll())
		    call YDWEPolledWaitNull(60.00)
		    call ForForce(GetPlayersAll(), function ShengliAll)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Boss___AfterBossLessLife takes unit u returns nothing
		if ( u == UGhost ) then
			call s__SuperShield_deallocate(TShieldGhost)
	        set TShieldGhost=s__SuperShield_create(UGhost , 1)
	        call s__SuperShield_SetDeathContinue(TShieldGhost)
		elseif ( u == UAngle ) then
			call s__SuperShield_deallocate(TShieldAngle)
	        set TShieldAngle=s__SuperShield_create(UAngle , 1)
	        call s__SuperShield_SetDeathContinue(TShieldAngle)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Boss___InitGhostAngle takes nothing returns nothing
  local timer t= null
		call ShowGameHintAll("\n		    |cffffff00上路BOSS(鬼王傀儡) 技能:|r\n	        4次生命,1段无敌\n	        瞬闪攻击\n	        视野无效化\n	        圈外免疫\n	        百分比攻击\n	        |cff00ccff下路BOSS(仙王傀儡) 技能:|r\n	        4次生命,1段无敌\n	        数学提问(回答错误会扣防护罩)\n	        光芒万丈(读秒预判)\n	        英雄敌队化(各自为战)\n	        复活之火(复活后的伤害)\n	        |cffff0000BOSS正式进攻!|r")
		//call PolledWait(10)
		set UGhost=CreateUnit(Player(11), 'N02B', GetRectCenterX(gg_rct________3), GetRectCenterY(gg_rct________3), 90)
		set UAngle=CreateUnit(Player(11), 'N02C', GetRectCenterX(gg_rct________6), GetRectCenterY(gg_rct________6), 270)
		//多条命
		set MLGhost=s__MultiLife_create(UGhost , I3(renshu == 1 or GetDiffculty() < 5 , 2 , I3(IsWanjie() , 4 , 3)))
		set MLAngle=s__MultiLife_create(UAngle , I3(renshu == 1 or GetDiffculty() < 5 , 2 , I3(IsWanjie() , 4 , 3)))
		call s__MultiLife_setAL(MLGhost,(1))
		call s__MultiLife_setAL(MLAngle,(1))
        set TShieldGhost=s__SuperShield_create(UGhost , 1)
        call s__SuperShield_SetDeathContinue(TShieldGhost)
        set TShieldAngle=s__SuperShield_create(UAngle , 1)
        call s__SuperShield_SetDeathContinue(TShieldAngle)
		call SetUnitAbilityLevel(UAngle, 'A0AG', udg_Nandu_JJJ)
		call SetUnitAbilityLevel(UGhost, 'A0AG', udg_Nandu_JJJ)
		call StartFangKa(UGhost)
		call StartFangKa(UAngle)
	    call PauseTimer(TiGhostAngle)
	    call DestroyTimer(TiGhostAngle)
    	call DestroyTimerDialog(TiDiaGhostAngle)
        set DTJ1=s__DamageTJ_create(UAngle)
        set DTJ2=s__DamageTJ_create(UGhost)
        set udg_Time_BOSS=CreateTimer()
	    call StartTimerBJ(udg_Time_BOSS, false, 1200.00)
	    call CreateTimerDialogBJ(udg_Time_BOSS, "限时击杀时间")
	    set udg_Timer_BOSS=GetLastCreatedTimerDialogBJ()
	    call TimerDialogDisplayBJ(true, udg_Timer_BOSS)
	    if ( not ( CT7() ) ) then
		    set t=CreateTimer()
		    call SaveUnitHandle(LHTable, GetHandleId(t), 1, UAngle)
		    call TimerStart(t, 1, true, function Boss___JudgeBossAttackTimer)
		    set t=CreateTimer()
		    call SaveUnitHandle(LHTable, GetHandleId(t), 1, UGhost)
		    call TimerStart(t, 1, true, function Boss___JudgeBossAttackTimer)
		    set t=null
		else
			call BossAddOnlyAttack(UAngle)
			call BossAddOnlyAttack(UGhost)
	    endif
	    //鬼王技能
		call InitShiyeTimer()
		set TSpellGhost=CreateTrigger()
		call TriggerRegisterUnitEvent(TSpellGhost, UGhost, EVENT_UNIT_DAMAGED)
		call TriggerAddCondition(TSpellGhost, Condition(function TSpellGhostCon))
		call TriggerAddAction(TSpellGhost, function TSpellGhostAct)
		if ( GetDiffculty() >= 6 ) then
			call InitShunshan()
		endif
	    //仙帝技能
		call InitQuestionTimer()
		call InitGuangmang()
	    if ( GetDiffculty() >= 6 ) then
	    	call InitDiduihua()
	    endif
    	set TDeathGhostAngle=CreateTrigger()
    	call TriggerAddAction(TDeathGhostAngle, function Boss___TDeathGhostAngleAct)
    	call TriggerRegisterUnitEvent(TDeathGhostAngle, UGhost, EVENT_UNIT_DEATH)
    	call TriggerRegisterUnitEvent(TDeathGhostAngle, UAngle, EVENT_UNIT_DEATH)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function StartGhostAngleTimer takes nothing returns nothing
        set TiGhostAngle=CreateTimer()
        set TiDiaGhostAngle=CreateTimerDialogBJ(TiGhostAngle, "六界傀儡2")
	    call PauseTimer(udg_Double_M[1])
	    call DestroyTimer(udg_Double_M[1])
    	call DestroyTimerDialog(udg_Double_Me)
        call TimerStart(TiGhostAngle, GetWangSpeed(), false, function Boss___InitGhostAngle)
        call TimerDialogDisplay(TiDiaGhostAngle, true)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Boss___TDeathRenyaoAct takes nothing returns nothing
		if ( GetDyingUnit() == UXiaoY ) then
			call DestroyConnection()
		endif
		if ( GetDyingUnit() == UChuanzhang ) then
		    call s__TianfuForbidder_deallocate(TFChuan)
		    call PauseTimer(TRBChuan)
		    call DestroyTimer(TRBChuan)
		endif
		if ( not ( IsUnitAliveBJ(UXiaoY) ) and GetUnitAbilityLevel(UXiaoY, 'A0KH') < 1 and not ( IsUnitAliveBJ(UChuanzhang) ) and GetUnitAbilityLevel(UChuanzhang, 'A0KH') < 1 ) then
		    call PauseTimer(udg_Time_BOSS)
		    call DestroyTimer(udg_Time_BOSS)
	    	call DestroyTimerDialog(udg_Timer_BOSS)
			//call CinematicModeBJ( true, GetPlayersAll() )
		    //call TransmissionFromUnitWithNameBJ( GetPlayersAll(), udg_H[GetConvertedPlayerId(GetFirstPlayer())], GetUnitName(udg_H[GetConvertedPlayerId(GetFirstPlayer())]), null, "看似这场战争暂时性的结束了...不过看似这背后并不简单?", bj_TIMETYPE_ADD, 2.00, true )
		   // call PolledWait(2.00)
		   // call TransmissionFromUnitWithNameBJ( GetPlayersAll(), udg_H[GetConvertedPlayerId(GetFirstPlayer())], GetUnitName(udg_H[GetConvertedPlayerId(GetFirstPlayer())]), null, "游戏将在60秒后结束...", bj_TIMETYPE_ADD, 2.00, true )
       call SaveAchievement()
		    //call PolledWait(2.00)
	        call s__DamageTJ_show(DTJ1)
	        call s__DamageTJ_show(DTJ2)
	        set DTJ1=0
	        set DTJ2=0
       call SaveAchievementKuilei1()
		    //call CinematicModeBJ( false, GetPlayersAll() )
		    //debug call CreateAllYuebing()
		    call StartGhostAngleTimer()
		    call BJDebugMsg("|cffff0000【注意】第二波傀儡将于7分钟后进攻!|r")
		    call BJDebugMsg("|cffff0000【注意】第二波傀儡将于7分钟后进攻!|r")
		    call BJDebugMsg("|cffff0000【注意】第二波傀儡将于7分钟后进攻!|r")
		    call BJDebugMsg("|cffff0000【注意】第二波傀儡将于7分钟后进攻!|r")
		    call BJDebugMsg("|cffff0000【注意】第二波傀儡将于7分钟后进攻!|r")
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Boss___InitRenYao takes nothing returns nothing
  local timer t= null
		call ShowGameHintAll("\n		    |cffffff00上路BOSS(人王傀儡) 技能:|r\n	        3次生命\n	        火焰之棒(每死一次多一条棒,速度更快,注意躲开)\n	        航海领域(眩晕攻击)\n	        天赋禁用(周期性技能)\n	        |cff00ccff下路BOSS(妖王傀儡) 技能:|r\n	        3次生命\n	        生命共享(任一队友死亡则全队死亡)\n	        法伤变负(周期性技能,范围有效)\n	        陨石坠落(注意倒计时!)\n	        |cffff0000BOSS正式进攻!|r")
		//call PolledWait(10)
		set UXiaoY=CreateUnit(Player(11), 'N01O', GetRectCenterX(gg_rct________6), GetRectCenterY(gg_rct________6), 90)
		set UChuanzhang=CreateUnit(Player(11), 'N01P', GetRectCenterX(gg_rct________3), GetRectCenterY(gg_rct________3), 270)
		//多条命
		set MLChuanzhang=s__MultiLife_create(UChuanzhang , I3(renshu == 1 or GetDiffculty() < 5 , 1 , I3(IsWanjie() , 3 , 2)))
		set MLXiaoY=s__MultiLife_create(UXiaoY , I3(renshu == 1 or GetDiffculty() < 5 , 1 , I3(IsWanjie() , 3 , 2)))
		call SetUnitAbilityLevel(UXiaoY, 'A0AG', udg_Nandu_JJJ)
		call SetUnitAbilityLevel(UChuanzhang, 'A0AG', udg_Nandu_JJJ)
		call StartFangKa(UXiaoY)
		call StartFangKa(UChuanzhang)
	    call PauseTimer(TiRenYao)
	    call DestroyTimer(TiRenYao)
    	call DestroyTimerDialog(TiDiaRenYao)
        set DTJ1=s__DamageTJ_create(UXiaoY)
        set DTJ2=s__DamageTJ_create(UChuanzhang)
	    call StartTimerBJ(udg_Time_BOSS, false, 1200.00)
	    call CreateTimerDialogBJ(udg_Time_BOSS, "限时击杀时间")
	    set udg_Timer_BOSS=GetLastCreatedTimerDialogBJ()
	    call TimerDialogDisplayBJ(true, udg_Timer_BOSS)
	    if ( not ( CT7() ) ) then
		    set t=CreateTimer()
		    call SaveUnitHandle(LHTable, GetHandleId(t), 1, UXiaoY)
		    call TimerStart(t, 1, true, function Boss___JudgeBossAttackTimer)
		    set t=CreateTimer()
		    call SaveUnitHandle(LHTable, GetHandleId(t), 1, UChuanzhang)
		    call TimerStart(t, 1, true, function Boss___JudgeBossAttackTimer)
		    set t=null
		else
			call BossAddOnlyAttack(UXiaoY)
			call BossAddOnlyAttack(UChuanzhang)
	    endif
	    //小Y技能
	    call InitFashangfuTimer()
	    if ( GetDiffculty() >= 6 ) then
	   		call InitTimerStoneKill()
	    endif
	    call StartLifeConnect()
	    //船长技能
	    call InitHanghai()
	    set TFChuan=s__TianfuForbidder_create(UChuanzhang , GetForbidTianfuTime() , 10. - GetForbidTianfuTime())
	    set TRBChuan=CreateTimer()
	    call TimerStart(TRBChuan, 1, true, function Boss___DaroubangJudge)
    	set Boss___TDeathRenyao=CreateTrigger()
    	call TriggerAddAction(Boss___TDeathRenyao, function Boss___TDeathRenyaoAct)
    	call TriggerRegisterUnitEvent(Boss___TDeathRenyao, UXiaoY, EVENT_UNIT_DEATH)
    	call TriggerRegisterUnitEvent(Boss___TDeathRenyao, UChuanzhang, EVENT_UNIT_DEATH)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function StartRenYaoTimer takes nothing returns nothing
        set TiRenYao=CreateTimer()
        set TiDiaRenYao=CreateTimerDialogBJ(TiRenYao, "六界傀儡1")
	    call PauseTimer(udg_Double_M[1])
	    call DestroyTimer(udg_Double_M[1])
    	call DestroyTimerDialog(udg_Double_Me)
        call TimerStart(TiRenYao, GetWangSpeed(), false, function Boss___InitRenYao)
        call TimerDialogDisplay(TiDiaRenYao, true)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SimulateDamageBoss takes unit u returns boolean
		if ( GetUnitTypeId(u) == 'h01S' ) then
			call DisableTrigger(GetTriggeringTrigger())
			if ( IsUnitType(GetTriggerUnit(), UNIT_TYPE_MAGIC_IMMUNE) and playerName[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] != "信哲大人" ) then
				call UnitDamageTarget(u, GetTriggerUnit(), GetUnitState(GetTriggerUnit(), UNIT_STATE_MAX_LIFE) * 2, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_SLOW_POISON, WEAPON_TYPE_WHOKNOWS)
			endif
			call EnableTrigger(GetTriggeringTrigger())
			return true
		endif
		if ( GetUnitTypeId(u) == 'h01T' and IsUnitAliveBJ(UChuanzhang) and IsUnitDeadBJ(GetTriggerUnit()) ) then
			call RecoverUnitHP(UChuanzhang , 0.005)
			return true
		endif
		return false
	endfunction
//---------------------------------------------------------------------------------------------------
 function Boss___InitBoss takes nothing returns nothing
		set bossTable=InitHashtable()
	endfunction

//library Boss ends
//library PIV:
//---------------------------------------------------------------------------------------------------
	
 function PIV___XinzheCon takes nothing returns boolean
		return ( GetIssuedOrderIdBJ() == String2OrderIdBJ("smart") )
	endfunction
 function PIV___XinzheAct takes nothing returns nothing
		if ( IsInForbitRegion(GetOrderPointX() , GetOrderPointY() , GetTriggerUnit()) ) then
			call IssueImmediateOrder(GetTriggerUnit(), "stop")
	        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, "|cFFFF66CC【消息】|r此处禁止瞬移到达.")
	        return
		endif
		call SetUnitX(GetTriggerUnit(), GetOrderPointX())
		call SetUnitY(GetTriggerUnit(), GetOrderPointY())
		if ( BX1 ) then
			call DamageArea(GetTriggerUnit() , GetUnitX(GetTriggerUnit()) , GetUnitY(GetTriggerUnit()) , 600 , GetDamageBase(GetTriggerUnit()) * 0.8)
		endif
	endfunction
 function InitXinzhe takes unit u returns nothing
  local trigger t= CreateTrigger()
    	call TriggerRegisterUnitEvent(t, u, EVENT_UNIT_ISSUED_POINT_ORDER)
		call TriggerAddCondition(t, Condition(function PIV___XinzheCon))
		call TriggerAddAction(t, function PIV___XinzheAct)
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function PIV___JingjuCondition takes nothing returns boolean
		return GetUnitTypeId(GetFilterUnit()) == 'n006' or GetUnitTypeId(GetFilterUnit()) == 'n00Y'
	endfunction
 function PIV___JingjuDiyuhuo takes nothing returns nothing
		call RecoverUnitHP(GetEnumUnit() , 0.3)
	endfunction
 function PIV___JingjuTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local unit u= LoadUnitHandle(LHTable, id, 1)
  local group g= YDWEGetUnitsOfPlayerMatchingNull(GetOwningPlayer(u) , Condition(function PIV___JingjuCondition))
		call RecoverUnitHP(u , 0.1)
		call ForGroupBJ(g, function PIV___JingjuDiyuhuo)
		set u=null
		call DestroyGroup(g)
		set t=null
		set g=null
	endfunction
 function InitJingju takes unit u returns nothing
  local timer t= CreateTimer()
		call SaveUnitHandle(LHTable, GetHandleId(t), 1, u)
		call TimerStart(t, 1, true, function PIV___JingjuTimer)
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function PIV___TableHas takes integer i returns boolean
		return HaveSavedBoolean(PIV___PIVTable, kPIV, i)
	endfunction
//---------------------------------------------------------------------------------------------------
    
    function PIV___GetPIVCode takes string s returns integer
        local string result= s
        local integer i= 1
        loop
            exitwhen i > 6
            set result=I2S(StringHash(result))
            set i=i + 1
        endloop
        return S2I(SubStringBJ(result, 2, StringLength(result)))
    endfunction
//---------------------------------------------------------------------------------------------------
	
 function PIV___InitPlayerPIV takes player p returns nothing
		if ( PIV___isFirst ) then
			set PIV___isFirst=false
			set udg_I_Er_diansi[1]=udg_I_Er_diansi[1] + 2
			call BJDebugMsg("|cFFFF66CC【消息】|r你们已激活在任意难度下获得24+5+2波的特权.")
			call BJDebugMsg("|cFFFF66CC【消息】|r基地获得了额外的2次防护罩.")
		endif
		set sPIV[GetConvertedPlayerId(p)]=true
		call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r激活成功,你已经获得永久赞助特权，如果要关闭赞助功能,请输入-zz")
   call SavePIV(p , PIV___GetPIVCode(GetPlayerName(p)))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function PIV___InitDingzhi takes unit u returns nothing
		if ( playerName[GetConvertedPlayerId(GetOwningPlayer(u))] == "无心使者" ) then
			call UnitAddItemByIdSwapped('IXU1', u)
	        call SaveInteger(YDHT, GetHandleId(GetLastCreatedItem()), 0xA75AD423, GetConvertedPlayerId(GetOwningPlayer(u)))
			call UnitAddItemByIdSwapped('IXU1', u)
	        call SaveInteger(YDHT, GetHandleId(GetLastCreatedItem()), 0xA75AD423, GetConvertedPlayerId(GetOwningPlayer(u)))
	        call AddMoneyPercent(GetConvertedPlayerId(GetOwningPlayer(u)) , 5)
	        call AddMoneyPercent(GetConvertedPlayerId(GetOwningPlayer(u)) , 5)
	        call AddHPPercent(GetConvertedPlayerId(GetOwningPlayer(u)) , 2.0)
	        call AddIntPercent(GetConvertedPlayerId(GetOwningPlayer(u)) , 0.7)
	        call AddAgiPercent(GetConvertedPlayerId(GetOwningPlayer(u)) , 0.7)
	        call AddStrPercent(GetConvertedPlayerId(GetOwningPlayer(u)) , 0.7)
    		call SetPlayerTechResearchedSwap('R01K', 1, GetOwningPlayer(u))
    		call SetPlayerTechResearchedSwap('R006', 1, GetOwningPlayer(u))
    		call SetPlayerTechResearchedSwap('R007', 1, GetOwningPlayer(u))
    		call SetPlayerTechResearchedSwap('R008', 1, GetOwningPlayer(u))
    		call SetPlayerTechResearchedSwap('R009', 1, GetOwningPlayer(u))
    		call SetPlayerTechResearchedSwap('R00A', 1, GetOwningPlayer(u))
    		call SetPlayerTechResearchedSwap('R00B', 1, GetOwningPlayer(u))
			call InitJingju(u)
	    	set udg_I_Jingyan[GetConvertedPlayerId(GetOwningPlayer(u))]=udg_I_Jingyan[GetConvertedPlayerId(GetOwningPlayer(u))] + 2.5
			call SetPlayerStateBJ(GetOwningPlayer(u), PLAYER_STATE_RESOURCE_FOOD_CAP, ( GetPlayerState(GetOwningPlayer(u), PLAYER_STATE_RESOURCE_FOOD_CAP) + 10 ))
		elseif ( playerName[GetConvertedPlayerId(GetOwningPlayer(u))] == "信哲大人" ) then
			set BGoldGongxiang[GetConvertedPlayerId(GetOwningPlayer(u))]=true
	        call AddMoneyPercent(GetConvertedPlayerId(GetOwningPlayer(u)) , 1.5)
	        call AddIntPercent(GetConvertedPlayerId(GetOwningPlayer(u)) , 1.5)
	        call AddAgiPercent(GetConvertedPlayerId(GetOwningPlayer(u)) , 1.5)
	        call AddStrPercent(GetConvertedPlayerId(GetOwningPlayer(u)) , 1.5)
	        call AddSpellPercent(GetConvertedPlayerId(GetOwningPlayer(u)) , 4.)
	        call UnitAddAbility(u, 'A0MF')
            call UnitMakeAbilityPermanent(u, true, 'A0MF')
            call UnitMakeAbilityPermanent(u, true, 'A0MG')
			call SetPlayerAbilityAvailable(GetOwningPlayer(u), 'A0MF', false)
			call InitXinzhe(u)
		endif
	endfunction
 function InitPIVHero takes unit u returns nothing
   call PIV___InitDingzhi(u)
		if ( IsPIV(GetOwningPlayer(u)) ) then
			call UnitAddItemByIdSwapped('IXU1', u)
	        call SaveInteger(YDHT, GetHandleId(GetLastCreatedItem()), 0xA75AD423, GetConvertedPlayerId(GetOwningPlayer(u)))
			call AdjustPlayerStateBJ(8000, GetOwningPlayer(u), PLAYER_STATE_RESOURCE_GOLD)
			call Discolor(u)
			return
		endif
		if ( ( not ( IsPIV(GetOwningPlayer(u)) ) ) and IsColorSpin(GetOwningPlayer(u)) ) then
			call Discolor(u)
		endif
   call GetPlatformLevelGold(GetOwningPlayer(u))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CertificatePIV takes player p,string vCode returns nothing
		if ( vCode == null and PIV___TableHas(PIV___GetPIVCode(GetPlayerName(p))) ) then
			call PIV___InitPlayerPIV(p)
			return
		endif
		if ( I2S(PIV___GetPIVCode(GetPlayerName(p))) == vCode ) then
			call PIV___InitPlayerPIV(p)
			return
		endif
		if ( vCode != null ) then
			call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r激活码不正确！")
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
    function ChatPIV takes nothing returns nothing
        local string chat= GetEventPlayerChatString()
        local string vCode= SubStringBJ(chat, 2, StringLength(chat))
		call CertificatePIV(GetTriggerPlayer() , vCode)
    endfunction
//---------------------------------------------------------------------------------------------------
	
 function PIV___PIVDialogClick takes nothing returns nothing
     local dialog d= GetClickedDialogBJ()
     local integer i= 0
     local string s= LoadStr(PIV___PIVTable, GetHandleId(d), kPIVStr)
     local player p= LoadPlayerHandle(PIV___PIVTable, GetHandleId(d), kPIVPlayer)
	    //验证
	    if ( GetClickedButtonBJ() == LoadButtonHandle(PIV___PIVTable, GetHandleId(d), 10) ) then
	        call CertificatePIV(p , s)
	        call FlushChildHashtable(PIV___PIVTable, GetHandleId(d))
        	call DialogDisplay(p, d, false)
	        call DialogClear(d)
	        call DialogDestroy(d)
	        set d=null
	        set s=null
	        set p=null
	        call DestroyTrigger(GetTriggeringTrigger())
	        return
	    endif
	    //输入
	    loop
	        exitwhen i > 9
	        if ( GetClickedButtonBJ() == LoadButtonHandle(PIV___PIVTable, GetHandleId(d), i) ) then
	            set s=s + I2S(i)
	            call SaveStr(PIV___PIVTable, GetHandleId(d), kPIVStr, s)
	            exitwhen true
	        endif
	        set i=i + 1
	    endloop
	    call DialogSetMessage(d, "激活码:" + s)
        call DialogDisplay(p, d, true)
	    set d=null
	    set s=null
	    set p=null
	endfunction
 function CreatePIVDialog takes nothing returns nothing
     local trigger t
     local dialog d
		if ( IsPIV(GetTriggerPlayer()) ) then
			call DisplayTextToPlayer(GetTriggerPlayer(), 0., 0., "|cFFFF66CC【消息】|r你已激活了永久赞助权限,无须重复激活！")
			return
		endif
		if ( udg_H[GetConvertedPlayerId(GetTriggerPlayer())] != null ) then
			call DisplayTextToPlayer(GetTriggerPlayer(), 0., 0., "|cFFFF66CC【消息】|r激活失败,请在选择英雄前激活！")
			return
		endif
	    set t=CreateTrigger()
	    set d=DialogCreate()
	    call DialogSetMessage(d, "请从第1位开始依次输入激活码")
	    call SaveButtonHandle(PIV___PIVTable, GetHandleId(d), 0, DialogAddButton(d, "0", '0'))
	    call SaveButtonHandle(PIV___PIVTable, GetHandleId(d), 1, DialogAddButton(d, "1", '1'))
	    call SaveButtonHandle(PIV___PIVTable, GetHandleId(d), 2, DialogAddButton(d, "2", '2'))
	    call SaveButtonHandle(PIV___PIVTable, GetHandleId(d), 3, DialogAddButton(d, "3", '3'))
	    call SaveButtonHandle(PIV___PIVTable, GetHandleId(d), 4, DialogAddButton(d, "4", '4'))
	    call SaveButtonHandle(PIV___PIVTable, GetHandleId(d), 5, DialogAddButton(d, "5", '5'))
	    call SaveButtonHandle(PIV___PIVTable, GetHandleId(d), 6, DialogAddButton(d, "6", '6'))
	    call SaveButtonHandle(PIV___PIVTable, GetHandleId(d), 7, DialogAddButton(d, "7", '7'))
	    call SaveButtonHandle(PIV___PIVTable, GetHandleId(d), 8, DialogAddButton(d, "8", '8'))
	    call SaveButtonHandle(PIV___PIVTable, GetHandleId(d), 9, DialogAddButton(d, "9", '9'))
	    call SaveButtonHandle(PIV___PIVTable, GetHandleId(d), 10, DialogAddButton(d, "输入完毕|cffff6800(Esc)|r", 512))
	    call SaveStr(PIV___PIVTable, GetHandleId(d), kPIVStr, "")
	    call SavePlayerHandle(PIV___PIVTable, GetHandleId(d), kPIVPlayer, GetTriggerPlayer())
	    call SaveInteger(PIV___PIVTable, GetHandleId(d), kPIVPointer, 1)
	    call DialogDisplay(GetTriggerPlayer(), d, true)
	    call TriggerRegisterDialogEvent(t, d)
	    call TriggerAddAction(t, function PIV___PIVDialogClick)
	    set d=null
	    set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Qskc_GetL takes player l100,string str,integer l10O,integer l1O0 returns boolean
  local integer OO11=0
  local integer lI0O=0
  local integer l0O1=0
  local integer O011=0
  local integer llO0=0
  local integer ll0O= 0
  local integer O01l= 0
  local string OOll=SubStringBJ(str, 11, 9999)
  local string OOl1=SubStringBJ(str, 1, 10)
  local integer llOO=StringLength(OOll) - 2
  local integer O0l1=IAbsBJ(StringHash(GetPlayerName(l100)))
		set ll0O=StringHash(OOll)
		set ll0O=ll0O + StringHash(I2S(StringLength(OOll)))
		loop
		exitwhen llO0 >= StringLength(OOll)
		set ll0O=ll0O + StringHash(SubString(OOll, llO0, llO0 + 1))
		set O01l=S2I(SubStringBJ(R2S(IAbsBJ(ll0O)), 1, 2)) + S2I(SubStringBJ(R2S(IAbsBJ(ll0O)), 3, 4))
		set llO0=llO0 + 1
		endloop
		if StringLength(str) < 90 then
		return false
		endif
		loop
		exitwhen O011 >= O01l
		set O0l1=IAbsBJ(StringHash(I2S(O0l1)))
		set O011=O011 + 1
		endloop
		if O0l1 < $3B9ACA00 then
		set O0l1=O0l1 + $3B9ACA00
		endif
		loop
		exitwhen OO11 > llOO
		set lI0O=lI0O + StringHash(SubString(OOll, OO11, OO11 + 2)) + StringHash(I2S(l0O1))
		set l0O1=l0O1 + StringHash(I2S(lI0O)) - StringHash(SubString(OOll, OO11, OO11 + 2))
		set OO11=OO11 + 1
		endloop
		return lI0O == l10O and l0O1 == l1O0 and I2S(O0l1) == OOl1
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Fgetc_GetL takes player l1000,string l1OOO,integer l10OO,integer l1O00 returns boolean
  local integer OO111=0
  local integer lI0OO=0
  local integer l0O11=0
  local integer O0111=0
  local integer llO00=0
  local integer ll0OO=0
  local integer O01ll=0
  local integer O10ll=0
  local integer O1l0l=0
  local integer llOOO=0
  local string lllOO= ""
  local string ll1OO= ""
  local string array l1lOO
  local integer O0l11=IAbsBJ(StringHash(GetPlayerName(l1000)))
  local integer l11O0=IAbsBJ(StringHash(GetPlayerName(l1000)))
  local string OOl11=SubStringBJ(l1OOO, 1, 10)
  local string OOlll=SubStringBJ(l1OOO, 11, 9999)
		set l1lOO[0]=SubStringBJ(OOlll, 1, 3)
		set l1lOO[1]=SubStringBJ(OOlll, 9, 11)
		set l1lOO[2]=SubStringBJ(OOlll, 16, 19)
		set l1lOO[3]=SubStringBJ(OOlll, 4, 8)
		set l1lOO[4]=SubStringBJ(OOlll, 12, 15)
		set l1lOO[5]=SubStringBJ(OOlll, 20, 999)
		set lllOO=l1lOO[0] + l1lOO[1] + l1lOO[2]
		set ll1OO=l1lOO[3] + l1lOO[4] + l1lOO[5]
		set llOOO=StringLength(ll1OO) - 2
		set ll0OO=StringHash(ll1OO)
		set ll0OO=ll0OO + StringHash(I2S(StringLength(ll1OO)))
		loop
		exitwhen llO00 >= StringLength(ll1OO)
		set ll0OO=ll0OO + StringHash(SubString(ll1OO, llO00, llO00 + 1))
		set O01ll=S2I(SubStringBJ(I2S(IAbsBJ(ll0OO)), 1, 2)) + S2I(SubStringBJ(I2S(IAbsBJ(ll0OO)), 3, 4))
		set O10ll=S2I(SubStringBJ(I2S(IAbsBJ(ll0OO)), 4, 5)) + S2I(SubStringBJ(I2S(IAbsBJ(ll0OO)), 6, 7))
		set llO00=llO00 + 1
		endloop
		loop
		exitwhen O0111 >= O01ll
		set O0l11=IAbsBJ(StringHash(I2S(O0l11)) + $77359400)
		set O0111=O0111 + 1
		endloop
		loop
		exitwhen O1l0l >= O10ll
		set l11O0=IAbsBJ(StringHash(I2S(l11O0)) + $77359400)
		set O1l0l=O1l0l + 1
		endloop
		if O0l11 < $3B9ACA00 then
		set O0l11=O0l11 + $3B9ACA00
		endif
		if l11O0 < $3B9ACA00 then
		set l11O0=l11O0 + $3B9ACA00
		endif
		loop
		exitwhen OO111 > llOOO
		set lI0OO=lI0OO + StringHash(SubString(ll1OO, OO111, OO111 + 2)) + StringHash(I2S(l0O11))
		set l0O11=l0O11 + StringHash(I2S(lI0OO)) - StringHash(SubString(ll1OO, OO111, OO111 + 2))
		set OO111=OO111 + 1
		endloop
		return lI0OO == l10OO and l0O11 == l1O00 and I2S(O0l11) == OOl11 and I2S(l11O0) == lllOO
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function PIV___Verify17Wanba takes nothing returns nothing
	    if ( ( Qskc_GetL(GetTriggerPlayer() , GetEventPlayerChatString() , - 117135511 , 628755061) ) or Fgetc_GetL(GetTriggerPlayer() , GetEventPlayerChatString() , - 1139053518 , 43777771) ) then
		    if ( IsPIV(GetTriggerPlayer()) ) then
				call DisplayTextToPlayer(GetTriggerPlayer(), 0., 0., "|cFFFF66CC【消息】|r你已激活了永久赞助权限,无须重复激活！")
				return
			endif
			if ( udg_H[GetConvertedPlayerId(GetTriggerPlayer())] != null ) then
				call DisplayTextToPlayer(GetTriggerPlayer(), 0., 0., "|cFFFF66CC【消息】|r激活失败,请在选择英雄前激活！")
				return
			endif
			call PIV___InitPlayerPIV(GetTriggerPlayer())
		elseif ( ( Fgetc_GetL(GetTriggerPlayer() , GetEventPlayerChatString() , - 767946655 , - 1650132445) ) ) then
			if not ( true ) then
				call BJDebugMsg("|cFFFF66CC【消息】|r你已激活了所有皮肤使用权限！")
				call ActivateAllSpin(GetTriggerPlayer())
			else
				call BJDebugMsg("|cFFFF66CC【消息】|rspin.")
			endif
    call SetSeyuSpinOK(GetTriggerPlayer())
    call SetXiaoyueSpinOK(GetTriggerPlayer())
    call SetYanmieSpinOK(GetTriggerPlayer())
    call SetXuanxue1SpinOK(GetTriggerPlayer())
    call SetTaiyaSpinOK(GetTriggerPlayer())
    call SetChenji1SpinOK(GetTriggerPlayer())
    call SetHanshang1SpinOK(GetTriggerPlayer())
    call SetLingxueSpinOK(GetTriggerPlayer())
    call SetChenji2SpinOK(GetTriggerPlayer())
    call SetMoqiSpinOK(GetTriggerPlayer())
    call SetKaisaSpinOK(GetTriggerPlayer())
    call SetXuanxue2SpinOK(GetTriggerPlayer())
    call SetBajueSpinOK(GetTriggerPlayer())
    call SetSheyanSpinOK(GetTriggerPlayer())
    call SetHuanyiSpinOK(GetTriggerPlayer())
    call SetSichenSpinOK(GetTriggerPlayer())
    call SetLichiSpinOK(GetTriggerPlayer())
    call SetHeiyanSpinOK(GetTriggerPlayer())
    call SetCanglingSpinOK(GetTriggerPlayer())
    call SetHanshang2SpinOK(GetTriggerPlayer())
    call SetXinglong1SpinOK(GetTriggerPlayer())
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CancelVIP takes player p returns nothing
	    if not ( IsPIV(p) ) then
			call DisplayTextToPlayer(GetTriggerPlayer(), 0., 0., "|cFFFF66CC【消息】|r你并非永久赞助,关闭失败.")
			return
		endif
		if ( udg_H[GetConvertedPlayerId(p)] != null ) then
			call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r该功能仅在选择英雄前输入有效.")
			return
		endif
		call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r关闭赞助功能成功.")
		set sPIV[GetConvertedPlayerId(p)]=false
		if not ( hasPIV() ) then
			set PIV___isFirst=true
			set udg_I_Er_diansi[1]=1
			call BJDebugMsg("|cFFFF66CC【消息】|r你们已失去在任意难度下获得24+5波的特权.")
			call BJDebugMsg("|cFFFF66CC【消息】|r基地失去了额外的2次防护罩.")
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitAllPIV takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > 6
			call CertificatePIV(ConvertedPlayer(i) , null)
    if ( IsSavePIV(ConvertedPlayer(i) , PIV___GetPIVCode(GetPlayerName(ConvertedPlayer(i)))) ) then
    call CertificatePIV(ConvertedPlayer(i) , I2S(PIV___GetPIVCode(GetPlayerName(ConvertedPlayer(i)))))
    endif
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ClosePIV takes nothing returns nothing
		call FlushParentHashtable(PIV___PIVTable)
	endfunction
//---------------------------------------------------------------------------------------------------
 function PIV___InitPIV takes nothing returns nothing
  local integer i= 1
  local trigger t= CreateTrigger()
		loop
			exitwhen i > 6
			set sPIV[i]=false
			set i=i + 1
		endloop
		call SaveBoolean(PIV___PIVTable, kPIV, 560584534, true)
		//call SaveBoolean(PIVTable,kPIV,805389327,true)
		//2.64:
		call SaveBoolean(PIV___PIVTable, kPIV, 1386963254, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 920323633, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 2028760546, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 76404545, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 772953595, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 122150585, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 1866394937, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 668865994, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 11465124, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 1483305270, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 89160614, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 416503868, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 366425370, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 24682425, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 838476900, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 21235704, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 259338775, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 1945313488, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 185409653, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 848895504, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 970908405, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 1406966725, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 476387019, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 1407806903, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 39350822, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 947015907, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 1524326451, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 1199483482, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 85817056, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 1884797690, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 138245006, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 55883798, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 237209239, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 208207478, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 764958705, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 1556955637, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 769983234, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 1018574645, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 1602970119, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 1968941945, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 281722192, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 55774054, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 1794669457, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 4775200, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 5934560, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 1556972891, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 1308263866, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 819949938, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 935082247, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 874526666, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 274143214, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 242646218, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 42780764, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 15784280, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 1846898150, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 162418494, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 1028656343, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 871412081, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 724251537, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 572061793, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 1562039753, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 27535638, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 2856770, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 29748027, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 78547297, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 1691009533, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 108509507, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 863575409, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 47256210, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 386002974, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 253021838, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 4943346, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 655724335, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 1300925723, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 526128524, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 527932086, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 491536351, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 765412438, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 1807059619, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 158219634, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 812702019, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 93444649, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 1652902274, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 42083283, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 79706688, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 81738293, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 3334224, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 705577564, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 1834015365, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 249745215, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 936721376, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 96122563, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 242232349, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 99200445, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 17295550, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 192227001, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 500660555, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 1321008731, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 917107829, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 1277254148, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 556905161, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 55162747, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 395306233, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 442043076, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 987238722, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 454437652, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 50731632, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 1088397663, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 1193547207, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 263166628, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 991993981, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 343567476, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 41292785, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 199066564, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 58301014, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 975300858, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 24962383, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 6484930, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 922261063, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 9423109, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 388868057, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 61444830, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 89183810, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 255054188, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 589040132, true)
		call SaveBoolean(PIV___PIVTable, kPIV, 46380924, true)
		call TriggerRegisterPlayerChatEvent(t, Player(0), "##", true)
		call TriggerRegisterPlayerChatEvent(t, Player(1), "##", true)
		call TriggerRegisterPlayerChatEvent(t, Player(2), "##", true)
		call TriggerRegisterPlayerChatEvent(t, Player(3), "##", true)
		call TriggerRegisterPlayerChatEvent(t, Player(4), "##", true)
		call TriggerRegisterPlayerChatEvent(t, Player(5), "##", true)
	    call TriggerAddAction(t, function CreatePIVDialog)
	    set T17Wan=CreateTrigger()
		call TriggerRegisterPlayerChatEvent(T17Wan, Player(0), "", false)
		call TriggerRegisterPlayerChatEvent(T17Wan, Player(1), "", false)
		call TriggerRegisterPlayerChatEvent(T17Wan, Player(2), "", false)
		call TriggerRegisterPlayerChatEvent(T17Wan, Player(3), "", false)
		call TriggerRegisterPlayerChatEvent(T17Wan, Player(4), "", false)
		call TriggerRegisterPlayerChatEvent(T17Wan, Player(5), "", false)
	    call TriggerAddAction(T17Wan, function PIV___Verify17Wanba)
	    set t=null
	endfunction

//library PIV ends
//library Arena:
//---------------------------------------------------------------------------------------------------
	
 function Arena___updateLevel takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer int= GetHeroInt(Arena___challenager, true)
  local integer agi= GetHeroAgi(Arena___challenager, true)
  local integer str= GetHeroStr(Arena___challenager, true)
		if ( IsUnitAliveBJ(Arena___challenager) and ( Arena___currentLevel < ARENA_MAX_LEVEL ) ) then
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Avatar\\AvatarCaster.mdl", GetUnitX(Arena___challenager), GetUnitY(Arena___challenager)))
			call SetHeroInt(Arena___challenager, GetLimit(int + int / Arena___currentLevel), true)
			call SetHeroAgi(Arena___challenager, GetLimit(agi + agi / Arena___currentLevel), true)
			call SetHeroStr(Arena___challenager, GetLimit(str + str / Arena___currentLevel), true)
			set Arena___currentLevel=Arena___currentLevel + 1
			//设置技能等级
			call IncUnitAbilityLevel(Arena___challenager, 'ACbh')
			call IncUnitAbilityLevel(Arena___challenager, 'A0ET')
			call IncUnitAbilityLevel(Arena___challenager, 'A0EU')
			call IncUnitAbilityLevel(Arena___challenager, 'ACt2')
			call IncUnitAbilityLevel(Arena___challenager, 'AL04')
			call IncUnitAbilityLevel(Arena___challenager, 'AL05')
			call IncUnitAbilityLevel(Arena___challenager, 'A0EY')
			call IncUnitAbilityLevel(Arena___challenager, 'A0H6')
			call IncUnitAbilityLevel(Arena___challenager, 'A0H7')
			call SetTextTagTextBJ(Arena___textTag_Level, I2S(Arena___currentLevel) + "级", 20)
		else
			call PauseTimer(t)
			call DestroyTimer(t)
		endif
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Arena___updateLevelLoc takes nothing returns nothing
  local timer t= GetExpiredTimer()
		if ( IsUnitAliveBJ(Arena___challenager) ) then
			call SetTextTagPosUnitBJ(Arena___textTag_Level, Arena___challenager, 25)
		else
			call DestroyTextTag(Arena___textTag_Level)
			call PauseTimer(t)
			call DestroyTimer(t)
		endif
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Arena___TSpellLingerCon takes nothing returns boolean
	    return ( ( GetAttacker() == Arena___challenager ) and ( IsUnitAliveBJ(GetAttacker()) == true ) and ( IsUnitIllusionBJ(GetAttacker()) != true ) and RectContainsUnit(gg_rct_Arena_all, GetAttackedUnitBJ()) )
	endfunction
 function Arena___TSpellLingerAct takes nothing returns nothing
		call SetUnitX(GetAttackedUnitBJ(), GetRectCenterX(gg_rct_Arena_1))
		call SetUnitY(GetAttackedUnitBJ(), GetRectCenterY(gg_rct_Arena_1))
	endfunction
	
 function Arena___LingerAssemble takes nothing returns nothing
  local real x= GetRectCenterX(gg_rct_Arena_1)
  local real y= GetRectCenterY(gg_rct_Arena_1)
  local group l_group= CreateGroup()
  local unit l_unit
  local timer t= GetExpiredTimer()
		if ( IsUnitAliveBJ(Arena___challenager) ) then
			call GroupEnumUnitsInRange(l_group, GetUnitX(Arena___challenager), GetUnitY(Arena___challenager), 900, null)
			loop
			    set l_unit=FirstOfGroup(l_group)
			    exitwhen l_unit == null
			    call GroupRemoveUnit(l_group, l_unit)
			    if ( IsEnemy(GetEnumUnit() , Arena___challenager) ) then
					call SetUnitX(GetAttackedUnitBJ(), GetRectCenterX(gg_rct_Arena_1))
					call SetUnitY(GetAttackedUnitBJ(), GetRectCenterY(gg_rct_Arena_1))
			    endif
			endloop
	    	call CreateSpellTextTag("万箭定心！" , Arena___challenager , 100 , 100 , 0 , 2)
		else
			call PauseTimer(t)
			call DestroyTimer(t)
		endif
		call DestroyGroup(l_group)
		set t=null
		set l_group=null
		set l_unit=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Arena___TSpellZhousiCon takes nothing returns boolean
	    return ( ( GetAttacker() == Arena___challenager ) and ( IsUnitAliveBJ(Arena___challenager) == true ) and ( IsUnitIllusionBJ(Arena___challenager) != true ) and ( GetRandomInt(1, 40) == 1 ) and ( GetUnitStateSwap(UNIT_STATE_MANA, Arena___challenager) > 200.00 ) )
	endfunction
 function Arena___TSpellZhousiAct takes nothing returns nothing
  local integer i= 1
	    loop
	    	exitwhen i > 6
	    	call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Thunderclap\\ThunderClapCaster.mdl", GetUnitX(Arena___challenager) + SinBJ(i * 60) * 400, GetUnitY(Arena___challenager) + CosBJ(i * 60) * 400))
	    	set i=i + 1
	    endloop
		call DamageArea(Arena___challenager , GetUnitX(Arena___challenager) , GetUnitY(Arena___challenager) , 600 , 300000 + 15000 * Arena___currentLevel)
	    call CreateSpellTextTag("千煞破击！" , Arena___challenager , 100 , 0 , 0 , 2)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Arena___TSpellXuemo1Con takes nothing returns boolean
	    return ( ( GetAttacker() == Arena___challenager ) and ( IsUnitAliveBJ(GetAttacker()) == true ) and ( IsUnitIllusionBJ(GetAttacker()) != true ) and ( GetRandomInt(1, 40) == 1 ) )
	endfunction
 function Arena___TSpellXuemo1Act takes nothing returns nothing
  local unit u
  local integer i= 1
	    loop
	    	exitwhen i > 5
	        set u=CreateUnit(GetOwningPlayer(GetAttacker()), 'h000', GetUnitX(GetAttackedUnitBJ()), GetUnitY(GetAttackedUnitBJ()), 0)
	        call UnitApplyTimedLifeBJ(5.00, 'BHwe', u)
	        call UnitAddAbilityBJ('A0EV', u)
	        call SetUnitAbilityLevel(u, 'A0EV', IMinBJ(Arena___currentLevel, 20))
	        call IssueTargetOrderById(u, 852274, GetAttackedUnitBJ())
	    	set i=i + 1
	    endloop
	    call CreateSpellTextTag("幻魔灵枭！" , Arena___challenager , 100 , 0 , 0 , 2)
	    set u=null
	endfunction
	
 function Arena___TSpellXuemo2Con takes nothing returns boolean
	    return ( ( GetAttackedUnitBJ() == Arena___challenager ) and ( IsUnitAliveBJ(GetAttackedUnitBJ()) == true ) and ( IsUnitIllusionBJ(GetAttackedUnitBJ()) != true ) and ( GetRandomInt(1, 20) == 1 ) and ( GetUnitStateSwap(UNIT_STATE_MANA, GetAttackedUnitBJ()) > 200.00 ) )
	endfunction
 function Arena___TSpellXuemo2Act takes nothing returns nothing
  local location point= GetUnitLoc(GetAttacker())
     local unit u= CreateUnit(GetOwningPlayer(GetAttackedUnitBJ()), 'h000', GetUnitX(GetAttacker()), GetUnitY(GetAttacker()), 0)
	    call UnitApplyTimedLifeBJ(5.00, 'BHwe', u)
        call UnitAddAbilityBJ('AL01', u)
        call SetUnitAbilityLevel(u, 'AL01', IMinBJ(Arena___currentLevel, 20))
	    call IssuePointOrderLoc(u, "rainoffire", point)
	    call RemoveLocation(point)
	    set u=null
	    set point=null
	    call CreateSpellTextTag("天玄星陨！" , Arena___challenager , 0 , 100 , 100 , 2)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Arena___TSpellWuxinCon takes nothing returns boolean
	    return ( ( GetAttacker() == Arena___challenager ) and ( IsUnitAliveBJ(GetAttacker()) == true ) and ( IsUnitIllusionBJ(GetAttacker()) != true ) )
	endfunction
 function Arena___TSpellWuxinAct takes nothing returns nothing
		call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Human\\HumanLargeDeathExplode\\HumanLargeDeathExplode.mdl", GetUnitX(GetAttackedUnitBJ()), GetUnitY(GetAttackedUnitBJ())))
		call UnitDamageTarget(Arena___challenager, GetAttackedUnitBJ(), ( 0.01 * GetUnitStateSwap(UNIT_STATE_LIFE, GetAttackedUnitBJ()) ), false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_POISON, WEAPON_TYPE_WHOKNOWS)
	endfunction
 function Arena___WuxinFlash takes nothing returns nothing
		//5秒沉默切换
		if ( IsUnitAliveBJ(Arena___challenager) and GetUnitTypeId(Arena___challenager) == 'O003' ) then
			if ( GetUnitUserData(Arena___challenager) == 0 ) then
 				call SimulateSpell(Arena___challenager , Arena___challenager , 'A0M8' , 1 , 5 , "silence" , true , false , false)
 				call SetUnitUserData(Arena___challenager, 1)
			else
 				call SimulateSpell(Arena___challenager , Arena___challenager , 'A0M9' , 1 , 5 , "silence" , true , false , false)
 				call SetUnitUserData(Arena___challenager, 0)
			endif
		else
			call PauseTimer(GetExpiredTimer())
			call DestroyTimer(GetExpiredTimer())
			return
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Arena___TSpellFuwangCon takes nothing returns boolean
	    return ( ( GetAttacker() == Arena___challenager ) and ( IsUnitAliveBJ(GetAttacker()) == true ) and ( IsUnitIllusionBJ(GetAttacker()) != true ) and ( GetRandomInt(1, 10) == 1 ) )
	endfunction
 function Arena___TSpellFuwangAct takes nothing returns nothing
		call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Human\\HumanLargeDeathExplode\\HumanLargeDeathExplode.mdl", GetUnitX(GetAttackedUnitBJ()), GetUnitY(GetAttackedUnitBJ())))
		call UnitDamageTarget(Arena___challenager, GetAttackedUnitBJ(), ( 0.1 * GetUnitStateSwap(UNIT_STATE_LIFE, GetAttackedUnitBJ()) ), false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_POISON, WEAPON_TYPE_WHOKNOWS)
	    call CreateSpellTextTag("淘汰之刃！" , Arena___challenager , 0 , 100 , 0 , 2)
	endfunction
//---------------------------------------------------------------------------------------------------
	
	
 function Arena___TSpellMeidusha1Invu takes nothing returns nothing
  local group l_group= CreateGroup()
  local unit l_unit
  local integer count= 0
  local timer t= GetExpiredTimer()
		call GroupEnumUnitsInRange(l_group, GetUnitX(Arena___challenager), GetUnitY(Arena___challenager), 1800, null)
		loop
		    set l_unit=FirstOfGroup(l_group)
		    exitwhen l_unit == null
		    call GroupRemoveUnit(l_group, l_unit)
			if ( ( GetUnitTypeId(l_unit) == 'osp1' ) and GetOwningPlayer(l_unit) == Player(10) and IsUnitAliveBJ(l_unit) == true ) then
				set count=count + 1
			endif
		endloop
		if ( count == 0 ) then
			call SetUnitInvulnerable(Arena___challenager, false)
			call PauseTimer(t)
			call DestroyTimer(t)
		endif
		call DestroyGroup(l_group)
		set l_group=null
		set l_unit=null
		set t=null
	endfunction
	
 function Arena___TSpellMeidusha1Con takes nothing returns boolean
	    return ( ( GetAttacker() == Arena___challenager ) and ( IsUnitAliveBJ(GetAttacker()) == true ) and ( IsUnitIllusionBJ(GetAttacker()) != true ) and ( GetRandomInt(1, 60) == 1 ) )
	endfunction
 function Arena___TSpellMeidusha1Act takes nothing returns nothing
  local location point= GetUnitLoc(GetAttackedUnitBJ())
  local timer t= CreateTimer()
     local unit u= CreateUnit(GetOwningPlayer(GetAttacker()), 'h000', GetUnitX(GetAttackedUnitBJ()), GetUnitY(GetAttackedUnitBJ()), 0)
	    call UnitApplyTimedLifeBJ(5.00, 'BHwe', u)
        call UnitAddAbilityBJ('Arsw', u)
	    call IssuePointOrderLoc(u, "ward", point)
	    call CreateSpellTextTag("阴魂螣蛇！" , Arena___challenager , 0 , 0 , 0 , 2)
	    call RemoveLocation(point)
	    call SetUnitInvulnerable(Arena___challenager, TRUE)
	    call TimerStart(t, 0.3, true, function Arena___TSpellMeidusha1Invu)
	    set u=null
	    set point=null
	    set t=null
	endfunction
	
 function Arena___TSpellMeidusha2Con takes nothing returns boolean
	    return ( ( GetAttackedUnitBJ() == Arena___challenager ) and ( IsUnitAliveBJ(GetAttackedUnitBJ()) == true ) and ( IsUnitIllusionBJ(GetAttackedUnitBJ()) != true ) and ( GetRandomInt(1, 80) == 1 ) )
	endfunction
 function Arena___TSpellMeidusha2Act takes nothing returns nothing
  local group l_group= CreateGroup()
  local group l_pausinggroup= CreateGroup()
  local unit l_unit= null
		call GroupEnumUnitsInRange(l_group, GetUnitX(GetAttackedUnitBJ()), GetUnitY(GetAttackedUnitBJ()), 900, null)
		loop
		    set l_unit=FirstOfGroup(l_group)
		    exitwhen l_unit == null
		    call GroupRemoveUnit(l_group, l_unit)
		    if ( IsEnemy(l_unit , Arena___challenager) ) then
				call PauseUnitBJ(true, l_unit)
				call GroupAddUnit(l_pausinggroup, l_unit)
				call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl", GetUnitX(l_unit), GetUnitY(l_unit)))
		    endif
		endloop
	    call CreateSpellTextTag("石化凝视！" , Arena___challenager , 51 , 51 , 51 , 2)
		call DestroyGroup(l_group)
		set l_group=null
		call YDWEPolledWaitNull(3.00)
		loop
		    set l_unit=FirstOfGroup(l_pausinggroup)
		    exitwhen l_unit == null
		    call GroupRemoveUnit(l_pausinggroup, l_unit)
			call PauseUnitBJ(false, l_unit)
			call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl", GetUnitX(l_unit), GetUnitY(l_unit)))
		endloop
		call DestroyGroup(l_pausinggroup)
		set l_pausinggroup=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function TSpellKiller1Con takes nothing returns boolean
	    return ( ( GetAttackedUnitBJ() == Arena___challenager ) and ( IsUnitAliveBJ(GetAttackedUnitBJ()) == true ) and ( IsUnitIllusionBJ(GetAttackedUnitBJ()) != true ) and ( GetRandomInt(1, 20) == 1 ) and ( GetUnitAbilityLevel(GetAttacker(), 'Amim') < 1 ) and UnitHasBuffBJ(GetAttacker(), 'BEsh') != true )
	endfunction
 function TSpellKiller1Act takes nothing returns nothing
     local unit u= CreateUnit(GetOwningPlayer(GetAttackedUnitBJ()), 'h000', GetUnitX(GetAttacker()), GetUnitY(GetAttacker()), 0)
	    call UnitApplyTimedLifeBJ(5.00, 'BHwe', u)
        call UnitAddAbilityBJ('AL02', u)
        call SetUnitAbilityLevel(u, 'AL02', IMinBJ(Arena___currentLevel, 20))
	    call IssueTargetOrder(u, "shadowstrike", GetAttacker())
	    call CreateSpellTextTag("致命毒镖！" , Arena___challenager , 0 , 0 , 0 , 2)
	    set u=null
	endfunction
	
 function TSpellKiller2Con takes nothing returns boolean
	    return ( ( GetAttacker() == Arena___challenager ) and ( IsUnitAliveBJ(GetAttacker()) == true ) and ( IsUnitIllusionBJ(GetAttacker()) != true ) and ( GetRandomInt(1, 80) == 1 ) and ( GetUnitStateSwap(UNIT_STATE_MANA, GetAttacker()) > 200.00 ) )
	endfunction
 function TSpellKiller2Act takes nothing returns nothing
 		call SimulateSpell(GetAttacker() , GetAttackedUnitBJ() , 'A0AC' , 1 , 5 , "entanglingroots" , false , false , true)
	    call CreateSpellTextTag("冰封囚笼！" , Arena___challenager , 0 , 255 , 0 , 2)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function TSpellJinxuan1Con takes nothing returns boolean
	    return ( ( GetAttacker() == Arena___challenager ) and ( IsUnitIllusionBJ(GetAttacker()) != true ) and ( IsUnitAliveBJ(GetAttacker()) == true ) and ( GetRandomInt(1, 70) == 1 ) and ( GetUnitStateSwap(UNIT_STATE_MANA, GetAttacker()) > 200.00 ) )
	endfunction
 function TSpellJinxuan1Act takes nothing returns nothing
 		call SimulateSpell(GetAttacker() , GetAttackedUnitBJ() , 'ACrf' , IMinBJ(Arena___currentLevel, 20) , 6 , "rainoffire" , true , false , false)
	    call CreateSpellTextTag("瞬闪雷鸣！" , Arena___challenager , 0 , 0 , 100 , 2)
	endfunction
	
 function TSpellJinxuan2Con takes nothing returns boolean
	    return ( ( GetAttackedUnitBJ() == Arena___challenager ) and ( IsUnitAliveBJ(GetAttackedUnitBJ()) == true ) and ( IsUnitIllusionBJ(GetAttackedUnitBJ()) != true ) and ( GetRandomInt(1, 50) == 1 ) and ( GetUnitStateSwap(UNIT_STATE_MANA, GetAttackedUnitBJ()) > 200.00 ) )
	endfunction
 function TSpellJinxuan2Act takes nothing returns nothing
 		call SimulateSpell(GetAttackedUnitBJ() , GetAttacker() , 'ANst' , IMinBJ(Arena___currentLevel, 20) , 5 , "stampede" , true , false , false)
	    call CreateSpellTextTag("逆合玄天！" , Arena___challenager , 0 , 0 , 100 , 2)
	endfunction
	
 function TSpellJinxuan3Con takes nothing returns boolean
	    return ( ( GetAttacker() == Arena___challenager ) and ( IsUnitAliveBJ(GetAttacker()) == true ) and ( IsUnitIllusionBJ(GetAttacker()) != true ) and ( GetRandomInt(1, 70) == 1 ) and ( GetUnitStateSwap(UNIT_STATE_MANA, GetAttacker()) > 200.00 ) )
	endfunction
 function TSpellJinxuan3Act takes nothing returns nothing
 		call SimulateSpell(GetAttacker() , GetAttackedUnitBJ() , 'AHtb' , IMinBJ(Arena___currentLevel, 20) , 5 , "thunderbolt" , false , false , true)
	    call CreateSpellTextTag("魔化射线！" , Arena___challenager , 100 , 0 , 100 , 2)
	endfunction
	
 function TSpellJinxuan4Con takes nothing returns boolean
	    return ( ( GetAttackedUnitBJ() == Arena___challenager ) and ( IsUnitAliveBJ(GetAttackedUnitBJ()) == true ) and ( IsUnitIllusionBJ(GetAttackedUnitBJ()) != true ) and ( GetRandomInt(1, 20) == 1 ) )
	endfunction
 function TSpellJinxuan4Act takes nothing returns nothing
	    call SetUnitManaBJ(GetAttacker(), ( GetUnitStateSwap(UNIT_STATE_MANA, GetAttacker()) - 500.00 ))
	    call CreateSpellTextTag("魔法窃取！" , Arena___challenager , 0 , 100 , 0 , 2)
	    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\AnimateDead\\AnimateDeadTarget.mdl", GetUnitX(GetAttacker()), GetUnitY(GetAttacker())))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function TSpellYuanshaCon takes nothing returns boolean
	    return ( ( GetOwningPlayer(GetEventDamageSource()) != GetOwningPlayer(Arena___defier) ) and ( GetEventDamage() > 10 ) )
	endfunction
 function TSpellYuanshaAct takes nothing returns nothing
		call SetUnitLifeBJ(Arena___challenager, GetUnitState(Arena___challenager, UNIT_STATE_LIFE) + GetEventDamage())
		if ( GetRandomInt(1, 5) == 1 ) then
	    	call CreateSpellTextTag("局外免疫！" , Arena___challenager , 0 , 0 , 100 , 2)
		endif
	endfunction
	
 function Arena___YuanshaMove takes nothing returns nothing
  local real x= GetRandomReal(GetRectMinX(gg_rct_Arena_Spell), GetRectMaxX(gg_rct_Arena_Spell))
  local real y= GetRandomReal(GetRectMinY(gg_rct_Arena_Spell), GetRectMaxY(gg_rct_Arena_Spell))
		if ( IsUnitAliveBJ(Arena___challenager) ) then
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\Blink\\BlinkCaster.mdl", x, y))
			call SetUnitX(Arena___challenager, x)
			call SetUnitY(Arena___challenager, y)
		else
			call PauseTimer(GetExpiredTimer())
			call DestroyTimer(GetExpiredTimer())
			return
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function TArenaStartAct takes nothing returns nothing
  local integer attract
		//符合条件再开始
	    if ( ( IsUnitType(GetBuyingUnit(), UNIT_TYPE_HERO) == true ) ) then
	        if ( ( Arena___challenager == null ) ) then
	            if ( ( Arena___currentArena[GetConvertedPlayerId(GetOwningPlayer(Arena___defier))] != 11 ) ) then
	            	//开始啦
	                call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r挑战将在3秒后开始。")
	                if ( ( Arena___currentArena[GetConvertedPlayerId(GetOwningPlayer(Arena___defier))] == 0 ) ) then
	                    set Arena___challenager=CreateUnit(Player(10), 'Huth', GetRandomReal(GetRectMinX(gg_rct_Arena_all), GetRectMaxX(gg_rct_Arena_all)), GetRandomReal(GetRectMinY(gg_rct_Arena_all), GetRectMaxY(gg_rct_Arena_all)), 180.00)
	                elseif ( ( Arena___currentArena[GetConvertedPlayerId(GetOwningPlayer(Arena___defier))] == 1 ) ) then
	                    set Arena___challenager=CreateUnit(Player(10), 'Hpb1', GetRandomReal(GetRectMinX(gg_rct_Arena_all), GetRectMaxX(gg_rct_Arena_all)), GetRandomReal(GetRectMinY(gg_rct_Arena_all), GetRectMaxY(gg_rct_Arena_all)), 180.00)
	                elseif ( ( Arena___currentArena[GetConvertedPlayerId(GetOwningPlayer(Arena___defier))] == 2 ) ) then
	                    set Arena___challenager=CreateUnit(Player(10), 'Hgam', GetRectCenterX(gg_rct_Arena_2), GetRectCenterY(gg_rct_Arena_2), 180.00)
	                    call TimerStart(CreateTimer(), 2, TRUE, function Arena___LingerAssemble)
	                    call EnableTrigger(Arena___TSpellLinger)
	                elseif ( ( Arena___currentArena[GetConvertedPlayerId(GetOwningPlayer(Arena___defier))] == 3 ) ) then
	                    set Arena___challenager=CreateUnit(Player(10), 'Hmbr', GetRandomReal(GetRectMinX(gg_rct_Arena_all), GetRectMaxX(gg_rct_Arena_all)), GetRandomReal(GetRectMinY(gg_rct_Arena_all), GetRectMaxY(gg_rct_Arena_all)), 180.00)
	                    set attract=s__Attract_create(Arena___challenager , 600 , 0.05 , 20)
	                    call s__Attract_start(attract)
						call EnableTrigger(Arena___TSpellZhousi)
	                elseif ( ( Arena___currentArena[GetConvertedPlayerId(GetOwningPlayer(Arena___defier))] == 4 ) ) then
	                    set Arena___challenager=CreateUnit(Player(10), 'Odrt', GetRandomReal(GetRectMinX(gg_rct_Arena_all), GetRectMaxX(gg_rct_Arena_all)), GetRandomReal(GetRectMinY(gg_rct_Arena_all), GetRectMaxY(gg_rct_Arena_all)), 180.00)
	                	call UnitAddAbilityBJ('A0F1', Arena___challenager)
	                	call UnitAddAbilityBJ('Adtg', Arena___challenager)
						call EnableTrigger(Arena___TSpellXuemo1)
						call EnableTrigger(Arena___TSpellXuemo2)
	                elseif ( ( Arena___currentArena[GetConvertedPlayerId(GetOwningPlayer(Arena___defier))] == 5 ) ) then
	                    set Arena___challenager=CreateUnit(Player(10), 'O003', GetRandomReal(GetRectMinX(gg_rct_Arena_all), GetRectMaxX(gg_rct_Arena_all)), GetRandomReal(GetRectMinY(gg_rct_Arena_all), GetRectMaxY(gg_rct_Arena_all)), 180.00)
	                	call UnitAddAbilityBJ('A0F1', Arena___challenager)
	                	call UnitAddAbilityBJ('Adtg', Arena___challenager)
						call EnableTrigger(Arena___TSpellWuxin)
	                    call TimerStart(CreateTimer(), 5, TRUE, function Arena___WuxinFlash)
	                elseif ( ( Arena___currentArena[GetConvertedPlayerId(GetOwningPlayer(Arena___defier))] == 6 ) ) then
	                    set Arena___challenager=CreateUnit(Player(10), 'Ogrh', GetRandomReal(GetRectMinX(gg_rct_Arena_all), GetRectMaxX(gg_rct_Arena_all)), GetRandomReal(GetRectMinY(gg_rct_Arena_all), GetRectMaxY(gg_rct_Arena_all)), 180.00)
	                    set attract=s__Attract_create(Arena___challenager , 600 , 0.05 , 20)
	                    call s__Attract_start(attract)
	                	call UnitAddAbilityBJ('A0F1', Arena___challenager)
	                	call UnitAddAbilityBJ('Adtg', Arena___challenager)
						call EnableTrigger(Arena___TSpellFuwang)
	                elseif ( ( Arena___currentArena[GetConvertedPlayerId(GetOwningPlayer(Arena___defier))] == 7 ) ) then
	                    set Arena___challenager=CreateUnit(Player(10), 'Hvsh', GetRandomReal(GetRectMinX(gg_rct_Arena_all), GetRectMaxX(gg_rct_Arena_all)), GetRandomReal(GetRectMinY(gg_rct_Arena_all), GetRectMaxY(gg_rct_Arena_all)), 180.00)
	                	call UnitAddAbilityBJ('Adtg', Arena___challenager)
						call EnableTrigger(Arena___TSpellMeidusha1)
						call EnableTrigger(Arena___TSpellMeidusha2)
	                elseif ( ( Arena___currentArena[GetConvertedPlayerId(GetOwningPlayer(Arena___defier))] == 8 ) ) then
	                    set Arena___challenager=CreateUnit(Player(10), 'Hpb2', GetRandomReal(GetRectMinX(gg_rct_Arena_all), GetRectMaxX(gg_rct_Arena_all)), GetRandomReal(GetRectMinY(gg_rct_Arena_all), GetRectMaxY(gg_rct_Arena_all)), 180.00)
	                	call UnitAddAbilityBJ('A0F1', Arena___challenager)
	                	call UnitAddAbilityBJ('Adtg', Arena___challenager)
						call EnableTrigger(Arena___TSpellKiller1)
						call EnableTrigger(Arena___TSpellKiller2)
	                elseif ( ( Arena___currentArena[GetConvertedPlayerId(GetOwningPlayer(Arena___defier))] == 9 ) ) then
	                    set Arena___challenager=CreateUnit(Player(10), 'Hlgr', GetRandomReal(GetRectMinX(gg_rct_Arena_all), GetRectMaxX(gg_rct_Arena_all)), GetRandomReal(GetRectMinY(gg_rct_Arena_all), GetRectMaxY(gg_rct_Arena_all)), 180.00)
	                	call UnitAddAbilityBJ('A0F1', Arena___challenager)
	                	call UnitAddAbilityBJ('Adtg', Arena___challenager)
						call EnableTrigger(Arena___TSpellJinxuan1)
						call EnableTrigger(Arena___TSpellJinxuan2)
						call EnableTrigger(Arena___TSpellJinxuan3)
						call EnableTrigger(Arena___TSpellJinxuan4)
	                elseif ( ( Arena___currentArena[GetConvertedPlayerId(GetOwningPlayer(Arena___defier))] == 10 ) ) then
	                    set Arena___challenager=CreateUnit(Player(10), 'Hdgo', GetRandomReal(GetRectMinX(gg_rct_Arena_all), GetRectMaxX(gg_rct_Arena_all)), GetRandomReal(GetRectMinY(gg_rct_Arena_all), GetRectMaxY(gg_rct_Arena_all)), 180.00)
	                	call UnitAddAbilityBJ('A0F1', Arena___challenager)
	                	call UnitAddAbilityBJ('Adtg', Arena___challenager)
						call EnhanceDiffAttack(Arena___challenager)
	                    call TimerStart(CreateTimer(), 0.5, TRUE, function Arena___YuanshaMove)
						call EnableTrigger(Arena___TSpellYuansha)
	                endif
	                //初始化单位
					call SetUnitX(Arena___defier, GetRectCenterX(gg_rct_Arena_1))
					call SetUnitY(Arena___defier, GetRectCenterY(gg_rct_Arena_1))
	                call SetUnitInvulnerable(Arena___challenager, true)
	                call PauseUnitBJ(true, Arena___challenager)
	                set Arena___currentLevel=1
	                call UnitAddAbilityBJ('A0ES', Arena___challenager)
	                call UnitAddAbilityBJ('A0B9', Arena___challenager)
	                call UnitAddAbilityBJ('A09W', Arena___challenager)
	                call UnitAddAbilityBJ('A0P1', Arena___challenager)
                	call BossAddOnlyAttack(Arena___challenager)
	                call AddTianyanmokang(Arena___challenager)
	                set Arena___textTag_Level=CreateTextTagUnitBJ(I2S(Arena___currentLevel) + "级", Arena___challenager, 0, 20, 100, 0, 0, 0)
	                call YDWEPolledWaitNull(3.00)
	                if ( ( Arena___challenager != null ) ) then
	                    call SetUnitInvulnerable(Arena___challenager, false)
	                    call PauseUnitBJ(false, Arena___challenager)
	                    call DisplayTextToPlayer(GetOwningPlayer(Arena___defier), 0, 0, "|cFFFF66CC【消息】|r挑战开始！")
	                    //5秒更新一次等级
	                    call TimerStart(CreateTimer(), GetArenaUpdateSpeed(), TRUE, function Arena___updateLevel)
	                    //0.05秒更新一次等级提示的位置
	                    call TimerStart(CreateTimer(), 0.05, TRUE, function Arena___updateLevelLoc)
   						call TriggerRegisterUnitEvent(Arena___TDieEvent, Arena___challenager, EVENT_UNIT_DEATH)
	                else
	                endif
	            else
	                call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r擂台已经全部挑战完毕！")
	            endif
	        else
	            call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r请打完这场擂台再挑战新的！（认输方法：输入HG回城）")
	        endif
	    else
	        call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r请让英雄购买！")
	    endif
	endfunction
 function Arena___TArenaStartCon takes nothing returns boolean
	    return ( ( GetItemTypeId(GetSoldItem()) == 'I04D' ) and BuyerFilter(GetBuyingUnit()) == true and ( GetBuyingUnit() == Arena___defier ) )
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function TArenaLeaveCon takes nothing returns boolean
	    return ( ( Arena___defier == GetLeavingUnit() ) and ( IsUnitIllusionBJ(GetLeavingUnit()) != true ) )
	endfunction
 function TArenaLeaveAct takes nothing returns nothing
	    set Arena___defier=null
	    if ( ( Arena___challenager != null ) ) then
	        call RemoveUnit(Arena___challenager)
	        set Arena___challenager=null
	        call DestroyTextTag(Arena___textTag_Level)
	        call Arena___updateLevel()
	    	set Arena___currentLevel=1
	    endif
        call DisableTrigger(Arena___TSpellLinger)
		call DisableTrigger(Arena___TSpellZhousi)
		call DisableTrigger(Arena___TSpellXuemo1)
		call DisableTrigger(Arena___TSpellXuemo2)
		call DisableTrigger(Arena___TSpellFuwang)
		call DisableTrigger(Arena___TSpellMeidusha1)
		call DisableTrigger(Arena___TSpellMeidusha2)
		call DisableTrigger(Arena___TSpellKiller1)
		call DisableTrigger(Arena___TSpellKiller2)
		call DisableTrigger(Arena___TSpellJinxuan1)
		call DisableTrigger(Arena___TSpellJinxuan2)
		call DisableTrigger(Arena___TSpellJinxuan3)
		call DisableTrigger(Arena___TSpellJinxuan4)
		call DisableTrigger(Arena___TSpellYuansha)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Arena___TArenaEnterAct takes nothing returns nothing
  local location point
	    if ( ( GetItemTypeId(GetSoldItem()) == 'fgrd' ) ) then
	        if ( ( IsUnitType(GetBuyingUnit(), UNIT_TYPE_HERO) == true ) ) then
	            if ( ( Arena___defier == null ) ) then
	                set Arena___defier=GetBuyingUnit()
	                set point=GetRandomLocInRect(gg_rct_Arena_all)
	                call SetUnitPositionLoc(GetBuyingUnit(), point)
	                call PanCameraToTimedLocForPlayer(GetOwningPlayer(GetBuyingUnit()), point, 0.20)
	                call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", GetUnitX(GetBuyingUnit()), GetUnitY(GetBuyingUnit())))
	                call RemoveLocation(point)
	                call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r回去输入“HG”。")
	            else
	                call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r擂台只支持单挑,里面有人了哦~")
	            endif
	        else
	            call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r请让英雄购买！")
	        endif
	    else
	    endif
	    set point=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function TDieEventConditions takes nothing returns boolean
	    return ( ( IsUnitIllusionBJ(GetDyingUnit()) != true ) )
	endfunction
 function TDieEventActions takes nothing returns nothing
     local integer ty= ( GetUnitTypeId(GetDyingUnit()) )
	    if ( ty == 'Huth' ) then
	        call CreateItem('prvt', GetRectCenterX(gg_rct_Arena_all), GetRectCenterY(gg_rct_Arena_all))
	    elseif ( ty == 'Hpb1' ) then
	        call CreateItem('cnob', GetRectCenterX(gg_rct_Arena_all), GetRectCenterY(gg_rct_Arena_all))
	    elseif ( ty == 'Hgam' ) then
	        call CreateItem('rhth', GetRectCenterX(gg_rct_Arena_all), GetRectCenterY(gg_rct_Arena_all))
        	call DisableTrigger(Arena___TSpellLinger)
	    elseif ( ty == 'Hmbr' ) then
	        call CreateItem('hval', GetRectCenterX(gg_rct_Arena_all), GetRectCenterY(gg_rct_Arena_all))
			call DisableTrigger(Arena___TSpellZhousi)
	    elseif ( ty == 'Odrt' ) then
	        call CreateItem('afac', GetRectCenterX(gg_rct_Arena_all), GetRectCenterY(gg_rct_Arena_all))
			call DisableTrigger(Arena___TSpellXuemo1)
			call DisableTrigger(Arena___TSpellXuemo2)
	    elseif ( ty == 'O003' ) then
	        call CreateItem('I078', GetRectCenterX(gg_rct_Arena_all), GetRectCenterY(gg_rct_Arena_all))
			call DisableTrigger(Arena___TSpellWuxin)
	    elseif ( ty == 'Ogrh' ) then
	        call CreateItem('pmna', GetRectCenterX(gg_rct_Arena_all), GetRectCenterY(gg_rct_Arena_all))
			call DisableTrigger(Arena___TSpellFuwang)
	    elseif ( ty == 'Hvsh' ) then
	        call CreateItem('evtl', GetRectCenterX(gg_rct_Arena_all), GetRectCenterY(gg_rct_Arena_all))
			call DisableTrigger(Arena___TSpellMeidusha1)
			call DisableTrigger(Arena___TSpellMeidusha2)
	    elseif ( ty == 'Hpb2' ) then
	        call CreateItem('bspd', GetRectCenterX(gg_rct_Arena_all), GetRectCenterY(gg_rct_Arena_all))
	        call DisableTrigger(Arena___TSpellKiller1)
			call DisableTrigger(Arena___TSpellKiller2)
	    elseif ( ty == 'Hlgr' ) then
	        call CreateItem('mcou', GetRectCenterX(gg_rct_Arena_all), GetRectCenterY(gg_rct_Arena_all))
	        call DisableTrigger(Arena___TSpellJinxuan1)
			call DisableTrigger(Arena___TSpellJinxuan2)
			call DisableTrigger(Arena___TSpellJinxuan3)
			call DisableTrigger(Arena___TSpellJinxuan4)
		elseif ( ty == 'Hdgo' ) then
    call SaveKillLeishi(GetOwningPlayer(Arena___defier))
	        call CreateItem('ciri', GetRectCenterX(gg_rct_Arena_all), GetRectCenterY(gg_rct_Arena_all))
			call DisableTrigger(Arena___TSpellYuansha)
	    endif
	    set Arena___currentLevel=1
	    set Arena___currentArena[GetConvertedPlayerId(GetOwningPlayer(Arena___defier))]=Arena___currentArena[GetConvertedPlayerId(GetOwningPlayer(Arena___defier))] + 1
	    call DisplayTextToPlayer(GetOwningPlayer(Arena___defier), 0, 0, "|cFFFF66CC【消息】|r挑战成功!")
        call PlaySoundBJ(gg_snd_v_leitai)
	    call RemoveUnit(Arena___challenager)
	    set Arena___challenager=null
	endfunction
//---------------------------------------------------------------------------------------------------
 function Arena___InitArena takes nothing returns nothing
		//挑战开始--买了"挑战开始"
  local trigger t= CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_SELL_ITEM)
	    call TriggerAddCondition(t, Condition(function Arena___TArenaStartCon))
	    call TriggerAddAction(t, function TArenaStartAct)
	    //离开擂台后判负
	    set t=CreateTrigger()
	    call YDWETriggerRegisterLeaveRectSimpleNull(t , gg_rct_Arena_forbit)
	    call TriggerAddCondition(t, Condition(function TArenaLeaveCon))
	    call TriggerAddAction(t, function TArenaLeaveAct)
	    //进入挑战场--买了"进入擂台"
	    set t=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_SELL_ITEM)
	    call TriggerAddAction(t, function Arena___TArenaEnterAct)
	    //擂主死亡事件
	    set Arena___TDieEvent=CreateTrigger()
	    call TriggerAddCondition(Arena___TDieEvent, Condition(function TDieEventConditions))
	    call TriggerAddAction(Arena___TDieEvent, function TDieEventActions)
        //灵儿技能
	    set Arena___TSpellLinger=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(Arena___TSpellLinger, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(Arena___TSpellLinger, Condition(function Arena___TSpellLingerCon))
	    call TriggerAddAction(Arena___TSpellLinger, function Arena___TSpellLingerAct)
	    call DisableTrigger(Arena___TSpellLinger)
	    //宙斯技能
	    set Arena___TSpellZhousi=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(Arena___TSpellZhousi, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(Arena___TSpellZhousi, Condition(function Arena___TSpellZhousiCon))
	    call TriggerAddAction(Arena___TSpellZhousi, function Arena___TSpellZhousiAct)
	    call DisableTrigger(Arena___TSpellZhousi)
	    //血魔技能
	    set Arena___TSpellXuemo1=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(Arena___TSpellXuemo1, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(Arena___TSpellXuemo1, Condition(function Arena___TSpellXuemo1Con))
	    call TriggerAddAction(Arena___TSpellXuemo1, function Arena___TSpellXuemo1Act)
	    call DisableTrigger(Arena___TSpellXuemo1)
	    set Arena___TSpellXuemo2=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(Arena___TSpellXuemo2, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(Arena___TSpellXuemo2, Condition(function Arena___TSpellXuemo2Con))
	    call TriggerAddAction(Arena___TSpellXuemo2, function Arena___TSpellXuemo2Act)
	    call DisableTrigger(Arena___TSpellXuemo2)
    	//无心技能
	    set Arena___TSpellWuxin=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(Arena___TSpellWuxin, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(Arena___TSpellWuxin, Condition(function Arena___TSpellWuxinCon))
	    call TriggerAddAction(Arena___TSpellWuxin, function Arena___TSpellWuxinAct)
	    call DisableTrigger(Arena___TSpellWuxin)
    	//斧王技能
	    set Arena___TSpellFuwang=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(Arena___TSpellFuwang, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(Arena___TSpellFuwang, Condition(function Arena___TSpellFuwangCon))
	    call TriggerAddAction(Arena___TSpellFuwang, function Arena___TSpellFuwangAct)
	    call DisableTrigger(Arena___TSpellFuwang)
	    //美杜莎技能
	    set Arena___TSpellMeidusha1=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(Arena___TSpellMeidusha1, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(Arena___TSpellMeidusha1, Condition(function Arena___TSpellMeidusha1Con))
	    call TriggerAddAction(Arena___TSpellMeidusha1, function Arena___TSpellMeidusha1Act)
	    call DisableTrigger(Arena___TSpellMeidusha1)
	    set Arena___TSpellMeidusha2=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(Arena___TSpellMeidusha2, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(Arena___TSpellMeidusha2, Condition(function Arena___TSpellMeidusha2Con))
	    call TriggerAddAction(Arena___TSpellMeidusha2, function Arena___TSpellMeidusha2Act)
	    call DisableTrigger(Arena___TSpellMeidusha2)
	    //杀手技能
	    set Arena___TSpellKiller1=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(Arena___TSpellKiller1, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(Arena___TSpellKiller1, Condition(function TSpellKiller1Con))
	    call TriggerAddAction(Arena___TSpellKiller1, function TSpellKiller1Act)
	    call DisableTrigger(Arena___TSpellKiller1)
	    set Arena___TSpellKiller2=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(Arena___TSpellKiller2, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(Arena___TSpellKiller2, Condition(function TSpellKiller2Con))
	    call TriggerAddAction(Arena___TSpellKiller2, function TSpellKiller2Act)
	    call DisableTrigger(Arena___TSpellKiller2)
        //瑾轩技能
	    set Arena___TSpellJinxuan1=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(Arena___TSpellJinxuan1, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(Arena___TSpellJinxuan1, Condition(function TSpellJinxuan1Con))
	    call TriggerAddAction(Arena___TSpellJinxuan1, function TSpellJinxuan1Act)
	    call DisableTrigger(Arena___TSpellJinxuan1)
	    set Arena___TSpellJinxuan2=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(Arena___TSpellJinxuan2, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(Arena___TSpellJinxuan2, Condition(function TSpellJinxuan2Con))
	    call TriggerAddAction(Arena___TSpellJinxuan2, function TSpellJinxuan2Act)
	    call DisableTrigger(Arena___TSpellJinxuan2)
	    set Arena___TSpellJinxuan3=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(Arena___TSpellJinxuan3, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(Arena___TSpellJinxuan3, Condition(function TSpellJinxuan3Con))
	    call TriggerAddAction(Arena___TSpellJinxuan3, function TSpellJinxuan3Act)
	    call DisableTrigger(Arena___TSpellJinxuan3)
	    set Arena___TSpellJinxuan4=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(Arena___TSpellJinxuan4, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(Arena___TSpellJinxuan4, Condition(function TSpellJinxuan4Con))
	    call TriggerAddAction(Arena___TSpellJinxuan4, function TSpellJinxuan4Act)
	    call DisableTrigger(Arena___TSpellJinxuan4)
	    //辕煞
	    set Arena___TSpellYuansha=CreateTrigger()
	    call TriggerAddCondition(Arena___TSpellYuansha, Condition(function TSpellYuanshaCon))
	    call TriggerAddAction(Arena___TSpellYuansha, function TSpellYuanshaAct)
	    call DisableTrigger(Arena___TSpellYuansha)
	    set t=null
	endfunction

//library Arena ends
//library Box:
//---------------------------------------------------------------------------------------------------
	
 function Box___Is3Size takes player p returns boolean
		if ( playerName[GetConvertedPlayerId(p)] == "samwinn" or playerName[GetConvertedPlayerId(p)] == "司宸" or playerName[GetConvertedPlayerId(p)] == "雪落无痕Diana" or playerName[GetConvertedPlayerId(p)] == "天子脚下一堆坑" ) then
			return true
		endif
		return false
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Box___InitBoxWord takes player p returns nothing
  local integer index= GetConvertedPlayerId(p)
		set TTBBox[index]=s__TextTagBind_create(UDepot[index] , 50 , 50)
		call s__TextTagBind_setContent(TTBBox[index],S3(StringLength(SBoxWord[index]) < 1 , "输入-ck改头衔" , SBoxWord[index]))
		call s__TextTagBind_setSize(TTBBox[index],12.)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SetDIYBoxName takes player p,string s returns nothing
		if ( ModuloInteger(StringLength(s), 3) == 0 ) then
			if ( ( StringLength(s) > ( ( ( DzAPI_Map_GetMapLevel(p) / 10 ) + 2 + I3(Box___Is3Size(p) , 3 , 0) ) * 3 ) ) ) then
				call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r你地图等级当前为" + I2S(DzAPI_Map_GetMapLevel(p)) + "级,最多可自定义" + I2S(( ( DzAPI_Map_GetMapLevel(p) / 10 ) + 2 + I3(Box___Is3Size(p) , 3 , 0) )) + "个字.")
				call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r每10级可以额外获得1个字.")
				return
			endif
			set SBoxWord[GetConvertedPlayerId(p)]=s
			call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r成功修改头衔!")
			call DzAPI_Map_StoreString(p , "SBoxWord" , SBoxWord[GetConvertedPlayerId(p)])
			if ( TTBBox[GetConvertedPlayerId(p)] != 0 ) then
				call s__TextTagBind_setContent(TTBBox[GetConvertedPlayerId(p)],SBoxWord[GetConvertedPlayerId(p)])
			endif
		else
			call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r头衔格式不对！不允许中英(或数字)混杂输入。")
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Duihuanjinbi takes nothing returns nothing
		if ( GetPlayerState(GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_LUMBER) >= 10 ) then
        	call AdjustPlayerStateBJ(- 10, GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_LUMBER)
        	call AdjustPlayerStateBJ(10000, GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_GOLD)
        else
        	call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【消息】|r你的木材不足.")
		endif
	endfunction
 function DuihuanMucai takes nothing returns nothing
		if ( GetPlayerState(GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_GOLD) >= 10000 ) then
        	call AdjustPlayerStateBJ(10, GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_LUMBER)
        	call AdjustPlayerStateBJ(- 10000, GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_GOLD)
        else
        	call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【消息】|r你的金币不足.")
		endif
	endfunction
 function Wanwuqiyuan takes nothing returns nothing
		call UnitAddItemByIdSwapped('I006', GetTriggerUnit())
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Box___GetBoxName takes integer i returns string
		if ( i == 1 ) then
			return "倾雪寒晶"
		elseif ( i == 2 ) then
			return "救死扶伤"
		elseif ( i == 3 ) then
			return "货币达人"
		elseif ( i == 4 ) then
			return "心寞孤客"
		elseif ( i == 5 ) then
			return "瞬息万年"
		elseif ( i == 6 ) then
			return "紫雷之极"
		elseif ( i == 7 ) then
			return "万物之源"
		elseif ( i == 8 ) then
			return "熔炎火炮"
		elseif ( i == 9 ) then
			return "紫薇上神"
		endif
		return ""
	endfunction
 function Box___GetBoxCondition takes integer i returns string
		if ( i == 1 ) then
			return "|cff33cccc(完成挑战>10%解锁)|r"
		elseif ( i == 2 ) then
			return "|cff33cccc(完成挑战>25%解锁)|r"
		elseif ( i == 3 ) then
			return "|cff33cccc(完成挑战>50%解锁)|r"
		elseif ( i == 4 ) then
			return "|cff33cccc(完成挑战>75%解锁)|r"
		elseif ( i == 5 ) then
			return "|cff33cccc(完成挑战>99%解锁)|r"
		elseif ( i == 6 ) then
			return "|cff33cccc(地图等级大于18级解锁)|r"
		elseif ( i == 7 ) then
			return "|cff33cccc(加入指定公会[点击查看]解锁)|r"
		elseif ( i == 8 ) then
			return "|cff33cccc(获取赞助权限解锁)|r"
		elseif ( i == 9 ) then
			return "|cff33cccc(击败傀儡樱乐与梵胤解锁)|r"
		endif
		return ""
	endfunction
 function Box___GetBoxType takes integer i returns integer
		if ( i == 1 ) then
			return 'n01R'
		elseif ( i == 2 ) then
			return 'n01Z'
		elseif ( i == 3 ) then
			return 'n026'
		elseif ( i == 4 ) then
			return 'n027'
		elseif ( i == 5 ) then
			return 'n020'
		elseif ( i == 6 ) then
			return 'n021'
		elseif ( i == 7 ) then
			return 'n024'
		elseif ( i == 8 ) then
			return 'n025'
		elseif ( i == 9 ) then
			return 'n02D'
		endif
		return 0
	endfunction
 function Box___GetBoxAbility takes integer i returns integer
		if ( i == 1 ) then
			return 'A0KW'
		elseif ( i == 2 ) then
			return 'A0MD'
		elseif ( i == 3 ) then
			return 'A0MY'
		elseif ( i == 4 ) then
			return 'A0MZ'
		elseif ( i == 5 ) then
			return 'A0MX'
		elseif ( i == 6 ) then
			return 'Aprg'
		elseif ( i == 7 ) then
			return 'A0N0'
		elseif ( i == 8 ) then
			return 'A0N1'
		elseif ( i == 9 ) then
			return 'A0N7'
		endif
		return 0
	endfunction
 function Box___IsBoxAccess takes player p,integer i returns boolean
		if ( i == 1 ) then
			return IsHasCangku(p , i) or GetCompleteRate(p) >= 0.1 or GetBit(Greward[GetConvertedPlayerId(p)] , 1) > 0
		elseif ( i == 2 ) then
			return IsHasCangku(p , i) or GetCompleteRate(p) >= 0.25 or GetBit(Greward[GetConvertedPlayerId(p)] , 2) > 0
		elseif ( i == 3 ) then
			return IsHasCangku(p , i) or GetCompleteRate(p) >= 0.5 or GetBit(Greward[GetConvertedPlayerId(p)] , 5) > 0
		elseif ( i == 4 ) then
			return IsHasCangku(p , i) or GetCompleteRate(p) >= 0.75 or GetBit(Greward[GetConvertedPlayerId(p)] , 6) > 0
		elseif ( i == 5 ) then
			return IsHasCangku(p , i) or GetCompleteRate(p) >= 0.99 or GetBit(Greward[GetConvertedPlayerId(p)] , 3) > 0
		elseif ( i == 6 ) then
			return IsHasCangku(p , i) or DzAPI_Map_GetMapLevel(p) >= 18 or GetBit(Greward[GetConvertedPlayerId(p)] , 4) > 0
		elseif ( i == 7 ) then
			return IsHasCangku(p , i) or GetBit(Greward[GetConvertedPlayerId(p)] , 7) > 0
			// return IsHasCangku(p,i) or (DzAPI_Map_GetGuildName(p) == "Crainax" or DzAPI_Map_GetGuildName(p) == "大佬娱乐会所" or DzAPI_Map_GetGuildName(p) == "万劫封帝" or DzAPI_Map_GetGuildName(p) == "万劫录") or GetBit(Greward[GetConvertedPlayerId(p)],7) > 0 todo: 网易删除了这个API
		elseif ( i == 8 ) then
			return IsHasCangku(p , i) or IsPIV(p) or GetBit(Greward[GetConvertedPlayerId(p)] , 8) > 0
		elseif ( i >= 9 ) then
			return IsHasCangku(p , i)
		endif
		return false
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Box___CreateNewBox takes player p,integer i returns nothing
  local integer ii= 1
  local real x= GetUnitX(UDepot[GetConvertedPlayerId(p)])
  local real y= GetUnitY(UDepot[GetConvertedPlayerId(p)])
		loop
			exitwhen ii > 6
    		call UnitRemoveItemSwapped(UnitItemInSlotBJ(UDepot[GetConvertedPlayerId(p)], ii), UDepot[GetConvertedPlayerId(p)])
			set ii=ii + 1
		endloop
		call RemoveUnit(UDepot[GetConvertedPlayerId(p)])
		set UDepot[GetConvertedPlayerId(p)]=CreateUnit(p, Box___GetBoxType(i), x, y, 270.000)
		if ( GetDiffculty() <= 8 or i >= 9 ) then
			call UnitAddAbility(UDepot[GetConvertedPlayerId(p)], Box___GetBoxAbility(i))
		endif
	endfunction
 function Box___ChooseBoxClick takes nothing returns nothing
     local dialog d= GetClickedDialogBJ()
     local player p= LoadPlayerHandle(LHTable, GetHandleId(d), 11)
     local integer i= 1
	    loop
	    	exitwhen i > 9
	        if ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), i) ) then
				if ( i == 7 ) then
					call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r加入以下这4个公会之一即可:<小可爱>Crainax/<逆苍天>大佬娱乐会所/<万劫>万劫封帝/<六界王＞万劫录。")
					call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【备注】|r<轮回>六界联盟公会会长已经被不法手段窃取,故该公会已不属于认证轮回公会!")
				endif
	        	if ( Box___IsBoxAccess(p , i) ) then
	    			call Box___CreateNewBox(p , i)
	    			call Box___InitBoxWord(p)
	        	endif
			endif
	    	set i=i + 1
	    endloop
        call FlushChildHashtable(LHTable, GetHandleId(d))
    	call DialogDisplay(Player(0), d, false)
        call DialogClear(d)
        call DialogDestroy(d)
        set d=null
        call DestroyTrigger(GetTriggeringTrigger())
	endfunction
 function ChangeSpinDialog takes player p returns nothing
     local trigger t= CreateTrigger()
     local dialog d= DialogCreate()
     local integer i= 1
	    call DialogSetMessage(d, "\n	    完成挑战:(" + I2S(GetAllComplete(p)) + "/" + I2S(COUNT_CHALLANGER * 3) + "=" + I2S(R2I(GetCompleteRate(p) * 100)) + "%)\n	    箱子变形:")
    	call SaveButtonHandle(LHTable, GetHandleId(d), 9, DialogAddButtonBJ(d, Box___GetBoxName(9) + S3(Box___IsBoxAccess(p , 9) , "|cffff9900(已解锁)|r" , Box___GetBoxCondition(9))))
	    loop
	    	exitwhen i > 8
	    	call SaveButtonHandle(LHTable, GetHandleId(d), i, DialogAddButtonBJ(d, Box___GetBoxName(i) + S3(Box___IsBoxAccess(p , i) , "|cffff9900(已解锁)|r" , Box___GetBoxCondition(i))))
	    	set i=i + 1
	    endloop
    	call SaveButtonHandle(LHTable, GetHandleId(d), 10, DialogAddButton(d, "取消|cffff6800(Esc)|r", 512))
    	call SavePlayerHandle(LHTable, GetHandleId(d), 11, p)
	    call DialogDisplay(p, d, true)
	    call TriggerRegisterDialogEvent(t, d)
	    call TriggerAddAction(t, function Box___ChooseBoxClick)
	    set d=null
	    set t=null
	endfunction
//---------------------------------------------------------------------------------------------------

//library Box ends
//library CenterCredit:
//---------------------------------------------------------------------------------------------------
	
 function CenterCredit__TBuySoliderCon takes nothing returns boolean
		return ( GetUnitTypeId(GetSellingUnit()) == 'uS02' ) and RectContainsUnit(regionM1[GetConvertedPlayerId(GetOwningPlayer(GetBuyingUnit()))], GetSellingUnit())
	endfunction
 function CenterCredit__TBuySoliderAct takes nothing returns nothing
  local integer index= GetConvertedPlayerId(GetOwningPlayer(GetBuyingUnit()))
  local real x
  local real y
//textmacro instance: BuySoldier("uG01","1")
		if ( GetUnitTypeId(GetSoldUnit()) == 'uG01' ) then
			if ( centerCredit[index] < CenterCredit__CREDIT_SOLIDER_1 ) then
				call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0., 0., "|cFFFF66CC【消息】|r你的守家积分只有" + I2S(centerCredit[index]) + ",不足" + I2S(CenterCredit__CREDIT_SOLIDER_1))
				call RemoveUnit(GetSoldUnit())
				return
			endif
			set centerCredit[index]=centerCredit[index] - CenterCredit__CREDIT_SOLIDER_1
			set x=GetRectCenterX(regionM1[index])
			set y=GetRectCenterY(regionM1[index])
			call YDWEMultiboardSetItemValueBJNull(udg_D , 9 , index + 1 , I2S(centerCredit[index]))
			call SetUnitX(GetSoldUnit(), x)
			call SetUnitY(GetSoldUnit(), y)
	        call PanCameraToTimedForPlayer(GetOwningPlayer(GetBuyingUnit()), x, y, 0.2)
	        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", x, y))
	        call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0., 0., "|cFFFF66CC【消息】|r雇佣成功!")
	        return
		endif
//end of: BuySoldier("uG01","1")
//textmacro instance: BuySoldier("uG02","2")
		if ( GetUnitTypeId(GetSoldUnit()) == 'uG02' ) then
			if ( centerCredit[index] < CenterCredit__CREDIT_SOLIDER_2 ) then
				call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0., 0., "|cFFFF66CC【消息】|r你的守家积分只有" + I2S(centerCredit[index]) + ",不足" + I2S(CenterCredit__CREDIT_SOLIDER_2))
				call RemoveUnit(GetSoldUnit())
				return
			endif
			set centerCredit[index]=centerCredit[index] - CenterCredit__CREDIT_SOLIDER_2
			set x=GetRectCenterX(regionM2[index])
			set y=GetRectCenterY(regionM2[index])
			call YDWEMultiboardSetItemValueBJNull(udg_D , 9 , index + 1 , I2S(centerCredit[index]))
			call SetUnitX(GetSoldUnit(), x)
			call SetUnitY(GetSoldUnit(), y)
	        call PanCameraToTimedForPlayer(GetOwningPlayer(GetBuyingUnit()), x, y, 0.2)
	        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", x, y))
	        call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0., 0., "|cFFFF66CC【消息】|r雇佣成功!")
	        return
		endif
//end of: BuySoldier("uG02","2")
//textmacro instance: BuySoldier("uG03","3")
		if ( GetUnitTypeId(GetSoldUnit()) == 'uG03' ) then
			if ( centerCredit[index] < CenterCredit__CREDIT_SOLIDER_3 ) then
				call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0., 0., "|cFFFF66CC【消息】|r你的守家积分只有" + I2S(centerCredit[index]) + ",不足" + I2S(CenterCredit__CREDIT_SOLIDER_3))
				call RemoveUnit(GetSoldUnit())
				return
			endif
			set centerCredit[index]=centerCredit[index] - CenterCredit__CREDIT_SOLIDER_3
			set x=GetRectCenterX(regionM3[index])
			set y=GetRectCenterY(regionM3[index])
			call YDWEMultiboardSetItemValueBJNull(udg_D , 9 , index + 1 , I2S(centerCredit[index]))
			call SetUnitX(GetSoldUnit(), x)
			call SetUnitY(GetSoldUnit(), y)
	        call PanCameraToTimedForPlayer(GetOwningPlayer(GetBuyingUnit()), x, y, 0.2)
	        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", x, y))
	        call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0., 0., "|cFFFF66CC【消息】|r雇佣成功!")
	        return
		endif
//end of: BuySoldier("uG03","3")
//textmacro instance: BuySoldier("uG04","4")
		if ( GetUnitTypeId(GetSoldUnit()) == 'uG04' ) then
			if ( centerCredit[index] < CenterCredit__CREDIT_SOLIDER_4 ) then
				call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0., 0., "|cFFFF66CC【消息】|r你的守家积分只有" + I2S(centerCredit[index]) + ",不足" + I2S(CenterCredit__CREDIT_SOLIDER_4))
				call RemoveUnit(GetSoldUnit())
				return
			endif
			set centerCredit[index]=centerCredit[index] - CenterCredit__CREDIT_SOLIDER_4
			set x=GetRectCenterX(regionM4[index])
			set y=GetRectCenterY(regionM4[index])
			call YDWEMultiboardSetItemValueBJNull(udg_D , 9 , index + 1 , I2S(centerCredit[index]))
			call SetUnitX(GetSoldUnit(), x)
			call SetUnitY(GetSoldUnit(), y)
	        call PanCameraToTimedForPlayer(GetOwningPlayer(GetBuyingUnit()), x, y, 0.2)
	        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", x, y))
	        call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0., 0., "|cFFFF66CC【消息】|r雇佣成功!")
	        return
		endif
//end of: BuySoldier("uG04","4")
		if ( GetUnitTypeId(GetSoldUnit()) == 'uG05' ) then
			if ( IsPIV(GetOwningPlayer(GetBuyingUnit())) != true ) then
				call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0., 0., "|cFFFF66CC【消息】|r你不是永久赞助.")
				call RemoveUnit(GetSoldUnit())
				return
			endif
			if ( udg_Bo < 18 ) then
				call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0., 0., "|cFFFF66CC【消息】|r当前波数未到18波,尚未可以购买.")
				call RemoveUnit(GetSoldUnit())
				return
			endif
			set x=GetRectCenterX(regionM5[index])
			set y=GetRectCenterY(regionM5[index])
			call SetUnitX(GetSoldUnit(), x)
			call SetUnitY(GetSoldUnit(), y)
	        call PanCameraToTimedForPlayer(GetOwningPlayer(GetBuyingUnit()), x, y, 0.2)
	        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", x, y))
	        call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0., 0., "|cFFFF66CC【消息】|r雇佣成功!")
		endif
		if ( GetUnitTypeId(GetSoldUnit()) == 'uG06' ) then
			if ( IsPIV(GetOwningPlayer(GetBuyingUnit())) != true ) then
				call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0., 0., "|cFFFF66CC【消息】|r你不是永久赞助.")
				call RemoveUnit(GetSoldUnit())
				return
			endif
			if ( udg_Bo < 22 ) then
				call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0., 0., "|cFFFF66CC【消息】|r当前波数未到22波,尚未可以购买.")
				call RemoveUnit(GetSoldUnit())
				return
			endif
			set x=GetRectCenterX(regionM6[index])
			set y=GetRectCenterY(regionM6[index])
			call SetUnitX(GetSoldUnit(), x)
			call SetUnitY(GetSoldUnit(), y)
			call IssueImmediateOrder(GetSoldUnit(), "stop")
	        call PanCameraToTimedForPlayer(GetOwningPlayer(GetBuyingUnit()), x, y, 0.2)
	        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", x, y))
	        call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0., 0., "|cFFFF66CC【消息】|r雇佣成功!")
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SimulateDamageSoldier takes unit u returns boolean
		if ( GetUnitAbilityLevel(u, 'A0GZ') >= 1 and ( Is20Unit(GetTriggerUnit()) or Is10Unit(GetTriggerUnit()) ) ) then
			call DisableTrigger(GetTriggeringTrigger())
			call SetUnitLifeBJ(GetTriggerUnit(), 100)
			call UnitDamageTarget(u, GetTriggerUnit(), 1000, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_POISON, WEAPON_TYPE_WHOKNOWS)
			call EnableTrigger(GetTriggeringTrigger())
			return true
		endif
		return false
	endfunction
//---------------------------------------------------------------------------------------------------
 function CenterCredit__InitCenterCredit takes nothing returns nothing
  local trigger t= CreateTrigger()
		call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_SELL)
		call TriggerAddCondition(t, Condition(function CenterCredit__TBuySoliderCon))
		call TriggerAddAction(t, function CenterCredit__TBuySoliderAct)
		set t=null
	endfunction

//library CenterCredit ends
//library Hundun:
//---------------------------------------------------------------------------------------------------
	
 function Hundun___ClearGroup takes nothing returns nothing
		call RemoveUnit(GetEnumUnit())
	endfunction
 function DestroyHundun1 takes nothing returns nothing
		if ( MLHundun != 0 ) then
			call s__MultiLife_deallocate(MLHundun)
		endif
		call PauseTimer(THundunDian)
		call DestroyTimer(THundunDian)
		call ForGroup(GHundunDian, function Hundun___ClearGroup)
		call ForGroup(GHundunAttack, function Hundun___ClearGroup)
		call DestroyGroup(GHundunDian)
		set MLHundun=0
		set GHundunDian=null
		set THundunDian=null
		call DestroyGroup(GHundunAttack)
		set GHundunAttack=null
		call DisableTrigger(THundunSpellDamage)
	endfunction
 function DestroyHundun2 takes nothing returns nothing
		call DestroyHundun1()
		call s__Attract_deallocate(AHundun2)
		call s__SuperShield_deallocate(TShieldHundun)
		set AHundun2=0
		set TShieldHundun=0
	endfunction
//---------------------------------------------------------------------------------------------------
    
    function HundunMonsterFilter takes nothing returns boolean
        return ( ( ( IsUnitAliveBJ(GetFilterUnit()) == true ) and ( GetOwningPlayer(GetFilterUnit()) == Player(10) ) ) )
    endfunction
    function HundunPlayerFilter takes nothing returns boolean
        return ( ( IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) == true ) and ( GetPlayerController(GetOwningPlayer(GetFilterUnit())) == MAP_CONTROL_USER ) and ( IsUnitAliveBJ(GetFilterUnit()) or ( GetFilterUnit() == udg_H[GetConvertedPlayerId(GetOwningPlayer(GetFilterUnit()))] and not ( IsWanjie() ) ) ) )
    endfunction
    function ClearHundunRegion takes rect r returns nothing
        local unit l_unit= null
        local group group2= YDWEGetUnitsInRectMatchingNull(r , Condition(function HundunMonsterFilter))
        set group2=YDWEGetUnitsInRectMatchingNull(r , Condition(function HundunMonsterFilter))
        loop
            set l_unit=FirstOfGroup(group2)
            exitwhen l_unit == null
            call GroupRemoveUnit(group2, l_unit)
            call FlushChildHashtable(YDHT, GetHandleId(l_unit))
            call RemoveUnit(l_unit)
        endloop
        call DestroyGroup(group2)
        set group2=null
        set l_unit=null
    endfunction
    function TLeaveHundunRegionCon takes nothing returns boolean
        return ( ( GetPlayerController(GetOwningPlayer(GetLeavingUnit())) == MAP_CONTROL_USER ) )
    endfunction
    function TLeaveHundunRegionAct takes nothing returns nothing
        local group group1= YDWEGetUnitsInRectMatchingNull(gg_rct_Hundun , Condition(function HundunPlayerFilter))
        if ( ( CountUnitsInGroup(group1) == 0 ) ) then
            call ClearHundunRegion(gg_rct_Hundun)
            call DestroyHundun1()
        endif
        call DestroyGroup(group1)
        set group1=null
    endfunction
//---------------------------------------------------------------------------------------------------
	
 function SpellDian takes unit temp returns nothing
  local integer i= 1
  local integer end= IMaxBJ(1, s__MultiLife_getTimes(MLHundun)) * 18
  local real random= GetRandomReal(0, 360.)
  local unit u= null
		loop
			exitwhen i > ( end * 3 / 4 )
			set u=CreateUnit(Player(10), 'h01O', GetUnitX(temp) + 10 * CosBJ(ModuloReal(i * ( 360 / end ) + random, 360)), GetUnitY(temp) + 10 * SinBJ(ModuloReal(i * ( 360 / end ) + random, 360)), ModuloReal(i * ( 360 / end ) + random, 360))
        	call YDWEAroundSystem(u , temp , 0.00 , 20. , 0 , 5 , 0.05)
        	call UnitApplyTimedLife(u, 'BHwe', 5)
			set i=i + 1
		endloop
		set u=null
	endfunction
 function Hundun___flashDian takes nothing returns nothing
		call SpellDian(GroupPickRandomUnit(GHundunDian))
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Hundun___HundunTransimit takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local unit u= LoadUnitHandle(spellTable, id, 1)
		if ( IsUnitAliveBJ(u) ) then
			call TLeaveHundunRegionAct()
		else
			call PauseTimer(t)
			call FlushChildHashtable(spellTable, id)
			call DestroyTimer(t)
		endif
		set u=null
		set t=null
	endfunction
 function StartJudgeTransmitHundun takes unit u returns nothing
  local timer t= CreateTimer()
		call SaveUnitHandle(spellTable, GetHandleId(t), 1, u)
		call TimerStart(t, 2, true, function Hundun___HundunTransimit)
		set t=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Hundun___Hundun2SetLifeLess takes unit u returns nothing
		call s__Attract_setSpeed(AHundun2,- 16)
		call s__SuperShield_deallocate(TShieldHundun)
        set TShieldHundun=s__SuperShield_create(UHundun , I3(IsWanjie() , 3 , 1))
        call s__SuperShield_SetDeathContinue(TShieldHundun)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitHundun1 takes unit u returns nothing
  local integer i= 1
  local unit temp= null
		set UHundun=u
		call BossAddOnlyAttack(UHundun)
		set MLHundun=s__MultiLife_create(u , 2)
		//召唤电子盟
		set GHundunDian=CreateGroup()
		set GHundunAttack=CreateGroup()
    	call SetPlayerTechResearchedSwap(GetHundunTech(), hundun1_level, Player(10))
		loop
			exitwhen i > ( GetDiffculty() / 2 + 1 )
			set temp=CreateUnit(Player(10), 'h01Q', GetRandomReal(GetRectMinX(gg_rct_Hundun), GetRectMaxX(gg_rct_Hundun)), GetRandomReal(GetRectMinY(gg_rct_Hundun), GetRectMaxY(gg_rct_Hundun)), GetRandomReal(0, 360))
			call GroupAddUnit(GHundunDian, temp)
			call IssuePointOrder(temp, "patrol", GetRandomReal(GetRectMinX(gg_rct_Hundun), GetRectMaxX(gg_rct_Hundun)), GetRandomReal(GetRectMinY(gg_rct_Hundun), GetRectMaxY(gg_rct_Hundun)))
			set i=i + 1
		endloop
		set THundunDian=CreateTimer()
		call TimerStart(THundunDian, ( 10 / ( GetDiffculty() / 2 + 1 ) ), true, function Hundun___flashDian)
		//召唤攻击盟
		set i=1
		loop
			exitwhen i > ( GetDiffculty() / 2 + 1 )
			call GroupAddUnit(GHundunAttack, CreateUnit(Player(10), 'h01R', GetRandomReal(GetRectMinX(gg_rct_Hundun), GetRectMaxX(gg_rct_Hundun)), GetRandomReal(GetRectMinY(gg_rct_Hundun), GetRectMaxY(gg_rct_Hundun)), GetRandomReal(0, 360)))
			set i=i + 1
		endloop
		call EnableTrigger(THundunSpellDamage)
		set hundun_playerID=GetConvertedPlayerId(GetOwningPlayer(GetBuyingUnit()))
		if ( IsWanjie() ) then
			call StartJudgeTransmitHundun(u)
		endif
		set temp=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitHundun2 takes unit u returns nothing
		call InitHundun1(u)
    	call SetPlayerTechResearchedSwap(GetHundun2Tech(), hundun2_level, Player(10))
        set AHundun2=s__Attract_create(u , 3000 , 0.05 , - 8)
        call s__Attract_SetDeathContinue(AHundun2)
        call s__Attract_start(AHundun2)
        call s__MultiLife_setAL(MLHundun,(2))
        set TShieldHundun=s__SuperShield_create(u , I3(IsWanjie() , 3 , 1))
        call s__SuperShield_SetDeathContinue(TShieldHundun)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function HundunDeath takes nothing returns nothing
		set hundun1_level=hundun1_level + I3(IsTianyan , 3 , 1)
		call DestroyHundun1()
		 if ( ( hundun_playerID != 0 ) ) then
            call UnitAddItemByIdSwapped('I062', UDepot[hundun_playerID])
            call SetUnitPosition(UDepot[hundun_playerID], GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit()))
        else
            call CreateItem('I062', GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit()))
        endif
        set hundun_playerID=0
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Hundun2Death takes nothing returns nothing
		set hundun2_level=hundun2_level + I3(IsTianyan , 3 , 1)
		call DestroyHundun2()
		 if ( ( hundun_playerID != 0 ) ) then
            call UnitAddItemByIdSwapped('I07R', UDepot[hundun_playerID])
            call SetUnitPosition(UDepot[hundun_playerID], GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit()))
        else
            call CreateItem('I07R', GetUnitX(GetDyingUnit()), GetUnitY(GetDyingUnit()))
        endif
        set hundun_playerID=0
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Hundun___THundunSpellDamageCon takes nothing returns boolean
		return udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] == GetTriggerUnit()
	endfunction
 function THundunSpellDamageAct takes nothing returns nothing
		if ( YDWEDistanceBetweenUnits(UHundun , GetTriggerUnit()) < 1800 ) then
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Stampede\\StampedeMissileDeath.mdl", GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit())))
			call UnitDamageTarget(UHundun, GetTriggerUnit(), GetUnitState(GetTriggerUnit(), UNIT_STATE_MAX_LIFE) * 0.1, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_SLOW_POISON, WEAPON_TYPE_WHOKNOWS)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function DialogCombineClick takes nothing returns nothing
     local dialog d= GetClickedDialogBJ()
     local unit u= LoadUnitHandle(itemTable, GetHandleId(d), 3)
        call RemoveItem(LoadItemHandle(itemTable, GetHandleId(d), 7))
        call RemoveItem(LoadItemHandle(itemTable, GetHandleId(d), 8))
        if ( GetClickedButtonBJ() == LoadButtonHandle(itemTable, GetHandleId(d), 1) ) then
			call UnitAddItemByIdSwapped(LoadInteger(itemTable, GetHandleId(d), 4), u)
	        call SetItemCharges(GetLastCreatedItem(), LoadInteger(itemTable, GetHandleId(d), 6))
        endif
        if ( GetClickedButtonBJ() == LoadButtonHandle(itemTable, GetHandleId(d), 2) ) then
			call UnitAddItemByIdSwapped(LoadInteger(itemTable, GetHandleId(d), 5), u)
	        call SetItemCharges(GetLastCreatedItem(), LoadInteger(itemTable, GetHandleId(d), 6))
        endif
        call FlushChildHashtable(itemTable, GetHandleId(d))
    	call DialogDisplay(GetOwningPlayer(u), d, false)
        call DialogClear(d)
        call DialogDestroy(d)
        call PlaySoundBJ(gg_snd_hecheng_shenqi)
        call BJDebugMsg("|cFFFF66CC【消息】|r" + GetItemName(GetLastCreatedItem()) + "降临于世!!!")
        call BJDebugMsg("|cFFFF66CC【消息】|r" + GetItemName(GetLastCreatedItem()) + "降临于世!!!")
        call BJDebugMsg("|cFFFF66CC【消息】|r" + GetItemName(GetLastCreatedItem()) + "降临于世!!!")
        call BJDebugMsg("|cFFFF66CC【消息】|r" + GetItemName(GetLastCreatedItem()) + "降临于世!!!")
        set d=null
        set u=null
        call DestroyTrigger(GetTriggeringTrigger())
	endfunction
 function DialogCombine takes unit buyer,integer materials1,integer materials2,integer targetItem1,integer targetItem2,string targetName1,string targetName2,integer lumber returns nothing
  local trigger t
     local dialog d
     local integer i
		if ( ( GetItemTypeId(YDWEGetItemOfTypeFromUnitBJNull(GetBuyingUnit() , materials1)) == materials1 ) and ( GetItemTypeId(YDWEGetItemOfTypeFromUnitBJNull(GetBuyingUnit() , materials2)) == materials2 ) and ( IsItemPawnable(YDWEGetItemOfTypeFromUnitBJNull(GetBuyingUnit() , materials1)) ) and ( IsItemPawnable(YDWEGetItemOfTypeFromUnitBJNull(GetBuyingUnit() , materials2)) ) ) then
	    	set i=GetItemCharges(YDWEGetItemOfTypeFromUnitBJNull(GetBuyingUnit() , materials1))
			set t=CreateTrigger()
			set d=DialogCreate()
			call DialogSetMessage(d, "你想合成为:")
			call SaveButtonHandle(itemTable, GetHandleId(d), 1, DialogAddButton(d, targetName1, '1'))
			call SaveButtonHandle(itemTable, GetHandleId(d), 2, DialogAddButton(d, targetName2, '2'))
			call SaveUnitHandle(itemTable, GetHandleId(d), 3, buyer)
			call SaveInteger(itemTable, GetHandleId(d), 4, targetItem1)
			call SaveInteger(itemTable, GetHandleId(d), 5, targetItem2)
			call SaveInteger(itemTable, GetHandleId(d), 6, i)
			call SaveItemHandle(itemTable, GetHandleId(d), 7, YDWEGetItemOfTypeFromUnitBJNull(GetBuyingUnit() , materials1))
			call SaveItemHandle(itemTable, GetHandleId(d), 8, YDWEGetItemOfTypeFromUnitBJNull(GetBuyingUnit() , materials2))
			call DialogDisplay(GetOwningPlayer(buyer), d, true)
			call TriggerRegisterDialogEvent(t, d)
			call TriggerAddAction(t, function DialogCombineClick)
			set d=null
			set t=null
	    else
	        call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r你的材料不足.")
	        call AdjustPlayerStateBJ(lumber, GetOwningPlayer(GetBuyingUnit()), PLAYER_STATE_RESOURCE_LUMBER)
	        return
	    endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CombineI takes unit buyer,integer materials1,integer materials2,integer targetItem,integer lumber,boolean hints returns nothing
     local integer i
		if ( ( GetItemTypeId(YDWEGetItemOfTypeFromUnitBJNull(GetBuyingUnit() , materials1)) == materials1 ) and ( GetItemTypeId(YDWEGetItemOfTypeFromUnitBJNull(GetBuyingUnit() , materials2)) == materials2 ) and ( IsItemPawnable(YDWEGetItemOfTypeFromUnitBJNull(GetBuyingUnit() , materials1)) ) and ( IsItemPawnable(YDWEGetItemOfTypeFromUnitBJNull(GetBuyingUnit() , materials2)) ) ) then
	    	set i=GetItemCharges(YDWEGetItemOfTypeFromUnitBJNull(GetBuyingUnit() , materials1))
	        call RemoveItem(YDWEGetItemOfTypeFromUnitBJNull(GetBuyingUnit() , materials1))
	        call RemoveItem(YDWEGetItemOfTypeFromUnitBJNull(GetBuyingUnit() , materials2))
			call UnitAddItemByIdSwapped(targetItem, GetBuyingUnit())
    		call SetItemCharges(GetLastCreatedItem(), i)
        	call PlaySoundBJ(gg_snd_hecheng_shenqi)
        	call BJDebugMsg("|cFFFF66CC【消息】|r" + GetItemName(GetLastCreatedItem()) + "降临于世!!!")
        	call BJDebugMsg("|cFFFF66CC【消息】|r" + GetItemName(GetLastCreatedItem()) + "降临于世!!!")
        	call BJDebugMsg("|cFFFF66CC【消息】|r" + GetItemName(GetLastCreatedItem()) + "降临于世!!!")
        	call BJDebugMsg("|cFFFF66CC【消息】|r" + GetItemName(GetLastCreatedItem()) + "降临于世!!!")
	    else
	    	if ( hints ) then
	        	call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r你的材料不足.")
	    	endif
	        call AdjustPlayerStateBJ(lumber, GetOwningPlayer(GetBuyingUnit()), PLAYER_STATE_RESOURCE_LUMBER)
	        return
	    endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Yitian takes nothing returns nothing
  local integer i= 1
		loop
			exitwhen i > 6
			if ( ( GetPlayerSlotState(ConvertedPlayer(i)) == PLAYER_SLOT_STATE_PLAYING ) and ( GetPlayerController(ConvertedPlayer(i)) == MAP_CONTROL_USER ) and udg_H[i] != null ) then
				if ( YDWEUnitHasItemOfTypeBJNull(udg_H[i] , 'I04L') or YDWEUnitHasItemOfTypeBJNull(udg_H[i] , 'I04M') ) then
				    call AdjustPlayerStateBJ(I3(IsWanjie() , 600 / udg_RENSHU , 600) * CModeH(1 , 2), ConvertedPlayer(i), PLAYER_STATE_RESOURCE_LUMBER)
				    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Transmute\\PileofGold.mdl", GetUnitX(udg_H[i]), GetUnitY(udg_H[i])))
				elseif ( YDWEUnitHasItemOfTypeBJNull(udg_H[i] , 'rat6') ) then
				    call AdjustPlayerStateBJ(I3(IsWanjie() , 500 / udg_RENSHU , 500) * CModeH(1 , 2), ConvertedPlayer(i), PLAYER_STATE_RESOURCE_LUMBER)
				    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Transmute\\PileofGold.mdl", GetUnitX(udg_H[i]), GetUnitY(udg_H[i])))
				endif
			endif
			set i=i + 1
		endloop
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CombineJiaoyue takes unit u returns nothing
		if ( ( GetItemTypeId(YDWEGetItemOfTypeFromUnitBJNull(u , 'rat6')) == 'rat6' ) and ( GetItemTypeId(YDWEGetItemOfTypeFromUnitBJNull(u , 'ratc')) == 'ratc' ) and ( GetItemTypeId(YDWEGetItemOfTypeFromUnitBJNull(u , 'mcou')) == 'mcou' ) and ( IsItemPawnable(YDWEGetItemOfTypeFromUnitBJNull(u , 'rat6')) ) and ( IsItemPawnable(YDWEGetItemOfTypeFromUnitBJNull(u , 'mcou')) ) and ( IsItemPawnable(YDWEGetItemOfTypeFromUnitBJNull(u , 'ratc')) ) ) then
            call YDWEPolledWaitNull(0.01)
            call RemoveItem(YDWEGetItemOfTypeFromUnitBJNull(u , 'ratc'))
            call RemoveItem(YDWEGetItemOfTypeFromUnitBJNull(u , 'mcou'))
            call RemoveItem(YDWEGetItemOfTypeFromUnitBJNull(u , 'rat6'))
            call UnitAddItemById(u, 'I04L')
			call BJDebugMsg("|cFFFF66CC【消息】|r尘封的|cffff00ff【混沌】圣剑-皎月|r降世!!!!!!!")
			call BJDebugMsg("|cFFFF66CC【消息】|r尘封的|cffff00ff【混沌】圣剑-皎月|r降世!!!!!!!")
			call BJDebugMsg("|cFFFF66CC【消息】|r尘封的|cffff00ff【混沌】圣剑-皎月|r降世!!!!!!!")
			return
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CombineHundunyeai takes nothing returns nothing
  local integer i
		if ( ( GetItemTypeId(GetSoldItem()) == 'I04Q' ) ) then
		    if ( ( GetItemTypeId(YDWEGetItemOfTypeFromUnitBJNull(GetBuyingUnit() , 'I04L')) == 'I04L' ) and ( GetItemTypeId(YDWEGetItemOfTypeFromUnitBJNull(GetBuyingUnit() , 'stel')) == 'stel' ) and ( IsItemPawnable(YDWEGetItemOfTypeFromUnitBJNull(GetBuyingUnit() , 'I04L')) == true ) ) then
		    	set i=GetItemCharges(YDWEGetItemOfTypeFromUnitBJNull(GetBuyingUnit() , 'stel'))
		        call RemoveItem(YDWEGetItemOfTypeFromUnitBJNull(GetBuyingUnit() , 'I04L'))
		        call RemoveItem(YDWEGetItemOfTypeFromUnitBJNull(GetBuyingUnit() , 'stel'))
		        call UnitAddItemByIdSwapped('I04M', GetBuyingUnit())
		        call SetItemCharges(GetLastCreatedItem(), i)
				call BJDebugMsg("|cFFFF66CC【消息】|r尘封的|cFF66CC33【混沌】夜之哀伤|r降世!!!!!!!")
				call BJDebugMsg("|cFFFF66CC【消息】|r尘封的|cFF66CC33【混沌】夜之哀伤|r降世!!!!!!!")
				call BJDebugMsg("|cFFFF66CC【消息】|r尘封的|cFF66CC33【混沌】夜之哀伤|r降世!!!!!!!")
		        return
		    else
		        call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r你的材料不足.")
		        call AdjustPlayerStateBJ(1000, GetOwningPlayer(GetBuyingUnit()), PLAYER_STATE_RESOURCE_LUMBER)
		        return
		    endif
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function CombineHundunAll takes nothing returns nothing
		if ( ( GetItemTypeId(GetSoldItem()) == 'I064' ) ) then
			call DialogCombine(GetBuyingUnit() , 'tlum' , 'I062' , 'ICS1' , 'I04W' , "|cffffff00【混沌】诛神噬魔-贯|r(强大的破防能力与直刺生命的六元幽冥)" , "|cffffff00【混沌】诛神噬魔-袭|r(觉醒于融合六界之力的六元幽冥)" , 1000)
		endif
		if ( ( GetItemTypeId(GetSoldItem()) == 'I063' ) ) then
			call DialogCombine(GetBuyingUnit() , 'ssil' , 'I062' , 'I04Y' , 'I05T' , "|cffff9900【混沌】幽冥项链-亡|r(用生命换取贯穿寰宇的力量)" , "|cffff9900【混沌】幽冥项链-凌|r(源源不断的圣界之力)" , 1000)
		endif
		if ( ( GetItemTypeId(GetSoldItem()) == 'I065' ) ) then
			call DialogCombine(GetBuyingUnit() , 'lhst' , 'I062' , 'I05W' , 'I05V' , "|cffff00ff【混沌】魑魅魍魉-忌|r(更为玄幻的灵魂吸收之力)" , "|cffff00ff【混沌】魑魅魍魉-禁|r(空间跳跃，厉鬼相随)" , 1000)
		endif
		if ( ( GetItemTypeId(GetSoldItem()) == 'I066' ) ) then
			call DialogCombine(GetBuyingUnit() , 'I05F' , 'I062' , 'ICY1' , 'I05X' , "|cff99cc00【混沌】九渊冥鸢|r(无缺之体,坚不可摧)" , "|cff99cc00【混沌】绯绫三生燕|r(燎原之火,焚照千里)" , 1000)
		endif
		if ( ( GetItemTypeId(GetSoldItem()) == 'I067' ) ) then
			call DialogCombine(GetBuyingUnit() , 'IB09' , 'I062' , 'IB0A' , 'I04X' , "|cffff00ff【混沌】十翼|r|cffff0000天龙|r(拥有较强群体杀伤能力)" , "|cffff00ff【混沌】华缈|r|cffff0000弥鹤|r(拥有强大的单体杀伤能力)" , 1000)
		endif
		if ( ( GetItemTypeId(GetSoldItem()) == 'I068' ) ) then
			call CombineI(GetBuyingUnit() , 'rst1' , 'I062' , 'ICX1' , 1000 , true)
		endif
		if ( ( GetItemTypeId(GetSoldItem()) == 'I069' ) ) then
			call CombineI(GetBuyingUnit() , 'tbsm' , 'I062' , 'I05Y' , 0 , false)
			call CombineI(GetBuyingUnit() , 'tfar' , 'I062' , 'I05Z' , 0 , false)
			call CombineI(GetBuyingUnit() , 'tbak' , 'I062' , 'I060' , 0 , false)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function EnterHundun takes nothing returns nothing
  local real x
  local real y
		if ( ( GetItemTypeId(GetSoldItem()) == 'I04T' ) ) then
			set x=GetRectCenterX(gg_rct_Hundun)
			set y=GetRectCenterY(gg_rct_Hundun)
	        call SetUnitX(GetBuyingUnit(), x)
	        call SetUnitY(GetBuyingUnit(), y)
	        call PanCameraToTimedForPlayer(GetOwningPlayer(GetBuyingUnit()), x, y, 0.2)
	        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl", x, y))
	        call DisplayTextToPlayer(GetOwningPlayer(GetBuyingUnit()), 0, 0, "|cFFFF66CC【消息】|r回去输入“HG”。")
	    endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function InitHundunInner takes nothing returns nothing
        local trigger t= CreateTrigger()
        call YDWETriggerRegisterLeaveRectSimpleNull(t , gg_rct_Hundun)
        call TriggerAddCondition(t, Condition(function TLeaveHundunRegionCon))
        call TriggerAddAction(t, function TLeaveHundunRegionAct)
        set t=null
		set THundunSpellDamage=CreateTrigger()
		call TriggerRegisterAnyUnitEventBJ(THundunSpellDamage, EVENT_PLAYER_UNIT_SPELL_EFFECT)
		call TriggerAddCondition(THundunSpellDamage, Condition(function Hundun___THundunSpellDamageCon))
		call TriggerAddAction(THundunSpellDamage, function THundunSpellDamageAct)
		call DisableTrigger(THundunSpellDamage)
	endfunction

//library Hundun ends
//library RandomHero:
//---------------------------------------------------------------------------------------------------
	
 function RandomHero__GetRandomUnitInGroup takes group g returns unit
  local integer length= CountUnitsInGroup(g)
  local integer pos= 0
  local group temp= CreateGroup()
  local unit u= null
  local integer i= 1
		loop
			exitwhen i > ModuloInteger(DzAPI_Map_GetGameStartTime(), 19) + length + udg_Second[1] + udg_Nandu_JJJ
			set pos=GetRandomInt(1, length)
			set i=i + 1
		endloop
		call GroupAddGroup(g, temp)
		loop
			exitwhen pos == 0
			set u=FirstOfGroup(temp)
		    call GroupRemoveUnit(temp, u)
			set pos=pos - 1
		endloop
		call DestroyGroup(temp)
		set temp=null
		return u
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function RandomHero__RandomPickCondition takes nothing returns boolean
		return ( RectContainsUnit(gg_rct_______c1, GetFilterUnit()) and ( not ( IsUnitIsSpin(GetFilterUnit()) ) ) and IsUnitType(GetFilterUnit(), UNIT_TYPE_HERO) )
	endfunction
 function RandomPick takes player p returns nothing
  local integer i= 1
  local group g= YDWEGetUnitsOfPlayerMatchingNull(Player(PLAYER_NEUTRAL_PASSIVE) , Condition(function RandomHero__RandomPickCondition))
  local unit u= null
		if not ( IsPIV(p) ) then
			loop
				exitwhen i > HERO_COUNT
				if ( i == 15 and not ( GetHuanyiSelectedCon(p) ) ) then
					call GroupRemoveUnit(g, gg_unit_Hant_0205)
				elseif ( i == 16 and not ( GetCanglingSelectedCon(p) ) ) then
					call GroupRemoveUnit(g, gg_unit_Nsjs_0209)
				elseif ( i == 18 and not ( GetXinglongSelectedCon(p) ) ) then
					call GroupRemoveUnit(g, gg_unit_Hapm_0255)
				elseif ( i == 19 and not ( GetXiaotingSelectedCon(p) ) ) then
					call GroupRemoveUnit(g, gg_unit_H01Y_0286)
				endif
				set i=i + 1
			endloop
		endif
		call GroupRemoveUnit(g, gg_unit_H02B_0293)
		set BSuiji[GetConvertedPlayerId(p)]=true
		set u=RandomHero__GetRandomUnitInGroup(g)
		call DestroyGroup(g)
		set g=null
	    call SelectUnitForPlayerSingle(u, p)
	    call SelectUnitForPlayerSingle(u, p)
	    set u=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ClearSpin takes nothing returns nothing
  local integer i= 1
  local group g= YDWEGetUnitsOfPlayerMatchingNull(Player(PLAYER_NEUTRAL_PASSIVE) , Condition(function RandomHero__RandomPickCondition))
  local unit l_unit= null
		loop
		    set l_unit=FirstOfGroup(g)
		    exitwhen l_unit == null
		    call GroupRemoveUnit(g, l_unit)
		    if ( IsUnitIsSpin(l_unit) ) then
		    	call RemoveUnit(l_unit)
		    endif
		endloop
		call DestroyGroup(g)
		set g=null
		set l_unit=null
	endfunction

//library RandomHero ends
//library BaseVersion:
 function BaseVersion___TSpeakPasswordBase takes nothing returns nothing
  local string chat= GetEventPlayerChatString()
   if ( BDIYName[GetConvertedPlayerId(GetTriggerPlayer())] ) then
    call SetDIYName(GetTriggerPlayer() , chat)
    set BDIYName[GetConvertedPlayerId(GetTriggerPlayer())]=false
   elseif ( BBuqian1 ) then
   call Buqian2(GetTriggerPlayer() , GetEventPlayerChatString())
   elseif ( BBuqian2 ) then
   call Buqian3(GetTriggerPlayer() , GetEventPlayerChatString())
   elseif ( BBoxName[GetConvertedPlayerId(GetTriggerPlayer())] and chat != "-ck" ) then
    call SetDIYBoxName(GetTriggerPlayer() , chat)
    set BBoxName[GetConvertedPlayerId(GetTriggerPlayer())]=false
   elseif ( BCangkuhuoqu ) then
   call Huoqucangku(GetTriggerPlayer() , GetEventPlayerChatString())
   set BCangkuhuoqu=false
   elseif ( BSpinhuoqu ) then
   call Huoquspin(GetTriggerPlayer() , GetEventPlayerChatString())
   set BSpinhuoqu=false
   elseif ( ISpinachi != 0 ) then
   call Huoquachi(GetTriggerPlayer() , GetEventPlayerChatString() , ISpinachi)
   set ISpinachi=0
   endif
		call TSpeakPassword()
		set chat=null
   set BSlince=true
	endfunction
//---------------------------------------------------------------------------------------------------
 function BaseVersion___InitBaseVersion takes nothing returns nothing
      local trigger t= CreateTrigger()
		    call TriggerRegisterPlayerChatEvent(t, Player(0), "", false)
		    call TriggerRegisterPlayerChatEvent(t, Player(1), "", false)
		    call TriggerRegisterPlayerChatEvent(t, Player(2), "", false)
		    call TriggerRegisterPlayerChatEvent(t, Player(3), "", false)
		    call TriggerRegisterPlayerChatEvent(t, Player(4), "", false)
		    call TriggerRegisterPlayerChatEvent(t, Player(5), "", false)
		    call TriggerAddAction(t, function BaseVersion___TSpeakPasswordBase)
	endfunction

//library BaseVersion ends
//library Combine:
 function Combine___TCombineAllCon takes nothing returns boolean
		return ( IsUnitIllusionBJ(GetManipulatingUnit()) != true )
	endfunction
 function Combine___TCombineAllAct takes nothing returns nothing
		call CombineBeast(GetManipulatingUnit())
		call CombineJiaoyue(GetManipulatingUnit())
	endfunction
 function Combine___TCombineBuyAllCon takes nothing returns boolean
		return BuyerFilter(GetBuyingUnit())
	endfunction
 function Combine___TCombineBuyAllAct takes nothing returns nothing
		call CombineHundunyeai()
		call CombineHundunAll()
	endfunction
//---------------------------------------------------------------------------------------------------
 function Combine___InitCombine takes nothing returns nothing
     local trigger t= CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_PICKUP_ITEM)
	    call TriggerAddCondition(t, Condition(function Combine___TCombineAllCon))
	    call TriggerAddAction(t, function Combine___TCombineAllAct)
	    set t=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_SELL_ITEM)
	    call TriggerAddCondition(t, Condition(function Combine___TCombineBuyAllCon))
	    call TriggerAddAction(t, function Combine___TCombineBuyAllAct)
	    set t=null
	endfunction

//library Combine ends
//library ItemSpell:
//---------------------------------------------------------------------------------------------------
	
 function ItemSpell__TransferItemAct takes nothing returns nothing
		call UnitAddItem(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetSpellAbilityUnit()))], GetSpellTargetItem())
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemSpell__GetHeroItemClick takes nothing returns nothing
        local dialog d= GetClickedDialogBJ()
        local unit u= LoadUnitHandle(LHTable, GetHandleId(d), 8)
        local integer i= 1
        loop
        	exitwhen i > 6
        	if ( GetClickedButtonBJ() == LoadButtonHandle(LHTable, GetHandleId(d), i) ) then
        		if ( UnitItemInSlotBJ(u, i) != null ) then
        			if ( not ( IsMinganItem(UnitItemInSlotBJ(u, i)) ) and not ( IsZhanfahun(UnitItemInSlotBJ(u, i)) and not ( IsItemPawnable(UnitItemInSlotBJ(u, i)) ) ) ) then
						call UnitAddItem(UDepot[GetConvertedPlayerId(GetOwningPlayer(u))], UnitItemInSlotBJ(u, i))
        			else
        				call DisplayTextToPlayer(GetOwningPlayer(u), 0., 0., "|cFFFF66CC【消息】|r该物品不能移动.")
        			endif
        		endif
        	endif
        	set i=i + 1
        endloop
        call FlushChildHashtable(LHTable, GetHandleId(d))
        call DialogDisplay(GetOwningPlayer(u), d, false)
        call DialogClear(d)
        call DialogDestroy(d)
        set d=null
        set u=null
        call DestroyTrigger(GetTriggeringTrigger())
	endfunction
 function ItemSpell__GetHeroItemAct takes nothing returns nothing
        local trigger t= CreateTrigger()
        local unit u= udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]
        local dialog d= DialogCreate()
        call DialogSetMessage(d, "选择你要取走的装备")
	    call SaveButtonHandle(LHTable, GetHandleId(d), 1, DialogAddButton(d, S3(UnitItemInSlotBJ(u, 1) != null , GetItemName(UnitItemInSlotBJ(u, 1)) , "空") + "|cff00ccff(1)|r", '1'))
	    call SaveButtonHandle(LHTable, GetHandleId(d), 2, DialogAddButton(d, S3(UnitItemInSlotBJ(u, 2) != null , GetItemName(UnitItemInSlotBJ(u, 2)) , "空") + "|cff00ccff(2)|r", '2'))
	    call SaveButtonHandle(LHTable, GetHandleId(d), 3, DialogAddButton(d, S3(UnitItemInSlotBJ(u, 3) != null , GetItemName(UnitItemInSlotBJ(u, 3)) , "空") + "|cff00ccff(3)|r", '3'))
	    call SaveButtonHandle(LHTable, GetHandleId(d), 4, DialogAddButton(d, S3(UnitItemInSlotBJ(u, 4) != null , GetItemName(UnitItemInSlotBJ(u, 4)) , "空") + "|cff00ccff(4)|r", '4'))
	    call SaveButtonHandle(LHTable, GetHandleId(d), 5, DialogAddButton(d, S3(UnitItemInSlotBJ(u, 5) != null , GetItemName(UnitItemInSlotBJ(u, 5)) , "空") + "|cff00ccff(5)|r", '5'))
	    call SaveButtonHandle(LHTable, GetHandleId(d), 6, DialogAddButton(d, S3(UnitItemInSlotBJ(u, 6) != null , GetItemName(UnitItemInSlotBJ(u, 6)) , "空") + "|cff00ccff(6)|r", '6'))
	    call SaveButtonHandle(LHTable, GetHandleId(d), 7, DialogAddButton(d, "不传送|cff00ccff(Esc)|r", 512))
        call SaveUnitHandle(LHTable, GetHandleId(d), 8, u)
        call DialogDisplay(GetOwningPlayer(u), d, true)
        call TriggerRegisterDialogEvent(t, d)
        call TriggerAddAction(t, function ItemSpell__GetHeroItemClick)
        set d=null
        set t=null
        set u=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemSpell__Dianjin takes nothing returns nothing
  local integer i= GetHeroLevel(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))])
	    if ( ( RectContainsUnit(gg_rct______________084, GetSpellTargetUnit()) == true ) ) then
	        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, "|cFFFF66CC【提示】|r不能对炼狱的怪使用。")
	        return
	    endif
	    if ( IsLoyalUnit(GetSpellTargetUnit()) ) then
	        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, "|cFFFF66CC【提示】|r不能对忠诚单位使用。")
	        return
	    endif
	    if ( i >= GetUnitLevel(GetSpellTargetUnit()) ) then
	        call SetUnitLifeBJ(GetSpellTargetUnit(), 5.00)
	        call UnitDamageTarget(GetTriggerUnit(), GetSpellTargetUnit(), GetUnitState(GetSpellTargetUnit(), UNIT_STATE_MAX_LIFE) * 10, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_SLOW_POISON, WEAPON_TYPE_WHOKNOWS)
	        call AdjustPlayerStateBJ(( GetHeroLevel(GetTriggerUnit()) * 100 ), GetOwningPlayer(GetTriggerUnit()), PLAYER_STATE_RESOURCE_GOLD)
	        call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Transmute\\PileofGold.mdl", GetUnitX(GetSpellTargetUnit()), GetUnitY(GetSpellTargetUnit())))
	    	call CreateSpellTextTag("+" + I2S(( GetHeroLevel(GetTriggerUnit()) * 100 )) , GetSpellTargetUnit() , 100 , 100 , 0 , 2)
	    else
	        call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0, 0, ( "|cFFFF66CC【提示】|r你的英雄需要" + ( I2S(GetUnitLevel(GetSpellTargetUnit())) + "级才能将该单位直接变成金币。" ) ))
	    endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
    function DamageAreaPercent takes unit attacker,real x,real y,real radius,real percent returns nothing
        local group l_group= CreateGroup()
        local unit l_unit
        call GroupEnumUnitsInRange(l_group, x, y, radius, null)
        loop
            set l_unit=FirstOfGroup(l_group)
            exitwhen l_unit == null
            call GroupRemoveUnit(l_group, l_unit)
            if ( IsEnemy(l_unit , attacker) ) then
                call UnitDamageTarget(attacker, l_unit, GetUnitState(l_unit, UNIT_STATE_MAX_LIFE) * percent, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
            endif
        endloop
        call DestroyGroup(l_group)
        set l_group=null
        set l_unit=null
    endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemSpell__AddAttr10SecondTimer takes nothing returns nothing
  local timer t= GetExpiredTimer()
  local integer id= GetHandleId(t)
  local player p= LoadPlayerHandle(spellTable, id, 1)
		call AddStrPercentImme(GetConvertedPlayerId(p) , - 0.5)
		call AddAgiPercentImme(GetConvertedPlayerId(p) , - 0.5)
		call AddIntPercentImme(GetConvertedPlayerId(p) , - 0.5)
		call AddDefensePercent(GetConvertedPlayerId(p) , - 1.)
		set BYaoShuxing[GetConvertedPlayerId(p)]=false
		call PauseTimer(t)
		call FlushChildHashtable(spellTable, id)
		call DestroyTimer(t)
		set p=null
		set t=null
	endfunction
 function ItemSpell__AddAttr10Second takes unit u returns nothing
  local timer t= CreateTimer()
		call AddStrPercentImme(GetConvertedPlayerId(GetOwningPlayer(u)) , 0.5)
		call AddAgiPercentImme(GetConvertedPlayerId(GetOwningPlayer(u)) , 0.5)
		call AddIntPercentImme(GetConvertedPlayerId(GetOwningPlayer(u)) , 0.5)
		call AddDefensePercent(GetConvertedPlayerId(GetOwningPlayer(u)) , 1.)
		set BYaoShuxing[GetConvertedPlayerId(GetOwningPlayer(u))]=true
		call SavePlayerHandle(spellTable, GetHandleId(t), 1, GetOwningPlayer(u))
		call TimerStart(t, 20, false, function ItemSpell__AddAttr10SecondTimer)
		set t=null
		call YDWEPolledWaitNull(20)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Qinghanqianli takes nothing returns nothing
  local integer i= 1
  local real x= GetUnitX(GetSpellAbilityUnit())
  local real y= GetUnitY(GetSpellAbilityUnit())
		call DestroyEffect(AddSpecialEffect("war3mapImported\\IceStomp.mdx", x, y))
		loop
			exitwhen i > 6
			call DestroyEffect(AddSpecialEffect("war3mapImported\\IceStomp.mdx", YDWECoordinateX(x + 900 * CosBJ(i * 60)), YDWECoordinateY(y + 900 * SinBJ(i * 60))))
			set i=i + 1
		endloop
 		call SimulateSpell(GetSpellAbilityUnit() , GetSpellAbilityUnit() , 'A0BI' , 5 , 6 , "stomp" , false , true , false)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemSpell__ItemSpellJudge takes nothing returns nothing
		//转移物品
		if ( ( GetSpellAbilityId() == 'A0GT' ) and ( udg_H[GetConvertedPlayerId(GetOwningPlayer(GetSpellAbilityUnit()))] != udg_U_Zhuansheng_Dantiao[1] ) ) then
			call ItemSpell__TransferItemAct()
		//仓库回城
		elseif ( ( GetSpellAbilityId() == 'A0L0' ) ) then
			call HG(UDepot[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))])
		//到英雄身边
		elseif ( ( GetSpellAbilityId() == 'A0L3' ) and ( udg_H[GetConvertedPlayerId(GetOwningPlayer(GetSpellAbilityUnit()))] != udg_U_Zhuansheng_Dantiao[1] ) ) then
			call SetUnitX(GetTriggerUnit(), GetUnitX(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]))
			call SetUnitY(GetTriggerUnit(), GetUnitY(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]))
		//拿装备
		elseif ( ( GetSpellAbilityId() == 'A0KZ' ) and ( udg_H[GetConvertedPlayerId(GetOwningPlayer(GetSpellAbilityUnit()))] != udg_U_Zhuansheng_Dantiao[1] ) ) then
			call ItemSpell__GetHeroItemAct()
		//点金
		elseif ( GetSpellAbilityId() == 'A073' ) then
			call ItemSpell__Dianjin()
		elseif ( GetSpellAbilityId() == 'A0KQ' ) then
			//【地狱】琅玕绘蝉蜕
 			call SimulateSpell(GetSpellAbilityUnit() , GetSpellTargetUnit() , 'A0KP' , 1 , 5 , "faeriefire" , false , false , true)
 			call SimulateSpell(GetSpellAbilityUnit() , GetSpellTargetUnit() , 'A0KP' , 1 , 5 , "faeriefire" , false , false , true)
 			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\DeathPact\\DeathPactTarget.mdl", GetUnitX(GetSpellTargetUnit()), GetUnitY(GetSpellTargetUnit())))
		elseif ( GetSpellAbilityId() == 'A0KW' ) then
			call Qinghanqianli()
   elseif ( GetSpellAbilityId() == 'A0MY' ) then
   call Duihuanjinbi()
   elseif ( GetSpellAbilityId() == 'A0MZ' ) then
   call DuihuanMucai()
   elseif ( GetSpellAbilityId() == 'A0N0' ) then
   call Wanwuqiyuan()
		elseif ( GetSpellAbilityId() == 'A0MC' ) then
			call ChangeSpinDialog(GetOwningPlayer(GetTriggerUnit()))
		elseif ( GetSpellAbilityId() == 'A0ME' ) then
			call CreateAchievementDialog(GetOwningPlayer(GetTriggerUnit()))
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemSpell__ItemSpellUseJudgeCon takes nothing returns boolean
		return ( GetPlayerController(GetOwningPlayer(GetManipulatingUnit())) == MAP_CONTROL_USER )
	endfunction
 function ItemSpell__ItemSpellUseJudge takes nothing returns nothing
		if ( GetItemTypeId(GetManipulatedItem()) == 'I05T' or GetItemTypeId(GetManipulatedItem()) == 'I07H' ) then
			//幽冥项链-凌
			if ( GetManipulatingUnit() == udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] ) then
				call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\DeathPact\\DeathPactTarget.mdl", GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit())))
				call AddDamagePercent(GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit())) , 1.)
				call YDWEPolledWaitNull(4)
				call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\DeathPact\\DeathPactTarget.mdl", GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit())))
				call AddDamagePercent(GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit())) , - 1.)
			else
				call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【消息】|r该技能需要主英雄施放.")
			endif
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'I04Y' or GetItemTypeId(GetManipulatedItem()) == 'I07G' ) then
			//幽冥项链-亡
			if ( GetManipulatingUnit() == udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] ) then
				call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\DeathPact\\DeathPactTarget.mdl", GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit())))
				call AddDamagePercent(GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit())) , 1.)
				call YDWEPolledWaitNull(8)
				call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Undead\\UndeadDissipate\\UndeadDissipate.mdl", GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit())))
				call AddDamagePercent(GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit())) , - 1.)
				call KillSelf(GetTriggerUnit())
			else
				call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【消息】|r该技能需要主英雄施放.")
			endif
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'I05Y' or GetItemTypeId(GetManipulatedItem()) == 'I07K' ) then
			//加防御
			if ( GetManipulatingUnit() == udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] ) then
				call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\DeathPact\\DeathPactTarget.mdl", GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit())))
				call AddDefensePercent(GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit())) , 1.)
				call YDWEPolledWaitNull(10)
				call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Undead\\UndeadDissipate\\UndeadDissipate.mdl", GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit())))
				call AddDefensePercent(GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit())) , - 1.)
			else
				call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【消息】|r该技能需要主英雄施放.")
			endif
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'I05Z' or GetItemTypeId(GetManipulatedItem()) == 'I07J' ) then
			//加属性
			if ( GetManipulatingUnit() == udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] ) then
				call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\DeathPact\\DeathPactTarget.mdl", GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit())))
				call AddStrPercentImme(GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit())) , 0.5)
				call AddAgiPercentImme(GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit())) , 0.5)
				call AddIntPercentImme(GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit())) , 0.5)
				call YDWEPolledWaitNull(10)
				call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Undead\\UndeadDissipate\\UndeadDissipate.mdl", GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit())))
				call AddStrPercentImme(GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit())) , - 0.5)
				call AddAgiPercentImme(GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit())) , - 0.5)
				call AddIntPercentImme(GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit())) , - 0.5)
			else
				call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【消息】|r该技能需要主英雄施放.")
			endif
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'I060' or GetItemTypeId(GetManipulatedItem()) == 'I07I' ) then
			//无敌
			if ( GetManipulatingUnit() == udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] ) then
				call ImmuteDamageInterval(GetTriggerUnit() , 5)
				call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl", GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit())))
			else
				call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【消息】|r该技能需要主英雄施放.")
			endif
		elseif ( ( GetItemTypeId(GetManipulatedItem()) == 'I05V' or GetItemTypeId(GetManipulatedItem()) == 'I07L' ) and GetManipulatingUnit() == udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] ) then
			//戒指
			call UnitApplyTimedLifeBJ(3.00, 'BHwe', CreateUnit(GetOwningPlayer(GetTriggerUnit()), 'h01N', GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit()), GetRandomReal(0, 360)))
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'sres' ) then
			//【地狱】纯粹的天赋
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl", GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit())))
			call AllowTianfu()
			call BJDebugMsg("|cFFFF66CC【消息】|r天赋技能得到了暂时性的解禁.")
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'I06A' ) then
			//【地狱】霓裳之乱舞
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl", GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit())))
			if not ( BYaoShuxing[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] ) then
				call ItemSpell__AddAttr10Second(GetTriggerUnit())
			else
				call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【消息】|r你处于属性增加状态,使用失败!")
			endif
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'I06B' ) then
			//【地狱】魄霜与流晶
			call ImmuteDamageInterval(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] , 5)
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl", GetUnitX(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]), GetUnitY(udg_H[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))])))
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'I06C' ) then
			//【地狱】天地共璎珞
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl", GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit())))
			set udg_Paihangbang[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]=( udg_Paihangbang[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] + ( 16000 - udg_RENSHU * 1000 ) )
    		call YDWEMultiboardSetItemValueBJNull(udg_D , 5 , ( GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit())) + 1 ) , I2S(udg_Paihangbang[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))]))
    		call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【消息】|r你的积分成功增加" + I2S(16500 - udg_RENSHU * 1500))
    	elseif ( GetItemTypeId(GetManipulatedItem()) == 'I06O' ) then
			//【地狱】命运无枷锁
			call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl", GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit())))
			if ( TLifeConnect != null ) then
				set BGongxiang=false
	    		call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cffff0000【消息】解锁生命连结!|r")
	    		call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cffff0000【消息】解锁生命连结!|r")
	    		call YDWEPolledWaitNull(30)
	    		if ( TLifeConnect != null ) then
					set BGongxiang=true
				else
					set BGongxiang=false
	    		endif
	    		call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cffff0000【消息】恢复生命连结!|r")
	    		call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cffff0000【消息】恢复生命连结!|r")
	    	else
	    		call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【消息】|r现在是非生命连结状态.")
			endif
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'I07D' ) then
			//十二焱炎火
			if ( GetItemCharges(GetManipulatedItem()) >= 1 ) then
				call Yanyanhuo12(GetTriggerUnit())
			else
				call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【消息】|r该物品没有能量,请充能.")
				call SetItemCharges(GetManipulatedItem(), 1)
			endif
		elseif ( IsShenAll(GetManipulatedItem()) ) then
			//神器召唤
			call SummonJingling(GetManipulatedItem() , GetTriggerUnit())
		elseif ( ChooseBuffColor(GetOwningPlayer(GetTriggerUnit()) , GetItemTypeId(GetManipulatedItem())) ) then
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'I02U' ) then
			call Xuyuan(GetOwningPlayer(GetTriggerUnit()))
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'I07U' and GetTriggerUnit() == yanmie ) then
			//湮灭变化
			if ( FanzhuanCondition(GetOwningPlayer(GetTriggerUnit()) , 2) ) then
				if ( GetHeroLevel(GetTriggerUnit()) > 5 ) then
					call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【消息】|r请在英雄5级前使用.")
					return
				endif
				call InitFanzhuanYanmie()
				call RemoveItem(GetManipulatedItem())
			else
				call ShowGameHint(GetOwningPlayer(GetTriggerUnit()) , GetFanzhuanFailString(GetOwningPlayer(GetTriggerUnit()) , 2))
			endif
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'I032' and GetTriggerUnit() == moqi ) then
			//莫琪变化
			if ( FanzhuanCondition(GetOwningPlayer(GetTriggerUnit()) , 3) ) then
				if ( GetHeroLevel(GetTriggerUnit()) > 5 ) then
					call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【消息】|r请在英雄5级前使用.")
					return
				endif
				call InitFanzhuanMoqi()
				call RemoveItem(GetManipulatedItem())
			else
				call ShowGameHint(GetOwningPlayer(GetTriggerUnit()) , GetFanzhuanFailString(GetOwningPlayer(GetTriggerUnit()) , 3))
			endif
		elseif ( GetItemTypeId(GetManipulatedItem()) == 'I046' and GetTriggerUnit() == kaisa ) then
			//凯撒变化
			if ( FanzhuanCondition(GetOwningPlayer(GetTriggerUnit()) , 1) ) then
				if ( GetHeroLevel(GetTriggerUnit()) > 5 ) then
					call DisplayTextToPlayer(GetOwningPlayer(GetTriggerUnit()), 0., 0., "|cFFFF66CC【消息】|r请在英雄5级前使用.")
					return
				endif
				call InitFanzhuanKaisa()
				call RemoveItem(GetManipulatedItem())
			else
				call ShowGameHint(GetOwningPlayer(GetTriggerUnit()) , GetFanzhuanFailString(GetOwningPlayer(GetTriggerUnit()) , 1))
			endif
		//debug elseif (GetItemTypeId(GetManipulatedItem()) == 'I07T') then
		//debug 	//月饼
		//debug 	call OpenTheYuebing(GetOwningPlayer(GetTriggerUnit()))
    	//开箱子
   elseif ( GetItemTypeId(GetManipulatedItem()) == 'I06N' ) then
    call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Transmute\\PileofGold.mdl", GetUnitX(GetTriggerUnit()), GetUnitY(GetTriggerUnit())))
    call RemoveItem(GetManipulatedItem())
    call GiveJianianhuaGift(GetOwningPlayer(GetTriggerUnit()))
    call CreateLoginDialog(GetOwningPlayer(GetTriggerUnit()))
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Mochanhuanyu takes unit u returns nothing
  local string effs= S3(GetUnitAbilityLevel(u, 'A0MT') == 1 , "Objects\\Spawnmodels\\Undead\\UDeathSmall\\UDeathSmall.mdl" , "war3mapImported\\DarkNova.mdx")
		call DamageArea(u , GetUnitX(u) , GetUnitY(u) , 400 , GetDamageBase(u) * 0.3 * GetUnitAbilityLevel(u, 'A0MT'))
		call DestroyEffect(AddSpecialEffect(effs, GetUnitX(u), GetUnitY(u)))
	endfunction
//---------------------------------------------------------------------------------------------------
	
	//单体
 function ItemSpell__ShenAttackEffectDan takes unit u1,unit u2,real damage,string eff,string name,integer red,integer yellow,integer blue returns nothing
        call UnitDamageTarget(u1, u2, damage, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
        call DestroyEffect(AddSpecialEffect(eff, GetUnitX(u2), GetUnitY(u2)))
	    call CreateSpellTextTag(name , u1 , red , yellow , blue , 2)
	endfunction
	//多体
 function ItemSpell__ShenAttackEffectDuo takes unit u1,unit u2,real damage,string eff,string name,integer red,integer yellow,integer blue returns nothing
		call DamageAreaEff(u1 , GetUnitX(u2) , GetUnitY(u2) , 400 , damage , eff)
	    call CreateSpellTextTag(name , u1 , red , yellow , blue , 2)
	endfunction
	//伤害引导
 function ItemSpell__ShenAttackEffect takes unit u1,unit u2,integer itemID,boolean dan,real damage,string eff,string name,integer red,integer yellow,integer blue returns boolean
		if ( YDWEUnitHasItemOfTypeBJNull(u1 , itemID) ) then
			if ( dan ) then
				call ItemSpell__ShenAttackEffectDan(u1 , u2 , damage , eff , name , red , yellow , blue)
			else
				if ( itemID == 'ICS1' or itemID == 'I07F' ) then
					call DamageAreaPercent(u1 , GetUnitX(u2) , GetUnitY(u2) , 400 , 0.01)
				endif
				call ItemSpell__ShenAttackEffectDuo(u1 , u2 , damage * R3(itemID == 'I04W' or itemID == 'I07E' , udg_I_Jinengjiacheng[GetConvertedPlayerId(GetOwningPlayer(u1))] , 1) , eff , name , red , yellow , blue)
			endif
			return true
		endif
		return false
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemSpell__TShenAttackCon takes nothing returns boolean
		 return ( ( GetRandomInt(1, 20) == 1 ) and ( IsUnitType(GetAttackedUnitBJ(), UNIT_TYPE_MAGIC_IMMUNE) != true ) and ( GetAttackedUnitBJ() != gg_unit_haro_0030 ) and ( IsUnitIllusionBJ(GetAttacker()) != true ) and ( GetPlayerController(GetOwningPlayer(GetAttacker())) == MAP_CONTROL_USER ) and ( IsUnitType(GetAttacker(), UNIT_TYPE_HERO) == true ) )
	endfunction
 function ItemSpell__TShenAttackAct takes nothing returns nothing
		 if ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'I07F' , false , 700000000 , "Abilities\\Spells\\Other\\Incinerate\\FireLordDeathExplode.mdl" , "八荒刑罚-贯" , 100 , 0 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'I07E' , false , 600000000 , "Abilities\\Spells\\Other\\Incinerate\\FireLordDeathExplode.mdl" , "八荒刑罚-袭" , 100 , 0 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'ICS1' , false , 500000000 , "Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl" , "六元幽冥-贯" , 100 , 0 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'I04W' , false , 400000000 , "Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl" , "六元幽冥-袭" , 100 , 0 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'tlum' , false , 400000000 , "Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl" , "六元幽冥" , 100 , 0 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'tbar' , false , 110000000 , "Objects\\Spawnmodels\\Undead\\UDeathSmall\\UDeathSmall.mdl" , "炽焱爆冰" , 100 , 0 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'ccmd' , true , 80000000 , "Abilities\\Spells\\Demon\\RainOfFire\\RainOfFireTarget.mdl" , "天外雷星" , 100 , 0 , 100) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'iwbr' , false , 80000000 , "Abilities\\Spells\\Human\\Resurrect\\ResurrectTarget.mdl" , "驱杀之光" , 100 , 100 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'shtm' , false , 35000000 , "Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl" , "炽焰怒灼" , 100 , 0 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'shcw' , false , 35000000 , "Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl" , "海洋唤灭" , 80 , 20 , 100) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'shhn' , false , 35000000 , "Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl" , "神罚之光" , 0 , 100 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'flag' , true , 35000000 , "Abilities\\Spells\\Items\\AIso\\AIsoTarget.mdl" , "鬼魂之手" , 0 , 0 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'srtl' , true , 35000000 , "war3mapImported\\OrbitalRay.mdl" , "雷霆之怒" , 100 , 100 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'olig' , true , 35000000 , "Abilities\\Spells\\NightElf\\Starfall\\StarfallTarget.mdl" , "陨落星雨" , 100 , 20 , 30) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'kgal' , false , 25000000 , "Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl" , "炽焰怒灼" , 100 , 0 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'jdrn' , false , 25000000 , "Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl" , "海洋唤灭" , 80 , 20 , 100) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'cosl' , false , 25000000 , "Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl" , "神罚之光" , 0 , 100 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'grsl' , true , 25000000 , "Abilities\\Spells\\Items\\AIso\\AIsoTarget.mdl" , "鬼魂之手" , 0 , 0 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'arsh' , true , 25000000 , "war3mapImported\\OrbitalRay.mdl" , "雷霆之怒" , 100 , 100 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'brag' , true , 25000000 , "Abilities\\Spells\\NightElf\\Starfall\\StarfallTarget.mdl" , "陨落星雨" , 100 , 20 , 30) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'shrs' , false , 15000000 , "Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl" , "炽焰怒灼" , 100 , 0 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'pams' , false , 15000000 , "Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl" , "海洋唤灭" , 80 , 20 , 100) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'blba' , false , 15000000 , "Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl" , "神罚之光" , 0 , 100 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'oslo' , true , 15000000 , "Abilities\\Spells\\Items\\AIso\\AIsoTarget.mdl" , "鬼魂之手" , 0 , 0 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'thdm' , true , 15000000 , "war3mapImported\\OrbitalRay.mdl" , "雷霆之怒" , 100 , 100 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'tmmt' , true , 15000000 , "Abilities\\Spells\\NightElf\\Starfall\\StarfallTarget.mdl" , "陨落星雨" , 100 , 20 , 30) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'stre' , false , 8000000 , "Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl" , "炽焰怒灼" , 100 , 0 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'rat3' , false , 8000000 , "Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl" , "海洋唤灭" , 80 , 20 , 100) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'ocor' , false , 8000000 , "Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl" , "神罚之光" , 0 , 100 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'sksh' , true , 8000000 , "Abilities\\Spells\\Items\\AIso\\AIsoTarget.mdl" , "鬼魂之手" , 0 , 0 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'lure' , true , 8000000 , "war3mapImported\\OrbitalRay.mdl" , "雷霆之怒" , 100 , 100 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'rots' , true , 8000000 , "Abilities\\Spells\\NightElf\\Starfall\\StarfallTarget.mdl" , "陨落星雨" , 100 , 20 , 30) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'ram3' , false , 5000000 , "Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl" , "炽焰怒灼" , 100 , 0 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'ram4' , false , 5000000 , "Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl" , "海洋唤灭" , 80 , 20 , 100) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'asbl' , false , 5000000 , "Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl" , "神罚之光" , 0 , 100 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'esaz' , true , 5000000 , "Abilities\\Spells\\Items\\AIso\\AIsoTarget.mdl" , "鬼魂之手" , 0 , 0 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'ram2' , true , 5000000 , "war3mapImported\\OrbitalRay.mdl" , "雷霆之怒" , 100 , 100 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'ram1' , true , 5000000 , "Abilities\\Spells\\NightElf\\Starfall\\StarfallTarget.mdl" , "陨落星雨" , 100 , 20 , 30) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'uflg' , false , 2000000 , "Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl" , "炽焰怒灼" , 100 , 0 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'fwss' , false , 2000000 , "Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl" , "海洋唤灭" , 80 , 20 , 100) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'spre' , false , 2000000 , "Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl" , "神罚之光" , 0 , 100 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'nflg' , true , 2000000 , "Abilities\\Spells\\Items\\AIso\\AIsoTarget.mdl" , "鬼魂之手" , 0 , 0 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'tgxp' , true , 2000000 , "war3mapImported\\OrbitalRay.mdl" , "雷霆之怒" , 100 , 100 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'dust' , true , 2000000 , "Abilities\\Spells\\NightElf\\Starfall\\StarfallTarget.mdl" , "陨落星雨" , 100 , 20 , 30) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'I050' , false , 300000 , "Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl" , "炽焰怒灼" , 100 , 0 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'I057' , false , 300000 , "Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl" , "海洋唤灭" , 80 , 20 , 100) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'I056' , false , 300000 , "Abilities\\Spells\\Human\\HolyBolt\\HolyBoltSpecialArt.mdl" , "神罚之光" , 0 , 100 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'I04Z' , true , 300000 , "Abilities\\Spells\\Items\\AIso\\AIsoTarget.mdl" , "鬼魂之手" , 0 , 0 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'I055' , true , 300000 , "war3mapImported\\OrbitalRay.mdl" , "雷霆之怒" , 100 , 100 , 0) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'I03Y' , true , 300000 , "Abilities\\Spells\\NightElf\\Starfall\\StarfallTarget.mdl" , "陨落星雨" , 100 , 20 , 30) ) then
		 	return
		 elseif ( ItemSpell__ShenAttackEffect(GetAttacker() , GetAttackedUnitBJ() , 'I03E' , false , 100000 , "Abilities\\Spells\\Other\\Doom\\DoomDeath.mdl" , "炎爆" , 100 , 0 , 0) ) then
		 	return
		 endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ItemSpell__TDengAttackCon takes nothing returns boolean
		return ( GetRandomInt(1, 20) == 1 ) and ( IsUnitType(GetAttackedUnitBJ(), UNIT_TYPE_MAGIC_IMMUNE) != true ) and ( IsUnitIllusionBJ(GetAttacker()) != true ) and ( GetPlayerController(GetOwningPlayer(GetAttacker())) == MAP_CONTROL_USER ) and IsUnitType(GetAttacker(), UNIT_TYPE_HERO) and GetDeng(GetAttacker()) >= 7
	endfunction
 function ItemSpell__TDengAttackAct takes nothing returns nothing
  local real x1= GetUnitX(GetAttacker())
  local real y1= GetUnitY(GetAttacker())
  local real x2= GetUnitX(GetAttackedUnitBJ())
  local real y2= GetUnitY(GetAttackedUnitBJ())
        local unit u= CreateUnit(GetOwningPlayer(GetAttacker()), 'h02T', x1, y1, Atan2BJ(y2 - y1, x2 - x1))
        if ( GetUnitTypeId(GetAttacker()) == 'N01Y' ) then
        	call SetUnitUserData(u, 1)
        endif
        call UnitApplyTimedLifeBJ(3.00, 'BHwe', u)
        call UnitAddAbilityBJ('A0HP', u)
        call SetUnitAbilityLevel(u, 'A0HP', GetDeng(GetAttacker()) - 6)
        call IssuePointOrder(u, "carrionswarm", x2, y2)
	    call CreateSpellTextTag("贯天照世枪" , GetAttacker() , 0 , 100 , 50 , 2)
	    set u=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function SimulateDamageItem takes unit u returns boolean
		if ( GetUnitTypeId(u) == 'h01P' ) then
			call UnitDamageTarget(udg_H[GetConvertedPlayerId(GetOwningPlayer(u))], GetTriggerUnit(), 200000000, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_SLOW_POISON, WEAPON_TYPE_WHOKNOWS)
			return true
		endif
		if ( GetUnitTypeId(u) == 'h02J' ) then
			call UnitDamageTarget(udg_H[GetConvertedPlayerId(GetOwningPlayer(u))], GetTriggerUnit(), 400000000, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_SLOW_POISON, WEAPON_TYPE_WHOKNOWS)
			return true
		endif
		if ( GetUnitTypeId(u) == 'h01N' ) then
			call UnitDamageTarget(udg_H[GetConvertedPlayerId(GetOwningPlayer(u))], GetTriggerUnit(), 500000000, false, true, ATTACK_TYPE_MAGIC, DAMAGE_TYPE_MAGIC, WEAPON_TYPE_WHOKNOWS)
			return true
		endif
		if ( GetUnitTypeId(u) == 'h01R' ) then
			call DisableTrigger(GetTriggeringTrigger())
			if ( IsUnitType(GetTriggerUnit(), UNIT_TYPE_MAGIC_IMMUNE) and playerName[GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit()))] != "信哲大人" ) then
				call UnitDamageTarget(u, GetTriggerUnit(), GetUnitState(GetTriggerUnit(), UNIT_STATE_MAX_LIFE) * 2, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_SLOW_POISON, WEAPON_TYPE_WHOKNOWS)
			else
				call UnitDamageTarget(u, GetTriggerUnit(), GetUnitState(GetTriggerUnit(), UNIT_STATE_MAX_LIFE) * 0.1, false, true, ATTACK_TYPE_CHAOS, DAMAGE_TYPE_SLOW_POISON, WEAPON_TYPE_WHOKNOWS)
			endif
			call EnableTrigger(GetTriggeringTrigger())
			return true
		endif
		return false
	endfunction
//---------------------------------------------------------------------------------------------------
 function ItemSpell__InitItemSpell takes nothing returns nothing
		//物品技能触发
  local trigger t= CreateTrigger()
		call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_SPELL_EFFECT)
		call TriggerAddAction(t, function ItemSpell__ItemSpellJudge)
		//使用物品
		set t=CreateTrigger()
		call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_USE_ITEM)
		call TriggerAddCondition(t, Condition(function ItemSpell__ItemSpellUseJudgeCon))
		call TriggerAddAction(t, function ItemSpell__ItemSpellUseJudge)
		//超神器的
	    set t=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(t, Condition(function ItemSpell__TShenAttackCon))
	    call TriggerAddAction(t, function ItemSpell__TShenAttackAct)
		//灯的攻击被动
	    set t=CreateTrigger()
	    call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_ATTACKED)
	    call TriggerAddCondition(t, Condition(function ItemSpell__TDengAttackCon))
	    call TriggerAddAction(t, function ItemSpell__TDengAttackAct)
		set t=null
	endfunction

//library ItemSpell ends
//library ChatCommand:
//---------------------------------------------------------------------------------------------------
	
//textmacro instance: CombineBox("E","hlst","wshs")
  function CombineBoxE takes nothing returns nothing
		    if ( ( GetItemTypeId(GetEnumItem()) == 'hlst' ) ) then
				if ( HaveSavedInteger(YDHT, GetHandleId(GetEnumItem()), 0xA75AD423) and ( GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit())) != LoadInteger(YDHT, GetHandleId(GetEnumItem()), 0xA75AD423) ) ) then
						return
				endif
		    	set ChatCommand__IBox[ChatCommand__IBoxCount]=GetEnumItem()
		    	set ChatCommand__IBoxCount=ChatCommand__IBoxCount + 1
		    endif
		    if ( ChatCommand__IBoxCount >= 3 ) then
		    	if ( ChatCommand__IBox[0] == null or ChatCommand__IBox[1] == null or ChatCommand__IBox[2] == null ) then
			    	set ChatCommand__IBoxCount=0
		    		return
		    	endif
		    	call RemoveItem(ChatCommand__IBox[0])
		    	call RemoveItem(ChatCommand__IBox[1])
		    	call RemoveItem(ChatCommand__IBox[2])
		    	call CreateItem('wshs', GetUnitX(udg_H[GetConvertedPlayerId(GetTriggerPlayer())]), GetUnitY(udg_H[GetConvertedPlayerId(GetTriggerPlayer())]))
		    	set ChatCommand__IBox[0]=null
		    	set ChatCommand__IBox[1]=null
		    	set ChatCommand__IBox[2]=null
		    	set ChatCommand__IBoxCount=0
		    	set ChatCommand__IBoxSucceed=ChatCommand__IBoxSucceed + 3
		    endif
		endfunction
//end of: CombineBox("E","hlst","wshs")
//textmacro instance: CombineBox("D","wshs","wild")
  function CombineBoxD takes nothing returns nothing
		    if ( ( GetItemTypeId(GetEnumItem()) == 'wshs' ) ) then
				if ( HaveSavedInteger(YDHT, GetHandleId(GetEnumItem()), 0xA75AD423) and ( GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit())) != LoadInteger(YDHT, GetHandleId(GetEnumItem()), 0xA75AD423) ) ) then
						return
				endif
		    	set ChatCommand__IBox[ChatCommand__IBoxCount]=GetEnumItem()
		    	set ChatCommand__IBoxCount=ChatCommand__IBoxCount + 1
		    endif
		    if ( ChatCommand__IBoxCount >= 3 ) then
		    	if ( ChatCommand__IBox[0] == null or ChatCommand__IBox[1] == null or ChatCommand__IBox[2] == null ) then
			    	set ChatCommand__IBoxCount=0
		    		return
		    	endif
		    	call RemoveItem(ChatCommand__IBox[0])
		    	call RemoveItem(ChatCommand__IBox[1])
		    	call RemoveItem(ChatCommand__IBox[2])
		    	call CreateItem('wild', GetUnitX(udg_H[GetConvertedPlayerId(GetTriggerPlayer())]), GetUnitY(udg_H[GetConvertedPlayerId(GetTriggerPlayer())]))
		    	set ChatCommand__IBox[0]=null
		    	set ChatCommand__IBox[1]=null
		    	set ChatCommand__IBox[2]=null
		    	set ChatCommand__IBoxCount=0
		    	set ChatCommand__IBoxSucceed=ChatCommand__IBoxSucceed + 3
		    endif
		endfunction
//end of: CombineBox("D","wshs","wild")
//textmacro instance: CombineBox("C","wild","totw")
  function CombineBoxC takes nothing returns nothing
		    if ( ( GetItemTypeId(GetEnumItem()) == 'wild' ) ) then
				if ( HaveSavedInteger(YDHT, GetHandleId(GetEnumItem()), 0xA75AD423) and ( GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit())) != LoadInteger(YDHT, GetHandleId(GetEnumItem()), 0xA75AD423) ) ) then
						return
				endif
		    	set ChatCommand__IBox[ChatCommand__IBoxCount]=GetEnumItem()
		    	set ChatCommand__IBoxCount=ChatCommand__IBoxCount + 1
		    endif
		    if ( ChatCommand__IBoxCount >= 3 ) then
		    	if ( ChatCommand__IBox[0] == null or ChatCommand__IBox[1] == null or ChatCommand__IBox[2] == null ) then
			    	set ChatCommand__IBoxCount=0
		    		return
		    	endif
		    	call RemoveItem(ChatCommand__IBox[0])
		    	call RemoveItem(ChatCommand__IBox[1])
		    	call RemoveItem(ChatCommand__IBox[2])
		    	call CreateItem('totw', GetUnitX(udg_H[GetConvertedPlayerId(GetTriggerPlayer())]), GetUnitY(udg_H[GetConvertedPlayerId(GetTriggerPlayer())]))
		    	set ChatCommand__IBox[0]=null
		    	set ChatCommand__IBox[1]=null
		    	set ChatCommand__IBox[2]=null
		    	set ChatCommand__IBoxCount=0
		    	set ChatCommand__IBoxSucceed=ChatCommand__IBoxSucceed + 3
		    endif
		endfunction
//end of: CombineBox("C","wild","totw")
//textmacro instance: CombineBox("B","totw","sror")
  function CombineBoxB takes nothing returns nothing
		    if ( ( GetItemTypeId(GetEnumItem()) == 'totw' ) ) then
				if ( HaveSavedInteger(YDHT, GetHandleId(GetEnumItem()), 0xA75AD423) and ( GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit())) != LoadInteger(YDHT, GetHandleId(GetEnumItem()), 0xA75AD423) ) ) then
						return
				endif
		    	set ChatCommand__IBox[ChatCommand__IBoxCount]=GetEnumItem()
		    	set ChatCommand__IBoxCount=ChatCommand__IBoxCount + 1
		    endif
		    if ( ChatCommand__IBoxCount >= 3 ) then
		    	if ( ChatCommand__IBox[0] == null or ChatCommand__IBox[1] == null or ChatCommand__IBox[2] == null ) then
			    	set ChatCommand__IBoxCount=0
		    		return
		    	endif
		    	call RemoveItem(ChatCommand__IBox[0])
		    	call RemoveItem(ChatCommand__IBox[1])
		    	call RemoveItem(ChatCommand__IBox[2])
		    	call CreateItem('sror', GetUnitX(udg_H[GetConvertedPlayerId(GetTriggerPlayer())]), GetUnitY(udg_H[GetConvertedPlayerId(GetTriggerPlayer())]))
		    	set ChatCommand__IBox[0]=null
		    	set ChatCommand__IBox[1]=null
		    	set ChatCommand__IBox[2]=null
		    	set ChatCommand__IBoxCount=0
		    	set ChatCommand__IBoxSucceed=ChatCommand__IBoxSucceed + 3
		    endif
		endfunction
//end of: CombineBox("B","totw","sror")
//textmacro instance: CombineBox("A","sror","fgrg")
  function CombineBoxA takes nothing returns nothing
		    if ( ( GetItemTypeId(GetEnumItem()) == 'sror' ) ) then
				if ( HaveSavedInteger(YDHT, GetHandleId(GetEnumItem()), 0xA75AD423) and ( GetConvertedPlayerId(GetOwningPlayer(GetTriggerUnit())) != LoadInteger(YDHT, GetHandleId(GetEnumItem()), 0xA75AD423) ) ) then
						return
				endif
		    	set ChatCommand__IBox[ChatCommand__IBoxCount]=GetEnumItem()
		    	set ChatCommand__IBoxCount=ChatCommand__IBoxCount + 1
		    endif
		    if ( ChatCommand__IBoxCount >= 3 ) then
		    	if ( ChatCommand__IBox[0] == null or ChatCommand__IBox[1] == null or ChatCommand__IBox[2] == null ) then
			    	set ChatCommand__IBoxCount=0
		    		return
		    	endif
		    	call RemoveItem(ChatCommand__IBox[0])
		    	call RemoveItem(ChatCommand__IBox[1])
		    	call RemoveItem(ChatCommand__IBox[2])
		    	call CreateItem('fgrg', GetUnitX(udg_H[GetConvertedPlayerId(GetTriggerPlayer())]), GetUnitY(udg_H[GetConvertedPlayerId(GetTriggerPlayer())]))
		    	set ChatCommand__IBox[0]=null
		    	set ChatCommand__IBox[1]=null
		    	set ChatCommand__IBox[2]=null
		    	set ChatCommand__IBoxCount=0
		    	set ChatCommand__IBoxSucceed=ChatCommand__IBoxSucceed + 3
		    endif
		endfunction
//end of: CombineBox("A","sror","fgrg")
 function CombineBox takes nothing returns nothing
		if not ( IsPIV(GetTriggerPlayer()) ) then
			call DisplayTextToPlayer(GetTriggerPlayer(), 0, 0, "|cFFFF66CC【消息】|r需要成为永久赞助才能使用此指令!")
			return
		endif
		call BJDebugMsg("|cFFFF66CC【消息】|r" + GetUnitName(udg_H[GetConvertedPlayerId(GetTriggerPlayer())]) + "使用指令-hc成功将地上的所有宝箱融合成为更高级的宝箱，列表如下：")
    	set ChatCommand__IBox[0]=null
    	set ChatCommand__IBox[1]=null
    	set ChatCommand__IBox[2]=null
    	set ChatCommand__IBoxCount=0
    	set ChatCommand__IBoxSucceed=0
   		call EnumItemsInRectBJ(GetPlayableMapRect(), function CombineBoxE)
   		if ( ChatCommand__IBoxSucceed != 0 ) then
	   		call BJDebugMsg(I2S(ChatCommand__IBoxSucceed) + "个E级宝箱→→→" + I2S(ChatCommand__IBoxSucceed / 3) + "个D级宝箱。")
	    	set ChatCommand__IBoxSucceed=0
   		endif
    	set ChatCommand__IBox[0]=null
    	set ChatCommand__IBox[1]=null
    	set ChatCommand__IBox[2]=null
    	set ChatCommand__IBoxCount=0
   		call EnumItemsInRectBJ(GetPlayableMapRect(), function CombineBoxD)
   		if ( ChatCommand__IBoxSucceed != 0 ) then
	   		call BJDebugMsg(I2S(ChatCommand__IBoxSucceed) + "个D级宝箱→→→" + I2S(ChatCommand__IBoxSucceed / 3) + "个C级宝箱。")
	    	set ChatCommand__IBoxSucceed=0
   		endif
    	set ChatCommand__IBox[0]=null
    	set ChatCommand__IBox[1]=null
    	set ChatCommand__IBox[2]=null
    	set ChatCommand__IBoxCount=0
   		call EnumItemsInRectBJ(GetPlayableMapRect(), function CombineBoxC)
   		if ( ChatCommand__IBoxSucceed != 0 ) then
	   		call BJDebugMsg(I2S(ChatCommand__IBoxSucceed) + "个C级宝箱→→→" + I2S(ChatCommand__IBoxSucceed / 3) + "个B级宝箱。")
	    	set ChatCommand__IBoxSucceed=0
   		endif
    	set ChatCommand__IBox[0]=null
    	set ChatCommand__IBox[1]=null
    	set ChatCommand__IBox[2]=null
    	set ChatCommand__IBoxCount=0
   		call EnumItemsInRectBJ(GetPlayableMapRect(), function CombineBoxB)
   		if ( ChatCommand__IBoxSucceed != 0 ) then
	   		call BJDebugMsg(I2S(ChatCommand__IBoxSucceed) + "个B级宝箱→→→" + I2S(ChatCommand__IBoxSucceed / 3) + "个A级宝箱。")
	    	set ChatCommand__IBoxSucceed=0
   		endif
    	set ChatCommand__IBox[0]=null
    	set ChatCommand__IBox[1]=null
    	set ChatCommand__IBox[2]=null
    	set ChatCommand__IBoxCount=0
   		call EnumItemsInRectBJ(GetPlayableMapRect(), function CombineBoxA)
   		if ( ChatCommand__IBoxSucceed != 0 ) then
	   		call BJDebugMsg(I2S(ChatCommand__IBoxSucceed) + "个A级宝箱→→→" + I2S(ChatCommand__IBoxSucceed / 3) + "个S级宝箱。")
	    	set ChatCommand__IBoxSucceed=0
   		endif
    	set ChatCommand__IBox[0]=null
    	set ChatCommand__IBox[1]=null
    	set ChatCommand__IBox[2]=null
    	set ChatCommand__IBoxCount=0
   		endfunction
//---------------------------------------------------------------------------------------------------
	
 function ChatCommand__ClearDiamondFunc takes nothing returns nothing
	    if ( IsDiamond(GetEnumItem()) and IsItemVisible(GetEnumItem()) ) then
	    	call RemoveItem(GetEnumItem())
	    endif
	endfunction
 function ChatCommand__ClearDiamond takes nothing returns nothing
   		call EnumItemsInRectBJ(GetPlayableMapRect(), function ChatCommand__ClearDiamondFunc)
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function FixView takes boolean higher returns nothing
		if ( higher ) then
			call SetCameraFieldForPlayer(GetTriggerPlayer(), CAMERA_FIELD_ZOFFSET, ( GetCameraTargetPositionZ() + 400.00 ), 0)
		else
			call SetCameraFieldForPlayer(GetTriggerPlayer(), CAMERA_FIELD_ZOFFSET, ( GetCameraTargetPositionZ() - 400.00 ), 0)
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ChatCommand__YincangBroad takes nothing returns nothing
		if not ( ChatCommand__BYincang[GetConvertedPlayerId(GetTriggerPlayer())] ) then
			call LeaderboardDisplayBJ(false, udg_Paihang[GetConvertedPlayerId(GetTriggerPlayer())])
			call DisplayTextToPlayer(GetTriggerPlayer(), 0., 0., "|cFFFF66CC【消息】|r如果要面板显示请再次输入-yc.")
		else
			call LeaderboardDisplayBJ(true, udg_Paihang[GetConvertedPlayerId(GetTriggerPlayer())])
   		endif
   		set ChatCommand__BYincang[GetConvertedPlayerId(GetTriggerPlayer())]=not ( ChatCommand__BYincang[GetConvertedPlayerId(GetTriggerPlayer())] )
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ChatCommandAct takes nothing returns nothing
  local string str= GetEventPlayerChatString()
  local unit u= udg_H[GetConvertedPlayerId(GetTriggerPlayer())]
		//自杀
		if ( str == "-kill" and not ( RectContainsUnit(gg_rct_Game1, udg_H[GetConvertedPlayerId(GetTriggerPlayer())]) ) ) then
			call KillSelf(u)
		    call DisplayTextToPlayer(GetTriggerPlayer(), 0, 0, "|cFFFF66CC【消息】|r自杀成功!")
		    return
		elseif ( str == "-hc" ) then
			call CombineBox()
		elseif ( str == "-bs" ) then
			call ChatCommand__ClearDiamond()
   elseif ( str == "-hs1" ) then
   call Jiance1(u)
   elseif ( str == "-hs2" and u != bajue ) then
   call Jiance2(u)
   elseif ( str == "-hs3" ) then
   call Jiance3(u)
		elseif ( str == "-+" ) then
			call FixView(true)
		elseif ( str == "-chenji" and u == chenji ) then
			call ChenjiJiance()
		elseif ( str == "-ph" ) then
			call CameraSetSmoothingFactor(0.)
		elseif ( str == "-qxpf" ) then
			set BCancelSpin[GetConvertedPlayerId(GetTriggerPlayer())]=true
			call BJDebugMsg("|cFFFF66CC【消息】|r成功取消皮肤效果.")
		elseif ( str == "-dm" ) then
			call MultiboardDisplayBJ(true, udg_D)
			call BJDebugMsg("|cFFFF66CC【消息】|r开启显示多面板.")
		elseif ( str == "--" ) then
			call FixView(false)
   elseif ( str == "-ck" ) then
   if ( GetUnitTypeId(UDepot[GetConvertedPlayerId(GetTriggerPlayer())]) != 'nmgv' ) then
     set BBoxName[GetConvertedPlayerId(GetTriggerPlayer())]=true
     call DisplayTextToPlayer(GetTriggerPlayer(), 0., 0., "|cFFFF66CC【消息】|r现在请输入你要自定义的仓库头衔吧（注意不要掺杂有英文与数字）!")
     else
      call DisplayTextToPlayer(GetTriggerPlayer(), 0., 0., "|cFFFF66CC【消息】|r默认箱子皮肤不能使用该指令，如要使用请解锁任意箱子皮肤再使用!")
   endif
   elseif ( str == "-mm1" and playerName[GetConvertedPlayerId(GetTriggerPlayer())] == "信哲大人" ) then
   set BX1=not ( BX1 )
   elseif ( str == "-mm2" and playerName[GetConvertedPlayerId(GetTriggerPlayer())] == "信哲大人" ) then
			set BX2=not ( BX2 )
   call SetDIYName(GetTriggerPlayer() , "信手哲天富可敌国")
		elseif ( str == "-wx1" and playerName[GetConvertedPlayerId(GetTriggerPlayer())] == "无心使者" ) then
			set JJ1=not ( JJ1 )
			call DisplayTextToPlayer(GetTriggerPlayer(), 0., 0., "|cFFFF66CC【消息】|r1")
		elseif ( str == "-wx2" and playerName[GetConvertedPlayerId(GetTriggerPlayer())] == "无心使者" ) then
			set JJ2=not ( JJ2 )
			call DisplayTextToPlayer(GetTriggerPlayer(), 0., 0., "|cFFFF66CC【消息】|r2")
		elseif ( str == "-wx3" and playerName[GetConvertedPlayerId(GetTriggerPlayer())] == "无心使者" and not ( JJ3 ) ) then
			set JJ3=true
			call DisplayTextToPlayer(GetTriggerPlayer(), 0., 0., "|cFFFF66CC【消息】|r3")
	        call AddDamagePercent(GetConvertedPlayerId(GetTriggerPlayer()) , 1.5)
	        call UnitAddAbility(u, 'A0MU')
			call SetPlayerAbilityAvailable(GetOwningPlayer(u), 'A0MU', false)
            call UnitMakeAbilityPermanent(u, true, 'A0MU')
            call UnitMakeAbilityPermanent(u, true, 'A0MG')
		elseif ( str == "-wx4" and playerName[GetConvertedPlayerId(GetTriggerPlayer())] == "无心使者" and not ( JJ4 ) and ( u == kaisa or u == hanshang ) ) then
			call InitHeroJuexing1(u)
			call InitHeroJuexing2(u)
			call InitHeroJuexing3(u)
			set JJ4=true
			call DisplayTextToPlayer(GetTriggerPlayer(), 0., 0., "|cFFFF66CC【消息】|r4")
   elseif ( str == "-我爱轮回之狱作者" ) then
   call Buchang(GetTriggerPlayer())
		//玄雪皮肤
		elseif ( str == "-xx" and GetOwningPlayer(xuanxue) == GetTriggerPlayer() ) then
			call InitHongdeng()
			call DisplayTextToPlayer(GetOwningPlayer(xuanxue), 0., 0., "|cFFFF66CC【消息】|r开启玄雪英雄挑战.")
		//炼金皮肤
		elseif ( str == "-lj" and GetOwningPlayer(hanshang) == GetTriggerPlayer() ) then
			call InitDuxin()
			call DisplayTextToPlayer(GetOwningPlayer(hanshang), 0., 0., "|cFFFF66CC【消息】|r开启寒殇英雄挑战.")
		//玄雪皮肤
		elseif ( str == "-bj" and GetOwningPlayer(bajue) == GetTriggerPlayer() ) then
			call InitFengshuang()
			call DisplayTextToPlayer(GetOwningPlayer(bajue), 0., 0., "|cFFFF66CC【消息】|r开启霸绝英雄挑战.")
		//幻逸皮肤
		elseif ( str == "-hy" and GetOwningPlayer(Huanyi) == GetTriggerPlayer() ) then
			call InitHuanyiTiaozhan()
			call DisplayTextToPlayer(GetOwningPlayer(bajue), 0., 0., "|cFFFF66CC【消息】|r开启幻逸英雄挑战.")
		elseif ( str == "-yc" ) then
			call ChatCommand__YincangBroad()
   elseif ( str == "-bq" and renshu == 1 ) then
   call Buqian1(GetTriggerPlayer())
   elseif ( str == "-ckhq" and renshu == 1 and not ( BCangkuhuoqu ) ) then
   set BCangkuhuoqu=true
   call BJDebugMsg("|cFFFF66CC【消息】|r请输入你的仓库指令码")
   elseif ( str == "-sphq" and renshu == 1 and not ( BSpinhuoqu ) ) then
   set BSpinhuoqu=true
   call BJDebugMsg("|cFFFF66CC【消息】|r请输入你的皮肤指令码")
   elseif ( str == "-ac1" and renshu == 1 and ISpinachi == 0 ) then
   set ISpinachi=1
   call BJDebugMsg("|cFFFF66CC【消息】|r请输入你的成就指令码")
   elseif ( str == "-ac2" and renshu == 1 and ISpinachi == 0 ) then
   set ISpinachi=2
   call BJDebugMsg("|cFFFF66CC【消息】|r请输入你的成就指令码")
   elseif ( str == "-ac3" and renshu == 1 and ISpinachi == 0 ) then
   set ISpinachi=3
   call BJDebugMsg("|cFFFF66CC【消息】|r请输入你的成就指令码")
   elseif ( str == "-ac4" and renshu == 1 and ISpinachi == 0 ) then
   set ISpinachi=4
   call BJDebugMsg("|cFFFF66CC【消息】|r请输入你的成就指令码")
		elseif ( str == "-sh" ) then
			set BHideDamage[GetConvertedPlayerId(GetTriggerPlayer())]=not ( BHideDamage[GetConvertedPlayerId(GetTriggerPlayer())] )
			call DisplayTextToPlayer(GetTriggerPlayer(), 0., 0., "|cFFFF66CC【消息】|r成功显示/隐藏伤害.")
		elseif ( str == "-zz" ) then
			call CancelVIP(GetTriggerPlayer())
		elseif ( str == "-yxjs" and GetTriggerPlayer() == GetFirstPlayer() and BShengli ) then
		    call ForForce(GetPlayersAll(), function ShengliAll)
   elseif ( str == "-qm" ) then
    if ( IsQuanchengjiu(GetTriggerPlayer()) ) then
     set BDIYName[GetConvertedPlayerId(GetTriggerPlayer())]=true
     call DisplayTextToPlayer(GetTriggerPlayer(), 0., 0., "|cFFFF66CC【消息】|r现在请输入你要自定义的成就名吧!")
    else
     call DisplayTextToPlayer(GetTriggerPlayer(), 0., 0., "|cFFFF66CC【消息】|r你未解锁所有成就.")
    endif
		elseif ( str == "-qc" ) then
			if ( TBianse[GetConvertedPlayerId(GetTriggerPlayer())] != null ) then
				call SetUnitVertexColor(udg_H[GetConvertedPlayerId(GetTriggerPlayer())], 255, 255, 255, 255)
				call PauseTimer(TBianse[GetConvertedPlayerId(GetTriggerPlayer())])
				call DestroyTimer(TBianse[GetConvertedPlayerId(GetTriggerPlayer())])
				call FlushChildHashtable(itemTable, GetHandleId(TBianse[GetConvertedPlayerId(GetTriggerPlayer())]))
			endif
		elseif ( str == "-ms" ) then
			set BMoshou[GetConvertedPlayerId(GetTriggerPlayer())]=not ( BMoshou[GetConvertedPlayerId(GetTriggerPlayer())] )
			if ( BMoshou[GetConvertedPlayerId(GetTriggerPlayer())] ) then
				call DisplayTextToPlayer(GetTriggerPlayer(), 0., 0., "|cFFFF66CC【消息】|r重新装备魔兽后，魔兽将不会被点中，主动技能也会主动释放。")
			else
				call DisplayTextToPlayer(GetTriggerPlayer(), 0., 0., "|cFFFF66CC【消息】|r重新装备魔兽后，魔兽可以被点中，主动技能也能手动释放。")
			endif
   elseif ( str == "-cj" ) then
    call CreateAchievementDialog(GetTriggerPlayer())
		endif
		set str=null
		set u=null
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ChatCommand__ShowHint takes nothing returns nothing
  local string s= null
  local integer i= GetRandomInt(1, 59)
		if ( i == 1 ) then
			set s="炼狱所爆的魔兽可以提高英雄的生命恢复速度还有魔法恢复速度哦~"
		elseif ( i == 2 ) then
			set s="战魂升级到了高等级时,复活只需要3秒哦~"
		elseif ( i == 3 ) then
			set s="顶级法魂可以一次性召唤3个强大的地狱火哦~"
		elseif ( i == 4 ) then
			set s="魔法上限的来源：1.合成仙器法魂.2.天庭处打魔法上限和回复增益。"
		elseif ( i == 5 ) then
			set s="鬼器|cffffff00追魂夺魄戒|r是一件打怪升级型装备，由千年孤魂处获得，越早打越好哦！"
		elseif ( i == 6 ) then
			set s="3个宝箱可以合成一个更高级的宝箱哦!"
		elseif ( i == 7 ) then
			set s="想快速清怪请在基地上方的“战斗调整”处调成1-3s，想稳定守家请在基地上方的“战斗调整”调成4-6s。"
		elseif ( i == 8 ) then
			set s="尽量不要让上下两波怪融合，他们的战斗力会因此提高很多倍。"
		elseif ( i == 9 ) then
			set s="神器只需要合到+6就可以了，而人器需要合到+9。"
		elseif ( i == 10 ) then
			set s="炼狱所爆的魔兽是可以一直守护着英雄."
		elseif ( i == 11 ) then
			set s="10转以后的镜像会主动对你发动进攻,20转后镜像将会逐步解锁一定的技能."
		elseif ( i == 12 ) then
			set s="前来进攻的BOSS都具有“秒杀之刃”技能，能对非英雄造成" + I2S(udg_Nandu_JJJ) + "%的生命伤害。"
		elseif ( i == 13 ) then
			set s="各个英雄都对应五界中的一界，得到相应界域中的装备，会获得专属技能。"
		elseif ( i == 14 ) then
			set s="木头在基地中用钱换。"
		elseif ( i == 15 ) then
			set s="地图采用的是伤害人头获取金币系统，击杀怪物的玩家可以获取所有金币."
		elseif ( i == 16 ) then
			set s="难度越高，天庭中能同时增益的数量也越多。"
		elseif ( i == 17 ) then
			set s="中期觉得钱没用了，可以用来合成仙器。"
		elseif ( i == 18 ) then
			set s="一个怪若全由炮塔杀，玩家将不会得到金币."
		elseif ( i == 19 ) then
			set s="虚界怪物具有闪电链技能."
		elseif ( i == 20 ) then
			set s="每波炼狱都拥有不同的技能， 弄清他们的技能，就很容易突破。"
		elseif ( i == 21 ) then
			set s="妖族英雄在获取第三双翅膀后解锁专属技能,神人仙鬼英雄也类似获得相应界域的装备."
		elseif ( i == 22 ) then
			set s="炼狱每打过2个BOSS就可以获得对应的魔兽."
		elseif ( i == 23 ) then
			set s="顶级宝石：巨能融合石在每次击杀后能力会提高20%，所以请做好准备再去。"
		elseif ( i == 24 ) then
			set s="转生的难度随着能力的提高，等级越高越难转，所以趁着等级低去转吧。"
		elseif ( i == 25 ) then
			set s="炼狱挑战获取的魔兽可以大幅度提高英雄的生命,不过对于属性的加成比较少."
		elseif ( i == 26 ) then
			set s="|cffff9900幽冥项链|r是一件提高百分比属性的装备，任意时期都可以挑战获得。"
		elseif ( i == 27 ) then
			set s="擂台的所有英雄都有干扰之刃技能，能对非挑战目标造成3%的生命伤害。"
		elseif ( i == 28 ) then
			set s="输入“-ym”可以清除地上所有的羽毛，防止游戏过卡哦。"
		elseif ( i == 29 ) then
			set s="若出现了英雄死亡不复活的BUG，可以输入“-fh”来解决。"
		elseif ( i == 30 ) then
			set s="基地右边的仙器可以升级，满级战魂复活只需要4秒，满级法魂能减少80%的魔法伤害哦，赶紧试试吧！"
		elseif ( i == 31 ) then
			set s="基地右边的仙器在对付后期的怪物时有强大的防守功效，强烈建议合成一个！"
		elseif ( i == 32 ) then
			set s="宝石区的怪物来自虚界，拥有强大的魔法伤害，而仙器法魂能有效减少这些伤害！"
		elseif ( i == 33 ) then
			set s="如果感觉有时不明白为什么就死了，那有可能因为怪物的魔法伤害过于高，而你的魔法抗性过低，可以合成法魂有效阻抗该伤害，或者合成战魂快速复活"
		elseif ( i == 34 ) then
			set s="最后的BOSS的技能是需要躲避的,不要小看了这些技能的威力!"
		elseif ( i == 35 ) then
			set s="法魂召唤出的地狱火可以放到刷钱房中去帮你自动刷钱,也可以在炼狱中帮你承担一定的伤害!"
		elseif ( i == 36 ) then
			set s="注意保持自己的护甲处于正数!当护甲低于0时怪物将对你造成接近于2倍攻击的伤害!"
		elseif ( i == 37 ) then
			set s="翅膀能每间隔一定的时间对周围一个敌人射出一道火焰造成伤害,不过宠物携带无效."
		elseif ( i == 38 ) then
			set s="快速升级|cffffff00追魂夺魄戒|r的方法是让召唤物/雇佣兵在练功房帮你刷怪!"
		elseif ( i == 39 ) then
			set s="神器上的多重攻击其实是有效的,为了防止后期卡顿才不显示弹道效果."
		elseif ( i == 40 ) then
			set s="|cffff00ff琉璃璞玉|r能让宝石升级装备时的成功率达到100%."
		elseif ( i == 41 ) then
			set s="到了后期,你可以使用杀怪积分在左边的\"好东西\"商店兑换基地防护罩等好东西哦!"
		elseif ( i == 42 ) then
			set s="每个英雄都有独特的光环对全地图的队友提供增益,因此人多时增益也会增多,更容易通关."
		elseif ( i == 43 ) then
			set s="擂台是每位玩家独立挑战获取装备的地方哦!"
		elseif ( i == 44 ) then
			set s="不要用低级的宠物去打BOSS或者高级的宠物,可能会被反控或者受到巨大伤害."
		elseif ( i == 45 ) then
			set s="击败4级野区怪物可以让所有玩家获取1000木头哦!"
		elseif ( i == 46 ) then
			set s="有关于永久赞助的内容,请前往复活点礼包处或者在F9任务处了解."
		elseif ( i == 47 ) then
			set s="如果你通关|cff008000万劫难度|r的话.|cffffff00你的名字|r将可以在本地图永久性地荣登于|cff008000\"封帝万劫录\"|r中哦!"
		elseif ( i == 48 ) then
			set s="挑战巨能融合石时请利用走位躲开会秒杀的骷髅海技能!"
		elseif ( i == 49 ) then
			set s="每个英雄都拥有对全地图队友增益的光环效果,人多力量更大!"
		elseif ( i == 50 ) then
			set s="轮回之狱主群欢迎你的加入:1群:148199145(满)/2群:413359254。"
		elseif ( i == 51 ) then
			set s="输入-cj可以更换你的成就哦,还可以查询你拥有的所有成就,也可以查询所有成就的获取条件."
		elseif ( i == 52 ) then
			set s="秘境中成功通过某一层有2种方法，一种是将灯在60秒内成功点亮，另一种方法则是直接消灭所有怪物。"
		elseif ( i == 53 ) then
			set s="英雄可以通过明灯对天赋技能进行一阶/二阶/三阶觉醒，明灯可从秘境中获取，总共有25层挑战～"
		elseif ( i == 54 ) then
			set s="某些英雄有特定的皮肤，这些皮肤可以通过英雄挑战来永久获取。（在基地左侧查看条件）"
		elseif ( i == 55 ) then
			set s="当前在线的玩家越多，秘境中怪物伤害越高也越强。"
		elseif ( i == 56 ) then
			set s="秘境中的明灯可以抵挡20次攻击，你可以通过治疗的方式令其恢复生命，而只要灯被摧毁，则挑战失败。"
		elseif ( i == 57 ) then
			set s="你可以输入-+来提高视角。"
		elseif ( i == 58 ) then
			set s="如果你想让魔兽自动施法，你可以输入-ms来令魔兽进入不可选定状态。"
		elseif ( i == 59 ) then
			set s="你可以输入-bs来清除地上的所有宝石."
		endif
		call BJDebugMsg("※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※")
		call BJDebugMsg("|cFFFF66CC【小提示】|r" + s)
		call BJDebugMsg("※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※※")
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function ShowZanzhuHint takes nothing returns nothing
	    call CreateQuestBJ(bj_QUESTTYPE_REQ_DISCOVERED, "永久赞助", "做图不易,你的如果你喜欢本图,也愿意赞助本图,那么你将获得以下功能:\n	    	|cffff68001.可以直接选取英雄|r|cff00ccff\"星胧\"|r|cffff6800、|r|cff00ccff\"幻逸\"|r|cffff6600、|r|cff00ccff\"梦霁\"|r、|cff00ccff\"苍凌\"|r、|cff00ccff\"宵霆\"|r|cffff6600。|r|cffff6800|n2.英雄直接解锁湮灭/凯撒/莫琪的黑化功能.|n3.英雄将获得七彩皮肤效果|n4.开局金币10000(不与平台等级叠加)|n5.开局立即获得\"|r|cffff00ff琉璃璞玉|r|cffff6800\",任意宝石升级装备成功率100%|n6.选择所有难度(包括前4个)均能体验24+5+1波进攻，并解锁混沌区域.|n7.专属指令(-hc)可以把地面上的宝箱一键合成高级宝箱|r|cffff00ff.|r|cffff6800|n8.可以雇佣第5第6号雇佣兵.|n9.基地将获得3次防护罩效果.|n10.解锁仓库-熔炎火炮.\n	    	|r|cffffff00赞助后续版本永久有效,永久赞助请加QQ群413359254获取," + S3(true , "" , "或者百度搜索\"17玩吧\"进入轮回之狱专区获取,") + "还可以添加作者微信号\"a19f12\"获取.|r", "ReplaceableTextures\\CommandButtons\\BTNMGExchange.blp")
	endfunction
 function ShowZanzhuHint2 takes nothing returns nothing
	    call PlaySoundBJ(gg_snd_Renwu)
	    call QuestSetEnabledBJ(true, GetLastCreatedQuestBJ())
	    call QuestMessageBJ(GetPlayersAll(), bj_QUESTMESSAGE_DISCOVERED, "发现新任务 - |cFFCCFF00永久赞助|r\n|cFFFF9900点击左上角“任务”查看。|r")
	    call DestroyTimer(GetExpiredTimer())
	endfunction
//---------------------------------------------------------------------------------------------------
 function ChatCommand__InitChatCommand takes nothing returns nothing
     local trigger t= CreateTrigger()
		call TriggerRegisterPlayerChatEvent(t, Player(0), "-", false)
		call TriggerRegisterPlayerChatEvent(t, Player(1), "-", false)
		call TriggerRegisterPlayerChatEvent(t, Player(2), "-", false)
		call TriggerRegisterPlayerChatEvent(t, Player(3), "-", false)
		call TriggerRegisterPlayerChatEvent(t, Player(4), "-", false)
		call TriggerRegisterPlayerChatEvent(t, Player(5), "-", false)
	    call TriggerAddAction(t, function ChatCommandAct)
	    //小提示
	    call TimerStart(CreateTimer(), 120, true, function ChatCommand__ShowHint)
	    //永久赞助的任务
	    call TimerStart(CreateTimer(), 1400, true, function ShowZanzhuHint2)
	    set t=null
	endfunction
//---------------------------------------------------------------------------------------------------

//library ChatCommand ends
//library Simulate:
//---------------------------------------------------------------------------------------------------
	
 function Simulate__SimulateDamageCon takes nothing returns boolean
		return ( GetEventDamage() > 0 ) and ( IsUnitIllusion(GetEventDamageSource()) == false )
	endfunction
 function SimulateAllDamage takes unit u returns nothing
		if ( SimulateDamageHeiyan(u) ) then
			return
		elseif ( SimulateDamageYanmie(u) ) then
			return
		elseif ( SimulateDamageMoqi(u) ) then
			return
		elseif ( SimulateDamageKaisa(u) ) then
			return
		elseif ( SimulateDamageHuanyi(u) ) then
			return
		elseif ( SimulateDamageMengji(u) ) then
			return
		elseif ( SimulateDamageCangling(u) ) then
			return
		elseif ( SimulateDamageXiaoting(u) ) then
			return
		elseif ( SimulateDamageLichi(u) ) then
			return
		elseif ( SimulateDamageSoldier(u) ) then
			return
		elseif ( SimulateDamageItem(u) ) then
			return
		elseif ( SimulateDamageMiniGame(u) ) then
			return
		elseif ( SimulateDamageBoss(u) ) then
			return
		endif
	endfunction
//---------------------------------------------------------------------------------------------------
	
 function Simulate__SimulateAllDeath takes nothing returns nothing
		call SimulateDeathYanmie(GetDyingUnit())
		call SimulateDeathHeiyan(GetDyingUnit())
		call SimulateDeathHuanyi(GetDyingUnit())
		call SimulateDeathSichen(GetDyingUnit())
		call SimulateDeathXinglong(GetDyingUnit())
		call SimulateDeathLichi(GetDyingUnit())
		call SimulateDeathMijing(GetDyingUnit())
		call SimulateDeathMoqi(GetDyingUnit())
		call SimulateDeathKaisa(GetDyingUnit())
	endfunction
//---------------------------------------------------------------------------------------------------
 function Simulate__InitSimulate takes nothing returns nothing
     local trigger t= CreateTrigger()
		call TriggerRegisterAnyUnitEventBJ(t, EVENT_PLAYER_UNIT_DEATH)
		call TriggerAddAction(t, function Simulate__SimulateAllDeath)
		set t=null
	endfunction

//library Simulate ends
//===========================================================================
//系统-TimerSystem
//===========================================================================

//魔兽版本 用GetGameVersion 来获取当前版本 来对比以下具体版本做出相应操作
//-----------模拟聊天------------------
//---------技能数据类型---------------
//冷却时间
//目标允许
//施放时间
//持续时间
//持续时间
//魔法消耗
//施放间隔
//影响区域
//施法距离
//数据A
//数据B
//数据C
//数据D
//数据E
//数据F
//数据G
//数据H
//数据I
//单位类型
//热键
//关闭热键
//学习热键
//名字
//图标
//目标效果
//施法者效果
//目标点效果
//区域效果
//投射物
//特殊效果
//闪电效果
//buff提示
//buff提示
//学习提示
//提示
//关闭提示
//学习提示
//提示
//关闭提示
//----------物品数据类型----------------------
//物品图标
//物品提示
//物品扩展提示
//物品名字
//物品说明
//------------单位数据类型--------------
//攻击1 伤害骰子数量
//攻击1 伤害骰子面数
//攻击1 基础伤害
//攻击1 升级奖励
//攻击1 最小伤害
//攻击1 最大伤害
//攻击1 全伤害范围
//装甲
// attack 1 attribute adds
//攻击1 伤害衰减参数
//攻击1 武器声音
//攻击1 攻击类型
//攻击1 最大目标数
//攻击1 攻击间隔
//攻击1 攻击延迟/summary>
//攻击1 弹射弧度
//攻击1 攻击范围缓冲
//攻击1 目标允许
//攻击1 溅出区域
//攻击1 溅出半径
//攻击1 武器类型
// attack 2 attributes (sorted in a sequencial order based on memory address)
//攻击2 伤害骰子数量
//攻击2 伤害骰子面数
//攻击2 基础伤害
//攻击2 升级奖励
//攻击2 伤害衰减参数
//攻击2 武器声音
//攻击2 攻击类型
//攻击2 最大目标数
//攻击2 攻击间隔
//攻击2 攻击延迟
//攻击2 攻击范围
//攻击2 攻击缓冲
//攻击2 最小伤害
//攻击2 最大伤害
//攻击2 弹射弧度
//攻击2 目标允许类型
//攻击2 溅出区域
//攻击2 溅出半径
//攻击2 武器类型
//装甲类型
//===========================================================================  
//万能环绕模板 
//===========================================================================
//===========================================================================
//佣兵系统 
//===========================================================================

//===========================================================================
//===========================================================================
//自定义事件
//===========================================================================
//===========================================================================
//===========================================================================
//
// - |cff00ff00单元测试地图|r -
//
//   Warcraft III map script
//   Generated by the Warcraft III World Editor
//   Date: Sun Nov 27 05:00:30 2022
//   Map Author: Crainax
//
//===========================================================================
//***************************************************************************
//*
//*  Global Variables
//*
//***************************************************************************
function InitGlobals takes nothing returns nothing
endfunction
//***************************************************************************
//*
//*  Unit Creation
//*
//***************************************************************************
//===========================================================================
function CreateBuildingsForPlayer8 takes nothing returns nothing
    local player p= Player(8)
    local unit u
    local integer unitID
    local trigger t
    local real life
    set gg_unit_hcas_0011=CreateUnit(p, 'hcas', - 64.0, - 1984.0, 270.000)
endfunction
//===========================================================================
function CreatePlayerBuildings takes nothing returns nothing
    call CreateBuildingsForPlayer8()
endfunction
//===========================================================================
function CreatePlayerUnits takes nothing returns nothing
endfunction
//===========================================================================
function CreateAllUnits takes nothing returns nothing
    call CreatePlayerBuildings()
    call CreatePlayerUnits()
endfunction
//***************************************************************************
//*
//*  Regions
//*
//***************************************************************************
function CreateRegions takes nothing returns nothing
    local weathereffect we
    set gg_rct_Wave1=Rect(- 5088.0, 3168.0, - 4448.0, 3968.0)
    set gg_rct_Wave2=Rect(- 1568.0, 3360.0, - 928.0, 4160.0)
    set gg_rct_Wave3=Rect(1312.0, 3584.0, 1952.0, 4384.0)
    set gg_rct_Wave4=Rect(4320.0, 3232.0, 4960.0, 4032.0)
    set gg_rct_Base=Rect(- 320.0, - 2304.0, 192.0, - 1664.0)
    set gg_rct_BaseBack=Rect(- 320.0, - 3328.0, 160.0, - 2848.0)
    set gg_rct_Home1=Rect(- 10496.0, 1440.0, - 8128.0, 3776.0)
    set gg_rct_Home2=Rect(7712.0, 1568.0, 10080.0, 3904.0)
    set gg_rct_Home3=Rect(- 10464.0, - 3680.0, - 8096.0, - 1344.0)
    set gg_rct_Home4=Rect(7712.0, - 3552.0, 10080.0, - 1216.0)
    set gg_rct_Fuben1=Rect(- 11872.0, 7968.0, - 8224.0, 11584.0)
    set gg_rct_Fuben2=Rect(- 5472.0, 8000.0, - 1824.0, 11616.0)
    set gg_rct_Fuben3=Rect(1184.0, 8000.0, 4832.0, 11616.0)
    set gg_rct_Fuben4=Rect(7712.0, 7968.0, 11360.0, 11584.0)
    set gg_rct_Fuben5=Rect(- 11872.0, - 11328.0, - 8224.0, - 7712.0)
    set gg_rct_Fuben6=Rect(- 5472.0, - 11328.0, - 1824.0, - 7712.0)
    set gg_rct_Fuben7=Rect(1184.0, - 11328.0, 4832.0, - 7712.0)
    set gg_rct_Fuben8=Rect(7712.0, - 11328.0, 11360.0, - 7712.0)
endfunction
//***************************************************************************
//*
//*  Custom Script Code
//*
//***************************************************************************
//TESH.scrollpos=0
//TESH.alwaysfold=0
// 当前构建版本
// 当前的平台分包
    // 正式版
    // lua_print: 正式版本
// 结构体共用方法定义
//共享打印方法
// UI组件内部共享方法及成员
// UI组件依赖库
// UI组件创建时共享调用
// UI组件销毁时共享调用
// 原生UI的大小
// #define StructMode // todo:结构体数量查看模式:用条件编译直接全部搞定
//函数入口
// 用原始地图测试
// 用空地图测试
///#include  "edit/Test.j"



///#include  "edit/Huodong.j"

///#include  "edit/NetVersion.j"
///#include  "edit/NetVersion.j"

///#include  "edit/NetVersion.j"

///#include  "edit/Jizi.j"

///#include  "edit/Box.j"
///#include  "edit/NetVersion.j"


///#include  "edit/Diamond.j"



///#include  "edit/Diamond.j"

///#include  "edit/Beast.j"
///#include  "edit/Netversion.j"
///#include  "edit/NetVersion.j"
///#include  "edit/Beast.j"

// 基础
// 高难系数
// 装备属性初始化

// VIP
// 多面板
// 转生
// 黑店

// 宠物有关
///#include  "edit/NetVersion.j"

// 合成装备
///#include  "edit/Beast.j"

// 宝石升级
///#include  "edit/NetVersion.j"

// 属性加成
// 导入基地有关

// 物品技能
///#include  "edit/Continous.j"

///#include  "edit/Purgatory.j"
///#include  "edit/Box.j"

// 翅膀

// 戒指

// 同类型物品
// 皮肤
// 导入英雄

//!import "LHBase.j"
//!import "Spin.j"


///#include  "edit/Pet.j"

// 战斗调整
// 野区
// 秘境
///#include  "edit/NetVersion.j"

// 传承试练
// 马甲模拟
///#include  "edit/NetVersion.j"
///#include  "edit/CenterCredit.j"

// 导入指令
///#include  "edit/Continous.j"

// 学习技能
// 金币系统
// 怪物技能
///#include  "edit/BigBoss.j"
///#include  "edit/Diamond.j"
// 魔兽技能
// 练级场
///#include  "edit/Exercise.j"

// 迷你游戏
// 随机英雄
///#include  "edit/NetVersion.j"
// 狂欢活动
// 连续登录
// 测试文件
/// #include "edit/Debug.j"
/// #include "edit/NotPublic.j"
/// #include "edit/DebugNet.j"
// lua_print: 正式地图
//***************************************************************************
//*
//*  Triggers
//*
//***************************************************************************
//===========================================================================
// Trigger: 简介
//===========================================================================
function Trig_______uActions takes nothing returns nothing
    // 欢迎使用世界编辑器，开始你的地图创造之旅。
    // 你可以从dz.163.com获取最新编辑器咨询。
    // 当你的地图意外损坏时，你可以在backups目录找到你最近26次保存的地图。
    // 任何疑问请加官方作者群：QQ35063417。
    // 本次更新添加判断玩家是否为平台AI玩家，现在平台已经添加虚拟玩家，不用再担心匹配没人问题了！如果你的地图有AI，试试在作者之家开启这个功能吧！
endfunction
//===========================================================================
function InitTrig_______u takes nothing returns nothing
    set gg_trg_______u=CreateTrigger()
    call DoNothing()
    call TriggerAddAction(gg_trg_______u, function Trig_______uActions)
endfunction
//===========================================================================
function InitCustomTriggers takes nothing returns nothing
    call InitTrig_______u()
endfunction
//***************************************************************************
//*
//*  Players
//*
//***************************************************************************
function InitCustomPlayerSlots takes nothing returns nothing
    // Player 0
    call SetPlayerStartLocation(Player(0), 0)
    call ForcePlayerStartLocation(Player(0), 0)
    call SetPlayerColor(Player(0), ConvertPlayerColor(0))
    call SetPlayerRacePreference(Player(0), RACE_PREF_HUMAN)
    call SetPlayerRaceSelectable(Player(0), false)
    call SetPlayerController(Player(0), MAP_CONTROL_USER)
    // Player 1
    call SetPlayerStartLocation(Player(1), 1)
    call ForcePlayerStartLocation(Player(1), 1)
    call SetPlayerColor(Player(1), ConvertPlayerColor(1))
    call SetPlayerRacePreference(Player(1), RACE_PREF_HUMAN)
    call SetPlayerRaceSelectable(Player(1), false)
    call SetPlayerController(Player(1), MAP_CONTROL_USER)
    // Player 2
    call SetPlayerStartLocation(Player(2), 2)
    call ForcePlayerStartLocation(Player(2), 2)
    call SetPlayerColor(Player(2), ConvertPlayerColor(2))
    call SetPlayerRacePreference(Player(2), RACE_PREF_HUMAN)
    call SetPlayerRaceSelectable(Player(2), false)
    call SetPlayerController(Player(2), MAP_CONTROL_USER)
    // Player 3
    call SetPlayerStartLocation(Player(3), 3)
    call ForcePlayerStartLocation(Player(3), 3)
    call SetPlayerColor(Player(3), ConvertPlayerColor(3))
    call SetPlayerRacePreference(Player(3), RACE_PREF_HUMAN)
    call SetPlayerRaceSelectable(Player(3), false)
    call SetPlayerController(Player(3), MAP_CONTROL_USER)
    // Player 4
    call SetPlayerStartLocation(Player(4), 4)
    call ForcePlayerStartLocation(Player(4), 4)
    call SetPlayerColor(Player(4), ConvertPlayerColor(4))
    call SetPlayerRacePreference(Player(4), RACE_PREF_NIGHTELF)
    call SetPlayerRaceSelectable(Player(4), false)
    call SetPlayerController(Player(4), MAP_CONTROL_COMPUTER)
    // Player 5
    call SetPlayerStartLocation(Player(5), 5)
    call ForcePlayerStartLocation(Player(5), 5)
    call SetPlayerColor(Player(5), ConvertPlayerColor(5))
    call SetPlayerRacePreference(Player(5), RACE_PREF_NIGHTELF)
    call SetPlayerRaceSelectable(Player(5), false)
    call SetPlayerController(Player(5), MAP_CONTROL_COMPUTER)
    // Player 6
    call SetPlayerStartLocation(Player(6), 6)
    call ForcePlayerStartLocation(Player(6), 6)
    call SetPlayerColor(Player(6), ConvertPlayerColor(6))
    call SetPlayerRacePreference(Player(6), RACE_PREF_NIGHTELF)
    call SetPlayerRaceSelectable(Player(6), false)
    call SetPlayerController(Player(6), MAP_CONTROL_COMPUTER)
    // Player 7
    call SetPlayerStartLocation(Player(7), 7)
    call ForcePlayerStartLocation(Player(7), 7)
    call SetPlayerColor(Player(7), ConvertPlayerColor(7))
    call SetPlayerRacePreference(Player(7), RACE_PREF_NIGHTELF)
    call SetPlayerRaceSelectable(Player(7), false)
    call SetPlayerController(Player(7), MAP_CONTROL_COMPUTER)
    // Player 8
    call SetPlayerStartLocation(Player(8), 8)
    call ForcePlayerStartLocation(Player(8), 8)
    call SetPlayerColor(Player(8), ConvertPlayerColor(8))
    call SetPlayerRacePreference(Player(8), RACE_PREF_NIGHTELF)
    call SetPlayerRaceSelectable(Player(8), false)
    call SetPlayerController(Player(8), MAP_CONTROL_COMPUTER)
    // Player 9
    call SetPlayerStartLocation(Player(9), 9)
    call ForcePlayerStartLocation(Player(9), 9)
    call SetPlayerColor(Player(9), ConvertPlayerColor(9))
    call SetPlayerRacePreference(Player(9), RACE_PREF_UNDEAD)
    call SetPlayerRaceSelectable(Player(9), false)
    call SetPlayerController(Player(9), MAP_CONTROL_COMPUTER)
    // Player 10
    call SetPlayerStartLocation(Player(10), 10)
    call ForcePlayerStartLocation(Player(10), 10)
    call SetPlayerColor(Player(10), ConvertPlayerColor(10))
    call SetPlayerRacePreference(Player(10), RACE_PREF_UNDEAD)
    call SetPlayerRaceSelectable(Player(10), false)
    call SetPlayerController(Player(10), MAP_CONTROL_COMPUTER)
    // Player 11
    call SetPlayerStartLocation(Player(11), 11)
    call ForcePlayerStartLocation(Player(11), 11)
    call SetPlayerColor(Player(11), ConvertPlayerColor(11))
    call SetPlayerRacePreference(Player(11), RACE_PREF_UNDEAD)
    call SetPlayerRaceSelectable(Player(11), false)
    call SetPlayerController(Player(11), MAP_CONTROL_COMPUTER)
endfunction
function InitCustomTeams takes nothing returns nothing
    // Force: TRIGSTR_013
    call SetPlayerTeam(Player(0), 0)
    call SetPlayerTeam(Player(1), 0)
    call SetPlayerTeam(Player(2), 0)
    call SetPlayerTeam(Player(3), 0)
    call SetPlayerTeam(Player(4), 0)
    call SetPlayerTeam(Player(5), 0)
    call SetPlayerTeam(Player(6), 0)
    call SetPlayerTeam(Player(7), 0)
    call SetPlayerTeam(Player(8), 0)
    //   Allied
    call SetPlayerAllianceStateAllyBJ(Player(0), Player(1), true)
    call SetPlayerAllianceStateAllyBJ(Player(0), Player(2), true)
    call SetPlayerAllianceStateAllyBJ(Player(0), Player(3), true)
    call SetPlayerAllianceStateAllyBJ(Player(0), Player(4), true)
    call SetPlayerAllianceStateAllyBJ(Player(0), Player(5), true)
    call SetPlayerAllianceStateAllyBJ(Player(0), Player(6), true)
    call SetPlayerAllianceStateAllyBJ(Player(0), Player(7), true)
    call SetPlayerAllianceStateAllyBJ(Player(0), Player(8), true)
    call SetPlayerAllianceStateAllyBJ(Player(1), Player(0), true)
    call SetPlayerAllianceStateAllyBJ(Player(1), Player(2), true)
    call SetPlayerAllianceStateAllyBJ(Player(1), Player(3), true)
    call SetPlayerAllianceStateAllyBJ(Player(1), Player(4), true)
    call SetPlayerAllianceStateAllyBJ(Player(1), Player(5), true)
    call SetPlayerAllianceStateAllyBJ(Player(1), Player(6), true)
    call SetPlayerAllianceStateAllyBJ(Player(1), Player(7), true)
    call SetPlayerAllianceStateAllyBJ(Player(1), Player(8), true)
    call SetPlayerAllianceStateAllyBJ(Player(2), Player(0), true)
    call SetPlayerAllianceStateAllyBJ(Player(2), Player(1), true)
    call SetPlayerAllianceStateAllyBJ(Player(2), Player(3), true)
    call SetPlayerAllianceStateAllyBJ(Player(2), Player(4), true)
    call SetPlayerAllianceStateAllyBJ(Player(2), Player(5), true)
    call SetPlayerAllianceStateAllyBJ(Player(2), Player(6), true)
    call SetPlayerAllianceStateAllyBJ(Player(2), Player(7), true)
    call SetPlayerAllianceStateAllyBJ(Player(2), Player(8), true)
    call SetPlayerAllianceStateAllyBJ(Player(3), Player(0), true)
    call SetPlayerAllianceStateAllyBJ(Player(3), Player(1), true)
    call SetPlayerAllianceStateAllyBJ(Player(3), Player(2), true)
    call SetPlayerAllianceStateAllyBJ(Player(3), Player(4), true)
    call SetPlayerAllianceStateAllyBJ(Player(3), Player(5), true)
    call SetPlayerAllianceStateAllyBJ(Player(3), Player(6), true)
    call SetPlayerAllianceStateAllyBJ(Player(3), Player(7), true)
    call SetPlayerAllianceStateAllyBJ(Player(3), Player(8), true)
    call SetPlayerAllianceStateAllyBJ(Player(4), Player(0), true)
    call SetPlayerAllianceStateAllyBJ(Player(4), Player(1), true)
    call SetPlayerAllianceStateAllyBJ(Player(4), Player(2), true)
    call SetPlayerAllianceStateAllyBJ(Player(4), Player(3), true)
    call SetPlayerAllianceStateAllyBJ(Player(4), Player(5), true)
    call SetPlayerAllianceStateAllyBJ(Player(4), Player(6), true)
    call SetPlayerAllianceStateAllyBJ(Player(4), Player(7), true)
    call SetPlayerAllianceStateAllyBJ(Player(4), Player(8), true)
    call SetPlayerAllianceStateAllyBJ(Player(5), Player(0), true)
    call SetPlayerAllianceStateAllyBJ(Player(5), Player(1), true)
    call SetPlayerAllianceStateAllyBJ(Player(5), Player(2), true)
    call SetPlayerAllianceStateAllyBJ(Player(5), Player(3), true)
    call SetPlayerAllianceStateAllyBJ(Player(5), Player(4), true)
    call SetPlayerAllianceStateAllyBJ(Player(5), Player(6), true)
    call SetPlayerAllianceStateAllyBJ(Player(5), Player(7), true)
    call SetPlayerAllianceStateAllyBJ(Player(5), Player(8), true)
    call SetPlayerAllianceStateAllyBJ(Player(6), Player(0), true)
    call SetPlayerAllianceStateAllyBJ(Player(6), Player(1), true)
    call SetPlayerAllianceStateAllyBJ(Player(6), Player(2), true)
    call SetPlayerAllianceStateAllyBJ(Player(6), Player(3), true)
    call SetPlayerAllianceStateAllyBJ(Player(6), Player(4), true)
    call SetPlayerAllianceStateAllyBJ(Player(6), Player(5), true)
    call SetPlayerAllianceStateAllyBJ(Player(6), Player(7), true)
    call SetPlayerAllianceStateAllyBJ(Player(6), Player(8), true)
    call SetPlayerAllianceStateAllyBJ(Player(7), Player(0), true)
    call SetPlayerAllianceStateAllyBJ(Player(7), Player(1), true)
    call SetPlayerAllianceStateAllyBJ(Player(7), Player(2), true)
    call SetPlayerAllianceStateAllyBJ(Player(7), Player(3), true)
    call SetPlayerAllianceStateAllyBJ(Player(7), Player(4), true)
    call SetPlayerAllianceStateAllyBJ(Player(7), Player(5), true)
    call SetPlayerAllianceStateAllyBJ(Player(7), Player(6), true)
    call SetPlayerAllianceStateAllyBJ(Player(7), Player(8), true)
    call SetPlayerAllianceStateAllyBJ(Player(8), Player(0), true)
    call SetPlayerAllianceStateAllyBJ(Player(8), Player(1), true)
    call SetPlayerAllianceStateAllyBJ(Player(8), Player(2), true)
    call SetPlayerAllianceStateAllyBJ(Player(8), Player(3), true)
    call SetPlayerAllianceStateAllyBJ(Player(8), Player(4), true)
    call SetPlayerAllianceStateAllyBJ(Player(8), Player(5), true)
    call SetPlayerAllianceStateAllyBJ(Player(8), Player(6), true)
    call SetPlayerAllianceStateAllyBJ(Player(8), Player(7), true)
    //   Shared Vision
    call SetPlayerAllianceStateVisionBJ(Player(0), Player(1), true)
    call SetPlayerAllianceStateVisionBJ(Player(0), Player(2), true)
    call SetPlayerAllianceStateVisionBJ(Player(0), Player(3), true)
    call SetPlayerAllianceStateVisionBJ(Player(0), Player(4), true)
    call SetPlayerAllianceStateVisionBJ(Player(0), Player(5), true)
    call SetPlayerAllianceStateVisionBJ(Player(0), Player(6), true)
    call SetPlayerAllianceStateVisionBJ(Player(0), Player(7), true)
    call SetPlayerAllianceStateVisionBJ(Player(0), Player(8), true)
    call SetPlayerAllianceStateVisionBJ(Player(1), Player(0), true)
    call SetPlayerAllianceStateVisionBJ(Player(1), Player(2), true)
    call SetPlayerAllianceStateVisionBJ(Player(1), Player(3), true)
    call SetPlayerAllianceStateVisionBJ(Player(1), Player(4), true)
    call SetPlayerAllianceStateVisionBJ(Player(1), Player(5), true)
    call SetPlayerAllianceStateVisionBJ(Player(1), Player(6), true)
    call SetPlayerAllianceStateVisionBJ(Player(1), Player(7), true)
    call SetPlayerAllianceStateVisionBJ(Player(1), Player(8), true)
    call SetPlayerAllianceStateVisionBJ(Player(2), Player(0), true)
    call SetPlayerAllianceStateVisionBJ(Player(2), Player(1), true)
    call SetPlayerAllianceStateVisionBJ(Player(2), Player(3), true)
    call SetPlayerAllianceStateVisionBJ(Player(2), Player(4), true)
    call SetPlayerAllianceStateVisionBJ(Player(2), Player(5), true)
    call SetPlayerAllianceStateVisionBJ(Player(2), Player(6), true)
    call SetPlayerAllianceStateVisionBJ(Player(2), Player(7), true)
    call SetPlayerAllianceStateVisionBJ(Player(2), Player(8), true)
    call SetPlayerAllianceStateVisionBJ(Player(3), Player(0), true)
    call SetPlayerAllianceStateVisionBJ(Player(3), Player(1), true)
    call SetPlayerAllianceStateVisionBJ(Player(3), Player(2), true)
    call SetPlayerAllianceStateVisionBJ(Player(3), Player(4), true)
    call SetPlayerAllianceStateVisionBJ(Player(3), Player(5), true)
    call SetPlayerAllianceStateVisionBJ(Player(3), Player(6), true)
    call SetPlayerAllianceStateVisionBJ(Player(3), Player(7), true)
    call SetPlayerAllianceStateVisionBJ(Player(3), Player(8), true)
    call SetPlayerAllianceStateVisionBJ(Player(4), Player(0), true)
    call SetPlayerAllianceStateVisionBJ(Player(4), Player(1), true)
    call SetPlayerAllianceStateVisionBJ(Player(4), Player(2), true)
    call SetPlayerAllianceStateVisionBJ(Player(4), Player(3), true)
    call SetPlayerAllianceStateVisionBJ(Player(4), Player(5), true)
    call SetPlayerAllianceStateVisionBJ(Player(4), Player(6), true)
    call SetPlayerAllianceStateVisionBJ(Player(4), Player(7), true)
    call SetPlayerAllianceStateVisionBJ(Player(4), Player(8), true)
    call SetPlayerAllianceStateVisionBJ(Player(5), Player(0), true)
    call SetPlayerAllianceStateVisionBJ(Player(5), Player(1), true)
    call SetPlayerAllianceStateVisionBJ(Player(5), Player(2), true)
    call SetPlayerAllianceStateVisionBJ(Player(5), Player(3), true)
    call SetPlayerAllianceStateVisionBJ(Player(5), Player(4), true)
    call SetPlayerAllianceStateVisionBJ(Player(5), Player(6), true)
    call SetPlayerAllianceStateVisionBJ(Player(5), Player(7), true)
    call SetPlayerAllianceStateVisionBJ(Player(5), Player(8), true)
    call SetPlayerAllianceStateVisionBJ(Player(6), Player(0), true)
    call SetPlayerAllianceStateVisionBJ(Player(6), Player(1), true)
    call SetPlayerAllianceStateVisionBJ(Player(6), Player(2), true)
    call SetPlayerAllianceStateVisionBJ(Player(6), Player(3), true)
    call SetPlayerAllianceStateVisionBJ(Player(6), Player(4), true)
    call SetPlayerAllianceStateVisionBJ(Player(6), Player(5), true)
    call SetPlayerAllianceStateVisionBJ(Player(6), Player(7), true)
    call SetPlayerAllianceStateVisionBJ(Player(6), Player(8), true)
    call SetPlayerAllianceStateVisionBJ(Player(7), Player(0), true)
    call SetPlayerAllianceStateVisionBJ(Player(7), Player(1), true)
    call SetPlayerAllianceStateVisionBJ(Player(7), Player(2), true)
    call SetPlayerAllianceStateVisionBJ(Player(7), Player(3), true)
    call SetPlayerAllianceStateVisionBJ(Player(7), Player(4), true)
    call SetPlayerAllianceStateVisionBJ(Player(7), Player(5), true)
    call SetPlayerAllianceStateVisionBJ(Player(7), Player(6), true)
    call SetPlayerAllianceStateVisionBJ(Player(7), Player(8), true)
    call SetPlayerAllianceStateVisionBJ(Player(8), Player(0), true)
    call SetPlayerAllianceStateVisionBJ(Player(8), Player(1), true)
    call SetPlayerAllianceStateVisionBJ(Player(8), Player(2), true)
    call SetPlayerAllianceStateVisionBJ(Player(8), Player(3), true)
    call SetPlayerAllianceStateVisionBJ(Player(8), Player(4), true)
    call SetPlayerAllianceStateVisionBJ(Player(8), Player(5), true)
    call SetPlayerAllianceStateVisionBJ(Player(8), Player(6), true)
    call SetPlayerAllianceStateVisionBJ(Player(8), Player(7), true)
    // Force: TRIGSTR_014
    call SetPlayerTeam(Player(9), 1)
    call SetPlayerTeam(Player(10), 1)
    call SetPlayerTeam(Player(11), 1)
    //   Allied
    call SetPlayerAllianceStateAllyBJ(Player(9), Player(10), true)
    call SetPlayerAllianceStateAllyBJ(Player(9), Player(11), true)
    call SetPlayerAllianceStateAllyBJ(Player(10), Player(9), true)
    call SetPlayerAllianceStateAllyBJ(Player(10), Player(11), true)
    call SetPlayerAllianceStateAllyBJ(Player(11), Player(9), true)
    call SetPlayerAllianceStateAllyBJ(Player(11), Player(10), true)
    //   Shared Vision
    call SetPlayerAllianceStateVisionBJ(Player(9), Player(10), true)
    call SetPlayerAllianceStateVisionBJ(Player(9), Player(11), true)
    call SetPlayerAllianceStateVisionBJ(Player(10), Player(9), true)
    call SetPlayerAllianceStateVisionBJ(Player(10), Player(11), true)
    call SetPlayerAllianceStateVisionBJ(Player(11), Player(9), true)
    call SetPlayerAllianceStateVisionBJ(Player(11), Player(10), true)
endfunction
function InitAllyPriorities takes nothing returns nothing
    call SetStartLocPrioCount(0, 3)
    call SetStartLocPrio(0, 0, 1, MAP_LOC_PRIO_HIGH)
    call SetStartLocPrio(0, 1, 2, MAP_LOC_PRIO_HIGH)
    call SetStartLocPrio(0, 2, 3, MAP_LOC_PRIO_HIGH)
    call SetStartLocPrioCount(1, 3)
    call SetStartLocPrio(1, 0, 0, MAP_LOC_PRIO_HIGH)
    call SetStartLocPrio(1, 1, 2, MAP_LOC_PRIO_HIGH)
    call SetStartLocPrio(1, 2, 3, MAP_LOC_PRIO_HIGH)
    call SetStartLocPrioCount(2, 3)
    call SetStartLocPrio(2, 0, 0, MAP_LOC_PRIO_HIGH)
    call SetStartLocPrio(2, 1, 1, MAP_LOC_PRIO_HIGH)
    call SetStartLocPrio(2, 2, 3, MAP_LOC_PRIO_HIGH)
    call SetStartLocPrioCount(3, 3)
    call SetStartLocPrio(3, 0, 0, MAP_LOC_PRIO_HIGH)
    call SetStartLocPrio(3, 1, 1, MAP_LOC_PRIO_HIGH)
    call SetStartLocPrio(3, 2, 2, MAP_LOC_PRIO_HIGH)
endfunction
//***************************************************************************
//*
//*  Main Initialization
//*
//***************************************************************************
//===========================================================================
function main takes nothing returns nothing
    call initializeLua()
 call SetCameraBounds(- 13568.0 + GetCameraMargin(CAMERA_MARGIN_LEFT), - 13824.0 + GetCameraMargin(CAMERA_MARGIN_BOTTOM), 13568.0 - GetCameraMargin(CAMERA_MARGIN_RIGHT), 13312.0 - GetCameraMargin(CAMERA_MARGIN_TOP), - 13568.0 + GetCameraMargin(CAMERA_MARGIN_LEFT), 13312.0 - GetCameraMargin(CAMERA_MARGIN_TOP), 13568.0 - GetCameraMargin(CAMERA_MARGIN_RIGHT), - 13824.0 + GetCameraMargin(CAMERA_MARGIN_BOTTOM))
    call SetDayNightModels("Environment\\DNC\\DNCLordaeron\\DNCLordaeronTerrain\\DNCLordaeronTerrain.mdl", "Environment\\DNC\\DNCLordaeron\\DNCLordaeronUnit\\DNCLordaeronUnit.mdl")
    call NewSoundEnvironment("Default")
    call SetAmbientDaySound("NorthrendDay")
    call SetAmbientNightSound("NorthrendNight")
    call SetMapMusic("Music", true, 0)
    call CreateRegions()
    call CreateAllUnits()
    call InitBlizzard()

call ExecuteFunc("jasshelper__initstructs22869546")
call ExecuteFunc("YDLua___onInit")
call ExecuteFunc("YDTriggerSaveLoadSystem___Init")
call ExecuteFunc("InitializeYD")
call ExecuteFunc("Constant___InitConstant")
call ExecuteFunc("Logger___onInit")
call ExecuteFunc("YDWETimerPattern___Init")
call ExecuteFunc("YDWETimerSystem___Init")
call ExecuteFunc("LHBase___InitLHBase")
call ExecuteFunc("Attr___InitAttr")
call ExecuteFunc("Exercise__InitExercise")
call ExecuteFunc("Printer___InitPrinter")
call ExecuteFunc("TouristTrap___InitTouristTrap")
call ExecuteFunc("UseItem___InitUse")
call ExecuteFunc("ItemAttr___InitItemAttr")
call ExecuteFunc("Battle___InitBattle")
call ExecuteFunc("ItemBase___InitItemBase")
call ExecuteFunc("LHOther___InitLHOther")
call ExecuteFunc("Beast__InitBeast")
call ExecuteFunc("Continous___InitContinous")
call ExecuteFunc("Purgatory___InitPurgatory")
call ExecuteFunc("SameItem__InitSameItem")
call ExecuteFunc("InitVersion")
call ExecuteFunc("CenterBase__InitCenterBase")
call ExecuteFunc("Diamond___InitDiamond")
call ExecuteFunc("GoldSystem___InitGoldSystem")
call ExecuteFunc("MiniGame__InitMiniGame")
call ExecuteFunc("Multiboard___InitMultiboard")
call ExecuteFunc("Pet___InitPet")
call ExecuteFunc("Ring__InitRing")
call ExecuteFunc("MonsterSpell__InitMonsterSpell")
call ExecuteFunc("Shilian___InitShilian")
call ExecuteFunc("HeroSpellBase__InitHeroSpellBase")
call ExecuteFunc("Juexing___InitJuexing")
call ExecuteFunc("Kuanghuan___InitKuanghuan")
call ExecuteFunc("Revive___InitRevive")
call ExecuteFunc("Boss___InitBoss")
call ExecuteFunc("PIV___InitPIV")
call ExecuteFunc("Arena___InitArena")
call ExecuteFunc("CenterCredit__InitCenterCredit")
call ExecuteFunc("InitHundunInner")
call ExecuteFunc("BaseVersion___InitBaseVersion")
call ExecuteFunc("Combine___InitCombine")
call ExecuteFunc("ItemSpell__InitItemSpell")
call ExecuteFunc("ChatCommand__InitChatCommand")
call ExecuteFunc("Simulate__InitSimulate")

    call InitGlobals()
    call InitCustomTriggers()
endfunction
//***************************************************************************
//*
//*  Map Configuration
//*
//***************************************************************************
function config takes nothing returns nothing
    call SetMapName("TRIGSTR_1232")
    call SetMapDescription("TRIGSTR_1234")
    call SetPlayers(12)
    call SetTeams(12)
    call SetGamePlacement(MAP_PLACEMENT_TEAMS_TOGETHER)
    call DefineStartLocation(0, 0.0, 0.0)
    call DefineStartLocation(1, 0.0, 0.0)
    call DefineStartLocation(2, 0.0, 0.0)
    call DefineStartLocation(3, 0.0, 0.0)
    call DefineStartLocation(4, 0.0, 0.0)
    call DefineStartLocation(5, 0.0, 0.0)
    call DefineStartLocation(6, 0.0, 0.0)
    call DefineStartLocation(7, 0.0, 0.0)
    call DefineStartLocation(8, 0.0, 0.0)
    call DefineStartLocation(9, 0.0, 0.0)
    call DefineStartLocation(10, 0.0, 0.0)
    call DefineStartLocation(11, 0.0, 0.0)
    // Player setup
    call InitCustomPlayerSlots()
    call InitCustomTeams()
    call InitAllyPriorities()
endfunction




//Struct method generated initializers/callers:

//Functions for BigArrays:
function sa__DamageTJ__staticgetindex takes nothing returns boolean
local handle h=f__arg_handle1
set f__result_integer= YDWEGetIntegerByString("damageTJ" , I2S(YDWEH2I(h)))
   return true
endfunction
function sa__DamageTJ_onDestroy takes nothing returns boolean
local integer this=f__arg_this
   local integer i= 1
			call s__DamageTJ_flush(s__DamageTJ_t[this])
			set s__DamageTJ_monitor[this]=null
			loop
				exitwhen i > 6
				set s___DamageTJ_RTongji[s__DamageTJ_RTongji[this]+i]=0
				set i=i + 1
			endloop
			call DestroyTrigger(s__DamageTJ_t[this])
			set s__DamageTJ_t[this]=null
   return true
endfunction
function sa__TianfuForbidder_forbitTimer takes nothing returns boolean

   local integer this= sc__TianfuForbidder__staticgetindex(GetExpiredTimer())
			call ForbidTianfu()
			call PauseTimer(s__TianfuForbidder_t[this])
			call TimerStart(s__TianfuForbidder_t[this], s__TianfuForbidder_IForbid[this], false, function s__TianfuForbidder_allowTimer)
   return true
endfunction
function sa__TianfuForbidder__staticgetindex takes nothing returns boolean
local handle h=f__arg_handle1
set f__result_integer= YDWEGetIntegerByString("SPellBase" , I2S(YDWEH2I(h)))
   return true
endfunction
function sa__TianfuForbidder_onDestroy takes nothing returns boolean
local integer this=f__arg_this
			call s__TianfuForbidder_flush(s__TianfuForbidder_t[this])
			call AllowTianfu()
			set s__TianfuForbidder_IForbid[this]=0
			set s__TianfuForbidder_IAllow[this]=0
			call PauseTimer(s__TianfuForbidder_t[this])
			call DestroyTimer(s__TianfuForbidder_t[this])
			set s__TianfuForbidder_t[this]=null
   return true
endfunction
function sa__Boom_onDestroy takes nothing returns boolean
local integer this=f__arg_this
			call FlushChildHashtable(LHTable, GetHandleId(s__Boom_t[this]))
			call RemoveUnit(s__Boom_caster[this])
			set s__Boom_caster[this]=null
			set s__Boom_x[this]=0.0
			set s__Boom_y[this]=0.0
			set s__Boom_facing[this]=0.0
			set s__Boom_damage[this]=0.0
			set s__Boom_speed[this]=0.0
			set s__Boom_radius[this]=0.0
			set s__Boom_effx[this]=null
			call PauseTimer(s__Boom_t[this])
			call DestroyTimer(s__Boom_t[this])
			set s__Boom_t[this]=null
   return true
endfunction
function sa__JudgeInvu_onDestroy takes nothing returns boolean
local integer this=f__arg_this
			call FlushChildHashtable(LHTable, GetHandleId(s__JudgeInvu_t[this]))
			set s__JudgeInvu_u[this]=null
			call PauseTimer(s__JudgeInvu_t[this])
			call DestroyTimer(s__JudgeInvu_t[this])
			set s__JudgeInvu_t[this]=null
   return true
endfunction
function sa__Buff__staticgetindex takes nothing returns boolean
local handle h=f__arg_handle1
set f__result_integer= YDWEGetIntegerByString("TextTagBind" , I2S(YDWEH2I(h)))
   return true
endfunction
function sa__Buff_onDestroy takes nothing returns boolean
local integer this=f__arg_this
			call s__Buff_flush(s__Buff_t[this])
			set s__Buff_p[this]=null
			set s__Buff_ab[this]=0
			call PauseTimer(s__Buff_t[this])
			call DestroyTimer(s__Buff_t[this])
			set s__Buff_t[this]=null
   return true
endfunction
function sa__TextTagBind__staticgetindex takes nothing returns boolean
local handle h=f__arg_handle1
set f__result_integer= YDWEGetIntegerByString("TextTagBind" , I2S(YDWEH2I(h)))
   return true
endfunction
function sa__TextTagBind_onDestroy takes nothing returns boolean
local integer this=f__arg_this
			call s__TextTagBind_flush(s__TextTagBind_t[this])
			set s__TextTagBind_caster[this]=null
			call DestroyTextTag(s__TextTagBind_tt[this])
			set s__TextTagBind_tt[this]=null
			set s__TextTagBind_xOff[this]=0.
			set s__TextTagBind_yOff[this]=0.
			call PauseTimer(s__TextTagBind_t[this])
			call DestroyTimer(s__TextTagBind_t[this])
			set s__TextTagBind_t[this]=null
   return true
endfunction
function sa__SuperShield__staticgetindex takes nothing returns boolean
local handle h=f__arg_handle1
set f__result_integer= YDWEGetIntegerByString("SPellBase" , I2S(YDWEH2I(h)))
   return true
endfunction
function sa__SuperShield_onDestroy takes nothing returns boolean
local integer this=f__arg_this
			call s__SuperShield_flush(s__SuperShield_t[this])
			set s__SuperShield_caster[this]=null
			call PauseTimer(s__SuperShield_t[this])
			call DestroyTimer(s__SuperShield_t[this])
			set s__SuperShield_t[this]=null
   return true
endfunction
function sa__MultiLife__staticgetindex takes nothing returns boolean
local handle h=f__arg_handle1
set f__result_integer= YDWEGetIntegerByString("SPellBase" , I2S(YDWEH2I(h)))
   return true
endfunction
function sa__MultiLife_onDestroy takes nothing returns boolean
local integer this=f__arg_this
			call s__MultiLife_flush(s__MultiLife_t[this])
			call UnitRemoveAbility(s__MultiLife_caster[this], 'A0KH')
			call DestroyTextTag(s__MultiLife_ttHint[this])
			set s__MultiLife_ttHint[this]=null
			set s__MultiLife_caster[this]=null
			call PauseTimer(s__MultiLife_t[this])
			call DestroyTimer(s__MultiLife_t[this])
			set s__MultiLife_t[this]=null
   return true
endfunction
function sa__Roubang__staticgetindex takes nothing returns boolean
local handle h=f__arg_handle1
set f__result_integer= YDWEGetIntegerByString("SPellBase" , I2S(YDWEH2I(h)))
   return true
endfunction
function sa__Roubang_onDestroy takes nothing returns boolean
local integer this=f__arg_this
   local integer i= 1
			call s__Roubang_flush(s__Roubang_t[this])
			set s__Roubang_caster[this]=null
			loop
				exitwhen i > s__Roubang_number[this]
				if ( s___Roubang_URou[s__Roubang_URou[this]+i] != null ) then
					call RemoveUnit(s___Roubang_URou[s__Roubang_URou[this]+i])
					set s___Roubang_URou[s__Roubang_URou[this]+i]=null
				endif
				set i=i + 1
			endloop
			call PauseTimer(s__Roubang_t[this])
			call DestroyTimer(s__Roubang_t[this])
			set s__Roubang_aSpeed[this]=0.
			set s__Roubang_cAngle[this]=0.
			set s__Roubang_radius[this]=0.
			set s__Roubang_number[this]=0
			set s__Roubang_t[this]=null
   return true
endfunction
function sa__Questions_onDestroy takes nothing returns boolean
local integer this=f__arg_this
			call PauseTimer(s__Questions_t[this])
			call DestroyTimer(s__Questions_t[this])
			call FlushChildHashtable(LHTable, GetHandleId(s__Questions_t[this]))
			set s__Questions_t[this]=null
			set s__Questions_time[this]=0
			set s__Questions_rightPos[this]=0
			call FlushChildHashtable(LHTable, GetHandleId(s__Questions_click[this]))
			call FlushChildHashtable(LHTable, GetHandleId(s__Questions_d[this]))
			call DestroyTrigger(s__Questions_click[this])
	    	call DialogDisplay(s__Questions_p[this], s__Questions_d[this], false)
	        call DialogClear(s__Questions_d[this])
	        call DialogDestroy(s__Questions_d[this])
			set s__Questions_click[this]=null
			set s__Questions_p[this]=null
			set s__Questions_question[this]=null
			set s__Questions_d[this]=null
   return true
endfunction
function sa__Missile__staticgetindex takes nothing returns boolean
local handle h=f__arg_handle1
set f__result_integer= YDWEGetIntegerByString("SPellBase" , I2S(YDWEH2I(h)))
   return true
endfunction
function sa__Missile_onDestroy takes nothing returns boolean
local integer this=f__arg_this
			call s__Missile_flush(s__Missile_t[this])
			set s__Missile_caster[this]=null
			call PauseTimer(s__Missile_t[this])
			call DestroyTimer(s__Missile_t[this])
			set s__Missile_t[this]=null
   return true
endfunction
function sa__Attract__staticgetindex takes nothing returns boolean
local handle h=f__arg_handle1
set f__result_integer= YDWEGetIntegerByString("SPellBase" , I2S(YDWEH2I(h)))
   return true
endfunction
function sa__Attract_onDestroy takes nothing returns boolean
local integer this=f__arg_this
			call s__Attract_flush(s__Attract_t[this])
			set s__Attract_caster[this]=null
			call PauseTimer(s__Attract_t[this])
			call DestroyTimer(s__Attract_t[this])
			set s__Attract_t[this]=null
   return true
endfunction
function sa__Connect__staticgetindex takes nothing returns boolean
local handle h=f__arg_handle1
set f__result_integer= YDWEGetIntegerByString("SpellBase" , I2S(YDWEH2I(h)))
   return true
endfunction
function sa__Connect_onDestroy takes nothing returns boolean
local integer this=f__arg_this
			call s__Connect_flush(s__Connect_t[this])
			set s__Connect_unit1[this]=null
			set s__Connect_unit2[this]=null
			call DestroyLightningBJ(s__Connect_l[this])
			set s__Connect_l[this]=null
			call PauseTimer(s__Connect_t[this])
			call DestroyTimer(s__Connect_t[this])
			set s__Connect_t[this]=null
   return true
endfunction
function sa__OnlyAttackBase__staticgetindex takes nothing returns boolean
local handle h=f__arg_handle1
set f__result_integer= YDWEGetIntegerByString("SpellBase" , I2S(YDWEH2I(h)))
   return true
endfunction
function sa__OnlyAttackBase_onDestroy takes nothing returns boolean
local integer this=f__arg_this
			call s__OnlyAttackBase_flush(s__OnlyAttackBase_t[this])
			set s__OnlyAttackBase_u[this]=null
			call PauseTimer(s__OnlyAttackBase_t[this])
			call DestroyTimer(s__OnlyAttackBase_t[this])
			set s__OnlyAttackBase_t[this]=null
   return true
endfunction
function sa__YDWETimerPattern___Thread_onDestroy takes nothing returns boolean
local integer this=f__arg_this
            call s__YDWETimerPattern___Thread_flush(s__YDWETimerPattern___Thread_obj[this])
            call s__YDWETimerPattern___Thread_flush(s__YDWETimerPattern___Thread_t[this])
            call GroupClear(s__YDWETimerPattern___Thread_g[this])
            call DestroyGroup(s__YDWETimerPattern___Thread_g[this])
            call PauseTimer(s__YDWETimerPattern___Thread_t[this])
            call DestroyTimer(s__YDWETimerPattern___Thread_t[this])
            call s__YDWETimerPattern___YDVector3_deallocate(s__YDWETimerPattern___Thread_des[this])
            call s__YDWETimerPattern___YDVector3_deallocate(s__YDWETimerPattern___Thread_pos[this])
            call s__YDWETimerPattern___YDVector3_deallocate(s__YDWETimerPattern___Thread_vel[this])
            set s__YDWETimerPattern___Thread_caster[this]=null
            set s__YDWETimerPattern___Thread_target[this]=null
            set s__YDWETimerPattern___Thread_obj[this]=null
            set s__YDWETimerPattern___Thread_g[this]=null
            set s__YDWETimerPattern___Thread_t[this]=null
            set s__YDWETimerPattern___Thread_amount[this]=0
            set s__YDWETimerPattern___Thread_skills[this]=0
            set s__YDWETimerPattern___Thread_order[this]=0
            set s__YDWETimerPattern___Thread_afc[this]=0
            set s__YDWETimerPattern___Thread_dsfx[this]=""
            set s__YDWETimerPattern___Thread_gsfx[this]=""
            set s__YDWETimerPattern___Thread_wsfx[this]=""
            set s__YDWETimerPattern___Thread_part[this]=""
   return true
endfunction
function sa___prototype223_YDWETimerPattern___Rebound takes nothing returns boolean
 local integer t=f__arg_integer1
 local real nx=f__arg_real1
 local real ny=f__arg_real2

        if not ( IsTerrainPathable(nx, s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_pos[t]], PATHING_TYPE_WALKABILITY) ) then
            set s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_vel[t]]=- 1 * s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_vel[t]]
        elseif not ( IsTerrainPathable(s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_pos[t]], ny, PATHING_TYPE_WALKABILITY) ) then
            set s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_vel[t]]=- 1 * s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_vel[t]]
        else
            set s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_vel[t]]=- 1 * s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_vel[t]]
            set s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_vel[t]]=- 1 * s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_vel[t]]
        endif
        call GroupClear(s__YDWETimerPattern___Thread_g[t])
        call SetUnitFacing(s__YDWETimerPattern___Thread_obj[t], Atan2BJ(s__YDWETimerPattern___YDVector3_y[s__YDWETimerPattern___Thread_vel[t]], s__YDWETimerPattern___YDVector3_x[s__YDWETimerPattern___Thread_vel[t]]))
    return true
endfunction
function sa___prototype261_Jizi___AfterMoneyBuffTime takes nothing returns boolean
 local player p=f__arg_player1

		call AddMoneyPercent(GetConvertedPlayerId(p) , - 1.0)
		call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r月饼给你提供的金钱时间到了.")
    return true
endfunction
function sa___prototype261_Jizi___AfterSpellBuffTime takes nothing returns boolean
 local player p=f__arg_player1

		call AddSpellPercent(GetConvertedPlayerId(p) , - 0.5)
		call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r月饼给你提供的技能伤害时间到了.")
    return true
endfunction
function sa___prototype261_Jizi___AfterReviveBuffTime takes nothing returns boolean
 local player p=f__arg_player1

		set B3SecondRevive[GetConvertedPlayerId(p)]=false
		call DisplayTextToPlayer(p, 0., 0., "|cFFFF66CC【消息】|r月饼给你提供的3秒复活时间到了.")
    return true
endfunction
function sa___prototype51_CreateCDialog2 takes nothing returns boolean

     local trigger t= CreateTrigger()
     local dialog d= DialogCreate()
     local integer i= 1
	    if ( CDiff == 1 ) then
	    	call DialogSetMessage(d, "选择挑战类别(简单)")
	    elseif ( CDiff == 2 ) then
	    	call DialogSetMessage(d, "选择挑战类别(中等)")
	    elseif ( CDiff == 3 ) then
	    	call DialogSetMessage(d, "选择挑战类别(困难)")
	    endif
	    call SaveButtonHandle(LHTable, GetHandleId(d), 7, DialogAddButtonBJ(d, GetChallangerTitle(7) + S3(IsChallangerComplete(GetFirstPlayer() , 7) , "|cffff9900(已完成)|r" , "|cff33cccc(未完成)|r")))
	    loop
	    	exitwhen i > 6
		    call SaveButtonHandle(LHTable, GetHandleId(d), i, DialogAddButtonBJ(d, GetChallangerTitle(i) + S3(IsChallangerComplete(GetFirstPlayer() , i) , "|cffff9900(已完成)|r" , "|cff33cccc(未完成)|r")))
	    	set i=i + 1
	    endloop
    	call SaveButtonHandle(LHTable, GetHandleId(d), 10, DialogAddButton(d, "返回|cffff6800(Esc)|r", 512))
	    call DialogDisplay(GetFirstPlayer(), d, true)
	    call TriggerRegisterDialogEvent(t, d)
	    call TriggerAddAction(t, function ChallangerMode___ChooseChallangerClick)
	    set d=null
	    set t=null
    return true
endfunction
function sa___prototype51_CreateCDialog1 takes nothing returns boolean

     local trigger t= CreateTrigger()
     local dialog d= DialogCreate()
	    call DialogSetMessage(d, "选择挑战难度")
	    if ( true ) then
		    call SaveButtonHandle(LHTable, GetHandleId(d), 1, DialogAddButtonBJ(d, "简单(" + I2S(GetEasyComplete(GetFirstPlayer())) + "/" + I2S(COUNT_CHALLANGER) + ")"))
		    call SaveButtonHandle(LHTable, GetHandleId(d), 2, DialogAddButtonBJ(d, "中等(" + I2S(GetMiddleComplete(GetFirstPlayer())) + "/" + I2S(COUNT_CHALLANGER) + ")"))
		    call SaveButtonHandle(LHTable, GetHandleId(d), 3, DialogAddButtonBJ(d, "困难(" + I2S(GetHardComplete(GetFirstPlayer())) + "/" + I2S(COUNT_CHALLANGER) + ")"))
		else
			call SaveButtonHandle(LHTable, GetHandleId(d), 1, DialogAddButtonBJ(d, "简单"))
		    call SaveButtonHandle(LHTable, GetHandleId(d), 2, DialogAddButtonBJ(d, "中等"))
		    call SaveButtonHandle(LHTable, GetHandleId(d), 3, DialogAddButtonBJ(d, "困难"))
	    endif
	    call DialogDisplay(GetFirstPlayer(), d, true)
	    call TriggerRegisterDialogEvent(t, d)
	    call TriggerAddAction(t, function ChallangerMode___ChooseDifficultyClick)
	    set d=null
	    set t=null
    return true
endfunction
function sa___prototype51_Boss___AfterQuestionSucceed takes nothing returns boolean

		if ( IsUnitAliveBJ(UGhost) ) then
	    	call RecoverUnitHP(UGhost , - 0.1)
		endif
		if ( IsUnitAliveBJ(UAngle) ) then
	    	call RecoverUnitHP(UAngle , - 0.1)
		endif
   set IKongshen=IKongshen + 1
		if ( IKongshen >= 30 ) then
    call SaveAllPlayerAchievement(415)
		elseif ( ModuloInteger(IKongshen, 5) == 0 ) then
			call BJDebugMsg("|cFFFF66CC【消息】|r你们总共答对了" + I2S(IKongshen) + "道题.")
		endif
    return true
endfunction
function sa___prototype189_Boss___AfterBossLessLife takes nothing returns boolean
    call Boss___AfterBossLessLife(f__arg_unit1)
    return true
endfunction
function sa___prototype189_Hundun___Hundun2SetLifeLess takes nothing returns boolean
    call Hundun___Hundun2SetLifeLess(f__arg_unit1)
    return true
endfunction

function jasshelper__initstructs22869546 takes nothing returns nothing
    set st__DamageTJ__staticgetindex=CreateTrigger()
    call TriggerAddCondition(st__DamageTJ__staticgetindex,Condition( function sa__DamageTJ__staticgetindex))
    set st__DamageTJ_onDestroy=CreateTrigger()
    call TriggerAddCondition(st__DamageTJ_onDestroy,Condition( function sa__DamageTJ_onDestroy))
    set st__TianfuForbidder_forbitTimer=CreateTrigger()
    call TriggerAddCondition(st__TianfuForbidder_forbitTimer,Condition( function sa__TianfuForbidder_forbitTimer))
    set st__TianfuForbidder__staticgetindex=CreateTrigger()
    call TriggerAddCondition(st__TianfuForbidder__staticgetindex,Condition( function sa__TianfuForbidder__staticgetindex))
    set st__TianfuForbidder_onDestroy=CreateTrigger()
    call TriggerAddCondition(st__TianfuForbidder_onDestroy,Condition( function sa__TianfuForbidder_onDestroy))
    set st__Boom_onDestroy=CreateTrigger()
    call TriggerAddCondition(st__Boom_onDestroy,Condition( function sa__Boom_onDestroy))
    set st__JudgeInvu_onDestroy=CreateTrigger()
    call TriggerAddCondition(st__JudgeInvu_onDestroy,Condition( function sa__JudgeInvu_onDestroy))
    set st__Buff__staticgetindex=CreateTrigger()
    call TriggerAddCondition(st__Buff__staticgetindex,Condition( function sa__Buff__staticgetindex))
    set st__Buff_onDestroy=CreateTrigger()
    call TriggerAddCondition(st__Buff_onDestroy,Condition( function sa__Buff_onDestroy))
    set st__TextTagBind__staticgetindex=CreateTrigger()
    call TriggerAddCondition(st__TextTagBind__staticgetindex,Condition( function sa__TextTagBind__staticgetindex))
    set st__TextTagBind_onDestroy=CreateTrigger()
    call TriggerAddCondition(st__TextTagBind_onDestroy,Condition( function sa__TextTagBind_onDestroy))
    set st__SuperShield__staticgetindex=CreateTrigger()
    call TriggerAddCondition(st__SuperShield__staticgetindex,Condition( function sa__SuperShield__staticgetindex))
    set st__SuperShield_onDestroy=CreateTrigger()
    call TriggerAddCondition(st__SuperShield_onDestroy,Condition( function sa__SuperShield_onDestroy))
    set st__MultiLife__staticgetindex=CreateTrigger()
    call TriggerAddCondition(st__MultiLife__staticgetindex,Condition( function sa__MultiLife__staticgetindex))
    set st__MultiLife_onDestroy=CreateTrigger()
    call TriggerAddCondition(st__MultiLife_onDestroy,Condition( function sa__MultiLife_onDestroy))
    set st__Roubang__staticgetindex=CreateTrigger()
    call TriggerAddCondition(st__Roubang__staticgetindex,Condition( function sa__Roubang__staticgetindex))
    set st__Roubang_onDestroy=CreateTrigger()
    call TriggerAddCondition(st__Roubang_onDestroy,Condition( function sa__Roubang_onDestroy))
    set st__Questions_onDestroy=CreateTrigger()
    call TriggerAddCondition(st__Questions_onDestroy,Condition( function sa__Questions_onDestroy))
    set st__Missile__staticgetindex=CreateTrigger()
    call TriggerAddCondition(st__Missile__staticgetindex,Condition( function sa__Missile__staticgetindex))
    set st__Missile_onDestroy=CreateTrigger()
    call TriggerAddCondition(st__Missile_onDestroy,Condition( function sa__Missile_onDestroy))
    set st__Attract__staticgetindex=CreateTrigger()
    call TriggerAddCondition(st__Attract__staticgetindex,Condition( function sa__Attract__staticgetindex))
    set st__Attract_onDestroy=CreateTrigger()
    call TriggerAddCondition(st__Attract_onDestroy,Condition( function sa__Attract_onDestroy))
    set st__Connect__staticgetindex=CreateTrigger()
    call TriggerAddCondition(st__Connect__staticgetindex,Condition( function sa__Connect__staticgetindex))
    set st__Connect_onDestroy=CreateTrigger()
    call TriggerAddCondition(st__Connect_onDestroy,Condition( function sa__Connect_onDestroy))
    set st__OnlyAttackBase__staticgetindex=CreateTrigger()
    call TriggerAddCondition(st__OnlyAttackBase__staticgetindex,Condition( function sa__OnlyAttackBase__staticgetindex))
    set st__OnlyAttackBase_onDestroy=CreateTrigger()
    call TriggerAddCondition(st__OnlyAttackBase_onDestroy,Condition( function sa__OnlyAttackBase_onDestroy))
    set st__YDWETimerPattern___Thread_onDestroy[5]=CreateTrigger()
    set st__YDWETimerPattern___Thread_onDestroy[6]=st__YDWETimerPattern___Thread_onDestroy[5]
    set st__YDWETimerPattern___Thread_onDestroy[7]=st__YDWETimerPattern___Thread_onDestroy[5]
    set st__YDWETimerPattern___Thread_onDestroy[8]=st__YDWETimerPattern___Thread_onDestroy[5]
    call TriggerAddCondition(st__YDWETimerPattern___Thread_onDestroy[5],Condition( function sa__YDWETimerPattern___Thread_onDestroy))
    set st___prototype223[1]=CreateTrigger()
    call TriggerAddAction(st___prototype223[1],function sa___prototype223_YDWETimerPattern___Rebound)
    call TriggerAddCondition(st___prototype223[1],Condition(function sa___prototype223_YDWETimerPattern___Rebound))
    set st___prototype261[1]=CreateTrigger()
    call TriggerAddAction(st___prototype261[1],function sa___prototype261_Jizi___AfterMoneyBuffTime)
    call TriggerAddCondition(st___prototype261[1],Condition(function sa___prototype261_Jizi___AfterMoneyBuffTime))
    set st___prototype261[2]=CreateTrigger()
    call TriggerAddAction(st___prototype261[2],function sa___prototype261_Jizi___AfterSpellBuffTime)
    call TriggerAddCondition(st___prototype261[2],Condition(function sa___prototype261_Jizi___AfterSpellBuffTime))
    set st___prototype261[3]=CreateTrigger()
    call TriggerAddAction(st___prototype261[3],function sa___prototype261_Jizi___AfterReviveBuffTime)
    call TriggerAddCondition(st___prototype261[3],Condition(function sa___prototype261_Jizi___AfterReviveBuffTime))
    set st___prototype51[1]=CreateTrigger()
    call TriggerAddAction(st___prototype51[1],function sa___prototype51_CreateCDialog2)
    call TriggerAddCondition(st___prototype51[1],Condition(function sa___prototype51_CreateCDialog2))
    set st___prototype51[2]=CreateTrigger()
    call TriggerAddAction(st___prototype51[2],function sa___prototype51_CreateCDialog1)
    call TriggerAddCondition(st___prototype51[2],Condition(function sa___prototype51_CreateCDialog1))
    set st___prototype51[3]=CreateTrigger()
    call TriggerAddAction(st___prototype51[3],function sa___prototype51_Boss___AfterQuestionSucceed)
    call TriggerAddCondition(st___prototype51[3],Condition(function sa___prototype51_Boss___AfterQuestionSucceed))
    set st___prototype189[1]=CreateTrigger()
    call TriggerAddAction(st___prototype189[1],function sa___prototype189_Boss___AfterBossLessLife)
    call TriggerAddCondition(st___prototype189[1],Condition(function sa___prototype189_Boss___AfterBossLessLife))
    set st___prototype189[2]=CreateTrigger()
    call TriggerAddAction(st___prototype189[2],function sa___prototype189_Hundun___Hundun2SetLifeLess)
    call TriggerAddCondition(st___prototype189[2],Condition(function sa___prototype189_Hundun___Hundun2SetLifeLess))































    call ExecuteFunc("s__music_onInit")
endfunction

